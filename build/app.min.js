var CLM=function(e){var t={};function r(i){if(t[i]){return t[i].exports}var a=t[i]={i,l:false,exports:{}};e[i].call(a.exports,a,a.exports,r);a.l=true;return a.exports}r.m=e;r.c=t;r.d=function(e,t,i){if(!r.o(e,t)){Object.defineProperty(e,t,{enumerable:true,get:i})}};r.r=function(e){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(e,"__esModule",{value:true})};r.t=function(e,t){if(t&1)e=r(e);if(t&8)return e;if(t&4&&typeof e==="object"&&e&&e.__esModule)return e;var i=Object.create(null);r.r(i);Object.defineProperty(i,"default",{enumerable:true,value:e});if(t&2&&typeof e!="string")for(var a in e)r.d(i,a,function(t){return e[t]}.bind(null,a));return i};r.n=function(e){var t=e&&e.__esModule?function t(){return e["default"]}:function t(){return e};r.d(t,"a",t);return t};r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};r.p="";return r(r.s=11)}([function(e,t){THREE.Sky=function(){var e=THREE.Sky.SkyShader;var t=new THREE.ShaderMaterial({fragmentShader:e.fragmentShader,vertexShader:e.vertexShader,uniforms:THREE.UniformsUtils.clone(e.uniforms),side:THREE.BackSide});THREE.Mesh.call(this,new THREE.BoxBufferGeometry(1,1,1),t)};THREE.Sky.prototype=Object.create(THREE.Mesh.prototype);THREE.Sky.SkyShader={uniforms:{luminance:{value:1},turbidity:{value:11.7},rayleigh:{value:2},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new THREE.Vector3}},vertexShader:["uniform vec3 sunPosition;","uniform float rayleigh;","uniform float turbidity;","uniform float mieCoefficient;","varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","const vec3 up = vec3( 0.0, 1.0, 0.0 );","const float e = 2.71828182845904523536028747135266249775724709369995957;","const float pi = 3.141592653589793238462643383279502884197169;","const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );","const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );","const float v = 4.0;","const vec3 K = vec3( 0.686, 0.678, 0.666 );","const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );","const float cutoffAngle = 1.6110731556870734;","const float steepness = 1.5;","const float EE = 1000.0;","float sunIntensity( float zenithAngleCos ) {","\tzenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );","\treturn EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );","}","vec3 totalMie( float T ) {","\tfloat c = ( 0.2 * T ) * 10E-18;","\treturn 0.434 * c * MieConst;","}","void main() {","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tvWorldPosition = worldPosition.xyz;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","\tgl_Position.z = gl_Position.w;","\tvSunDirection = normalize( sunPosition );","\tvSunE = sunIntensity( dot( vSunDirection, up ) );","\tvSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );","\tfloat rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );","\tvBetaR = totalRayleigh * rayleighCoefficient;","\tvBetaM = totalMie( turbidity ) * mieCoefficient;","}"].join("\n"),fragmentShader:["varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","uniform float luminance;","uniform float mieDirectionalG;","const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );","const float pi = 3.141592653589793238462643383279502884197169;","const float n = 1.0003;","const float N = 2.545E25;","const float rayleighZenithLength = 8.4E3;","const float mieZenithLength = 1.25E3;","const vec3 up = vec3( 0.0, 1.0, 0.0 );","const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;","const float THREE_OVER_SIXTEENPI = 0.05968310365946075;","const float ONE_OVER_FOURPI = 0.07957747154594767;","float rayleighPhase( float cosTheta ) {","\treturn THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );","}","float hgPhase( float cosTheta, float g ) {","\tfloat g2 = pow( g, 2.0 );","\tfloat inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );","\treturn ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );","}","const float A = 0.15;","const float B = 0.50;","const float C = 0.10;","const float D = 0.20;","const float E = 0.02;","const float F = 0.30;","const float whiteScale = 1.0748724675633854;","vec3 Uncharted2Tonemap( vec3 x ) {","\treturn ( ( x * ( A * x + C * B ) + D * E ) / ( x * ( A * x + B ) + D * F ) ) - E / F;","}","void main() {","\tfloat zenithAngle = acos( max( 0.0, dot( up, normalize( vWorldPosition - cameraPos ) ) ) );","\tfloat inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );","\tfloat sR = rayleighZenithLength * inverse;","\tfloat sM = mieZenithLength * inverse;","\tvec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );","\tfloat cosTheta = dot( normalize( vWorldPosition - cameraPos ), vSunDirection );","\tfloat rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );","\tvec3 betaRTheta = vBetaR * rPhase;","\tfloat mPhase = hgPhase( cosTheta, mieDirectionalG );","\tvec3 betaMTheta = vBetaM * mPhase;","\tvec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );","\tLin *= mix(vec3(1.0), pow(vSunE * ((betaRTheta + betaMTheta) / (vBetaR + vBetaM)) * Fex, vec3(1.0 / 2.0)), clamp(pow(1.0 - dot(up, vSunDirection), 5.0), 0.0, 1.0));","\tvec3 direction = normalize( vWorldPosition - cameraPos );","\tfloat theta = acos( direction.y ); // elevation --\x3e y-axis, [-pi/2, pi/2]","\tfloat phi = atan( direction.z, direction.x ); // azimuth --\x3e x-axis [-pi/2, pi/2]","\tvec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );","\tvec3 L0 = vec3( 0.1 ) * Fex;","\tvec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );","\tvec3 curr = Uncharted2Tonemap( ( log2( 2.0 / pow( luminance, 4.0 ) ) ) * texColor );","\tvec3 color = curr * whiteScale;","\tvec3 retColor = pow( color, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );","\tgl_FragColor = vec4( retColor, 1.0 );","}"].join("\n")}},function(e,t){THREE.CopyShader={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","gl_FragColor = opacity * texel;","}"].join("\n")}},function(e,t){THREE.EffectComposer=function(e,t){this.renderer=e;if(t===undefined){var r={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,stencilBuffer:false};var i=e.getDrawingBufferSize();t=new THREE.WebGLRenderTarget(i.width,i.height,r);t.texture.name="EffectComposer.rt1"}this.renderTarget1=t;this.renderTarget2=t.clone();this.renderTarget2.texture.name="EffectComposer.rt2";this.writeBuffer=this.renderTarget1;this.readBuffer=this.renderTarget2;this.passes=[];if(THREE.CopyShader===undefined){console.error("THREE.EffectComposer relies on THREE.CopyShader")}if(THREE.ShaderPass===undefined){console.error("THREE.EffectComposer relies on THREE.ShaderPass")}this.copyPass=new THREE.ShaderPass(THREE.CopyShader)};Object.assign(THREE.EffectComposer.prototype,{swapBuffers:function(){var e=this.readBuffer;this.readBuffer=this.writeBuffer;this.writeBuffer=e},addPass:function(e){this.passes.push(e);var t=this.renderer.getDrawingBufferSize();e.setSize(t.width,t.height)},insertPass:function(e,t){this.passes.splice(t,0,e)},render:function(e){var t=false;var r,i,a=this.passes.length;for(i=0;i<a;i++){r=this.passes[i];if(r.enabled===false)continue;r.render(this.renderer,this.writeBuffer,this.readBuffer,e,t);if(r.needsSwap){if(t){var s=this.renderer.context;s.stencilFunc(s.NOTEQUAL,1,4294967295);this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e);s.stencilFunc(s.EQUAL,1,4294967295)}this.swapBuffers()}if(THREE.MaskPass!==undefined){if(r instanceof THREE.MaskPass){t=true}else if(r instanceof THREE.ClearMaskPass){t=false}}}},reset:function(e){if(e===undefined){var t=this.renderer.getDrawingBufferSize();e=this.renderTarget1.clone();e.setSize(t.width,t.height)}this.renderTarget1.dispose();this.renderTarget2.dispose();this.renderTarget1=e;this.renderTarget2=e.clone();this.writeBuffer=this.renderTarget1;this.readBuffer=this.renderTarget2},setSize:function(e,t){this.renderTarget1.setSize(e,t);this.renderTarget2.setSize(e,t);for(var r=0;r<this.passes.length;r++){this.passes[r].setSize(e,t)}}});THREE.Pass=function(){this.enabled=true;this.needsSwap=true;this.clear=false;this.renderToScreen=false};Object.assign(THREE.Pass.prototype,{setSize:function(e,t){},render:function(e,t,r,i,a){console.error("THREE.Pass: .render() must be implemented in derived pass.")}})},function(e,t){THREE.LuminosityHighPassShader={shaderID:"luminosityHighPass",uniforms:{tDiffuse:{type:"t",value:null},luminosityThreshold:{type:"f",value:1},smoothWidth:{type:"f",value:1},defaultColor:{type:"c",value:new THREE.Color(0)},defaultOpacity:{type:"f",value:0}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec3 defaultColor;","uniform float defaultOpacity;","uniform float luminosityThreshold;","uniform float smoothWidth;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","vec3 luma = vec3( 0.299, 0.587, 0.114 );","float v = dot( texel.xyz, luma );","vec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );","float alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );","gl_FragColor = mix( outputColor, texel, alpha );","}"].join("\n")}},function(e,t){THREE.RenderPass=function(e,t,r,i,a){THREE.Pass.call(this);this.scene=e;this.camera=t;this.overrideMaterial=r;this.clearColor=i;this.clearAlpha=a!==undefined?a:0;this.clear=true;this.clearDepth=false;this.needsSwap=false};THREE.RenderPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.RenderPass,render:function(e,t,r,i,a){var s=e.autoClear;e.autoClear=false;this.scene.overrideMaterial=this.overrideMaterial;var n,o;if(this.clearColor){n=e.getClearColor().getHex();o=e.getClearAlpha();e.setClearColor(this.clearColor,this.clearAlpha)}if(this.clearDepth){e.clearDepth()}e.render(this.scene,this.camera,this.renderToScreen?null:r,this.clear);if(this.clearColor){e.setClearColor(n,o)}this.scene.overrideMaterial=null;e.autoClear=s}})},function(e,t){THREE.ShaderPass=function(e,t){THREE.Pass.call(this);this.textureID=t!==undefined?t:"tDiffuse";if(e instanceof THREE.ShaderMaterial){this.uniforms=e.uniforms;this.material=e}else if(e){this.uniforms=THREE.UniformsUtils.clone(e.uniforms);this.material=new THREE.ShaderMaterial({defines:e.defines||{},uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})}this.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1);this.scene=new THREE.Scene;this.quad=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),null);this.quad.frustumCulled=false;this.scene.add(this.quad)};THREE.ShaderPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.ShaderPass,render:function(e,t,r,i,a){if(this.uniforms[this.textureID]){this.uniforms[this.textureID].value=r.texture}this.quad.material=this.material;if(this.renderToScreen){e.render(this.scene,this.camera)}else{e.render(this.scene,this.camera,t,this.clear)}}})},function(e,t){THREE.UnrealBloomPass=function(e,t,r,i){THREE.Pass.call(this);this.strength=t!==undefined?t:1;this.radius=r;this.threshold=i;this.resolution=e!==undefined?new THREE.Vector2(e.x,e.y):new THREE.Vector2(256,256);var a={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat};this.renderTargetsHorizontal=[];this.renderTargetsVertical=[];this.nMips=5;var s=Math.round(this.resolution.x/2);var n=Math.round(this.resolution.y/2);this.renderTargetBright=new THREE.WebGLRenderTarget(s,n,a);this.renderTargetBright.texture.name="UnrealBloomPass.bright";this.renderTargetBright.texture.generateMipmaps=false;for(var o=0;o<this.nMips;o++){var l=new THREE.WebGLRenderTarget(s,n,a);l.texture.name="UnrealBloomPass.h"+o;l.texture.generateMipmaps=false;this.renderTargetsHorizontal.push(l);var l=new THREE.WebGLRenderTarget(s,n,a);l.texture.name="UnrealBloomPass.v"+o;l.texture.generateMipmaps=false;this.renderTargetsVertical.push(l);s=Math.round(s/2);n=Math.round(n/2)}if(THREE.LuminosityHighPassShader===undefined)console.error("THREE.UnrealBloomPass relies on THREE.LuminosityHighPassShader");var h=THREE.LuminosityHighPassShader;this.highPassUniforms=THREE.UniformsUtils.clone(h.uniforms);this.highPassUniforms["luminosityThreshold"].value=i;this.highPassUniforms["smoothWidth"].value=.01;this.materialHighPassFilter=new THREE.ShaderMaterial({uniforms:this.highPassUniforms,vertexShader:h.vertexShader,fragmentShader:h.fragmentShader,defines:{}});this.separableBlurMaterials=[];var c=[3,5,7,9,11];var s=Math.round(this.resolution.x/2);var n=Math.round(this.resolution.y/2);for(var o=0;o<this.nMips;o++){this.separableBlurMaterials.push(this.getSeperableBlurMaterial(c[o]));this.separableBlurMaterials[o].uniforms["texSize"].value=new THREE.Vector2(s,n);s=Math.round(s/2);n=Math.round(n/2)}this.compositeMaterial=this.getCompositeMaterial(this.nMips);this.compositeMaterial.uniforms["blurTexture1"].value=this.renderTargetsVertical[0].texture;this.compositeMaterial.uniforms["blurTexture2"].value=this.renderTargetsVertical[1].texture;this.compositeMaterial.uniforms["blurTexture3"].value=this.renderTargetsVertical[2].texture;this.compositeMaterial.uniforms["blurTexture4"].value=this.renderTargetsVertical[3].texture;this.compositeMaterial.uniforms["blurTexture5"].value=this.renderTargetsVertical[4].texture;this.compositeMaterial.uniforms["bloomStrength"].value=t;this.compositeMaterial.uniforms["bloomRadius"].value=.1;this.compositeMaterial.needsUpdate=true;var u=[1,.8,.6,.4,.2];this.compositeMaterial.uniforms["bloomFactors"].value=u;this.bloomTintColors=[new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1)];this.compositeMaterial.uniforms["bloomTintColors"].value=this.bloomTintColors;if(THREE.CopyShader===undefined){console.error("THREE.BloomPass relies on THREE.CopyShader")}var p=THREE.CopyShader;this.copyUniforms=THREE.UniformsUtils.clone(p.uniforms);this.copyUniforms["opacity"].value=1;this.materialCopy=new THREE.ShaderMaterial({uniforms:this.copyUniforms,vertexShader:p.vertexShader,fragmentShader:p.fragmentShader,blending:THREE.AdditiveBlending,depthTest:false,depthWrite:false,transparent:true});this.enabled=true;this.needsSwap=false;this.oldClearColor=new THREE.Color;this.oldClearAlpha=1;this.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1);this.scene=new THREE.Scene;this.basic=new THREE.MeshBasicMaterial;this.quad=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),null);this.quad.frustumCulled=false;this.scene.add(this.quad)};THREE.UnrealBloomPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.UnrealBloomPass,dispose:function(){for(var e=0;e<this.renderTargetsHorizontal.length;e++){this.renderTargetsHorizontal[e].dispose()}for(var e=0;e<this.renderTargetsVertical.length;e++){this.renderTargetsVertical[e].dispose()}this.renderTargetBright.dispose()},setSize:function(e,t){var r=Math.round(e/2);var i=Math.round(t/2);this.renderTargetBright.setSize(r,i);for(var a=0;a<this.nMips;a++){this.renderTargetsHorizontal[a].setSize(r,i);this.renderTargetsVertical[a].setSize(r,i);this.separableBlurMaterials[a].uniforms["texSize"].value=new THREE.Vector2(r,i);r=Math.round(r/2);i=Math.round(i/2)}},render:function(e,t,r,i,a){this.oldClearColor.copy(e.getClearColor());this.oldClearAlpha=e.getClearAlpha();var s=e.autoClear;e.autoClear=false;e.setClearColor(new THREE.Color(0,0,0),0);if(a)e.context.disable(e.context.STENCIL_TEST);if(this.renderToScreen){this.quad.material=this.basic;this.basic.map=r.texture;e.render(this.scene,this.camera,undefined,true)}this.highPassUniforms["tDiffuse"].value=r.texture;this.highPassUniforms["luminosityThreshold"].value=this.threshold;this.quad.material=this.materialHighPassFilter;e.render(this.scene,this.camera,this.renderTargetBright,true);var n=this.renderTargetBright;for(var o=0;o<this.nMips;o++){this.quad.material=this.separableBlurMaterials[o];this.separableBlurMaterials[o].uniforms["colorTexture"].value=n.texture;this.separableBlurMaterials[o].uniforms["direction"].value=THREE.UnrealBloomPass.BlurDirectionX;e.render(this.scene,this.camera,this.renderTargetsHorizontal[o],true);this.separableBlurMaterials[o].uniforms["colorTexture"].value=this.renderTargetsHorizontal[o].texture;this.separableBlurMaterials[o].uniforms["direction"].value=THREE.UnrealBloomPass.BlurDirectionY;e.render(this.scene,this.camera,this.renderTargetsVertical[o],true);n=this.renderTargetsVertical[o]}this.quad.material=this.compositeMaterial;this.compositeMaterial.uniforms["bloomStrength"].value=this.strength;this.compositeMaterial.uniforms["bloomRadius"].value=this.radius;this.compositeMaterial.uniforms["bloomTintColors"].value=this.bloomTintColors;e.render(this.scene,this.camera,this.renderTargetsHorizontal[0],true);this.quad.material=this.materialCopy;this.copyUniforms["tDiffuse"].value=this.renderTargetsHorizontal[0].texture;if(a)e.context.enable(e.context.STENCIL_TEST);if(this.renderToScreen){e.render(this.scene,this.camera,undefined,false)}else{e.render(this.scene,this.camera,r,false)}e.setClearColor(this.oldClearColor,this.oldClearAlpha);e.autoClear=s},getSeperableBlurMaterial:function(e){return new THREE.ShaderMaterial({defines:{KERNEL_RADIUS:e,SIGMA:e},uniforms:{colorTexture:{value:null},texSize:{value:new THREE.Vector2(.5,.5)},direction:{value:new THREE.Vector2(.5,.5)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D colorTexture;\n\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec2 direction;\t\t\t\t\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\t\t\t\t}\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tfloat fSigma = float(SIGMA);\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, fSigma);\t\t\t\t\tvec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;\t\t\t\t\tfor( int i = 1; i < KERNEL_RADIUS; i ++ ) {\t\t\t\t\t\tfloat x = float(i);\t\t\t\t\t\tfloat w = gaussianPdf(x, fSigma);\t\t\t\t\t\tvec2 uvOffset = direction * invSize * x;\t\t\t\t\t\tvec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;\t\t\t\t\t\tvec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;\t\t\t\t\t\tdiffuseSum += (sample1 + sample2) * w;\t\t\t\t\t\tweightSum += 2.0 * w;\t\t\t\t\t}\t\t\t\t\tgl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n\t\t\t\t}"})},getCompositeMaterial:function(e){return new THREE.ShaderMaterial({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},dirtTexture:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D blurTexture1;\t\t\t\tuniform sampler2D blurTexture2;\t\t\t\tuniform sampler2D blurTexture3;\t\t\t\tuniform sampler2D blurTexture4;\t\t\t\tuniform sampler2D blurTexture5;\t\t\t\tuniform sampler2D dirtTexture;\t\t\t\tuniform float bloomStrength;\t\t\t\tuniform float bloomRadius;\t\t\t\tuniform float bloomFactors[NUM_MIPS];\t\t\t\tuniform vec3 bloomTintColors[NUM_MIPS];\t\t\t\t\t\t\t\tfloat lerpBloomFactor(const in float factor) { \t\t\t\t\tfloat mirrorFactor = 1.2 - factor;\t\t\t\t\treturn mix(factor, mirrorFactor, bloomRadius);\t\t\t\t}\t\t\t\t\t\t\t\tvoid main() {\t\t\t\t\tgl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );\t\t\t\t}"})}});THREE.UnrealBloomPass.BlurDirectionX=new THREE.Vector2(1,0);THREE.UnrealBloomPass.BlurDirectionY=new THREE.Vector2(0,1)},function(e,t){THREE.PosterShader={uniforms:{tDiffuse:{value:null}},vertexShader:`\n    varying vec2 vUv;\n\n    void main() {\n      vUv = uv;\n      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n    }\n  `,fragmentShader:`\n    #define PI 3.14159\n    #define UV_SCALE 0.02\n    #define MAX_HEIGHT 0.5\n    varying vec2 vUv;\n    uniform sampler2D tDiffuse;\n\n    float posterise(float val, float amount) {\n      return floor(val * amount) / amount;\n    }\n\n    float posteriseCeil(float val, float amount) {\n      return ceil(val * amount) / amount;\n    }\n\n    void main() {\n      vec4 frag = texture2D(tDiffuse, vUv);\n      frag.r = posterise(frag.r, 16.0);\n      gl_FragColor = frag;\n    }\n  `};THREE.PosterPass=function(e){THREE.Pass.call(this);this.size=e;this.shader=THREE.PosterShader;this.material=new THREE.ShaderMaterial(this.shader);this.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1);this.scene=new THREE.Scene;this.quad=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),this.material);this.quad.frustumCulled=false;this.scene.add(this.quad);this.time=0};THREE.PosterPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.PosterPass,render:function(e,t,r,i,a){this.shader.uniforms["tDiffuse"].value=r.texture;if(this.renderToScreen){e.render(this.scene,this.camera)}else{e.render(this.scene,this.camera,t,this.clear)}}})},function(e,t){THREE.MTLLoader=function(e){this.manager=e!==undefined?e:THREE.DefaultLoadingManager};THREE.MTLLoader.prototype={constructor:THREE.MTLLoader,load:function(e,t,r,i){var a=this;var s=new THREE.FileLoader(this.manager);s.setPath(this.path);s.load(e,function(e){t(a.parse(e))},r,i)},setPath:function(e){this.path=e},setTexturePath:function(e){this.texturePath=e},setBaseUrl:function(e){console.warn("THREE.MTLLoader: .setBaseUrl() is deprecated. Use .setTexturePath( path ) for texture path or .setPath( path ) for general base path instead.");this.setTexturePath(e)},setCrossOrigin:function(e){this.crossOrigin=e},setMaterialOptions:function(e){this.materialOptions=e},parse:function(e){var t=e.split("\n");var r={};var i=/\s+/;var a={};for(var s=0;s<t.length;s++){var n=t[s];n=n.trim();if(n.length===0||n.charAt(0)==="#"){continue}var o=n.indexOf(" ");var l=o>=0?n.substring(0,o):n;l=l.toLowerCase();var h=o>=0?n.substring(o+1):"";h=h.trim();if(l==="newmtl"){r={name:h};a[h]=r}else if(r){if(l==="ka"||l==="kd"||l==="ks"){var c=h.split(i,3);r[l]=[parseFloat(c[0]),parseFloat(c[1]),parseFloat(c[2])]}else{r[l]=h}}}var u=new THREE.MTLLoader.MaterialCreator(this.texturePath||this.path,this.materialOptions);u.setCrossOrigin(this.crossOrigin);u.setManager(this.manager);u.setMaterials(a);return u}};THREE.MTLLoader.MaterialCreator=function(e,t){this.baseUrl=e||"";this.options=t;this.materialsInfo={};this.materials={};this.materialsArray=[];this.nameLookup={};this.side=this.options&&this.options.side?this.options.side:THREE.FrontSide;this.wrap=this.options&&this.options.wrap?this.options.wrap:THREE.RepeatWrapping};THREE.MTLLoader.MaterialCreator.prototype={constructor:THREE.MTLLoader.MaterialCreator,crossOrigin:"Anonymous",setCrossOrigin:function(e){this.crossOrigin=e},setManager:function(e){this.manager=e},setMaterials:function(e){this.materialsInfo=this.convert(e);this.materials={};this.materialsArray=[];this.nameLookup={}},convert:function(e){if(!this.options)return e;var t={};for(var r in e){var i=e[r];var a={};t[r]=a;for(var s in i){var n=true;var o=i[s];var l=s.toLowerCase();switch(l){case"kd":case"ka":case"ks":if(this.options&&this.options.normalizeRGB){o=[o[0]/255,o[1]/255,o[2]/255]}if(this.options&&this.options.ignoreZeroRGBs){if(o[0]===0&&o[1]===0&&o[2]===0){n=false}}break;default:break}if(n){a[l]=o}}}return t},preload:function(){for(var e in this.materialsInfo){this.create(e)}},getIndex:function(e){return this.nameLookup[e]},getAsArray:function(){var e=0;for(var t in this.materialsInfo){this.materialsArray[e]=this.create(t);this.nameLookup[t]=e;e++}return this.materialsArray},create:function(e){if(this.materials[e]===undefined){this.createMaterial_(e)}return this.materials[e]},createMaterial_:function(e){var t=this;var r=this.materialsInfo[e];var i={name:e,side:this.side};function a(e,t){if(typeof t!=="string"||t==="")return"";if(/^https?:\/\//i.test(t))return t;return e+t}function s(e,r){if(i[e])return;var s=t.getTextureParams(r,i);var n=t.loadTexture(a(t.baseUrl,s.url));n.repeat.copy(s.scale);n.offset.copy(s.offset);n.wrapS=t.wrap;n.wrapT=t.wrap;i[e]=n}for(var n in r){var o=r[n];var l;if(o==="")continue;switch(n.toLowerCase()){case"kd":i.color=(new THREE.Color).fromArray(o);break;case"ks":i.specular=(new THREE.Color).fromArray(o);break;case"map_kd":s("map",o);break;case"map_ks":s("specularMap",o);break;case"norm":s("normalMap",o);break;case"map_bump":case"bump":s("bumpMap",o);break;case"ns":i.shininess=parseFloat(o);break;case"d":l=parseFloat(o);if(l<1){i.opacity=l;i.transparent=true}break;case"tr":l=parseFloat(o);if(l>0){i.opacity=1-l;i.transparent=true}break;default:break}}this.materials[e]=new THREE.MeshPhongMaterial(i);return this.materials[e]},getTextureParams:function(e,t){var r={scale:new THREE.Vector2(1,1),offset:new THREE.Vector2(0,0)};var i=e.split(/\s+/);var a;a=i.indexOf("-bm");if(a>=0){t.bumpScale=parseFloat(i[a+1]);i.splice(a,2)}a=i.indexOf("-s");if(a>=0){r.scale.set(parseFloat(i[a+1]),parseFloat(i[a+2]));i.splice(a,4)}a=i.indexOf("-o");if(a>=0){r.offset.set(parseFloat(i[a+1]),parseFloat(i[a+2]));i.splice(a,4)}r.url=i.join(" ").trim();return r},loadTexture:function(e,t,r,i,a){var s;var n=THREE.Loader.Handlers.get(e);var o=this.manager!==undefined?this.manager:THREE.DefaultLoadingManager;if(n===null){n=new THREE.TextureLoader(o)}if(n.setCrossOrigin)n.setCrossOrigin(this.crossOrigin);s=n.load(e,r,i,a);if(t!==undefined)s.mapping=t;return s}}},function(e,t){(function(){THREE.FBXLoader=function(e){this.manager=e!==undefined?e:THREE.DefaultLoadingManager};Object.assign(THREE.FBXLoader.prototype,{load:function(e,t,r,i){var a=this;var s=THREE.Loader.prototype.extractUrlBase(e);var n=new THREE.FileLoader(this.manager);n.setResponseType("arraybuffer");n.load(e,function(r){try{var n=a.parse(r,s);t(n)}catch(t){window.setTimeout(function(){if(i)i(t);a.manager.itemError(e)},0)}},r,i)},parse:function(r,a){var n;if(O(r)){n=(new N).parse(r)}else{var o=$(r);if(!_(o)){throw new Error("THREE.FBXLoader: Unknown format.")}if(V(o)<7e3){throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+V(o))}n=(new F).parse(o)}var h=e(n);var u=t(n);var p=i(n,new THREE.TextureLoader(this.manager).setPath(a),u,h);var f=s(n,p,h);var d=l(n,h);var v=c(n,h,d);var m=w(n,h,d,v,f);return m}});function e(e){var t=new Map;if("Connections"in e){var r=e.Connections.properties.connections;for(var i=0,a=r.length;i<a;++i){var s=r[i];if(!t.has(s[0])){t.set(s[0],{parents:[],children:[]})}var n={ID:s[1],relationship:s[2]};t.get(s[0]).parents.push(n);if(!t.has(s[1])){t.set(s[1],{parents:[],children:[]})}var o={ID:s[0],relationship:s[2]};t.get(s[1]).children.push(o)}}return t}function t(e){var t=new Map;if("Video"in e.Objects.subNodes){var i=e.Objects.subNodes.Video;for(var a in i){var s=i[a];if("Content"in s.properties){var n=r(i[a]);t.set(parseInt(a),n)}}}return t}function r(e){var t=e.properties.Content;var r=e.properties.RelativeFilename||e.properties.Filename;var i=r.slice(r.lastIndexOf(".")+1).toLowerCase();var a;switch(i){case"bmp":a="image/bmp";break;case"jpg":case"jpeg":a="image/jpeg";break;case"png":a="image/png";break;case"tif":a="image/tiff";break;default:console.warn('FBXLoader: Image type "'+i+'" is not supported.');return}if(typeof t==="string"){return"data:"+a+";base64,"+t}else{var s=new Uint8Array(t);return window.URL.createObjectURL(new Blob([s],{type:a}))}}function i(e,t,r,i){var s=new Map;var n=["jpg","jpeg","png","bmp"];if("Texture"in e.Objects.subNodes){var o=e.Objects.subNodes.Texture;for(var l in o){var h=o[l];var c=h.properties.FileName.slice(h.properties.FileName.lastIndexOf(".")+1).toLowerCase();if(n.indexOf(c)!=-1){var u=a(h,t,r,i);s.set(parseInt(l),u)}}}return s}function a(e,t,r,i){var a=e.id;var s=e.attrName;var n;var o=e.properties.FileName;var l=e.properties.RelativeFilename;var h=i.get(a).children;if(h!==undefined&&h.length>0&&r.has(h[0].ID)){n=r.get(h[0].ID)}else if(l!==undefined&&l[0]!=="/"&&l.match(/^[a-zA-Z]:/)===null){n=l}else{var c=o.split(/[\\\/]/);if(c.length>0){n=c[c.length-1]}else{n=o}}var u=t.path;if(n.indexOf("blob:")===0||n.indexOf("data:")===0){t.setPath(undefined)}var p=t.load(n);p.name=s;p.FBX_ID=a;var f=e.properties.WrapModeU;var d=e.properties.WrapModeV;var v=f!==undefined?f.value:0;var m=d!==undefined?d.value:0;p.wrapS=v===0?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping;p.wrapT=m===0?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping;if("Scaling"in e.properties){var g=e.properties.Scaling.value;p.repeat.x=g[0];p.repeat.y=g[1]}t.setPath(u);return p}function s(e,t,r){var i=new Map;if("Material"in e.Objects.subNodes){var a=e.Objects.subNodes.Material;for(var s in a){var o=n(a[s],t,r);if(o!==null)i.set(parseInt(s),o)}}return i}function n(e,t,r){var i=e.id;var a=e.attrName;var s=e.properties.ShadingModel;if(typeof s==="object"){s=s.value}if(!r.has(i))return null;var n=r.get(i).children;var l=o(e.properties,t,n);var h;switch(s.toLowerCase()){case"phong":h=new THREE.MeshPhongMaterial;break;case"lambert":h=new THREE.MeshLambertMaterial;break;case"unknown":h=new THREE.MeshStandardMaterial;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',s);h=new THREE.MeshPhongMaterial({color:3342591});break}h.setValues(l);h.name=a;return h}function o(e,t,r){var i={};if(e.BumpFactor){i.bumpScale=e.BumpFactor.value}if(e.Diffuse){i.color=W(e.Diffuse)}if(e.DisplacementFactor){i.displacementScale=e.DisplacementFactor.value}if(e.ReflectionFactor){i.reflectivity=e.ReflectionFactor.value}if(e.Specular){i.specular=W(e.Specular)}if(e.Shininess){i.shininess=e.Shininess.value}if(e.Emissive){i.emissive=W(e.Emissive)}if(e.EmissiveFactor){i.emissiveIntensity=parseFloat(e.EmissiveFactor.value)}if(e.Opacity){i.opacity=parseFloat(e.Opacity.value)}if(i.opacity<1){i.transparent=true}if(e["Maya|base_color"]){var a=e["Maya|base_color"].value;i.color=new THREE.Color(a[0],a[1],a[2])}if(e["Maya|emissive"]){var a=e["Maya|emissive"];i.emissive=new THREE.Color(a[0],a[1],a[2])}if(e["Maya|emissive_intensity"]){i.emissiveIntensity=e["Maya|emissive_intensity"].value}if(e["Maya|metallic"]){i.metalness=e["Maya|metallic"].value}if(e["Maya|roughness"]){i.roughness=e["Maya|roughness"].value}var s=1;if(e["Maya|uv_scale"]){var s=e["Maya|uv_scale"].value}for(var n=0,o=r.length;n<o;++n){var l=r[n];var h=l.relationship;switch(h){case"Maya|TEX_color_map":var c="Maya|use_color_map";if(e[c]&&e[c].value==1){i.map=t.get(l.ID);if(s!=1){i.map.wrapS=THREE.RepeatWrapping;i.map.wrapT=THREE.RepeatWrapping;i.map.repeat.set(s,s)}}break;case"Maya|TEX_emissive_map":var c="Maya|use_emissive_map";if(e[c]&&e[c].value==1){i.emissiveMap=t.get(l.ID);if(s!=1){i.emissiveMap.wrapS=THREE.RepeatWrapping;i.emissiveMap.wrapT=THREE.RepeatWrapping;i.emissiveMap.repeat.set(s,s)}}break;case"Maya|TEX_roughness_map":var c="Maya|use_roughness_map";if(e[c]&&e[c].value==1){i.roughnessMap=t.get(l.ID);if(s!=1){i.roughnessMap.wrapS=THREE.RepeatWrapping;i.roughnessMap.wrapT=THREE.RepeatWrapping;i.roughnessMap.repeat.set(s,s)}}break;case"Maya|TEX_normal_map":var c="Maya|use_normal_map";if(e[c]&&e[c].value==1){i.normalMap=t.get(l.ID);if(s!=1){i.normalMap.wrapS=THREE.RepeatWrapping;i.normalMap.wrapT=THREE.RepeatWrapping;i.normalMap.repeat.set(s,s)}}break;case"Maya|TEX_metallic_map":var c="Maya|use_metallic_map";if(e[c]&&e[c].value==1){i.metalnessMap=t.get(l.ID);if(s!=1){i.metalnessMap.wrapS=THREE.RepeatWrapping;i.metalnessMap.wrapT=THREE.RepeatWrapping;i.metalnessMap.repeat.set(s,s)}}break;case"Maya|TEX_ao_map":var c="Maya|use_ao_map";if(e[c]&&e[c].value==1){i.aoMap=t.get(l.ID);if(s!=1){i.aoMap.wrapS=THREE.RepeatWrapping;i.aoMap.wrapT=THREE.RepeatWrapping;i.aoMap.repeat.set(s,s)}}break;case"Maya|TEX_brdf_lut":case"Maya|TEX_global_specular_cube":case"Maya|TEX_global_diffuse_cube":break;case"Bump":i.bumpMap=t.get(l.ID);break;case"DiffuseColor":i.map=t.get(l.ID);break;case"DisplacementColor":i.displacementMap=t.get(l.ID);break;case"EmissiveColor":i.emissiveMap=t.get(l.ID);break;case"NormalMap":i.normalMap=t.get(l.ID);break;case"ReflectionColor":i.envMap=t.get(l.ID);i.envMap.mapping=THREE.EquirectangularReflectionMapping;break;case"SpecularColor":i.specularMap=t.get(l.ID);break;case"TransparentColor":i.alphaMap=t.get(l.ID);i.transparent=true;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",h);break}}return i}function l(e,t){var r={};if("Deformer"in e.Objects.subNodes){var i=e.Objects.subNodes.Deformer;for(var a in i){var s=i[a];if(s.attrType==="Skin"){var n=t.get(parseInt(a));var o=h(n,i);o.FBX_ID=parseInt(a);r[a]=o}}}return r}function h(e,t){var r={};var i=e.children;for(var a=0,s=i.length;a<s;++a){var n=i[a];var o=t[n.ID];var l={FBX_ID:n.ID,index:a,indices:[],weights:[],transform:(new THREE.Matrix4).fromArray(o.subNodes.Transform.properties.a),transformLink:(new THREE.Matrix4).fromArray(o.subNodes.TransformLink.properties.a),linkMode:o.properties.Mode};if("Indexes"in o.subNodes){l.indices=o.subNodes.Indexes.properties.a;l.weights=o.subNodes.Weights.properties.a}r[n.ID]=l}return{map:r,bones:[]}}function c(e,t,r){var i=new Map;if("Geometry"in e.Objects.subNodes){var a=e.Objects.subNodes.Geometry;for(var s in a){var n=t.get(parseInt(s));var o=u(a[s],n,r);i.set(parseInt(s),o)}}return i}function u(e,t,r){switch(e.attrType){case"Mesh":return p(e,t,r);break;case"NurbsCurve":return b(e);break}}function p(e,t,r){for(var i=0;i<t.children.length;++i){var a=r[t.children[i].ID];if(a!==undefined)break}return f(e,a)}function f(e,t){var r=e.subNodes;var i=r.Vertices.properties.a;var a=r.PolygonVertexIndex.properties.a;var s=[];var n=[];var o=[];var l=[];var h=[];var c=[];var u=[];if(r.LayerElementColor){var p=m(r.LayerElementColor[0])}if(r.LayerElementMaterial){var f=g(r.LayerElementMaterial[0])}if(r.LayerElementNormal){var E=d(r.LayerElementNormal[0])}if(r.LayerElementUV){var y=[];var b=0;while(r.LayerElementUV[b]){y.push(v(r.LayerElementUV[b]));b++}}var w={};if(t){var x=t.map;for(var R in x){var M=x[R];var H=M.indices;for(var S=0;S<H.length;S++){var k=H[S];var z=M.weights[S];if(w[k]===undefined)w[k]=[];w[k].push({id:M.index,weight:z})}}}var P=0;var C=0;var L=false;var I=[];var B=[];var A=[];var D=[];var F=[];var N=[];for(var U=0;U<a.length;U++){var j=a[U];var O=false;if(j<0){j=j^-1;a[U]=j;O=true}var _=[];var V=[];I.push(j*3,j*3+1,j*3+2);if(p){var X=T(U,P,j,p);A.push(X[0],X[1],X[2])}if(t){if(w[j]!==undefined){var G=w[j];for(var S=0,q=G.length;S<q;S++){V.push(G[S].weight);_.push(G[S].id)}}if(V.length>4){if(!L){console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights.");L=true}var W=[0,0,0,0];var $=[0,0,0,0];V.forEach(function(e,t){var r=e;var i=_[t];$.forEach(function(e,t,a){if(r>e){a[t]=r;r=e;var s=W[t];W[t]=i;i=s}})});_=W;V=$}for(var b=V.length;b<4;++b){V[b]=0;_[b]=0}for(var b=0;b<4;++b){F.push(V[b]);N.push(_[b])}}if(E){var X=T(U,P,j,E);B.push(X[0],X[1],X[2])}if(y){for(var b=0;b<y.length;b++){var X=T(U,P,j,y[b]);if(D[b]===undefined){D[b]=[]}D[b].push(X[0],X[1])}}C++;if(O){for(var b=2;b<C;b++){s.push(i[I[0]]);s.push(i[I[1]]);s.push(i[I[2]]);s.push(i[I[(b-1)*3]]);s.push(i[I[(b-1)*3+1]]);s.push(i[I[(b-1)*3+2]]);s.push(i[I[b*3]]);s.push(i[I[b*3+1]]);s.push(i[I[b*3+2]])}if(t){for(var b=2;b<C;b++){c.push(F[0]);c.push(F[1]);c.push(F[2]);c.push(F[3]);c.push(F[(b-1)*4]);c.push(F[(b-1)*4+1]);c.push(F[(b-1)*4+2]);c.push(F[(b-1)*4+3]);c.push(F[b*4]);c.push(F[b*4+1]);c.push(F[b*4+2]);c.push(F[b*4+3]);u.push(N[0]);u.push(N[1]);u.push(N[2]);u.push(N[3]);u.push(N[(b-1)*4]);u.push(N[(b-1)*4+1]);u.push(N[(b-1)*4+2]);u.push(N[(b-1)*4+3]);u.push(N[b*4]);u.push(N[b*4+1]);u.push(N[b*4+2]);u.push(N[b*4+3])}}if(E){for(var b=2;b<C;b++){n.push(B[0]);n.push(B[1]);n.push(B[2]);n.push(B[(b-1)*3]);n.push(B[(b-1)*3+1]);n.push(B[(b-1)*3+2]);n.push(B[b*3]);n.push(B[b*3+1]);n.push(B[b*3+2])}}if(y){for(var S=0;S<y.length;S++){if(l[S]===undefined)l[S]=[];for(var b=2;b<C;b++){l[S].push(D[S][0]);l[S].push(D[S][1]);l[S].push(D[S][(b-1)*2]);l[S].push(D[S][(b-1)*2+1]);l[S].push(D[S][b*2]);l[S].push(D[S][b*2+1])}}}if(p){for(var b=2;b<C;b++){o.push(A[0]);o.push(A[1]);o.push(A[2]);o.push(A[(b-1)*3]);o.push(A[(b-1)*3+1]);o.push(A[(b-1)*3+2]);o.push(A[b*3]);o.push(A[b*3+1]);o.push(A[b*3+2])}}if(f&&f.mappingType!=="AllSame"){var Y=T(U,P,j,f)[0];for(var b=2;b<C;b++){h.push(Y);h.push(Y);h.push(Y)}}P++;O=false;C=0;I=[];B=[];A=[];D=[];F=[];N=[]}}var Z=new THREE.BufferGeometry;Z.name=e.name;Z.addAttribute("position",new THREE.Float32BufferAttribute(s,3));if(o.length>0){Z.addAttribute("color",new THREE.Float32BufferAttribute(o,3))}if(t){Z.addAttribute("skinIndex",new THREE.Float32BufferAttribute(u,4));Z.addAttribute("skinWeight",new THREE.Float32BufferAttribute(c,4));Z.FBX_Deformer=t}if(n.length>0){Z.addAttribute("normal",new THREE.Float32BufferAttribute(n,3))}if(l.length>0){for(var b=0;b<l.length;b++){var K="uv"+(b+1).toString();if(b==0){K="uv"}Z.addAttribute(K,new THREE.Float32BufferAttribute(l[b],2))}}if(f&&f.mappingType!=="AllSame"){var Q=h[0];var J=0;for(var b=0;b<h.length;++b){if(h[b]!==Q){Z.addGroup(J,b-J,Q);Q=h[b];J=b}}if(Z.groups.length>0){var ee=Z.groups[Z.groups.length-1];var te=ee.start+ee.count;if(te!==h.length){Z.addGroup(te,h.length-te,Q)}}if(Z.groups.length===0){Z.addGroup(0,h.length,h[0])}}return Z}function d(e){var t=e.properties.MappingInformationType;var r=e.properties.ReferenceInformationType;var i=e.subNodes.Normals.properties.a;var a=[];if(r==="IndexToDirect"){if("NormalIndex"in e.subNodes){a=e.subNodes.NormalIndex.properties.a}else if("NormalsIndex"in e.subNodes){a=e.subNodes.NormalsIndex.properties.a}}return{dataSize:3,buffer:i,indices:a,mappingType:t,referenceType:r}}function v(e){var t=e.properties.MappingInformationType;var r=e.properties.ReferenceInformationType;var i=e.subNodes.UV.properties.a;var a=[];if(r==="IndexToDirect"){a=e.subNodes.UVIndex.properties.a}return{dataSize:2,buffer:i,indices:a,mappingType:t,referenceType:r}}function m(e){var t=e.properties.MappingInformationType;var r=e.properties.ReferenceInformationType;var i=e.subNodes.Colors.properties.a;var a=[];if(r==="IndexToDirect"){a=e.subNodes.ColorIndex.properties.a}return{dataSize:4,buffer:i,indices:a,mappingType:t,referenceType:r}}function g(e){var t=e.properties.MappingInformationType;var r=e.properties.ReferenceInformationType;if(t==="NoMappingInformation"){return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:r}}var i=e.subNodes.Materials.properties.a;var a=[];for(var s=0,n=i.length;s<n;++s){a.push(s)}return{dataSize:1,buffer:i,indices:a,mappingType:t,referenceType:r}}var E=[];var y={ByPolygonVertex:{Direct:function(e,t,r,i){var a=e*i.dataSize;var s=e*i.dataSize+i.dataSize;return K(E,i.buffer,a,s)},IndexToDirect:function(e,t,r,i){var a=i.indices[e];var s=a*i.dataSize;var n=a*i.dataSize+i.dataSize;return K(E,i.buffer,s,n)}},ByPolygon:{Direct:function(e,t,r,i){var a=t*i.dataSize;var s=t*i.dataSize+i.dataSize;return K(E,i.buffer,a,s)},IndexToDirect:function(e,t,r,i){var a=i.indices[t];var s=a*i.dataSize;var n=a*i.dataSize+i.dataSize;return K(E,i.buffer,s,n)}},ByVertice:{Direct:function(e,t,r,i){var a=r*i.dataSize;var s=r*i.dataSize+i.dataSize;return K(E,i.buffer,a,s)}},AllSame:{IndexToDirect:function(e,t,r,i){var a=i.indices[0]*i.dataSize;var s=i.indices[0]*i.dataSize+i.dataSize;return K(E,i.buffer,a,s)}}};function T(e,t,r,i){return y[i.mappingType][i.referenceType](e,t,r,i)}function b(e){if(THREE.NURBSCurve===undefined){console.error("THREE.FBXLoader: The loader relies on THREE.NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry.");return new THREE.BufferGeometry}var t=parseInt(e.properties.Order);if(isNaN(t)){console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.properties.Order,e.id);return new THREE.BufferGeometry}var r=t-1;var i=e.subNodes.KnotVector.properties.a;var a=[];var s=e.subNodes.Points.properties.a;for(var n=0,o=s.length;n<o;n+=4){a.push((new THREE.Vector4).fromArray(s,n))}var l,h;if(e.properties.Form==="Closed"){a.push(a[0])}else if(e.properties.Form==="Periodic"){l=r;h=i.length-1-l;for(var n=0;n<r;++n){a.push(a[n])}}var c=new THREE.NURBSCurve(r,i,a,l,h);var u=c.getPoints(a.length*7);var p=new Float32Array(u.length*3);for(var n=0,o=u.length;n<o;++n){u[n].toArray(p,n*3)}var f=new THREE.BufferGeometry;f.addAttribute("position",new THREE.BufferAttribute(p,3));return f}function w(e,t,r,i,a){var s=new THREE.Group;var n=e.Objects.subNodes.Model;var o=[];var l=new Map;for(var h in n){var c=parseInt(h);var u=n[h];var p=t.get(c);var f=null;for(var d=0;d<p.parents.length;++d){for(var v in r){var m=r[v];var g=m.map;var E=g[p.parents[d].ID];if(E){var y=f;f=new THREE.Bone;m.bones[E.index]=f;if(y!==null)f.add(y)}}}if(!f){switch(u.attrType){case"Camera":var T;for(var b=0,w=p.children.length;b<w;++b){var R=p.children[b].ID;var M=e.Objects.subNodes.NodeAttribute[R];if(M!==undefined&&M.properties!==undefined){T=M.properties}}if(T===undefined){f=new THREE.Object3D}else{var H=0;if(T.CameraProjectionType!==undefined&&T.CameraProjectionType.value===1){H=1}var S=1;if(T.NearPlane!==undefined){S=T.NearPlane.value/1e3}var k=1e3;if(T.FarPlane!==undefined){k=T.FarPlane.value/1e3}var P=window.innerWidth;var C=window.innerHeight;if(T.AspectWidth!==undefined&&T.AspectHeight!==undefined){P=T.AspectWidth.value;C=T.AspectHeight.value}var L=P/C;var I=45;if(T.FieldOfView!==undefined){I=T.FieldOfView.value}switch(H){case 0:f=new THREE.PerspectiveCamera(I,L,S,k);break;case 1:f=new THREE.OrthographicCamera(-P/2,P/2,C/2,-C/2,S,k);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+H+".");f=new THREE.Object3D;break}}break;case"Light":var B;for(var b=0,w=p.children.length;b<w;++b){var R=p.children[b].ID;var M=e.Objects.subNodes.NodeAttribute[R];if(M!==undefined&&M.properties!==undefined){B=M.properties}}if(B===undefined){f=new THREE.Object3D}else{var H;if(B.LightType===undefined){H=0}else{H=B.LightType.value}var A=16777215;if(B.Color!==undefined){A=W(B.Color.value)}var D=B.Intensity===undefined?1:B.Intensity.value/100;if(B.CastLightOnObject!==undefined&&B.CastLightOnObject.value===0){D=0}var F=0;if(B.FarAttenuationEnd!==undefined){if(B.EnableFarAttenuation!==undefined&&B.EnableFarAttenuation.value===0){F=0}else{F=B.FarAttenuationEnd.value/1e3}}var N=1;switch(H){case 0:f=new THREE.PointLight(A,D,F,N);break;case 1:f=new THREE.DirectionalLight(A,D);break;case 2:var U=Math.PI/3;if(B.InnerAngle!==undefined){U=THREE.Math.degToRad(B.InnerAngle.value)}var j=0;if(B.OuterAngle!==undefined){j=THREE.Math.degToRad(B.OuterAngle.value);j=Math.max(j,1)}f=new THREE.SpotLight(A,D,F,U,j,N);break;default:console.warn("THREE.FBXLoader: Unknown light type "+B.LightType.value+", defaulting to a THREE.PointLight.");f=new THREE.PointLight(A,D);break}if(B.CastShadows!==undefined&&B.CastShadows.value===1){f.castShadow=true}}break;case"Mesh":var O=null;var _=null;var V=[];for(var b=0,w=p.children.length;b<w;++b){var X=p.children[b];if(i.has(X.ID)){O=i.get(X.ID)}if(a.has(X.ID)){V.push(a.get(X.ID))}}if(V.length>1){_=V}else if(V.length>0){_=V[0]}else{_=new THREE.MeshPhongMaterial({color:13421772});V.push(_)}if("color"in O.attributes){for(var G=0,q=V.length;G<q;++G){V[G].vertexColors=THREE.VertexColors}}if(O.FBX_Deformer){for(var $=0,Z=V.length;$<Z;++$){V[$].skinning=true}f=new THREE.SkinnedMesh(O,_)}else{f=new THREE.Mesh(O,_)}break;case"NurbsCurve":var O=null;for(var b=0,w=p.children.length;b<w;++b){var X=p.children[b];if(i.has(X.ID)){O=i.get(X.ID)}}_=new THREE.LineBasicMaterial({color:3342591,linewidth:5});f=new THREE.Line(O,_);break;default:f=new THREE.Group;break}}f.name=THREE.PropertyBinding.sanitizeNodeName(u.attrName);f.FBX_ID=c;o.push(f);l.set(c,f)}for(var K=0,Q=o.length;K<Q;++K){var f=o[K];var u=n[f.FBX_ID];if("Lcl_Translation"in u.properties){f.position.fromArray(u.properties.Lcl_Translation.value)}if("Lcl_Rotation"in u.properties){var J=u.properties.Lcl_Rotation.value.map(THREE.Math.degToRad);J.push("ZYX");f.rotation.fromArray(J)}if("Lcl_Scaling"in u.properties){f.scale.fromArray(u.properties.Lcl_Scaling.value)}if("PreRotation"in u.properties){var ee=u.properties.PreRotation.value.map(THREE.Math.degToRad);ee[3]="ZYX";var te=(new THREE.Euler).fromArray(ee);te=(new THREE.Quaternion).setFromEuler(te);var re=(new THREE.Quaternion).setFromEuler(f.rotation);te.multiply(re);f.rotation.setFromQuaternion(te,"ZYX")}if("GeometricTranslation"in u.properties){var ee=u.properties.GeometricTranslation.value;f.traverse(function(e){if(e.geometry){e.geometry.translate(ee[0],ee[1],ee[2])}})}if("LookAtProperty"in u.properties){var p=t.get(f.FBX_ID);for(var b=0,w=p.children.length;b<w;++b){var X=p.children[b];if(X.relationship==="LookAtProperty"){var ie=e.Objects.subNodes.Model[X.ID];if("Lcl_Translation"in ie.properties){var ae=ie.properties.Lcl_Translation.value;if(f.target!==undefined){f.target.position.set(ae[0],ae[1],ae[2]);s.add(f.target)}else{f.lookAt(new THREE.Vector3(ae[0],ae[1],ae[2]))}}}}}var p=t.get(f.FBX_ID);for(var se=0;se<p.parents.length;se++){var ne=Y(o,function(e){return e.FBX_ID===p.parents[se].ID});if(ne>-1){o[ne].add(f);break}}if(f.parent===null){s.add(f)}}s.updateMatrixWorld(true);var oe=new Map;if("Pose"in e.Objects.subNodes){var le=e.Objects.subNodes.Pose;for(var h in le){if(le[h].attrType==="BindPose"){le=le[h];break}}var he=le.subNodes.PoseNode;for(var ce=0,ue=he.length;ce<ue;++ce){var u=he[ce];var pe=(new THREE.Matrix4).fromArray(u.subNodes.Matrix.properties.a);oe.set(parseInt(u.properties.Node),pe)}}for(var v in r){var m=r[v];var g=m.map;for(var fe in g){var E=g[fe];var de=E.index;var ve=m.bones[de];if(!oe.has(ve.FBX_ID)){break}var me=oe.get(ve.FBX_ID);ve.matrixWorld.copy(me)}m.skeleton=new THREE.Skeleton(m.bones);var p=t.get(m.FBX_ID);var ge=p.parents;for(var Ee=0,ye=ge.length;Ee<ye;++Ee){var Te=ge[Ee];if(i.has(Te.ID)){var be=Te.ID;var we=t.get(be);for(var d=0;d<we.parents.length;++d){if(l.has(we.parents[d].ID)){var f=l.get(we.parents[d].ID);f.bind(m.skeleton,f.matrixWorld);break}}}}}s.updateMatrixWorld(true);s.skeleton={bones:o};var xe=x(e,t,s);z(s,xe);if("GlobalSettings"in e&&"AmbientColor"in e.GlobalSettings.properties){var Re=e.GlobalSettings.properties.AmbientColor.value;var Me=Re[0];var He=Re[1];var Se=Re[2];if(Me!==0||He!==0||Se!==0){var A=new THREE.Color(Me,He,Se);s.add(new THREE.AmbientLight(A,1))}}return s}function x(e,t,r){var i=e.Objects.subNodes.AnimationCurveNode;var a=e.Objects.subNodes.AnimationCurve;var s=e.Objects.subNodes.AnimationLayer;var n=e.Objects.subNodes.AnimationStack;var o=30;if("GlobalSettings"in e&&"TimeMode"in e.GlobalSettings.properties){var l=[30,120,100,60,50,48,30,30,29.97,29.97,25,24,1,23.976,30,96,72,59.94];var h=e.GlobalSettings.properties.TimeMode.value;if(h===14){if("CustomFrameRate"in e.GlobalSettings.properties){o=e.GlobalSettings.properties.CustomFrameRate.value;o=o===-1?30:o}}else if(h<=17){o=l[h]}}var c={curves:new Map,layers:{},stacks:{},length:0,fps:o,frames:0};var u=[];for(var p in i){if(p.match(/\d+/)){var f=R(e,i[p],t,r);u.push(f)}}var d=new Map;for(var v=0;v<u.length;++v){if(u[v]===null){continue}d.set(u[v].id,u[v])}var m=[];for(p in a){if(p.match(/\d+/)){var g=M(a[p]);if(!t.has(g.id))continue;m.push(g);var E=t.get(g.id).parents[0];var y=E.ID;var T=E.relationship;var b="";if(T.match(/X/)){b="x"}else if(T.match(/Y/)){b="y"}else if(T.match(/Z/)){b="z"}else{continue}d.get(y).curves[b]=g}}d.forEach(function(e){var t=e.containerBoneID;if(!c.curves.has(t)){c.curves.set(t,{T:null,R:null,S:null})}c.curves.get(t)[e.attr]=e;if(e.attr==="R"){var r=e.curves;if(r.x===null){r.x={version:null,times:[0],values:[0]}}if(r.y===null){r.y={version:null,times:[0],values:[0]}}if(r.z===null){r.z={version:null,times:[0],values:[0]}}r.x.values=r.x.values.map(THREE.Math.degToRad);r.y.values=r.y.values.map(THREE.Math.degToRad);r.z.values=r.z.values.map(THREE.Math.degToRad);if(e.preRotations!==null){var i=(new THREE.Euler).setFromVector3(e.preRotations,"ZYX");i=(new THREE.Quaternion).setFromEuler(i);var a=new THREE.Euler;var s=new THREE.Quaternion;for(var n=0;n<r.x.times.length;++n){a.set(r.x.values[n],r.y.values[n],r.z.values[n],"ZYX");s.setFromEuler(a).premultiply(i);a.setFromQuaternion(s,"ZYX");r.x.values[n]=a.x;r.y.values[n]=a.y;r.z.values[n]=a.z}}}});for(var p in s){var w=[];var x=t.get(parseInt(p)).children;for(var S=0;S<x.length;S++){if(d.has(x[S].ID)){var k=d.get(x[S].ID);var z=k.containerBoneID;if(w[z]===undefined){w[z]={T:null,R:null,S:null}}w[z][k.attr]=k}}c.layers[p]=w}for(var p in n){var P=[];var x=t.get(parseInt(p)).children;var C={max:0,min:Number.MAX_VALUE};for(var S=0;S<x.length;++S){var L=c.layers[x[S].ID];if(L!==undefined){P.push(L);for(var I=0,B=L.length;I<B;++I){var w=L[I];if(w){H(w,C)}}}}if(C.max>C.min){c.stacks[p]={name:n[p].attrName,layers:P,length:C.max-C.min,frames:(C.max-C.min)*c.fps}}}return c}function R(e,t,r,i){var a=e.Objects.subNodes.Model;var s={id:t.id,attr:t.attrName,internalID:t.id,attrX:false,attrY:false,attrZ:false,containerBoneID:-1,containerID:-1,curves:{x:null,y:null,z:null},preRotations:null};if(s.attr.match(/S|R|T/)){for(var n in t.properties){if(n.match(/X/)){s.attrX=true}if(n.match(/Y/)){s.attrY=true}if(n.match(/Z/)){s.attrZ=true}}}else{return null}var o=r.get(s.id);var l=o.parents;for(var h=l.length-1;h>=0;--h){var c=Y(i.skeleton.bones,function(e){return e.FBX_ID===l[h].ID});if(c>-1){s.containerBoneID=c;s.containerID=l[h].ID;var u=a[s.containerID.toString()];if("PreRotation"in u.properties){s.preRotations=q(u.properties.PreRotation).multiplyScalar(Math.PI/180)}break}}return s}function M(e){return{version:null,id:e.id,internalID:e.id,times:e.subNodes.KeyTime.properties.a.map(X),values:e.subNodes.KeyValueFloat.properties.a,attrFlag:e.subNodes.KeyAttrFlags.properties.a,attrData:e.subNodes.KeyAttrDataFloat.properties.a}}function H(e,t){if(e.R){S(e.R.curves,t)}if(e.S){S(e.S.curves,t)}if(e.T){S(e.T.curves,t)}}function S(e,t){if(e.x){k(e.x,t)}if(e.y){k(e.y,t)}if(e.z){k(e.z,t)}}function k(e,t){t.max=e.times[e.times.length-1]>t.max?e.times[e.times.length-1]:t.max;t.min=e.times[0]<t.min?e.times[0]:t.min}function z(e,t){if(e.animations===undefined){e.animations=[]}var r=t.stacks;for(var i in r){var a=r[i];var s={name:a.name,fps:t.fps,length:a.length,hierarchy:[]};var n=e.skeleton.bones;for(var o=0,l=n.length;o<l;++o){var h=n[o];var c=h.name.replace(/.*:/,"");var u=Y(n,function(e){return h.parent===e});s.hierarchy.push({parent:u,name:c,keys:[]})}for(var p=0;p<=a.frames;p++){for(var o=0,l=n.length;o<l;++o){var h=n[o];var f=o;var d=a.layers[0][f];for(var v=0,m=s.hierarchy.length;v<m;++v){var g=s.hierarchy[v];if(g.name===h.name){g.keys.push(L(t,d,h,p))}}}}e.animations.push(THREE.AnimationClip.parseAnimation(s,n))}}var P=new THREE.Euler;var C=new THREE.Quaternion;function L(e,t,r,i){var a={time:i/e.fps,pos:r.position.toArray(),rot:r.quaternion.toArray(),scl:r.scale.toArray()};if(t===undefined)return a;P.setFromQuaternion(r.quaternion,"ZYX",false);try{if(B(t,"T")&&A(t.T,i)){if(t.T.curves.x.values[i]){a.pos[0]=t.T.curves.x.values[i]}if(t.T.curves.y.values[i]){a.pos[1]=t.T.curves.y.values[i]}if(t.T.curves.z.values[i]){a.pos[2]=t.T.curves.z.values[i]}}if(B(t,"R")&&A(t.R,i)){if(t.R.curves.x.values[i]){P.x=t.R.curves.x.values[i]}if(t.R.curves.y.values[i]){P.y=t.R.curves.y.values[i]}if(t.R.curves.z.values[i]){P.z=t.R.curves.z.values[i]}C.setFromEuler(P);a.rot=C.toArray()}if(B(t,"S")&&A(t.S,i)){if(t.T.curves.x.values[i]){a.scl[0]=t.S.curves.x.values[i]}if(t.T.curves.y.values[i]){a.scl[1]=t.S.curves.y.values[i]}if(t.T.curves.z.values[i]){a.scl[2]=t.S.curves.z.values[i]}}}catch(e){console.log("THREE.FBXLoader: ",r);console.log("THREE.FBXLoader: ",e)}return a}var I=["x","y","z"];function B(e,t){if(e===undefined){return false}var r=e[t];if(!r){return false}return I.every(function(e){return r.curves[e]!==null})}function A(e,t){return I.every(function(r){return D(e.curves[r],t)})}function D(e,t){return e.values[t]!==undefined}function F(){}Object.assign(F.prototype,{getPrevNode:function(){return this.nodeStack[this.currentIndent-2]},getCurrentNode:function(){return this.nodeStack[this.currentIndent-1]},getCurrentProp:function(){return this.currentProp},pushStack:function(e){this.nodeStack.push(e);this.currentIndent+=1},popStack:function(){this.nodeStack.pop();this.currentIndent-=1},setCurrentProp:function(e,t){this.currentProp=e;this.currentPropName=t},parse:function(e){this.currentIndent=0;this.allNodes=new j;this.nodeStack=[];this.currentProp=[];this.currentPropName="";var t=e.split("\n");for(var r=0,i=t.length;r<i;r++){var a=t[r];if(a.match(/^[\s\t]*;/)){continue}if(a.match(/^[\s\t]*$/)){continue}var s=new RegExp("^\\t{"+this.currentIndent+"}(\\w+):(.*){","");var n=a.match(s);if(n){var o=n[1].trim().replace(/^"/,"").replace(/"$/,"");var l=n[2].split(",");for(var h=0,a=l.length;h<a;h++){l[h]=l[h].trim().replace(/^"/,"").replace(/"$/,"")}this.parseNodeBegin(a,o,l||null);continue}var c=new RegExp("^\\t{"+this.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)");var n=a.match(c);if(n){var u=n[1].replace(/^"/,"").replace(/"$/,"").trim();var p=n[2].replace(/^"/,"").replace(/"$/,"").trim();if(u==="Content"&&p===","){p=t[++r].replace(/"/g,"").replace(/,$/,"").trim()}this.parseNodeProperty(a,u,p);continue}var f=new RegExp("^\\t{"+(this.currentIndent-1)+"}}");if(a.match(f)){this.nodeEnd();continue}if(a.match(/^[^\s\t}]/)){this.parseNodePropertyContinued(a)}}return this.allNodes},parseNodeBegin:function(e,t,r){var i={name:t,properties:{},subNodes:{}};var a=this.parseNodeAttr(r);var s=this.getCurrentNode();if(this.currentIndent===0){this.allNodes.add(t,i)}else{if(t in s.subNodes){var n=s.subNodes[t];if(this.isFlattenNode(s.subNodes[t])){if(a.id===""){s.subNodes[t]=[];s.subNodes[t].push(n)}else{s.subNodes[t]={};s.subNodes[t][n.id]=n}}if(a.id===""){s.subNodes[t].push(i)}else{s.subNodes[t][a.id]=i}}else if(typeof a.id==="number"||a.id.match(/^\d+$/)){s.subNodes[t]={};s.subNodes[t][a.id]=i}else{s.subNodes[t]=i}}if(r){i.id=a.id;i.attrName=a.name;i.attrType=a.type}this.pushStack(i)},parseNodeAttr:function(e){var t=e[0];if(e[0]!==""){t=parseInt(e[0]);if(isNaN(t)){t=e[0]}}var r="",i="";if(e.length>1){r=e[1].replace(/^(\w+)::/,"");i=e[2]}return{id:t,name:r,type:i}},parseNodeProperty:function(e,t,r){var i=this.getCurrentNode();var a=i.name;if(a!==undefined){var s=a.match(/Properties(\d)+/);if(s){this.parseNodeSpecialProperty(e,t,r);return}}if(t==="C"){var n=r.split(",").slice(1);var o=parseInt(n[0]);var l=parseInt(n[1]);var h=r.split(",").slice(3);h=h.map(function(e){return e.trim().replace(/^"/,"")});t="connections";r=[o,l];Z(r,h);if(i.properties[t]===undefined){i.properties[t]=[]}}if(t==="Node"){var c=parseInt(r);i.properties.id=c;i.id=c}if(t in i.properties){if(Array.isArray(i.properties[t])){i.properties[t].push(r)}else{i.properties[t]+=r}}else{if(Array.isArray(i.properties[t])){i.properties[t].push(r)}else{i.properties[t]=r}}this.setCurrentProp(i.properties,t);if(t==="a"&&r.slice(-1)!==","){i.properties.a=G(r)}},parseNodePropertyContinued:function(e){this.currentProp[this.currentPropName]+=e;if(e.slice(-1)!==","){var t=this.getCurrentNode();t.properties.a=G(t.properties.a)}},parseNodeSpecialProperty:function(e,t,r){var i=r.split('",');for(var a=0,s=i.length;a<s;a++){i[a]=i[a].trim().replace(/^\"/,"").replace(/\s/,"_")}var n=i[0];var o=i[1];var l=i[2];var h=i[3];var c=i[4];switch(o){case"int":case"enum":case"bool":case"ULongLong":c=parseInt(c);break;case"double":case"Number":case"FieldOfView":c=parseFloat(c);break;case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":c=G(c);break}this.getPrevNode().properties[n]={type:o,type2:l,flag:h,value:c};this.setCurrentProp(this.getPrevNode().properties,n)},nodeEnd:function(){this.popStack()},isFlattenNode:function(e){return"subNodes"in e&&"properties"in e?true:false}});function N(){}Object.assign(N.prototype,{parse:function(e){var t=new U(e);t.skip(23);var r=t.getUint32();var i=new j;var a=0;while(!this.endOfContent(t)){try{var s=this.parseNode(t,r);if(s!==null){i.add(s.name,s)}}catch(e){console.log(e)}}return i},endOfContent:function(e){if(e.size()%16===0){return(e.getOffset()+160+16&~15)>=e.size()}else{return e.getOffset()+160+16>=e.size()}},parseNode:function(e,t){var r=t>=7500?e.getUint64():e.getUint32();var i=t>=7500?e.getUint64():e.getUint32();var a=t>=7500?e.getUint64():e.getUint32();var s=e.getUint8();var n=e.getString(s);if(r===0)return null;var o=[];for(var l=0;l<i;l++){o.push(this.parseProperty(e))}var h=o.length>0?o[0]:"";var c=o.length>1?o[1]:"";var u=o.length>2?o[2]:"";var p={};var f={};var d=false;if(i===1&&e.getOffset()===r){d=true}while(r>e.getOffset()){var v=this.parseNode(e,t);if(v===null)continue;if(v.singleProperty===true){var m=v.propertyList[0];if(Array.isArray(m)){p[v.name]=v;v.properties.a=m}else{f[v.name]=m}continue}if(n==="Connections"&&v.name==="C"){var g=[];for(var l=1,E=v.propertyList.length;l<E;l++){g[l-1]=v.propertyList[l]}if(f.connections===undefined){f.connections=[]}f.connections.push(g);continue}if(v.name.match(/^Properties\d+$/)){var y=Object.keys(v.properties);for(var l=0,E=y.length;l<E;l++){var T=y[l];f[T]=v.properties[T]}continue}if(n.match(/^Properties\d+$/)&&v.name==="P"){var b=v.propertyList[0];var w=v.propertyList[1];var x=v.propertyList[2];var R=v.propertyList[3];var M;if(b.indexOf("Lcl ")===0)b=b.replace("Lcl ","Lcl_");if(w.indexOf("Lcl ")===0)w=w.replace("Lcl ","Lcl_");if(w==="ColorRGB"||w==="Vector"||w==="Vector3D"||w.indexOf("Lcl_")===0){M=[v.propertyList[4],v.propertyList[5],v.propertyList[6]]}else{M=v.propertyList[4]}f[b]={type:w,type2:x,flag:R,value:M};continue}if(p[v.name]===undefined){if(typeof v.id==="number"){p[v.name]={};p[v.name][v.id]=v}else{p[v.name]=v}}else{if(v.id===""){if(!Array.isArray(p[v.name])){p[v.name]=[p[v.name]]}p[v.name].push(v)}else{if(p[v.name][v.id]===undefined){p[v.name][v.id]=v}else{if(!Array.isArray(p[v.name][v.id])){p[v.name][v.id]=[p[v.name][v.id]]}p[v.name][v.id].push(v)}}}}return{singleProperty:d,id:h,attrName:c,attrType:u,name:n,properties:f,propertyList:o,subNodes:p}},parseProperty:function(e){var t=e.getChar();switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":var r=e.getUint32();return e.getArrayBuffer(r);case"S":var r=e.getUint32();return e.getString(r);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":var i=e.getUint32();var a=e.getUint32();var s=e.getUint32();if(a===0){switch(t){case"b":case"c":return e.getBooleanArray(i);case"d":return e.getFloat64Array(i);case"f":return e.getFloat32Array(i);case"i":return e.getInt32Array(i);case"l":return e.getInt64Array(i)}}if(window.Zlib===undefined){throw new Error("THREE.FBXLoader: External library Inflate.min.js required, obtain or import from https://github.com/imaya/zlib.js")}var n=new Zlib.Inflate(new Uint8Array(e.getArrayBuffer(s)));var o=new U(n.decompress().buffer);switch(t){case"b":case"c":return o.getBooleanArray(i);case"d":return o.getFloat64Array(i);case"f":return o.getFloat32Array(i);case"i":return o.getInt32Array(i);case"l":return o.getInt64Array(i)}default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}});function U(e,t){this.dv=new DataView(e);this.offset=0;this.littleEndian=t!==undefined?t:true}Object.assign(U.prototype,{getOffset:function(){return this.offset},size:function(){return this.dv.buffer.byteLength},skip:function(e){this.offset+=e},getBoolean:function(){return(this.getUint8()&1)===1},getBooleanArray:function(e){var t=[];for(var r=0;r<e;r++){t.push(this.getBoolean())}return t},getInt8:function(){var e=this.dv.getInt8(this.offset);this.offset+=1;return e},getInt8Array:function(e){var t=[];for(var r=0;r<e;r++){t.push(this.getInt8())}return t},getUint8:function(){var e=this.dv.getUint8(this.offset);this.offset+=1;return e},getUint8Array:function(e){var t=[];for(var r=0;r<e;r++){t.push(this.getUint8())}return t},getInt16:function(){var e=this.dv.getInt16(this.offset,this.littleEndian);this.offset+=2;return e},getInt16Array:function(e){var t=[];for(var r=0;r<e;r++){t.push(this.getInt16())}return t},getUint16:function(){var e=this.dv.getUint16(this.offset,this.littleEndian);this.offset+=2;return e},getUint16Array:function(e){var t=[];for(var r=0;r<e;r++){t.push(this.getUint16())}return t},getInt32:function(){var e=this.dv.getInt32(this.offset,this.littleEndian);this.offset+=4;return e},getInt32Array:function(e){var t=[];for(var r=0;r<e;r++){t.push(this.getInt32())}return t},getUint32:function(){var e=this.dv.getUint32(this.offset,this.littleEndian);this.offset+=4;return e},getUint32Array:function(e){var t=[];for(var r=0;r<e;r++){t.push(this.getUint32())}return t},getInt64:function(){var e,t;if(this.littleEndian){e=this.getUint32();t=this.getUint32()}else{t=this.getUint32();e=this.getUint32()}if(t&2147483648){t=~t&4294967295;e=~e&4294967295;if(e===4294967295)t=t+1&4294967295;e=e+1&4294967295;return-(t*4294967296+e)}return t*4294967296+e},getInt64Array:function(e){var t=[];for(var r=0;r<e;r++){t.push(this.getInt64())}return t},getUint64:function(){var e,t;if(this.littleEndian){e=this.getUint32();t=this.getUint32()}else{t=this.getUint32();e=this.getUint32()}return t*4294967296+e},getUint64Array:function(e){var t=[];for(var r=0;r<e;r++){t.push(this.getUint64())}return t},getFloat32:function(){var e=this.dv.getFloat32(this.offset,this.littleEndian);this.offset+=4;return e},getFloat32Array:function(e){var t=[];for(var r=0;r<e;r++){t.push(this.getFloat32())}return t},getFloat64:function(){var e=this.dv.getFloat64(this.offset,this.littleEndian);this.offset+=8;return e},getFloat64Array:function(e){var t=[];for(var r=0;r<e;r++){t.push(this.getFloat64())}return t},getArrayBuffer:function(e){var t=this.dv.buffer.slice(this.offset,this.offset+e);this.offset+=e;return t},getChar:function(){return String.fromCharCode(this.getUint8())},getString:function(e){var t="";while(e>0){var r=this.getUint8();e--;if(r===0)break;t+=String.fromCharCode(r)}t=decodeURIComponent(escape(t));this.skip(e);return t}});function j(){}Object.assign(j.prototype,{add:function(e,t){this[e]=t}});function O(e){var t="Kaydara FBX Binary  \0";return e.byteLength>=t.length&&t===$(e,0,t.length)}function _(e){var t=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];var r=0;function i(t){var i=e[t-1];e=e.slice(r+t);r++;return i}for(var a=0;a<t.length;++a){var s=i(1);if(s===t[a]){return false}}return true}function V(e){var t=/FBXVersion: (\d+)/;var r=e.match(t);if(r){var i=parseInt(r[1]);return i}throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function X(e){return e/46186158e3}function G(e){var t=e.split(",");for(var r=0,i=t.length;r<i;r++){t[r]=parseFloat(t[r])}return t}function q(e){return(new THREE.Vector3).fromArray(e.value)}function W(e){return(new THREE.Color).fromArray(e.value)}function $(e,t,r){if(t===undefined)t=0;if(r===undefined)r=e.byteLength;var i=new Uint8Array(e,t,r);if(window.TextDecoder!==undefined){return(new TextDecoder).decode(i)}var a="";for(var s=0,n=i.length;s<n;s++){a+=String.fromCharCode(i[s])}return a}function Y(e,t){for(var r=0,i=e.length;r<i;r++){if(t(e[r]))return r}return-1}function Z(e,t){for(var r=0,i=e.length,a=t.length;r<a;r++,i++){e[i]=t[r]}}function K(e,t,r,i){for(var a=r,s=0;a<i;a++,s++){e[s]=t[a]}return e}})()},function(e,t){THREE.OBJLoader=function(){var e=/^[og]\s*(.+)?/;var t=/^mtllib /;var r=/^usemtl /;function i(){var e={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materialLibraries:[],startObject:function(e,t){if(this.object&&this.object.fromDeclaration===false){this.object.name=e;this.object.fromDeclaration=t!==false;return}var r=this.object&&typeof this.object.currentMaterial==="function"?this.object.currentMaterial():undefined;if(this.object&&typeof this.object._finalize==="function"){this.object._finalize(true)}this.object={name:e||"",fromDeclaration:t!==false,geometry:{vertices:[],normals:[],colors:[],uvs:[]},materials:[],smooth:true,startMaterial:function(e,t){var r=this._finalize(false);if(r&&(r.inherited||r.groupCount<=0)){this.materials.splice(r.index,1)}var i={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&t.length>0?t[t.length-1]:"",smooth:r!==undefined?r.smooth:this.smooth,groupStart:r!==undefined?r.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:false,clone:function(e){var t={index:typeof e==="number"?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:false};t.clone=this.clone.bind(t);return t}};this.materials.push(i);return i},currentMaterial:function(){if(this.materials.length>0){return this.materials[this.materials.length-1]}return undefined},_finalize:function(e){var t=this.currentMaterial();if(t&&t.groupEnd===-1){t.groupEnd=this.geometry.vertices.length/3;t.groupCount=t.groupEnd-t.groupStart;t.inherited=false}if(e&&this.materials.length>1){for(var r=this.materials.length-1;r>=0;r--){if(this.materials[r].groupCount<=0){this.materials.splice(r,1)}}}if(e&&this.materials.length===0){this.materials.push({name:"",smooth:this.smooth})}return t}};if(r&&r.name&&typeof r.clone==="function"){var i=r.clone(0);i.inherited=true;this.object.materials.push(i)}this.objects.push(this.object)},finalize:function(){if(this.object&&typeof this.object._finalize==="function"){this.object._finalize(true)}},parseVertexIndex:function(e,t){var r=parseInt(e,10);return(r>=0?r-1:r+t/3)*3},parseNormalIndex:function(e,t){var r=parseInt(e,10);return(r>=0?r-1:r+t/3)*3},parseUVIndex:function(e,t){var r=parseInt(e,10);return(r>=0?r-1:r+t/2)*2},addVertex:function(e,t,r){var i=this.vertices;var a=this.object.geometry.vertices;a.push(i[e+0],i[e+1],i[e+2]);a.push(i[t+0],i[t+1],i[t+2]);a.push(i[r+0],i[r+1],i[r+2])},addVertexPoint:function(e){var t=this.vertices;var r=this.object.geometry.vertices;r.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){var t=this.vertices;var r=this.object.geometry.vertices;r.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,r){var i=this.normals;var a=this.object.geometry.normals;a.push(i[e+0],i[e+1],i[e+2]);a.push(i[t+0],i[t+1],i[t+2]);a.push(i[r+0],i[r+1],i[r+2])},addColor:function(e,t,r){var i=this.colors;var a=this.object.geometry.colors;a.push(i[e+0],i[e+1],i[e+2]);a.push(i[t+0],i[t+1],i[t+2]);a.push(i[r+0],i[r+1],i[r+2])},addUV:function(e,t,r){var i=this.uvs;var a=this.object.geometry.uvs;a.push(i[e+0],i[e+1]);a.push(i[t+0],i[t+1]);a.push(i[r+0],i[r+1])},addUVLine:function(e){var t=this.uvs;var r=this.object.geometry.uvs;r.push(t[e+0],t[e+1])},addFace:function(e,t,r,i,a,s,n,o,l){var h=this.vertices.length;var c=this.parseVertexIndex(e,h);var u=this.parseVertexIndex(t,h);var p=this.parseVertexIndex(r,h);this.addVertex(c,u,p);if(i!==undefined&&i!==""){var f=this.uvs.length;c=this.parseUVIndex(i,f);u=this.parseUVIndex(a,f);p=this.parseUVIndex(s,f);this.addUV(c,u,p)}if(n!==undefined&&n!==""){var d=this.normals.length;c=this.parseNormalIndex(n,d);u=n===o?c:this.parseNormalIndex(o,d);p=n===l?c:this.parseNormalIndex(l,d);this.addNormal(c,u,p)}if(this.colors.length>0){this.addColor(c,u,p)}},addPointGeometry:function(e){this.object.geometry.type="Points";var t=this.vertices.length;for(var r=0,i=e.length;r<i;r++){this.addVertexPoint(this.parseVertexIndex(e[r],t))}},addLineGeometry:function(e,t){this.object.geometry.type="Line";var r=this.vertices.length;var i=this.uvs.length;for(var a=0,s=e.length;a<s;a++){this.addVertexLine(this.parseVertexIndex(e[a],r))}for(var n=0,s=t.length;n<s;n++){this.addUVLine(this.parseUVIndex(t[n],i))}}};e.startObject("",false);return e}function a(e){this.manager=e!==undefined?e:THREE.DefaultLoadingManager;this.materials=null}a.prototype={constructor:a,load:function(e,t,r,i){var a=this;var s=new THREE.FileLoader(a.manager);s.setPath(this.path);s.load(e,function(e){t(a.parse(e))},r,i)},setPath:function(e){this.path=e;return this},setMaterials:function(e){this.materials=e;return this},parse:function(a){console.time("OBJLoader");var s=new i;if(a.indexOf("\r\n")!==-1){a=a.replace(/\r\n/g,"\n")}if(a.indexOf("\\\n")!==-1){a=a.replace(/\\\n/g,"")}var n=a.split("\n");var o="",l="";var h=0;var c=[];var u=typeof"".trimLeft==="function";for(var p=0,f=n.length;p<f;p++){o=n[p];o=u?o.trimLeft():o.trim();h=o.length;if(h===0)continue;l=o.charAt(0);if(l==="#")continue;if(l==="v"){var d=o.split(/\s+/);switch(d[0]){case"v":s.vertices.push(parseFloat(d[1]),parseFloat(d[2]),parseFloat(d[3]));if(d.length===8){s.colors.push(parseFloat(d[4]),parseFloat(d[5]),parseFloat(d[6]))}break;case"vn":s.normals.push(parseFloat(d[1]),parseFloat(d[2]),parseFloat(d[3]));break;case"vt":s.uvs.push(parseFloat(d[1]),parseFloat(d[2]));break}}else if(l==="f"){var v=o.substr(1).trim();var m=v.split(/\s+/);var g=[];for(var E=0,y=m.length;E<y;E++){var T=m[E];if(T.length>0){var b=T.split("/");g.push(b)}}var w=g[0];for(var E=1,y=g.length-1;E<y;E++){var x=g[E];var R=g[E+1];s.addFace(w[0],x[0],R[0],w[1],x[1],R[1],w[2],x[2],R[2])}}else if(l==="l"){var M=o.substring(1).trim().split(" ");var H=[],S=[];if(o.indexOf("/")===-1){H=M}else{for(var k=0,z=M.length;k<z;k++){var P=M[k].split("/");if(P[0]!=="")H.push(P[0]);if(P[1]!=="")S.push(P[1])}}s.addLineGeometry(H,S)}else if(l==="p"){var v=o.substr(1).trim();var C=v.split(" ");s.addPointGeometry(C)}else if((c=e.exec(o))!==null){var L=(" "+c[0].substr(1).trim()).substr(1);s.startObject(L)}else if(r.test(o)){s.object.startMaterial(o.substring(7).trim(),s.materialLibraries)}else if(t.test(o)){s.materialLibraries.push(o.substring(7).trim())}else if(l==="s"){c=o.split(" ");if(c.length>1){var I=c[1].trim().toLowerCase();s.object.smooth=I!=="0"&&I!=="off"}else{s.object.smooth=true}var B=s.object.currentMaterial();if(B)B.smooth=s.object.smooth}else{if(o==="\0")continue;throw new Error('THREE.OBJLoader: Unexpected line: "'+o+'"')}}s.finalize();var A=new THREE.Group;A.materialLibraries=[].concat(s.materialLibraries);for(var p=0,f=s.objects.length;p<f;p++){var D=s.objects[p];var F=D.geometry;var N=D.materials;var U=F.type==="Line";var j=F.type==="Points";var O=false;if(F.vertices.length===0)continue;var _=new THREE.BufferGeometry;_.addAttribute("position",new THREE.Float32BufferAttribute(F.vertices,3));if(F.normals.length>0){_.addAttribute("normal",new THREE.Float32BufferAttribute(F.normals,3))}else{_.computeVertexNormals()}if(F.colors.length>0){O=true;_.addAttribute("color",new THREE.Float32BufferAttribute(F.colors,3))}if(F.uvs.length>0){_.addAttribute("uv",new THREE.Float32BufferAttribute(F.uvs,2))}var V=[];for(var X=0,G=N.length;X<G;X++){var q=N[X];var B=undefined;if(this.materials!==null){B=this.materials.create(q.name);if(U&&B&&!(B instanceof THREE.LineBasicMaterial)){var W=new THREE.LineBasicMaterial;W.copy(B);W.lights=false;B=W}else if(j&&B&&!(B instanceof THREE.PointsMaterial)){var $=new THREE.PointsMaterial({size:10,sizeAttenuation:false});W.copy(B);B=$}}if(!B){if(U){B=new THREE.LineBasicMaterial}else if(j){B=new THREE.PointsMaterial({size:1,sizeAttenuation:false})}else{B=new THREE.MeshPhongMaterial}B.name=q.name}B.flatShading=q.smooth?false:true;B.vertexColors=O?THREE.VertexColors:THREE.NoColors;V.push(B)}var Y;if(V.length>1){for(var X=0,G=N.length;X<G;X++){var q=N[X];_.addGroup(q.groupStart,q.groupCount,X)}if(U){Y=new THREE.LineSegments(_,V)}else if(j){Y=new THREE.Points(_,V)}else{Y=new THREE.Mesh(_,V)}}else{if(U){Y=new THREE.LineSegments(_,V[0])}else if(j){Y=new THREE.Points(_,V[0])}else{Y=new THREE.Mesh(_,V[0])}}Y.name=D.name;A.add(Y)}console.timeEnd("OBJLoader");return A}};return a}()},function(e,t,r){"use strict";r.r(t);var i=r(1);var a=r(2);var s=r(3);var n=r(4);var o=r(5);var l=r(6);var h=r(0);var c=r(7);class u{constructor(e){this.scene=e.scene;this.camera=e.camera.camera;this.renderer=new THREE.WebGLRenderer({});this.renderer.setClearColor(4473924,1);this.renderer.gammaInput=true;this.renderer.gammaOutput=true;this.padding={x:64,y:96,minX:640,minY:480};this.setSize();const t=.5;const r=.125;const i=.96;this.passRender=new THREE.RenderPass(this.scene,this.camera);this.passPoster=new THREE.PosterPass(this.size);this.passBloom=new THREE.UnrealBloomPass(this.size,t,r,i);this.passBloom.renderToScreen=true;this.composer=new THREE.EffectComposer(this.renderer);this.composer.addPass(this.passRender);this.composer.addPass(this.passPoster);this.composer.addPass(this.passBloom);window.addEventListener("resize",()=>{this.resize()});this.domElement=document.querySelector("#canvas-target");this.domElement.append(this.renderer.domElement);this.resize();e.resize()}setSize(){const e=Math.min(window.innerWidth,Math.max(this.padding.minX,window.innerWidth-this.padding.x*2));const t=Math.min(window.innerHeight,Math.max(this.padding.minY,window.innerHeight-this.padding.y*2));this.width=e;this.height=t;if(!this.size){this.size=new THREE.Vector2(this.width,this.height)}else{this.size.x=this.width;this.size.y=this.height}}resize(){this.setSize();this.domElement.style.width=`${this.width}px`;this.domElement.style.height=`${this.height}px`;this.renderer.setSize(this.width,this.height);this.composer.setSize(this.width,this.height);this.passBloom.setSize(this.width,this.height)}draw(e){this.composer.render(e)}}class p{constructor(e){this.root=e;this.position=e.player.position;this.rotation=e.player.rotation;this.height=e.player.height;this.target=new THREE.Vector3;this.fov=65;this.aspectRatio=this.root.width/this.root.height;this.offset=1;this.camera=new THREE.PerspectiveCamera(this.fov,this.aspectRatio,.1,2e6);this.camera.up=new THREE.Vector3(0,1,0)}resize(e,t){this.aspectRatio=this.root.width/this.root.height;this.camera.aspect=this.aspectRatio;this.camera.updateProjectionMatrix()}update(e){const t=this.offset-this.offset*Math.abs(Math.sin(this.rotation.y));const r=this.offset;const i=this.position.y+this.height;this.camera.position.x=this.position.x-Math.sin(this.rotation.x)*t/4;this.camera.position.y=i-Math.sin(this.rotation.y)*r/4;this.camera.position.z=this.position.z-Math.cos(this.rotation.x)*t/4;this.target.x=this.position.x+Math.sin(this.rotation.x)*t;this.target.y=i+Math.sin(this.rotation.y)*r;this.target.z=this.position.z+Math.cos(this.rotation.x)*t;this.camera.lookAt(this.target)}}class f{constructor(e){this.scene=e.scene;this.sky=new THREE.Sky;this.sky.scale.setScalar(45e4);const t=4e5;const r=.25;const i=.4875;const a=Math.PI*(i-.5);const s=Math.PI*2*(r-.5);const n=new THREE.Vector3(t*Math.cos(s),t*Math.sin(s)*Math.sin(a),t*Math.sin(s)*Math.cos(a));this.sky.material.uniforms.sunPosition.value.copy(n);this.scene.add(this.sky);this.lights={point:{},ambient:{},directional:{},hemisphere:{}};this.lights.point.a=new THREE.PointLight(16711680,1,20,2);this.lights.point.b=new THREE.PointLight(16777215,1,32,2);this.lights.point.c=new THREE.PointLight(16777215,1,20,2);this.lights.ambient.a=new THREE.AmbientLight(16777215,.3);this.lights.directional.a=new THREE.DirectionalLight(16777215,.5);this.lights.hemisphere.a=new THREE.HemisphereLight(0,255,.25);this.lights.point.a.position.set(-8,10,22);this.lights.point.b.position.set(0,10,-4);this.lights.point.c.position.set(26,10,6);this.lights.directional.a.position.set(-1,1.5,-1);Object.keys(this.lights).forEach(e=>{Object.keys(this.lights[e]).forEach(t=>{this.scene.add(this.lights[e][t])})})}}class d{constructor(e){this.path=`${APP_ROOT}/${e}/`;this.mat={};this.mat.default=new THREE.MeshPhysicalMaterial({emissive:0,roughness:1,envMapIntensity:.25});this.mat.porcelain=new THREE.MeshPhysicalMaterial({color:16777215,emissive:8947848,emissiveIntensity:.6,roughness:.55,metalness:.125,envMapIntensity:.5});this.mat.metal=new THREE.MeshPhysicalMaterial({color:11046521,emissive:0,roughness:.25,metalness:1,envMapIntensity:.5});const t=["posx","negx","posy","negy","posz","negz"].map(e=>`${this.path}envmap/${e}.jpg`);this.envMap=(new THREE.CubeTextureLoader).load(t);this.normalMap=(new THREE.TextureLoader).load(this.path+"textures/noise.jpg");this.normalMap.wrapS=this.normalMap.wrapT=THREE.RepeatWrapping;this.normalMap.repeat.set(32,32);Object.keys(this.mat).forEach(e=>{if(this.mat[e].type&&this.mat[e].type==="MeshPhysicalMaterial"){this.mat[e].envMap=this.envMap}});this.uniforms={time:{value:0}};this.loaded={}}conform(e){if(!this.loaded[e.name]){this.loaded[e.name]=e}e.envMap=this.envMap;e.envMapIntensity=.5;switch(e.name){case"concrete":e.normalScale.x=.25;e.normalScale.y=.25;break;case"gold":break;case"neon":e.emissive=new THREE.Color(1,1,1);e.emissiveIntensity=1;break;case"plastic":break;default:break}}getCustomMaterial(e){const t=this.mat.metal.clone();t.onBeforeCompile=(e=>{e.vertexShader=`uniform float time;\n${e.vertexShader}`;const t=`\n        vec4 mvp = modelMatrix * vec4(position, 1.0);\n        float theta = sin(time * 0.1 + mvp.x / 2.0);\n        float c = cos(theta);\n        float s = sin(theta);\n        float off = 1.0;// + 0.2 * sin(time + position.x * 200.0);\n        mat3 roty = mat3(c, 0, s, 0, 1, 0, -s, 0, c);\n        //mat3 sy = mat3(s, 0, 0, 0, 1, 0, 0, 0, 1);\n        mat4 m = mat4(1, 0, 0, 0, 0, 1, 0, s * off * 2.0, 0, 0, 1, s * off, 0, 0, 0, 1);\n        vec4 t = vec4(position, 1.0) * m;\n        vec3 transformed = vec3(t.x, t.y, t.z);\n        vNormal = vNormal * roty;\n      `;e.vertexShader=e.vertexShader.replace("#include <begin_vertex>",t);e.uniforms.time=this.uniforms.time});t.roughness=.5;return t}update(e){this.uniforms.time.value+=e}}var v=r(8);var m=r(9);var g=r(10);class E{constructor(e){this.path=`${APP_ROOT}/${e}/`;this.materials={};this.images={};this.loaderFBX=new THREE.FBXLoader;this.loaderOBJ=new THREE.OBJLoader}loadFBX(e){return new Promise((t,r)=>{try{this.loaderFBX.load(this.path+e+".fbx",e=>{t(e)})}catch(e){console.log(e);r(e)}})}loadOBJ(e){return new Promise((t,r)=>{try{this.loaderOBJ.load(this.path+e+".obj",e=>{t(e)})}catch(e){console.log(e);r(e)}})}}class y{constructor(e){this.root=e;this.scene=e.scene;this.colliderSystem=e.colliderSystem;this.materials=new d("assets");this.loader=new E("assets");this.loadScene()}loadScene(){this.floor=new THREE.Mesh(new THREE.BoxBufferGeometry(100,1,100),new THREE.MeshPhongMaterial({}));this.floor.position.y=-.25;this.colliderSystem.add(this.floor);this.loader.loadFBX("map").then(e=>{this.scene.add(e);this.conformGroups(e);console.log(this.materials.loaded)},e=>{console.log(e)});this.loader.loadOBJ("collision").then(e=>{this.addCollisionMap(e)},e=>{console.log(e)});this.loader.loadFBX("props").then(e=>{this.scene.add(e);this.conformGroups(e)})}addCollisionMap(e){if(e.type==="Mesh"){this.colliderSystem.add(e)}else if(e.children&&e.children.length){e.children.forEach(e=>{this.addCollisionMap(e)})}}conformGroups(e){if(e.type==="Mesh"){this.materials.conform(e.material)}else if(e.children&&e.children.length){e.children.forEach(e=>{this.conformGroups(e)})}}update(e){this.materials.update(e);if(this.group){}}}const T=(e,t,r)=>{return(t-e)*r+e};const b=function(e,t){return Math.atan2(Math.sin(t-e),Math.cos(t-e))};const w=e=>{return Math.random()*e-e/2};const x=Math.PI*2;const R=(e,t,r)=>{return Math.min(r,Math.max(t,e))};class M{constructor(e){this.root=e;this.position=new THREE.Vector3(-24,1,16);this.rotation=new THREE.Vector2(Math.PI*.55,Math.PI*.03);this.motion=new THREE.Vector3;this.target={position:this.position.clone(),rotation:this.rotation.clone(),motion:this.motion.clone()};this.collider=new Collider.Collider(this.target.position,this.motion);this.collider.setPhysics({gravity:20});this.automove={active:{position:true,rotation:true},speed:{current:0,max:5},position:this.position.clone(),rotation:this.rotation.clone(),threshold:{position:{outer:2,inner:.02},rotation:Math.PI/1e3}};this.speed=8;this.rotationSpeed=Math.PI*.8;this.jump=8;this.jumpSpeedMultiplier=.25;this.height=3;this.falling=false;this.fallTime=0;this.fallTimeThreshold=.2;this.noclip=false;this.noclipSpeed=36;this.toggleNoclip=(()=>{this.noclip=this.noclip==false});this.minPitch=Math.PI*-.125;this.maxPitch=Math.PI*.125;this.adjust={slow:.05,normal:.1,fast:.125,maximum:.3};this.keys={disabled:true};this.group=new THREE.Group;this.light=new THREE.PointLight(16777215,1,10,2);this.light.position.y=this.height+.25;this.group.add(this.light);this.root.scene.add(this.group)}move(e){if(this.keys.left||this.keys.right){if(this.automove.active.rotation){this.target.rotation.copy(this.rotation);this.automove.active.rotation=false}const t=(this.keys.left?1:0)+(this.keys.right?-1:0);this.target.rotation.x+=t*this.rotationSpeed*e}if(this.keys.up||this.keys.down){if(this.automove.active.position){this.automove.active.position=false;this.target.position.copy(this.position)}const e=this.noclip?this.noclipSpeed*(1-Math.abs(Math.sin(this.target.rotation.y))):this.speed;const t=(this.keys.up?1:0)+(this.keys.down?-1:0);this.target.motion.x=Math.sin(this.rotation.x)*e*t;this.target.motion.z=Math.cos(this.rotation.x)*e*t}else{this.target.motion.x=0;this.target.motion.z=0}if(this.keys.jump){if(this.motion.y==0||this.fallTime<this.fallTimeThreshold){this.motion.y=this.jump;this.fallTime=this.fallTimeThreshold}}this.falling=this.motion.y!=0;this.fallTime=this.falling?this.fallTime+e:0;if(this.noclip){this.falling=false;if(this.keys.up||this.keys.down){const e=(this.keys.up?1:0)+(this.keys.down?-1:0);this.target.motion.y=Math.sin(this.target.rotation.y)*e*this.noclipSpeed}else{this.target.motion.y=0}this.motion.y=this.target.motion.y}if(!this.falling){this.motion.x=this.target.motion.x;this.motion.z=this.target.motion.z}else{this.motion.x=T(this.motion.x,this.target.motion.x,this.jumpSpeedMultiplier);this.motion.z=T(this.motion.z,this.target.motion.z,this.jumpSpeedMultiplier)}}applyAutomove(e){if(this.automove.active.position){const t=this.automove.position.clone();t.sub(this.position);const r=t.length();t.normalize();if(r>this.automove.threshold.position.outer){this.automove.speed.current+=(this.automove.speed.max-this.automove.speed.current)*.1;t.multiplyScalar(this.automove.speed.current*e);this.position.add(t)}else{if(r>this.automove.threshold.position.inner){const i=this.automove.speed.max*(r/this.automove.threshold.position.outer);this.automove.speed.current+=(i-this.automove.speed.current)*.1;t.multiplyScalar(this.automove.speed.current*e);this.position.add(t)}else{this.target.position.copy(this.automove.position);this.automove.active.position=false;this.keys.disabled=false}}}else{this.automove.speed.current=0}if(this.automove.active.rotation){const e=b(this.rotation.x,this.automove.rotation.x);const t=b(this.rotation.y,this.automove.rotation.y);const r=Math.hypot(e,t);this.rotation.x+=e*.025;this.rotation.y+=t*.025;if(r<this.automove.threshold.rotation){this.automove.active.rotation=false;this.target.rotation.copy(this.automove.rotation)}}}update(e){this.applyAutomove(e);if(!this.keys.disabled&&!this.automove.active.position){this.move(e);if(!this.noclip){this.collider.move(e,this.root.colliderSystem)}else{this.target.position.x+=this.motion.x*e;this.target.position.y+=this.motion.y*e;this.target.position.z+=this.motion.z*e}this.position.x=T(this.position.x,this.target.position.x,this.adjust.maximum);this.position.y=T(this.position.y,this.target.position.y,this.adjust.maximum);this.position.z=T(this.position.z,this.target.position.z,this.adjust.maximum)}if(!this.automove.active.rotation){this.rotation.x+=b(this.rotation.x,this.target.rotation.x)*this.adjust.normal;this.rotation.y=T(this.rotation.y,this.target.rotation.y,this.adjust.normal)}this.group.position.set(this.position.x,this.position.y,this.position.z)}setRotation(e,t){this.target.rotation.y=e;this.target.rotation.x=t;this.automove.active.rotation=false}getTargetPosition(){return this.target.position}}class H{constructor(){this.element=document.querySelector("#canvas-target");this.width=window.innerWidth;this.height=window.innerHeight;this.scene=new THREE.Scene;this.colliderSystem=new Collider.System;this.player=new M(this);this.camera=new p(this);this.lighting=new f(this);this.map=new y(this);window.addEventListener("resize",()=>{this.resize()})}resize(){const e=this.element.getBoundingClientRect();this.width=e.width;this.height=e.height;this.camera.resize()}update(e){this.player.update(e);this.camera.update(e);this.map.update(e)}}class S{constructor(e,t,r,i){this.x=0;this.y=0;this.origin={x:0,y:0};this.delta={x:0,y:0};this.active=false;this.domElement=e;this.domElement.addEventListener("mousedown",t,false);this.domElement.addEventListener("mousemove",r,false);this.domElement.addEventListener("mouseup",i,false);this.domElement.addEventListener("mouseleave",i,false)}start(e){this.active=true;this.origin.x=e.offsetX;this.origin.y=e.offsetY}move(e){this.x=e.offsetX;this.y=e.offsetY;this.delta.x=this.x-this.origin.x;this.delta.y=this.y-this.origin.y}stop(){this.active=false}}class k{constructor(e){this.keys={};this.onEvent=e;document.addEventListener("keydown",e=>{this.onKeyDown(e)});document.addEventListener("keyup",e=>{this.onKeyUp(e)})}onKeyDown(e){this.keys[e.key]=true;this.onEvent(e.key)}onKeyUp(e){this.keys[e.key]=false;this.onEvent(e.key)}release(e){this.keys[e]=false}isSpecial(){return this.keys["Shift"]||this.keys["Control"]||this.keys["Alt"]}isControl(){return this.keys["Control"]}isShift(){return this.keys["Shift"]}isAlt(){return this.keys["Alt"]}}class z{constructor(e,t,r){this.root=e;this.cvs=document.createElement("canvas");this.ctx=this.cvs.getContext("2d");this.domElement=t;this.canvasTarget=r;this.resize();this.domElement.append(this.cvs);this.prompt={};this.prompt.touchMove={alpha:{current:0,min:0,max:1},size:{current:12,min:12,max:24}};this.prompt.click={alpha:{current:0,min:0,max:1}}}clear(){this.ctx.clearRect(0,0,this.cvs.width,this.cvs.height);this.ctx.font="14px Karla";this.ctx.strokeStyle="#fff";this.ctx.fillStyle="#fff";this.ctx.lineWidth=1.5;this.ctx.lineCap="round"}resize(){this.cvs.width=this.canvasTarget.width;this.cvs.height=this.canvasTarget.height}promptClick(e,t,r,i){if(t){this.prompt.click.alpha.current+=(this.prompt.click.alpha.max-this.prompt.click.alpha.current)*.2}else{this.prompt.click.alpha.current+=(this.prompt.click.alpha.min-this.prompt.click.alpha.current)*.2}if(this.prompt.click.alpha.current>0){this.ctx.globalAlpha=this.prompt.click.alpha.current;this.ctx.fillText(e,r+12,i+12)}}promptTouchMove(e){if(e){this.prompt.touchMove.alpha.current+=(this.prompt.touchMove.alpha.max-this.prompt.touchMove.alpha.current)*.2;this.prompt.touchMove.size.current+=(this.prompt.touchMove.size.max-this.prompt.touchMove.size.current)*.2}else{this.prompt.touchMove.alpha.current+=(this.prompt.touchMove.alpha.min-this.prompt.touchMove.alpha.current)*.2;this.prompt.touchMove.size.current+=(this.prompt.touchMove.size.min-this.prompt.touchMove.size.current)*.2}if(this.prompt.touchMove.alpha.current>0){const e=this.prompt.touchMove.size.current;const t=e*2;const r=this.cvs.width/2;const i=this.cvs.height/2;this.ctx.globalAlpha=this.prompt.touchMove.alpha.current;this.ctx.beginPath();this.ctx.arc(r,i,e,0,Math.PI*2,false);this.ctx.moveTo(r-e,i);this.ctx.lineTo(r+e,i);this.ctx.moveTo(r,i-4);this.ctx.lineTo(r,i+4);this.ctx.stroke()}}promptGodMode(){this.ctx.globalAlpha=1;this.ctx.fillText("fly mode",20,this.cvs.height-40)}drawDevOverlay(){this.ctx.globalAlpha=1;const e=Math.round(this.root.player.position.x*10)/10;const t=Math.round(this.root.player.position.y*10)/10;const r=Math.round(this.root.player.position.z*10)/10;const i=Math.round(this.root.player.rotation.x*100)/100;this.ctx.fillText(`${e}, ${t}, ${r}, ${i}`,20,this.cvs.height-20)}drawNode(e){e.draw(this.ctx)}}class P{constructor(e,t){this.onscreen=true;this.position=e;this.clipping=t||null;this.coords=new THREE.Vector2;this.helper=new THREE.Vector3}calculateNodePosition(e,t,r){this.helper.copy(e.position);this.helper.sub(this.position);this.helper.normalize();if(this.helper.dot(t)<=0){this.onscreen=true;this.helper.copy(this.position);this.helper.project(e);this.coords.x=(this.helper.x+1)*r.x;this.coords.y=(-this.helper.y+1)*r.y}else{this.onscreen=false}if(this.clipping&&this.onscreen){this.helper.copy(e.position);this.helper.sub(this.position);if(this.helper.dot(this.clipping)<0){this.onscreen=false}}}}class C extends P{constructor(e,t,r){super(e,r||null);this.rotation=t;this.active=true;this.hover=false;this.nearby=false;this.radius={min:5,max:20,fadeThreshold:4};this.boundingBox={width:40,height:40,nearbyThreshold:150};this.eye={width:18,height:9,bez:6,radius:{current:7,min:5,max:7}};this.bez={};this.bez.p1={x:this.eye.width,y:2};this.bez.cp1={x:this.eye.width-this.eye.bez,y:2+this.eye.bez*.75};this.bez.cp2={x:this.eye.bez,y:this.eye.height};this.bez.p2={x:0,y:this.eye.height};this.bez.offset={current:0,min:-2,max:1.5};this.distance=-1;this.maxVerticalDifference=2;this.opacity=1}mouseOver(e,t){if(this.active&&this.onscreen){this.nearby=Math.hypot(this.coords.x-e,this.coords.y-t)<this.boundingBox.nearbyThreshold;this.hover=e>=this.coords.x-this.boundingBox.width&&e<=this.coords.x+this.boundingBox.width&&t>=this.coords.y-this.boundingBox.height&&t<=this.coords.y+this.boundingBox.height}else{this.nearby=false;this.hover=false}}isHover(){return this.hover&&this.active}update(e,t,r,i,a){this.calculateNodePosition(r,i,a);this.distance=t.position.distanceTo(this.position);this.height=Math.abs(t.position.y+t.height-this.position.y);if(this.distance<this.radius.min||this.distance>this.radius.max||this.height>this.maxVerticalDifference){this.active=false}else{this.active=true;if(this.distance<this.radius.min+this.radius.fadeThreshold){this.opacity=(this.distance-this.radius.min)/this.radius.fadeThreshold}else if(this.distance>this.radius.max-this.radius.fadeThreshold){this.opacity=(this.radius.max-this.distance)/this.radius.fadeThreshold}else{this.opacity=1}}}draw(e){if(this.onscreen&&this.active){e.globalAlpha=this.opacity;this.eye.radius.current+=((this.hover?this.eye.radius.max:this.eye.radius.min)-this.eye.radius.current)*.25;this.bez.offset.current+=((this.hover?this.bez.offset.min:this.bez.offset.max)-this.bez.offset.current)*.25;e.beginPath();e.arc(this.coords.x,this.coords.y,this.nearby?this.eye.radius.current:this.eye.radius.current*.75,Math.PI*.5,Math.PI*2.5);e.stroke()}}}class L extends P{constructor(e,t,r){super(t,r||null);this.message=e}update(e,t,r){this.calculateNodePosition(e,t,r)}draw(e){if(this.onscreen){e.globalAlpha=1;e.fillText(this.message,this.coords.x,this.coords.y)}}}class I{constructor(e,t){this.id=e;this.position=new THREE.Vector3;this.direction=new THREE.Vector3;this.element=t;this.nearRadius=5;this.data={url:t.dataset.url,title:t.dataset.title||"",subtitle:t.dataset.subtitle||"",desc:t.dataset.desc||"",link:t.dataset.link||"",width:parseFloat(t.dataset.width),offset:{horizontal:parseFloat(t.dataset.hoff),vertical:parseFloat(t.dataset.voff)},index:parseInt(t.dataset.location)-1||t.dataset.location}}init(e,t,r){const i=.125;const a=i/2+.01;const s=new THREE.Mesh(new THREE.BoxBufferGeometry(1,1,1),new THREE.MeshStandardMaterial({color:0,roughness:.75,metalness:0}));const n=new THREE.Mesh(new THREE.PlaneBufferGeometry(1,1),new THREE.MeshStandardMaterial({roughness:1,metalness:.5}));const o=(new THREE.TextureLoader).load(this.data.url,e=>{const t=this.data.width*(e.image.naturalHeight/e.image.naturalWidth);n.scale.x=this.data.width;n.scale.y=t;s.scale.x=r.x!=0?i:this.data.width;s.scale.y=t;s.scale.z=r.z!=0?i:this.data.width});o.wrapS=o.wrapT=THREE.ClampToEdgeWrapping;o.minFilter=THREE.LinearFilter;t.x+=(r.x!=0?0:1)*this.data.offset.horizontal;t.y+=this.data.offset.vertical;t.z+=(r.z!=0?0:1)*this.data.offset.horizontal;n.material.map=o;n.position.set(t.x+r.x*a,t.y,t.z+r.z*a);if(r.z==1){}else if(r.z==-1){n.rotation.y=Math.PI}else if(r.x==1){n.rotation.y=Math.PI*.5}else if(r.x==-1){n.rotation.y=Math.PI*1.5}s.scale.x=r.x!=0?i:1;s.scale.z=r.z!=0?i:1;s.position.set(t.x,t.y,t.z);e.add(n);e.add(s);this.node=new C(t,null,r);this.position.set(t.x,t.y,t.z);this.direction.set(r.x,r.y,r.z)}getDistanceTo(e){return this.position.distanceTo(e)}getCameraDot(e,t){const r=this.position.clone();r.sub(e);r.normalize();return r.dot(t)}}class B{constructor(e){this.root=e;this.player=this.root.scene.player;this.camera=this.root.scene.camera.camera;this.scene=this.root.scene.scene;this.centre=this.root.centre;this.cameraDirection=new THREE.Vector3;this.artworkActiveRadius=7;this.artworks=[];var t=0;document.querySelectorAll("#artworks .image").forEach(e=>{this.artworks.push(new I(++t,e))});this.placeArtworks();this.domElement=document.querySelector("#artwork-target");this.el={title:this.domElement.querySelector(".title"),subtitle:this.domElement.querySelector(".subtitle"),desc:this.domElement.querySelector(".desc"),link:this.domElement.querySelector(".link")};this.notes=[];this.notes.push(new L("[ logo here ]",new THREE.Vector3(28,12,6),null),new L("[ door here ]",new THREE.Vector3(-28,5,15),null))}placeArtworks(){const e=[{x:-24,y:4,z:23,nx:0,nz:-1},{x:-10.5,y:3.5,z:23,nx:0,nz:-1},{x:-8,y:3.5,z:23,nx:0,nz:-1},{x:-5.5,y:3.5,z:23,nx:0,nz:-1},{x:5.5,y:3.5,z:23,nx:0,nz:-1},{x:8,y:3.5,z:23,nx:0,nz:-1},{x:10.5,y:3.5,z:23,nx:0,nz:-1},{x:24,y:4,z:23,nx:0,nz:-1},{x:-12,y:3.5,z:8,nx:0,nz:1},{x:-8,y:3.5,z:8,nx:0,nz:1},{x:-4,y:3.5,z:8,nx:0,nz:1},{x:4,y:3.5,z:8,nx:0,nz:1},{x:8,y:3.5,z:8,nx:0,nz:1},{x:12,y:3.5,z:8,nx:0,nz:1},{x:-29.5,y:4,z:6,nx:1,nz:0},{x:30,y:4,z:6,nx:-1,nz:0},{x:-12,y:3.5,z:4,nx:0,nz:-1},{x:-8,y:3.5,z:4,nx:0,nz:-1},{x:-4,y:3.5,z:4,nx:0,nz:-1},{x:4,y:3.5,z:4,nx:0,nz:-1},{x:8,y:3.5,z:4,nx:0,nz:-1},{x:12,y:3.5,z:4,nx:0,nz:-1},{x:-8,y:3.5,z:-11.5,nx:0,nz:1},{x:8,y:3.5,z:-11.5,nx:0,nz:1},{x:-8,y:11,z:-11.5,nx:0,nz:1},{x:8,y:11,z:-11.5,nx:0,nz:1}];for(var t=0;t<this.artworks.length;t++){const a=this.artworks[t];var r=null;if(typeof a.data.index=="number"&&a.data.index<e.length&&e[a.data.index].active==undefined){r=e[a.data.index];r.active=true}if(r==null){for(var i=0;i<e.length;i++){if(!e[i].active){r=e[i];r.active=true;break}}}if(r!=null){const e=new THREE.Vector3(r.x,r.y,r.z);const t=new THREE.Vector3(r.nx,0,r.nz);a.init(this.scene,e,t)}else{console.log("Error: Duplicate artwork slot reference.");this.artworks.splice(t,1);t-=1}}const a=new THREE.MeshStandardMaterial({color:0,roughness:.75,metalness:0});e.forEach(e=>{if(!e.active){const t=new THREE.Mesh(new THREE.BoxBufferGeometry(.25,.25,.25),a);t.position.set(e.x,e.y,e.z);this.scene.add(t)}})}mouseOver(e,t){for(var r=0,i=this.artworks.length;r<i;++r){this.artworks[r].node.mouseOver(e,t)}}update(e){this.camera.getWorldDirection(this.cameraDirection);var t=false;var r=-1;this.activeArtwork=null;for(var i=0;i<this.artworks.length;++i){if(this.artworks[i].getDistanceTo(this.camera.position)<this.artworkActiveRadius){const e=this.artworks[i].getCameraDot(this.camera.position,this.cameraDirection);if(e>=0&&e>r){r=e;t=this.artworks[i]}}this.artworks[i].node.update(e,this.player,this.camera,this.cameraDirection,this.centre);if(this.artworks[i].node.isHover()){this.activeArtwork=this.artworks[i]}}if(t){if(this.domElement.dataset.active===undefined||this.domElement.dataset.active!=t.id||!this.domElement.classList.contains("active")){this.domElement.dataset.active=t.id;this.domElement.classList.add("active");this.el.title.innerHTML=t.data.title;this.el.subtitle.innerHTML=t.data.subtitle;this.el.desc.innerHTML=t.data.desc;this.el.link.innerHTML=t.data.link?`<a href='${t.data.link}' target='_blank'>Link</a>`:""}}else{this.domElement.classList.remove("active")}for(var i=0,a=this.notes.length;i<a;++i){this.notes[i].update(this.camera,this.cameraDirection,this.centre)}}draw(e){for(var t=0,r=this.artworks.length;t<r;++t){e.drawNode(this.artworks[t].node)}for(var t=0,r=this.notes.length;t<r;++t){e.drawNode(this.notes[t])}}}class A{constructor(e,t,r){this.scene=e;this.isMobile=r;this.player=this.scene.player;this.domElement=document.querySelector("#canvas-target");this.centre={x:0,y:0};this.setSize();this.rotation=new THREE.Vector2;this.timestamp=null;this.threshold={click:150,pan:200};this.keyboard=new k(e=>{this.onKeyboard(e)});this.mouse=new S(this.domElement,e=>{this.onMouseDown(e)},e=>{this.onMouseMove(e)},e=>{this.onMouseUp(e)});this.canvas=new z(this,this.domElement,t.renderer.domElement);window.addEventListener("resize",()=>{this.resize()});this.floorPlan=new B(this)}onMouseDown(e){this.rotation.y=this.player.rotation.y;this.rotation.x=this.player.rotation.x;this.timestamp=Date.now();this.mouse.start(e)}onMouseMove(e){this.mouse.move(e);if(this.mouse.active){if(!(this.player.keys.left||this.player.keys.right)){const t=this.rotation.x+this.mouse.delta.x/this.centre.x;const r=R(this.rotation.y+this.mouse.delta.y/this.centre.y,this.player.minPitch,this.player.maxPitch);if(r==this.player.minPitch||r==this.player.maxPitch){this.mouse.origin.y=e.offsetY;this.rotation.y=r}this.player.setRotation(r,t)}}else{this.floorPlan.mouseOver(this.mouse.x,this.mouse.y)}}onMouseUp(e){this.mouse.stop();if(Date.now()-this.timestamp<this.threshold.click){}}onKeyboard(e){switch(e){case"a":case"A":case"ArrowLeft":this.player.keys.left=this.keyboard.keys[e];break;case"d":case"D":case"ArrowRight":this.player.keys.right=this.keyboard.keys[e];break;case"w":case"W":case"ArrowUp":this.player.keys.up=this.keyboard.keys[e];break;case"s":case"S":case"ArrowDown":this.player.keys.down=this.keyboard.keys[e];break;case" ":this.player.keys.jump=this.keyboard.keys[e];break;case"x":case"X":if(this.keyboard.keys["x"]||this.keyboard.keys["X"]){if(this.keyboard.isControl()){this.player.toggleNoclip()}this.keyboard.release("x");this.keyboard.release("X")}break;default:break}}setSize(){const e=this.domElement.getBoundingClientRect();this.centre.x=e.width/2;this.centre.y=e.height/2}resize(){this.setSize();this.canvas.resize()}update(e){this.floorPlan.update(e);this.activeTitle=this.floorPlan.activeArtwork==null?"":this.floorPlan.activeArtwork.data.title}draw(){this.canvas.clear();this.floorPlan.draw(this.canvas);this.canvas.promptTouchMove(this.mouse.active&&Date.now()-this.timestamp>this.threshold.pan);this.canvas.promptClick("view: "+this.activeTitle,!this.mouse.active&&this.floorPlan.activeArtwork!=null,this.mouse.x,this.mouse.y);if(this.player.noclip){this.canvas.promptGodMode();this.canvas.drawDevOverlay()}else{this.canvas.drawDevOverlay()}}}const D=()=>{var e=false;(function(t){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))e=true})(navigator.userAgent||navigator.vendor||window.opera);return e};const F=()=>{var e=false;(function(t){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))e=true})(navigator.userAgent||navigator.vendor||window.opera);return e};class N{constructor(e){this.root=e;document.querySelector("#open-gallery").onclick=(()=>{this.toggleGallery()});document.querySelectorAll(".close-gallery").forEach(e=>{e.addEventListener("click",()=>{this.closeGalleryMenu();this.toggleGallery()})});this.initMenus()}toggleGallery(){if(!this.lock){this.lock=true;this.toggleCount=this.toggleCount?this.toggleCount+1:1;const e=document.querySelector("#pane-content");const t=document.querySelector("#pane-gallery");const r=document.querySelector("#background-grid");const i=document.querySelector(".nav");const a=document.querySelector(".logo-main");if(e.classList.contains("active")){e.classList.remove("active");t.classList.add("active");r.classList.add("active");i.classList.add("active");a.classList.add("active");document.documentElement.classList.add("freeze");if(this.toggleCount==1){setTimeout(()=>{this.lock=false;t.querySelectorAll("canvas").forEach(e=>{e.classList.add("active")});this.root.activate()},1e3)}else{this.root.activate();this.lock=false}}else{t.classList.remove("active");e.classList.add("active");r.classList.remove("active");i.classList.remove("active");a.classList.remove("active");document.documentElement.classList.remove("freeze");this.root.deactivate();this.lock=false}}}closeGalleryMenu(){document.querySelectorAll("#nav-gallery .item.active, .gallery-menu .active").forEach(e=>{e.classList.remove("active")});document.querySelector("#nav-gallery .close-gallery-menu").classList.add("active")}onMenuItem(e){if(e.dataset.active){const t=document.querySelector(e.dataset.active);if(t){e.parentNode.querySelectorAll(".active").forEach(e=>{e.classList.remove("active")});e.classList.add("active");if(e.parentNode.getAttribute("id")=="nav-content"){document.querySelectorAll(".pane-content .page.active").forEach(e=>{e.classList.remove("active")})}else{document.querySelectorAll(".gallery-menu .menu.active").forEach(e=>{e.classList.remove("active")})}t.classList.add("active")}}}initMenus(){document.querySelectorAll(".pane-content-nav .item").forEach(e=>{e.addEventListener("click",e=>{this.onMenuItem(e.currentTarget)})});document.querySelectorAll(".close-gallery-menu").forEach(e=>{e.addEventListener("click",e=>{this.closeGalleryMenu()})})}}class U{constructor(){this.active=false;this.isMobile=F();this.scene=new H;this.renderer=new u(this.scene);this.surface=new A(this.scene,this.renderer,this.isMobile);this.menu=new N(this);this.loop()}deactivate(){this.active=false}activate(){this.active=true;this.now=performance.now()}loop(){requestAnimationFrame(()=>{this.loop()});if(this.active){const e=performance.now();const t=(e-this.now)/1e3;this.now=e;this.scene.update(t);this.surface.update(t);this.renderer.draw(t);this.surface.draw()}}}window.onload=(()=>{const e=new U})}]);