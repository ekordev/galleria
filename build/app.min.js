var CLM=function(t){var e={};function i(s){if(e[s])return e[s].exports;var r=e[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(s,r,function(e){return t[e]}.bind(null,r));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=11)}([function(t,e){THREE.Sky=function(){var t=THREE.Sky.SkyShader,e=new THREE.ShaderMaterial({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:THREE.UniformsUtils.clone(t.uniforms),side:THREE.BackSide});THREE.Mesh.call(this,new THREE.BoxBufferGeometry(1,1,1),e)},THREE.Sky.prototype=Object.create(THREE.Mesh.prototype),THREE.Sky.SkyShader={uniforms:{luminance:{value:1},turbidity:{value:11.7},rayleigh:{value:2},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new THREE.Vector3}},vertexShader:["uniform vec3 sunPosition;","uniform float rayleigh;","uniform float turbidity;","uniform float mieCoefficient;","varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","const vec3 up = vec3( 0.0, 1.0, 0.0 );","const float e = 2.71828182845904523536028747135266249775724709369995957;","const float pi = 3.141592653589793238462643383279502884197169;","const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );","const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );","const float v = 4.0;","const vec3 K = vec3( 0.686, 0.678, 0.666 );","const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );","const float cutoffAngle = 1.6110731556870734;","const float steepness = 1.5;","const float EE = 1000.0;","float sunIntensity( float zenithAngleCos ) {","\tzenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );","\treturn EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );","}","vec3 totalMie( float T ) {","\tfloat c = ( 0.2 * T ) * 10E-18;","\treturn 0.434 * c * MieConst;","}","void main() {","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tvWorldPosition = worldPosition.xyz;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","\tgl_Position.z = gl_Position.w;","\tvSunDirection = normalize( sunPosition );","\tvSunE = sunIntensity( dot( vSunDirection, up ) );","\tvSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );","\tfloat rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );","\tvBetaR = totalRayleigh * rayleighCoefficient;","\tvBetaM = totalMie( turbidity ) * mieCoefficient;","}"].join("\n"),fragmentShader:["varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","uniform float luminance;","uniform float mieDirectionalG;","const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );","const float pi = 3.141592653589793238462643383279502884197169;","const float n = 1.0003;","const float N = 2.545E25;","const float rayleighZenithLength = 8.4E3;","const float mieZenithLength = 1.25E3;","const vec3 up = vec3( 0.0, 1.0, 0.0 );","const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;","const float THREE_OVER_SIXTEENPI = 0.05968310365946075;","const float ONE_OVER_FOURPI = 0.07957747154594767;","float rayleighPhase( float cosTheta ) {","\treturn THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );","}","float hgPhase( float cosTheta, float g ) {","\tfloat g2 = pow( g, 2.0 );","\tfloat inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );","\treturn ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );","}","const float A = 0.15;","const float B = 0.50;","const float C = 0.10;","const float D = 0.20;","const float E = 0.02;","const float F = 0.30;","const float whiteScale = 1.0748724675633854;","vec3 Uncharted2Tonemap( vec3 x ) {","\treturn ( ( x * ( A * x + C * B ) + D * E ) / ( x * ( A * x + B ) + D * F ) ) - E / F;","}","void main() {","\tfloat zenithAngle = acos( max( 0.0, dot( up, normalize( vWorldPosition - cameraPos ) ) ) );","\tfloat inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );","\tfloat sR = rayleighZenithLength * inverse;","\tfloat sM = mieZenithLength * inverse;","\tvec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );","\tfloat cosTheta = dot( normalize( vWorldPosition - cameraPos ), vSunDirection );","\tfloat rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );","\tvec3 betaRTheta = vBetaR * rPhase;","\tfloat mPhase = hgPhase( cosTheta, mieDirectionalG );","\tvec3 betaMTheta = vBetaM * mPhase;","\tvec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );","\tLin *= mix(vec3(1.0), pow(vSunE * ((betaRTheta + betaMTheta) / (vBetaR + vBetaM)) * Fex, vec3(1.0 / 2.0)), clamp(pow(1.0 - dot(up, vSunDirection), 5.0), 0.0, 1.0));","\tvec3 direction = normalize( vWorldPosition - cameraPos );","\tfloat theta = acos( direction.y ); // elevation --\x3e y-axis, [-pi/2, pi/2]","\tfloat phi = atan( direction.z, direction.x ); // azimuth --\x3e x-axis [-pi/2, pi/2]","\tvec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );","\tvec3 L0 = vec3( 0.1 ) * Fex;","\tvec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );","\tvec3 curr = Uncharted2Tonemap( ( log2( 2.0 / pow( luminance, 4.0 ) ) ) * texColor );","\tvec3 color = curr * whiteScale;","\tvec3 retColor = pow( color, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );","\tgl_FragColor = vec4( retColor, 1.0 );","}"].join("\n")}},function(t,e){THREE.MTLLoader=function(t){this.manager=void 0!==t?t:THREE.DefaultLoadingManager},THREE.MTLLoader.prototype={constructor:THREE.MTLLoader,load:function(t,e,i,s){var r=this,a=new THREE.FileLoader(this.manager);a.setPath(this.path),a.load(t,function(t){e(r.parse(t))},i,s)},setPath:function(t){this.path=t},setTexturePath:function(t){this.texturePath=t},setBaseUrl:function(t){console.warn("THREE.MTLLoader: .setBaseUrl() is deprecated. Use .setTexturePath( path ) for texture path or .setPath( path ) for general base path instead."),this.setTexturePath(t)},setCrossOrigin:function(t){this.crossOrigin=t},setMaterialOptions:function(t){this.materialOptions=t},parse:function(t){for(var e=t.split("\n"),i={},s=/\s+/,r={},a=0;a<e.length;a++){var o=e[a];if(0!==(o=o.trim()).length&&"#"!==o.charAt(0)){var n=o.indexOf(" "),h=n>=0?o.substring(0,n):o;h=h.toLowerCase();var l=n>=0?o.substring(n+1):"";if(l=l.trim(),"newmtl"===h)i={name:l},r[l]=i;else if(i)if("ka"===h||"kd"===h||"ks"===h){var c=l.split(s,3);i[h]=[parseFloat(c[0]),parseFloat(c[1]),parseFloat(c[2])]}else i[h]=l}}var u=new THREE.MTLLoader.MaterialCreator(this.texturePath||this.path,this.materialOptions);return u.setCrossOrigin(this.crossOrigin),u.setManager(this.manager),u.setMaterials(r),u}},THREE.MTLLoader.MaterialCreator=function(t,e){this.baseUrl=t||"",this.options=e,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.side=this.options&&this.options.side?this.options.side:THREE.FrontSide,this.wrap=this.options&&this.options.wrap?this.options.wrap:THREE.RepeatWrapping},THREE.MTLLoader.MaterialCreator.prototype={constructor:THREE.MTLLoader.MaterialCreator,crossOrigin:"Anonymous",setCrossOrigin:function(t){this.crossOrigin=t},setManager:function(t){this.manager=t},setMaterials:function(t){this.materialsInfo=this.convert(t),this.materials={},this.materialsArray=[],this.nameLookup={}},convert:function(t){if(!this.options)return t;var e={};for(var i in t){var s=t[i],r={};for(var a in e[i]=r,s){var o=!0,n=s[a],h=a.toLowerCase();switch(h){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(n=[n[0]/255,n[1]/255,n[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===n[0]&&0===n[1]&&0===n[2]&&(o=!1)}o&&(r[h]=n)}}return e},preload:function(){for(var t in this.materialsInfo)this.create(t)},getIndex:function(t){return this.nameLookup[t]},getAsArray:function(){var t=0;for(var e in this.materialsInfo)this.materialsArray[t]=this.create(e),this.nameLookup[e]=t,t++;return this.materialsArray},create:function(t){return void 0===this.materials[t]&&this.createMaterial_(t),this.materials[t]},createMaterial_:function(t){var e=this,i=this.materialsInfo[t],s={name:t,side:this.side};function r(t,i){if(!s[t]){var r,a,o=e.getTextureParams(i,s),n=e.loadTexture((r=e.baseUrl,"string"!=typeof(a=o.url)||""===a?"":/^https?:\/\//i.test(a)?a:r+a));n.repeat.copy(o.scale),n.offset.copy(o.offset),n.wrapS=e.wrap,n.wrapT=e.wrap,s[t]=n}}for(var a in i){var o,n=i[a];if(""!==n)switch(a.toLowerCase()){case"kd":s.color=(new THREE.Color).fromArray(n);break;case"ks":s.specular=(new THREE.Color).fromArray(n);break;case"map_kd":r("map",n);break;case"map_ks":r("specularMap",n);break;case"norm":r("normalMap",n);break;case"map_bump":case"bump":r("bumpMap",n);break;case"ns":s.shininess=parseFloat(n);break;case"d":(o=parseFloat(n))<1&&(s.opacity=o,s.transparent=!0);break;case"tr":(o=parseFloat(n))>0&&(s.opacity=1-o,s.transparent=!0)}}return this.materials[t]=new THREE.MeshPhongMaterial(s),this.materials[t]},getTextureParams:function(t,e){var i,s={scale:new THREE.Vector2(1,1),offset:new THREE.Vector2(0,0)},r=t.split(/\s+/);return(i=r.indexOf("-bm"))>=0&&(e.bumpScale=parseFloat(r[i+1]),r.splice(i,2)),(i=r.indexOf("-s"))>=0&&(s.scale.set(parseFloat(r[i+1]),parseFloat(r[i+2])),r.splice(i,4)),(i=r.indexOf("-o"))>=0&&(s.offset.set(parseFloat(r[i+1]),parseFloat(r[i+2])),r.splice(i,4)),s.url=r.join(" ").trim(),s},loadTexture:function(t,e,i,s,r){var a,o=THREE.Loader.Handlers.get(t),n=void 0!==this.manager?this.manager:THREE.DefaultLoadingManager;return null===o&&(o=new THREE.TextureLoader(n)),o.setCrossOrigin&&o.setCrossOrigin(this.crossOrigin),a=o.load(t,i,s,r),void 0!==e&&(a.mapping=e),a}}},function(t,e){!function(){function t(t){var e,i=t.properties.Content,s=t.properties.RelativeFilename||t.properties.Filename,r=s.slice(s.lastIndexOf(".")+1).toLowerCase();switch(r){case"bmp":e="image/bmp";break;case"jpg":case"jpeg":e="image/jpeg";break;case"png":e="image/png";break;case"tif":e="image/tiff";break;default:return void console.warn('FBXLoader: Image type "'+r+'" is not supported.')}if("string"==typeof i)return"data:"+e+";base64,"+i;var a=new Uint8Array(i);return window.URL.createObjectURL(new Blob([a],{type:e}))}function e(t,e,i,s){var r,a=t.id,o=t.attrName,n=t.properties.FileName,h=t.properties.RelativeFilename,l=s.get(a).children;if(void 0!==l&&l.length>0&&i.has(l[0].ID))r=i.get(l[0].ID);else if(void 0!==h&&"/"!==h[0]&&null===h.match(/^[a-zA-Z]:/))r=h;else{var c=n.split(/[\\\/]/);r=c.length>0?c[c.length-1]:n}var u=e.path;0!==r.indexOf("blob:")&&0!==r.indexOf("data:")||e.setPath(void 0);var p=e.load(r);p.name=o,p.FBX_ID=a;var d=t.properties.WrapModeU,m=t.properties.WrapModeV,v=void 0!==d?d.value:0,f=void 0!==m?m.value:0;if(p.wrapS=0===v?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,p.wrapT=0===f?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,"Scaling"in t.properties){var g=t.properties.Scaling.value;p.repeat.x=g[0],p.repeat.y=g[1]}return e.setPath(u),p}function i(t,e,i){var s=t.id,r=t.attrName,a=t.properties.ShadingModel;if("object"==typeof a&&(a=a.value),!i.has(s))return null;var o,n=i.get(s).children,h=function(t,e,i){var s={};t.BumpFactor&&(s.bumpScale=t.BumpFactor.value);t.Diffuse&&(s.color=k(t.Diffuse));t.DisplacementFactor&&(s.displacementScale=t.DisplacementFactor.value);t.ReflectionFactor&&(s.reflectivity=t.ReflectionFactor.value);t.Specular&&(s.specular=k(t.Specular));t.Shininess&&(s.shininess=t.Shininess.value);t.Emissive&&(s.emissive=k(t.Emissive));t.EmissiveFactor&&(s.emissiveIntensity=parseFloat(t.EmissiveFactor.value));t.Opacity&&(s.opacity=parseFloat(t.Opacity.value));s.opacity<1&&(s.transparent=!0);if(t["Maya|base_color"]){var r=t["Maya|base_color"].value;s.color=new THREE.Color(r[0],r[1],r[2])}if(t["Maya|emissive"]){var r=t["Maya|emissive"];s.emissive=new THREE.Color(r[0],r[1],r[2])}t["Maya|emissive_intensity"]&&(s.emissiveIntensity=t["Maya|emissive_intensity"].value);t["Maya|metallic"]&&(s.metalness=t["Maya|metallic"].value);t["Maya|roughness"]&&(s.roughness=t["Maya|roughness"].value);var a=1;if(t["Maya|uv_scale"])var a=t["Maya|uv_scale"].value;for(var o=0,n=i.length;o<n;++o){var h=i[o],l=h.relationship;switch(l){case"Maya|TEX_color_map":var c="Maya|use_color_map";t[c]&&1==t[c].value&&(s.map=e.get(h.ID),1!=a&&(s.map.wrapS=THREE.RepeatWrapping,s.map.wrapT=THREE.RepeatWrapping,s.map.repeat.set(a,a)));break;case"Maya|TEX_emissive_map":var c="Maya|use_emissive_map";t[c]&&1==t[c].value&&(s.emissiveMap=e.get(h.ID),1!=a&&(s.emissiveMap.wrapS=THREE.RepeatWrapping,s.emissiveMap.wrapT=THREE.RepeatWrapping,s.emissiveMap.repeat.set(a,a)));break;case"Maya|TEX_roughness_map":var c="Maya|use_roughness_map";t[c]&&1==t[c].value&&(s.roughnessMap=e.get(h.ID),1!=a&&(s.roughnessMap.wrapS=THREE.RepeatWrapping,s.roughnessMap.wrapT=THREE.RepeatWrapping,s.roughnessMap.repeat.set(a,a)));break;case"Maya|TEX_normal_map":var c="Maya|use_normal_map";t[c]&&1==t[c].value&&(s.normalMap=e.get(h.ID),1!=a&&(s.normalMap.wrapS=THREE.RepeatWrapping,s.normalMap.wrapT=THREE.RepeatWrapping,s.normalMap.repeat.set(a,a)));break;case"Maya|TEX_metallic_map":var c="Maya|use_metallic_map";t[c]&&1==t[c].value&&(s.metalnessMap=e.get(h.ID),1!=a&&(s.metalnessMap.wrapS=THREE.RepeatWrapping,s.metalnessMap.wrapT=THREE.RepeatWrapping,s.metalnessMap.repeat.set(a,a)));break;case"Maya|TEX_ao_map":var c="Maya|use_ao_map";t[c]&&1==t[c].value&&(s.aoMap=e.get(h.ID),1!=a&&(s.aoMap.wrapS=THREE.RepeatWrapping,s.aoMap.wrapT=THREE.RepeatWrapping,s.aoMap.repeat.set(a,a)));break;case"Maya|TEX_brdf_lut":case"Maya|TEX_global_specular_cube":case"Maya|TEX_global_diffuse_cube":break;case"Bump":s.bumpMap=e.get(h.ID);break;case"DiffuseColor":s.map=e.get(h.ID);break;case"DisplacementColor":s.displacementMap=e.get(h.ID);break;case"EmissiveColor":s.emissiveMap=e.get(h.ID);break;case"NormalMap":s.normalMap=e.get(h.ID);break;case"ReflectionColor":s.envMap=e.get(h.ID),s.envMap.mapping=THREE.EquirectangularReflectionMapping;break;case"SpecularColor":s.specularMap=e.get(h.ID);break;case"TransparentColor":s.alphaMap=e.get(h.ID),s.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",l)}}return s}(t.properties,e,n);switch(a.toLowerCase()){case"phong":o=new THREE.MeshPhongMaterial;break;case"lambert":o=new THREE.MeshLambertMaterial;break;case"unknown":o=new THREE.MeshStandardMaterial;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',a),o=new THREE.MeshPhongMaterial({color:3342591})}return o.setValues(h),o.name=r,o}function s(t,e){for(var i={},s=t.children,r=0,a=s.length;r<a;++r){var o=s[r],n=e[o.ID],h={FBX_ID:o.ID,index:r,indices:[],weights:[],transform:(new THREE.Matrix4).fromArray(n.subNodes.Transform.properties.a),transformLink:(new THREE.Matrix4).fromArray(n.subNodes.TransformLink.properties.a),linkMode:n.properties.Mode};"Indexes"in n.subNodes&&(h.indices=n.subNodes.Indexes.properties.a,h.weights=n.subNodes.Weights.properties.a),i[o.ID]=h}return{map:i,bones:[]}}function r(t,e,i){switch(t.attrType){case"Mesh":return function(t,e,i){for(var s=0;s<e.children.length;++s){var r=i[e.children[s].ID];if(void 0!==r)break}return function(t,e){var i=t.subNodes,s=i.Vertices.properties.a,r=i.PolygonVertexIndex.properties.a,o=[],n=[],l=[],c=[],u=[],p=[],d=[];if(i.LayerElementColor)var m=function(t){var e=t.properties.MappingInformationType,i=t.properties.ReferenceInformationType,s=t.subNodes.Colors.properties.a,r=[];"IndexToDirect"===i&&(r=t.subNodes.ColorIndex.properties.a);return{dataSize:4,buffer:s,indices:r,mappingType:e,referenceType:i}}(i.LayerElementColor[0]);if(i.LayerElementMaterial)var v=function(t){var e=t.properties.MappingInformationType,i=t.properties.ReferenceInformationType;if("NoMappingInformation"===e)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:i};for(var s=t.subNodes.Materials.properties.a,r=[],a=0,o=s.length;a<o;++a)r.push(a);return{dataSize:1,buffer:s,indices:r,mappingType:e,referenceType:i}}(i.LayerElementMaterial[0]);if(i.LayerElementNormal)var f=function(t){var e=t.properties.MappingInformationType,i=t.properties.ReferenceInformationType,s=t.subNodes.Normals.properties.a,r=[];"IndexToDirect"===i&&("NormalIndex"in t.subNodes?r=t.subNodes.NormalIndex.properties.a:"NormalsIndex"in t.subNodes&&(r=t.subNodes.NormalsIndex.properties.a));return{dataSize:3,buffer:s,indices:r,mappingType:e,referenceType:i}}(i.LayerElementNormal[0]);if(i.LayerElementUV)for(var g=[],E=0;i.LayerElementUV[E];)g.push(a(i.LayerElementUV[E])),E++;var y={};if(e){var b=e.map;for(var T in b)for(var x=b[T],w=x.indices,M=0;M<w.length;M++){var R=w[M],H=x.weights[M];void 0===y[R]&&(y[R]=[]),y[R].push({id:x.index,weight:H})}}for(var k=0,S=0,P=!1,z=[],L=[],C=[],I=[],A=[],B=[],D=0;D<r.length;D++){var F=r[D],j=!1;F<0&&(F^=-1,r[D]=F,j=!0);var O=[],N=[];if(z.push(3*F,3*F+1,3*F+2),m){var U=h(D,k,F,m);C.push(U[0],U[1],U[2])}if(e){if(void 0!==y[F])for(var _=y[F],M=0,V=_.length;M<V;M++)N.push(_[M].weight),O.push(_[M].id);if(N.length>4){P||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),P=!0);var q=[0,0,0,0],G=[0,0,0,0];N.forEach(function(t,e){var i=t,s=O[e];G.forEach(function(t,e,r){if(i>t){r[e]=i,i=t;var a=q[e];q[e]=s,s=a}})}),O=q,N=G}for(var E=N.length;E<4;++E)N[E]=0,O[E]=0;for(var E=0;E<4;++E)A.push(N[E]),B.push(O[E])}if(f){var U=h(D,k,F,f);L.push(U[0],U[1],U[2])}if(g)for(var E=0;E<g.length;E++){var U=h(D,k,F,g[E]);void 0===I[E]&&(I[E]=[]),I[E].push(U[0],U[1])}if(S++,j){for(var E=2;E<S;E++)o.push(s[z[0]]),o.push(s[z[1]]),o.push(s[z[2]]),o.push(s[z[3*(E-1)]]),o.push(s[z[3*(E-1)+1]]),o.push(s[z[3*(E-1)+2]]),o.push(s[z[3*E]]),o.push(s[z[3*E+1]]),o.push(s[z[3*E+2]]);if(e)for(var E=2;E<S;E++)p.push(A[0]),p.push(A[1]),p.push(A[2]),p.push(A[3]),p.push(A[4*(E-1)]),p.push(A[4*(E-1)+1]),p.push(A[4*(E-1)+2]),p.push(A[4*(E-1)+3]),p.push(A[4*E]),p.push(A[4*E+1]),p.push(A[4*E+2]),p.push(A[4*E+3]),d.push(B[0]),d.push(B[1]),d.push(B[2]),d.push(B[3]),d.push(B[4*(E-1)]),d.push(B[4*(E-1)+1]),d.push(B[4*(E-1)+2]),d.push(B[4*(E-1)+3]),d.push(B[4*E]),d.push(B[4*E+1]),d.push(B[4*E+2]),d.push(B[4*E+3]);if(f)for(var E=2;E<S;E++)n.push(L[0]),n.push(L[1]),n.push(L[2]),n.push(L[3*(E-1)]),n.push(L[3*(E-1)+1]),n.push(L[3*(E-1)+2]),n.push(L[3*E]),n.push(L[3*E+1]),n.push(L[3*E+2]);if(g)for(var M=0;M<g.length;M++){void 0===c[M]&&(c[M]=[]);for(var E=2;E<S;E++)c[M].push(I[M][0]),c[M].push(I[M][1]),c[M].push(I[M][2*(E-1)]),c[M].push(I[M][2*(E-1)+1]),c[M].push(I[M][2*E]),c[M].push(I[M][2*E+1])}if(m)for(var E=2;E<S;E++)l.push(C[0]),l.push(C[1]),l.push(C[2]),l.push(C[3*(E-1)]),l.push(C[3*(E-1)+1]),l.push(C[3*(E-1)+2]),l.push(C[3*E]),l.push(C[3*E+1]),l.push(C[3*E+2]);if(v&&"AllSame"!==v.mappingType)for(var X=h(D,k,F,v)[0],E=2;E<S;E++)u.push(X),u.push(X),u.push(X);k++,j=!1,S=0,z=[],L=[],C=[],I=[],A=[],B=[]}}var W=new THREE.BufferGeometry;W.name=t.name,W.addAttribute("position",new THREE.Float32BufferAttribute(o,3)),l.length>0&&W.addAttribute("color",new THREE.Float32BufferAttribute(l,3));e&&(W.addAttribute("skinIndex",new THREE.Float32BufferAttribute(d,4)),W.addAttribute("skinWeight",new THREE.Float32BufferAttribute(p,4)),W.FBX_Deformer=e);n.length>0&&W.addAttribute("normal",new THREE.Float32BufferAttribute(n,3));if(c.length>0)for(var E=0;E<c.length;E++){var Y="uv"+(E+1).toString();0==E&&(Y="uv"),W.addAttribute(Y,new THREE.Float32BufferAttribute(c[E],2))}if(v&&"AllSame"!==v.mappingType){for(var $=u[0],K=0,E=0;E<u.length;++E)u[E]!==$&&(W.addGroup(K,E-K,$),$=u[E],K=E);if(W.groups.length>0){var Z=W.groups[W.groups.length-1],Q=Z.start+Z.count;Q!==u.length&&W.addGroup(Q,u.length-Q,$)}0===W.groups.length&&W.addGroup(0,u.length,u[0])}return W}(t,r)}(t,e,i);case"NurbsCurve":return function(t){if(void 0===THREE.NURBSCurve)return console.error("THREE.FBXLoader: The loader relies on THREE.NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new THREE.BufferGeometry;var e=parseInt(t.properties.Order);if(isNaN(e))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",t.properties.Order,t.id),new THREE.BufferGeometry;for(var i,s,r=e-1,a=t.subNodes.KnotVector.properties.a,o=[],n=t.subNodes.Points.properties.a,h=0,l=n.length;h<l;h+=4)o.push((new THREE.Vector4).fromArray(n,h));if("Closed"===t.properties.Form)o.push(o[0]);else if("Periodic"===t.properties.Form){i=r,s=a.length-1-i;for(var h=0;h<r;++h)o.push(o[h])}for(var c=new THREE.NURBSCurve(r,a,o,i,s).getPoints(7*o.length),u=new Float32Array(3*c.length),h=0,l=c.length;h<l;++h)c[h].toArray(u,3*h);var p=new THREE.BufferGeometry;return p.addAttribute("position",new THREE.BufferAttribute(u,3)),p}(t)}}function a(t){var e=t.properties.MappingInformationType,i=t.properties.ReferenceInformationType,s=t.subNodes.UV.properties.a,r=[];return"IndexToDirect"===i&&(r=t.subNodes.UVIndex.properties.a),{dataSize:2,buffer:s,indices:r,mappingType:e,referenceType:i}}THREE.FBXLoader=function(t){this.manager=void 0!==t?t:THREE.DefaultLoadingManager},Object.assign(THREE.FBXLoader.prototype,{load:function(t,e,i,s){var r=this,a=THREE.Loader.prototype.extractUrlBase(t),o=new THREE.FileLoader(this.manager);o.setResponseType("arraybuffer"),o.load(t,function(i){try{var o=r.parse(i,a);e(o)}catch(e){window.setTimeout(function(){s&&s(e),r.manager.itemError(t)},0)}},i,s)},parse:function(a,o){var n,h,p;if(p="Kaydara FBX Binary  \0",(h=a).byteLength>=p.length&&p===S(h,0,p.length))n=(new T).parse(a);else{var d=S(a);if(!function(t){var e=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],i=0;function s(e){var s=t[e-1];return t=t.slice(i+e),i++,s}for(var r=0;r<e.length;++r){var a=s(1);if(a===e[r])return!1}return!0}(d))throw new Error("THREE.FBXLoader: Unknown format.");if(M(d)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+M(d));n=(new b).parse(d)}var m=function(t){var e=new Map;if("Connections"in t)for(var i=t.Connections.properties.connections,s=0,r=i.length;s<r;++s){var a=i[s];e.has(a[0])||e.set(a[0],{parents:[],children:[]});var o={ID:a[1],relationship:a[2]};e.get(a[0]).parents.push(o),e.has(a[1])||e.set(a[1],{parents:[],children:[]});var n={ID:a[0],relationship:a[2]};e.get(a[1]).children.push(n)}return e}(n),v=function(e){var i=new Map;if("Video"in e.Objects.subNodes){var s=e.Objects.subNodes.Video;for(var r in s){var a=s[r];if("Content"in a.properties){var o=t(s[r]);i.set(parseInt(r),o)}}}return i}(n),g=function(t,e,s){var r=new Map;if("Material"in t.Objects.subNodes){var a=t.Objects.subNodes.Material;for(var o in a){var n=i(a[o],e,s);null!==n&&r.set(parseInt(o),n)}}return r}(n,function(t,i,s,r){var a=new Map,o=["jpg","jpeg","png","bmp"];if("Texture"in t.Objects.subNodes){var n=t.Objects.subNodes.Texture;for(var h in n){var l=n[h],c=l.properties.FileName.slice(l.properties.FileName.lastIndexOf(".")+1).toLowerCase();if(-1!=o.indexOf(c)){var u=e(l,i,s,r);a.set(parseInt(h),u)}}}return a}(n,new THREE.TextureLoader(this.manager).setPath(o),v,m),m),E=function(t,e){var i={};if("Deformer"in t.Objects.subNodes){var r=t.Objects.subNodes.Deformer;for(var a in r){var o=r[a];if("Skin"===o.attrType){var n=e.get(parseInt(a)),h=s(n,r);h.FBX_ID=parseInt(a),i[a]=h}}}return i}(n,m),y=function(t,e,i){var s=new Map;if("Geometry"in t.Objects.subNodes){var a=t.Objects.subNodes.Geometry;for(var o in a){var n=e.get(parseInt(o)),h=r(a[o],n,i);s.set(parseInt(o),h)}}return s}(n,m,E);return function(t,e,i,s,r){var a=new THREE.Group,o=t.Objects.subNodes.Model,n=[],h=new Map;for(var p in o){for(var d=parseInt(p),m=o[p],v=e.get(d),g=null,E=0;E<v.parents.length;++E)for(var y in i){var b=i[y],T=b.map,x=T[v.parents[E].ID];if(x){var w=g;g=new THREE.Bone,b.bones[x.index]=g,null!==w&&g.add(w)}}if(!g)switch(m.attrType){case"Camera":for(var M,R=0,H=v.children.length;R<H;++R){var S=v.children[R].ID,z=t.Objects.subNodes.NodeAttribute[S];void 0!==z&&void 0!==z.properties&&(M=z.properties)}if(void 0===M)g=new THREE.Object3D;else{var L=0;void 0!==M.CameraProjectionType&&1===M.CameraProjectionType.value&&(L=1);var C=1;void 0!==M.NearPlane&&(C=M.NearPlane.value/1e3);var I=1e3;void 0!==M.FarPlane&&(I=M.FarPlane.value/1e3);var A=window.innerWidth,B=window.innerHeight;void 0!==M.AspectWidth&&void 0!==M.AspectHeight&&(A=M.AspectWidth.value,B=M.AspectHeight.value);var D=A/B,F=45;switch(void 0!==M.FieldOfView&&(F=M.FieldOfView.value),L){case 0:g=new THREE.PerspectiveCamera(F,D,C,I);break;case 1:g=new THREE.OrthographicCamera(-A/2,A/2,B/2,-B/2,C,I);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+L+"."),g=new THREE.Object3D}}break;case"Light":for(var j,R=0,H=v.children.length;R<H;++R){var S=v.children[R].ID,z=t.Objects.subNodes.NodeAttribute[S];void 0!==z&&void 0!==z.properties&&(j=z.properties)}if(void 0===j)g=new THREE.Object3D;else{L=void 0===j.LightType?0:j.LightType.value;var O=16777215;void 0!==j.Color&&(O=k(j.Color.value));var N=void 0===j.Intensity?1:j.Intensity.value/100;void 0!==j.CastLightOnObject&&0===j.CastLightOnObject.value&&(N=0);var U=0;void 0!==j.FarAttenuationEnd&&(U=void 0!==j.EnableFarAttenuation&&0===j.EnableFarAttenuation.value?0:j.FarAttenuationEnd.value/1e3);switch(L){case 0:g=new THREE.PointLight(O,N,U,1);break;case 1:g=new THREE.DirectionalLight(O,N);break;case 2:var _=Math.PI/3;void 0!==j.InnerAngle&&(_=THREE.Math.degToRad(j.InnerAngle.value));var V=0;void 0!==j.OuterAngle&&(V=THREE.Math.degToRad(j.OuterAngle.value),V=Math.max(V,1)),g=new THREE.SpotLight(O,N,U,_,V,1);break;default:console.warn("THREE.FBXLoader: Unknown light type "+j.LightType.value+", defaulting to a THREE.PointLight."),g=new THREE.PointLight(O,N)}void 0!==j.CastShadows&&1===j.CastShadows.value&&(g.castShadow=!0)}break;case"Mesh":for(var q=null,G=null,X=[],R=0,H=v.children.length;R<H;++R){var W=v.children[R];s.has(W.ID)&&(q=s.get(W.ID)),r.has(W.ID)&&X.push(r.get(W.ID))}if(X.length>1?G=X:X.length>0?G=X[0]:(G=new THREE.MeshPhongMaterial({color:13421772}),X.push(G)),"color"in q.attributes)for(var Y=0,$=X.length;Y<$;++Y)X[Y].vertexColors=THREE.VertexColors;if(q.FBX_Deformer){for(var K=0,Z=X.length;K<Z;++K)X[K].skinning=!0;g=new THREE.SkinnedMesh(q,G)}else g=new THREE.Mesh(q,G);break;case"NurbsCurve":for(var q=null,R=0,H=v.children.length;R<H;++R){var W=v.children[R];s.has(W.ID)&&(q=s.get(W.ID))}G=new THREE.LineBasicMaterial({color:3342591,linewidth:5}),g=new THREE.Line(q,G);break;default:g=new THREE.Group}g.name=THREE.PropertyBinding.sanitizeNodeName(m.attrName),g.FBX_ID=d,n.push(g),h.set(d,g)}for(var Q=0,J=n.length;Q<J;++Q){var g=n[Q],m=o[g.FBX_ID];if("Lcl_Translation"in m.properties&&g.position.fromArray(m.properties.Lcl_Translation.value),"Lcl_Rotation"in m.properties){var tt=m.properties.Lcl_Rotation.value.map(THREE.Math.degToRad);tt.push("ZYX"),g.rotation.fromArray(tt)}if("Lcl_Scaling"in m.properties&&g.scale.fromArray(m.properties.Lcl_Scaling.value),"PreRotation"in m.properties){var et=m.properties.PreRotation.value.map(THREE.Math.degToRad);et[3]="ZYX";var it=(new THREE.Euler).fromArray(et);it=(new THREE.Quaternion).setFromEuler(it);var st=(new THREE.Quaternion).setFromEuler(g.rotation);it.multiply(st),g.rotation.setFromQuaternion(it,"ZYX")}if("GeometricTranslation"in m.properties){var et=m.properties.GeometricTranslation.value;g.traverse(function(t){t.geometry&&t.geometry.translate(et[0],et[1],et[2])})}if("LookAtProperty"in m.properties)for(var v=e.get(g.FBX_ID),R=0,H=v.children.length;R<H;++R){var W=v.children[R];if("LookAtProperty"===W.relationship){var rt=t.Objects.subNodes.Model[W.ID];if("Lcl_Translation"in rt.properties){var at=rt.properties.Lcl_Translation.value;void 0!==g.target?(g.target.position.set(at[0],at[1],at[2]),a.add(g.target)):g.lookAt(new THREE.Vector3(at[0],at[1],at[2]))}}}for(var v=e.get(g.FBX_ID),ot=0;ot<v.parents.length;ot++){var nt=P(n,function(t){return t.FBX_ID===v.parents[ot].ID});if(nt>-1){n[nt].add(g);break}}null===g.parent&&a.add(g)}a.updateMatrixWorld(!0);var ht=new Map;if("Pose"in t.Objects.subNodes){var lt=t.Objects.subNodes.Pose;for(var p in lt)if("BindPose"===lt[p].attrType){lt=lt[p];break}for(var ct=lt.subNodes.PoseNode,ut=0,pt=ct.length;ut<pt;++ut){var m=ct[ut],dt=(new THREE.Matrix4).fromArray(m.subNodes.Matrix.properties.a);ht.set(parseInt(m.properties.Node),dt)}}for(var y in i){var b=i[y],T=b.map;for(var mt in T){var x=T[mt],vt=x.index,ft=b.bones[vt];if(!ht.has(ft.FBX_ID))break;var gt=ht.get(ft.FBX_ID);ft.matrixWorld.copy(gt)}b.skeleton=new THREE.Skeleton(b.bones);for(var v=e.get(b.FBX_ID),Et=v.parents,yt=0,bt=Et.length;yt<bt;++yt){var Tt=Et[yt];if(s.has(Tt.ID))for(var xt=Tt.ID,wt=e.get(xt),E=0;E<wt.parents.length;++E)if(h.has(wt.parents[E].ID)){var g=h.get(wt.parents[E].ID);g.bind(b.skeleton,g.matrixWorld);break}}}a.updateMatrixWorld(!0),a.skeleton={bones:n};var Mt=function(t,e,i){var s=t.Objects.subNodes.AnimationCurveNode,r=t.Objects.subNodes.AnimationCurve,a=t.Objects.subNodes.AnimationLayer,o=t.Objects.subNodes.AnimationStack,n=30;if("GlobalSettings"in t&&"TimeMode"in t.GlobalSettings.properties){var h=t.GlobalSettings.properties.TimeMode.value;14===h?"CustomFrameRate"in t.GlobalSettings.properties&&(n=-1===(n=t.GlobalSettings.properties.CustomFrameRate.value)?30:n):h<=17&&(n=[30,120,100,60,50,48,30,30,29.97,29.97,25,24,1,23.976,30,96,72,59.94][h])}var p={curves:new Map,layers:{},stacks:{},length:0,fps:n,frames:0},d=[];for(var m in s)if(m.match(/\d+/)){var v=l(t,s[m],e,i);d.push(v)}for(var f=new Map,g=0;g<d.length;++g)null!==d[g]&&f.set(d[g].id,d[g]);var E=[];for(m in r)if(m.match(/\d+/)){var y=c(r[m]);if(!e.has(y.id))continue;E.push(y);var b=e.get(y.id).parents[0],T=b.ID,x=b.relationship,w="";if(x.match(/X/))w="x";else if(x.match(/Y/))w="y";else{if(!x.match(/Z/))continue;w="z"}f.get(T).curves[w]=y}for(var m in f.forEach(function(t){var e=t.containerBoneID;if(p.curves.has(e)||p.curves.set(e,{T:null,R:null,S:null}),p.curves.get(e)[t.attr]=t,"R"===t.attr){var i=t.curves;if(null===i.x&&(i.x={version:null,times:[0],values:[0]}),null===i.y&&(i.y={version:null,times:[0],values:[0]}),null===i.z&&(i.z={version:null,times:[0],values:[0]}),i.x.values=i.x.values.map(THREE.Math.degToRad),i.y.values=i.y.values.map(THREE.Math.degToRad),i.z.values=i.z.values.map(THREE.Math.degToRad),null!==t.preRotations){var s=(new THREE.Euler).setFromVector3(t.preRotations,"ZYX");s=(new THREE.Quaternion).setFromEuler(s);for(var r=new THREE.Euler,a=new THREE.Quaternion,o=0;o<i.x.times.length;++o)r.set(i.x.values[o],i.y.values[o],i.z.values[o],"ZYX"),a.setFromEuler(r).premultiply(s),r.setFromQuaternion(a,"ZYX"),i.x.values[o]=r.x,i.y.values[o]=r.y,i.z.values[o]=r.z}}}),a){for(var M=[],R=e.get(parseInt(m)).children,H=0;H<R.length;H++)if(f.has(R[H].ID)){var k=f.get(R[H].ID),S=k.containerBoneID;void 0===M[S]&&(M[S]={T:null,R:null,S:null}),M[S][k.attr]=k}p.layers[m]=M}for(var m in o){for(var P=[],R=e.get(parseInt(m)).children,z={max:0,min:Number.MAX_VALUE},H=0;H<R.length;++H){var L=p.layers[R[H].ID];if(void 0!==L){P.push(L);for(var C=0,I=L.length;C<I;++C){var M=L[C];M&&u(M,z)}}}z.max>z.min&&(p.stacks[m]={name:o[m].attrName,layers:P,length:z.max-z.min,frames:(z.max-z.min)*p.fps})}return p}(t,e,a);if(function(t,e){void 0===t.animations&&(t.animations=[]);var i=e.stacks;for(var s in i){for(var r=i[s],a={name:r.name,fps:e.fps,length:r.length,hierarchy:[]},o=t.skeleton.bones,n=0,h=o.length;n<h;++n){var l=o[n],c=l.name.replace(/.*:/,""),u=P(o,function(t){return l.parent===t});a.hierarchy.push({parent:u,name:c,keys:[]})}for(var p=0;p<=r.frames;p++)for(var n=0,h=o.length;n<h;++n)for(var l=o[n],d=n,m=r.layers[0][d],v=0,g=a.hierarchy.length;v<g;++v){var E=a.hierarchy[v];E.name===l.name&&E.keys.push(f(e,m,l,p))}t.animations.push(THREE.AnimationClip.parseAnimation(a,o))}}(a,Mt),"GlobalSettings"in t&&"AmbientColor"in t.GlobalSettings.properties){var Rt=t.GlobalSettings.properties.AmbientColor.value,Ht=Rt[0],kt=Rt[1],St=Rt[2];if(0!==Ht||0!==kt||0!==St){var O=new THREE.Color(Ht,kt,St);a.add(new THREE.AmbientLight(O,1))}}return a}(n,m,E,y,g)}});var o=[],n={ByPolygonVertex:{Direct:function(t,e,i,s){var r=t*s.dataSize,a=t*s.dataSize+s.dataSize;return z(o,s.buffer,r,a)},IndexToDirect:function(t,e,i,s){var r=s.indices[t],a=r*s.dataSize,n=r*s.dataSize+s.dataSize;return z(o,s.buffer,a,n)}},ByPolygon:{Direct:function(t,e,i,s){var r=e*s.dataSize,a=e*s.dataSize+s.dataSize;return z(o,s.buffer,r,a)},IndexToDirect:function(t,e,i,s){var r=s.indices[e],a=r*s.dataSize,n=r*s.dataSize+s.dataSize;return z(o,s.buffer,a,n)}},ByVertice:{Direct:function(t,e,i,s){var r=i*s.dataSize,a=i*s.dataSize+s.dataSize;return z(o,s.buffer,r,a)}},AllSame:{IndexToDirect:function(t,e,i,s){var r=s.indices[0]*s.dataSize,a=s.indices[0]*s.dataSize+s.dataSize;return z(o,s.buffer,r,a)}}};function h(t,e,i,s){return n[s.mappingType][s.referenceType](t,e,i,s)}function l(t,e,i,s){var r=t.Objects.subNodes.Model,a={id:e.id,attr:e.attrName,internalID:e.id,attrX:!1,attrY:!1,attrZ:!1,containerBoneID:-1,containerID:-1,curves:{x:null,y:null,z:null},preRotations:null};if(!a.attr.match(/S|R|T/))return null;for(var o in e.properties)o.match(/X/)&&(a.attrX=!0),o.match(/Y/)&&(a.attrY=!0),o.match(/Z/)&&(a.attrZ=!0);for(var n,h=i.get(a.id).parents,l=h.length-1;l>=0;--l){var c=P(s.skeleton.bones,function(t){return t.FBX_ID===h[l].ID});if(c>-1){a.containerBoneID=c,a.containerID=h[l].ID;var u=r[a.containerID.toString()];"PreRotation"in u.properties&&(a.preRotations=(n=u.properties.PreRotation,(new THREE.Vector3).fromArray(n.value)).multiplyScalar(Math.PI/180));break}}return a}function c(t){return{version:null,id:t.id,internalID:t.id,times:t.subNodes.KeyTime.properties.a.map(R),values:t.subNodes.KeyValueFloat.properties.a,attrFlag:t.subNodes.KeyAttrFlags.properties.a,attrData:t.subNodes.KeyAttrDataFloat.properties.a}}function u(t,e){t.R&&p(t.R.curves,e),t.S&&p(t.S.curves,e),t.T&&p(t.T.curves,e)}function p(t,e){t.x&&d(t.x,e),t.y&&d(t.y,e),t.z&&d(t.z,e)}function d(t,e){e.max=t.times[t.times.length-1]>e.max?t.times[t.times.length-1]:e.max,e.min=t.times[0]<e.min?t.times[0]:e.min}var m=new THREE.Euler,v=new THREE.Quaternion;function f(t,e,i,s){var r={time:s/t.fps,pos:i.position.toArray(),rot:i.quaternion.toArray(),scl:i.scale.toArray()};if(void 0===e)return r;m.setFromQuaternion(i.quaternion,"ZYX",!1);try{E(e,"T")&&y(e.T,s)&&(e.T.curves.x.values[s]&&(r.pos[0]=e.T.curves.x.values[s]),e.T.curves.y.values[s]&&(r.pos[1]=e.T.curves.y.values[s]),e.T.curves.z.values[s]&&(r.pos[2]=e.T.curves.z.values[s])),E(e,"R")&&y(e.R,s)&&(e.R.curves.x.values[s]&&(m.x=e.R.curves.x.values[s]),e.R.curves.y.values[s]&&(m.y=e.R.curves.y.values[s]),e.R.curves.z.values[s]&&(m.z=e.R.curves.z.values[s]),v.setFromEuler(m),r.rot=v.toArray()),E(e,"S")&&y(e.S,s)&&(e.T.curves.x.values[s]&&(r.scl[0]=e.S.curves.x.values[s]),e.T.curves.y.values[s]&&(r.scl[1]=e.S.curves.y.values[s]),e.T.curves.z.values[s]&&(r.scl[2]=e.S.curves.z.values[s]))}catch(t){console.log("THREE.FBXLoader: ",i),console.log("THREE.FBXLoader: ",t)}return r}var g=["x","y","z"];function E(t,e){if(void 0===t)return!1;var i=t[e];return!!i&&g.every(function(t){return null!==i.curves[t]})}function y(t,e){return g.every(function(i){return function(t,e){return void 0!==t.values[e]}(t.curves[i],e)})}function b(){}function T(){}function x(t,e){this.dv=new DataView(t),this.offset=0,this.littleEndian=void 0===e||e}function w(){}function M(t){var e=t.match(/FBXVersion: (\d+)/);if(e)return parseInt(e[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function R(t){return t/46186158e3}function H(t){for(var e=t.split(","),i=0,s=e.length;i<s;i++)e[i]=parseFloat(e[i]);return e}function k(t){return(new THREE.Color).fromArray(t.value)}function S(t,e,i){void 0===e&&(e=0),void 0===i&&(i=t.byteLength);var s=new Uint8Array(t,e,i);if(void 0!==window.TextDecoder)return(new TextDecoder).decode(s);for(var r="",a=0,o=s.length;a<o;a++)r+=String.fromCharCode(s[a]);return r}function P(t,e){for(var i=0,s=t.length;i<s;i++)if(e(t[i]))return i;return-1}function z(t,e,i,s){for(var r=i,a=0;r<s;r++,a++)t[a]=e[r];return t}Object.assign(b.prototype,{getPrevNode:function(){return this.nodeStack[this.currentIndent-2]},getCurrentNode:function(){return this.nodeStack[this.currentIndent-1]},getCurrentProp:function(){return this.currentProp},pushStack:function(t){this.nodeStack.push(t),this.currentIndent+=1},popStack:function(){this.nodeStack.pop(),this.currentIndent-=1},setCurrentProp:function(t,e){this.currentProp=t,this.currentPropName=e},parse:function(t){this.currentIndent=0,this.allNodes=new w,this.nodeStack=[],this.currentProp=[],this.currentPropName="";for(var e=t.split("\n"),i=0,s=e.length;i<s;i++){if(!(h=e[i]).match(/^[\s\t]*;/)&&!h.match(/^[\s\t]*$/)){var r=new RegExp("^\\t{"+this.currentIndent+"}(\\w+):(.*){","");if(l=h.match(r)){for(var a=l[1].trim().replace(/^"/,"").replace(/"$/,""),o=l[2].split(","),n=0,h=o.length;n<h;n++)o[n]=o[n].trim().replace(/^"/,"").replace(/"$/,"");this.parseNodeBegin(h,a,o||null)}else{var l,c=new RegExp("^\\t{"+this.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)");if(l=h.match(c)){var u=l[1].replace(/^"/,"").replace(/"$/,"").trim(),p=l[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===u&&","===p&&(p=e[++i].replace(/"/g,"").replace(/,$/,"").trim()),this.parseNodeProperty(h,u,p)}else{var d=new RegExp("^\\t{"+(this.currentIndent-1)+"}}");h.match(d)?this.nodeEnd():h.match(/^[^\s\t}]/)&&this.parseNodePropertyContinued(h)}}}}return this.allNodes},parseNodeBegin:function(t,e,i){var s={name:e,properties:{},subNodes:{}},r=this.parseNodeAttr(i),a=this.getCurrentNode();if(0===this.currentIndent)this.allNodes.add(e,s);else if(e in a.subNodes){var o=a.subNodes[e];this.isFlattenNode(a.subNodes[e])&&(""===r.id?(a.subNodes[e]=[],a.subNodes[e].push(o)):(a.subNodes[e]={},a.subNodes[e][o.id]=o)),""===r.id?a.subNodes[e].push(s):a.subNodes[e][r.id]=s}else"number"==typeof r.id||r.id.match(/^\d+$/)?(a.subNodes[e]={},a.subNodes[e][r.id]=s):a.subNodes[e]=s;i&&(s.id=r.id,s.attrName=r.name,s.attrType=r.type),this.pushStack(s)},parseNodeAttr:function(t){var e=t[0];""!==t[0]&&(e=parseInt(t[0]),isNaN(e)&&(e=t[0]));var i="",s="";return t.length>1&&(i=t[1].replace(/^(\w+)::/,""),s=t[2]),{id:e,name:i,type:s}},parseNodeProperty:function(t,e,i){var s=this.getCurrentNode(),r=s.name;if(void 0!==r&&r.match(/Properties(\d)+/))return void this.parseNodeSpecialProperty(t,e,i);if("C"===e){var a=i.split(",").slice(1),o=parseInt(a[0]),n=parseInt(a[1]),h=i.split(",").slice(3);e="connections",function(t,e){for(var i=0,s=t.length,r=e.length;i<r;i++,s++)t[s]=e[i]}(i=[o,n],h=h.map(function(t){return t.trim().replace(/^"/,"")})),void 0===s.properties[e]&&(s.properties[e]=[])}if("Node"===e){var l=parseInt(i);s.properties.id=l,s.id=l}e in s.properties?Array.isArray(s.properties[e])?s.properties[e].push(i):s.properties[e]+=i:Array.isArray(s.properties[e])?s.properties[e].push(i):s.properties[e]=i,this.setCurrentProp(s.properties,e),"a"===e&&","!==i.slice(-1)&&(s.properties.a=H(i))},parseNodePropertyContinued:function(t){if(this.currentProp[this.currentPropName]+=t,","!==t.slice(-1)){var e=this.getCurrentNode();e.properties.a=H(e.properties.a)}},parseNodeSpecialProperty:function(t,e,i){for(var s=i.split('",'),r=0,a=s.length;r<a;r++)s[r]=s[r].trim().replace(/^\"/,"").replace(/\s/,"_");var o=s[0],n=s[1],h=s[2],l=s[3],c=s[4];switch(n){case"int":case"enum":case"bool":case"ULongLong":c=parseInt(c);break;case"double":case"Number":case"FieldOfView":c=parseFloat(c);break;case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":c=H(c)}this.getPrevNode().properties[o]={type:n,type2:h,flag:l,value:c},this.setCurrentProp(this.getPrevNode().properties,o)},nodeEnd:function(){this.popStack()},isFlattenNode:function(t){return"subNodes"in t&&"properties"in t}}),Object.assign(T.prototype,{parse:function(t){var e=new x(t);e.skip(23);for(var i=e.getUint32(),s=new w;!this.endOfContent(e);)try{var r=this.parseNode(e,i);null!==r&&s.add(r.name,r)}catch(t){console.log(t)}return s},endOfContent:function(t){return t.size()%16==0?(t.getOffset()+160+16&-16)>=t.size():t.getOffset()+160+16>=t.size()},parseNode:function(t,e){var i=e>=7500?t.getUint64():t.getUint32(),s=e>=7500?t.getUint64():t.getUint32(),r=(e>=7500?t.getUint64():t.getUint32(),t.getUint8()),a=t.getString(r);if(0===i)return null;for(var o=[],n=0;n<s;n++)o.push(this.parseProperty(t));var h=o.length>0?o[0]:"",l=o.length>1?o[1]:"",c=o.length>2?o[2]:"",u={},p={},d=!1;for(1===s&&t.getOffset()===i&&(d=!0);i>t.getOffset();){var m=this.parseNode(t,e);if(null!==m)if(!0!==m.singleProperty)if("Connections"!==a||"C"!==m.name)if(m.name.match(/^Properties\d+$/)){var v=Object.keys(m.properties);for(n=0,w=v.length;n<w;n++){var f=v[n];p[f]=m.properties[f]}}else if(a.match(/^Properties\d+$/)&&"P"===m.name){var g,E=m.propertyList[0],y=m.propertyList[1],b=m.propertyList[2],T=m.propertyList[3];0===E.indexOf("Lcl ")&&(E=E.replace("Lcl ","Lcl_")),0===y.indexOf("Lcl ")&&(y=y.replace("Lcl ","Lcl_")),g="ColorRGB"===y||"Vector"===y||"Vector3D"===y||0===y.indexOf("Lcl_")?[m.propertyList[4],m.propertyList[5],m.propertyList[6]]:m.propertyList[4],p[E]={type:y,type2:b,flag:T,value:g}}else void 0===u[m.name]?"number"==typeof m.id?(u[m.name]={},u[m.name][m.id]=m):u[m.name]=m:""===m.id?(Array.isArray(u[m.name])||(u[m.name]=[u[m.name]]),u[m.name].push(m)):void 0===u[m.name][m.id]?u[m.name][m.id]=m:(Array.isArray(u[m.name][m.id])||(u[m.name][m.id]=[u[m.name][m.id]]),u[m.name][m.id].push(m));else{for(var x=[],n=1,w=m.propertyList.length;n<w;n++)x[n-1]=m.propertyList[n];void 0===p.connections&&(p.connections=[]),p.connections.push(x)}else{var M=m.propertyList[0];Array.isArray(M)?(u[m.name]=m,m.properties.a=M):p[m.name]=M}}return{singleProperty:d,id:h,attrName:l,attrType:c,name:a,properties:p,propertyList:o,subNodes:u}},parseProperty:function(t){var e=t.getChar();switch(e){case"C":return t.getBoolean();case"D":return t.getFloat64();case"F":return t.getFloat32();case"I":return t.getInt32();case"L":return t.getInt64();case"R":var i=t.getUint32();return t.getArrayBuffer(i);case"S":i=t.getUint32();return t.getString(i);case"Y":return t.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":var s=t.getUint32(),r=t.getUint32(),a=t.getUint32();if(0===r)switch(e){case"b":case"c":return t.getBooleanArray(s);case"d":return t.getFloat64Array(s);case"f":return t.getFloat32Array(s);case"i":return t.getInt32Array(s);case"l":return t.getInt64Array(s)}if(void 0===window.Zlib)throw new Error("THREE.FBXLoader: External library Inflate.min.js required, obtain or import from https://github.com/imaya/zlib.js");var o=new x(new Zlib.Inflate(new Uint8Array(t.getArrayBuffer(a))).decompress().buffer);switch(e){case"b":case"c":return o.getBooleanArray(s);case"d":return o.getFloat64Array(s);case"f":return o.getFloat32Array(s);case"i":return o.getInt32Array(s);case"l":return o.getInt64Array(s)}default:throw new Error("THREE.FBXLoader: Unknown property type "+e)}}}),Object.assign(x.prototype,{getOffset:function(){return this.offset},size:function(){return this.dv.buffer.byteLength},skip:function(t){this.offset+=t},getBoolean:function(){return 1==(1&this.getUint8())},getBooleanArray:function(t){for(var e=[],i=0;i<t;i++)e.push(this.getBoolean());return e},getInt8:function(){var t=this.dv.getInt8(this.offset);return this.offset+=1,t},getInt8Array:function(t){for(var e=[],i=0;i<t;i++)e.push(this.getInt8());return e},getUint8:function(){var t=this.dv.getUint8(this.offset);return this.offset+=1,t},getUint8Array:function(t){for(var e=[],i=0;i<t;i++)e.push(this.getUint8());return e},getInt16:function(){var t=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,t},getInt16Array:function(t){for(var e=[],i=0;i<t;i++)e.push(this.getInt16());return e},getUint16:function(){var t=this.dv.getUint16(this.offset,this.littleEndian);return this.offset+=2,t},getUint16Array:function(t){for(var e=[],i=0;i<t;i++)e.push(this.getUint16());return e},getInt32:function(){var t=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,t},getInt32Array:function(t){for(var e=[],i=0;i<t;i++)e.push(this.getInt32());return e},getUint32:function(){var t=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,t},getUint32Array:function(t){for(var e=[],i=0;i<t;i++)e.push(this.getUint32());return e},getInt64:function(){var t,e;return this.littleEndian?(t=this.getUint32(),e=this.getUint32()):(e=this.getUint32(),t=this.getUint32()),2147483648&e?(e=4294967295&~e,4294967295===(t=4294967295&~t)&&(e=e+1&4294967295),-(4294967296*e+(t=t+1&4294967295))):4294967296*e+t},getInt64Array:function(t){for(var e=[],i=0;i<t;i++)e.push(this.getInt64());return e},getUint64:function(){var t,e;return this.littleEndian?(t=this.getUint32(),e=this.getUint32()):(e=this.getUint32(),t=this.getUint32()),4294967296*e+t},getUint64Array:function(t){for(var e=[],i=0;i<t;i++)e.push(this.getUint64());return e},getFloat32:function(){var t=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t},getFloat32Array:function(t){for(var e=[],i=0;i<t;i++)e.push(this.getFloat32());return e},getFloat64:function(){var t=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t},getFloat64Array:function(t){for(var e=[],i=0;i<t;i++)e.push(this.getFloat64());return e},getArrayBuffer:function(t){var e=this.dv.buffer.slice(this.offset,this.offset+t);return this.offset+=t,e},getChar:function(){return String.fromCharCode(this.getUint8())},getString:function(t){for(var e="";t>0;){var i=this.getUint8();if(t--,0===i)break;e+=String.fromCharCode(i)}return e=decodeURIComponent(escape(e)),this.skip(t),e}}),Object.assign(w.prototype,{add:function(t,e){this[t]=e}})}()},function(t,e){THREE.OBJLoader=function(){var t=/^[og]\s*(.+)?/,e=/^mtllib /,i=/^usemtl /;function s(){var t={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materialLibraries:[],startObject:function(t,e){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=t,void(this.object.fromDeclaration=!1!==e);var i=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:t||"",fromDeclaration:!1!==e,geometry:{vertices:[],normals:[],colors:[],uvs:[]},materials:[],smooth:!0,startMaterial:function(t,e){var i=this._finalize(!1);i&&(i.inherited||i.groupCount<=0)&&this.materials.splice(i.index,1);var s={index:this.materials.length,name:t||"",mtllib:Array.isArray(e)&&e.length>0?e[e.length-1]:"",smooth:void 0!==i?i.smooth:this.smooth,groupStart:void 0!==i?i.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(t){var e={index:"number"==typeof t?t:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return e.clone=this.clone.bind(e),e}};return this.materials.push(s),s},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(t){var e=this.currentMaterial();if(e&&-1===e.groupEnd&&(e.groupEnd=this.geometry.vertices.length/3,e.groupCount=e.groupEnd-e.groupStart,e.inherited=!1),t&&this.materials.length>1)for(var i=this.materials.length-1;i>=0;i--)this.materials[i].groupCount<=0&&this.materials.splice(i,1);return t&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),e}},i&&i.name&&"function"==typeof i.clone){var s=i.clone(0);s.inherited=!0,this.object.materials.push(s)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(t,e){var i=parseInt(t,10);return 3*(i>=0?i-1:i+e/3)},parseNormalIndex:function(t,e){var i=parseInt(t,10);return 3*(i>=0?i-1:i+e/3)},parseUVIndex:function(t,e){var i=parseInt(t,10);return 2*(i>=0?i-1:i+e/2)},addVertex:function(t,e,i){var s=this.vertices,r=this.object.geometry.vertices;r.push(s[t+0],s[t+1],s[t+2]),r.push(s[e+0],s[e+1],s[e+2]),r.push(s[i+0],s[i+1],s[i+2])},addVertexPoint:function(t){var e=this.vertices;this.object.geometry.vertices.push(e[t+0],e[t+1],e[t+2])},addVertexLine:function(t){var e=this.vertices;this.object.geometry.vertices.push(e[t+0],e[t+1],e[t+2])},addNormal:function(t,e,i){var s=this.normals,r=this.object.geometry.normals;r.push(s[t+0],s[t+1],s[t+2]),r.push(s[e+0],s[e+1],s[e+2]),r.push(s[i+0],s[i+1],s[i+2])},addColor:function(t,e,i){var s=this.colors,r=this.object.geometry.colors;r.push(s[t+0],s[t+1],s[t+2]),r.push(s[e+0],s[e+1],s[e+2]),r.push(s[i+0],s[i+1],s[i+2])},addUV:function(t,e,i){var s=this.uvs,r=this.object.geometry.uvs;r.push(s[t+0],s[t+1]),r.push(s[e+0],s[e+1]),r.push(s[i+0],s[i+1])},addUVLine:function(t){var e=this.uvs;this.object.geometry.uvs.push(e[t+0],e[t+1])},addFace:function(t,e,i,s,r,a,o,n,h){var l=this.vertices.length,c=this.parseVertexIndex(t,l),u=this.parseVertexIndex(e,l),p=this.parseVertexIndex(i,l);if(this.addVertex(c,u,p),void 0!==s&&""!==s){var d=this.uvs.length;c=this.parseUVIndex(s,d),u=this.parseUVIndex(r,d),p=this.parseUVIndex(a,d),this.addUV(c,u,p)}if(void 0!==o&&""!==o){var m=this.normals.length;c=this.parseNormalIndex(o,m),u=o===n?c:this.parseNormalIndex(n,m),p=o===h?c:this.parseNormalIndex(h,m),this.addNormal(c,u,p)}this.colors.length>0&&this.addColor(c,u,p)},addPointGeometry:function(t){this.object.geometry.type="Points";for(var e=this.vertices.length,i=0,s=t.length;i<s;i++)this.addVertexPoint(this.parseVertexIndex(t[i],e))},addLineGeometry:function(t,e){this.object.geometry.type="Line";for(var i=this.vertices.length,s=this.uvs.length,r=0,a=t.length;r<a;r++)this.addVertexLine(this.parseVertexIndex(t[r],i));var o=0;for(a=e.length;o<a;o++)this.addUVLine(this.parseUVIndex(e[o],s))}};return t.startObject("",!1),t}function r(t){this.manager=void 0!==t?t:THREE.DefaultLoadingManager,this.materials=null}return r.prototype={constructor:r,load:function(t,e,i,s){var r=this,a=new THREE.FileLoader(r.manager);a.setPath(this.path),a.load(t,function(t){e(r.parse(t))},i,s)},setPath:function(t){return this.path=t,this},setMaterials:function(t){return this.materials=t,this},parse:function(r){console.time("OBJLoader");var a=new s;-1!==r.indexOf("\r\n")&&(r=r.replace(/\r\n/g,"\n")),-1!==r.indexOf("\\\n")&&(r=r.replace(/\\\n/g,""));for(var o=r.split("\n"),n="",h="",l=[],c="function"==typeof"".trimLeft,u=0,p=o.length;u<p;u++)if(n=o[u],0!==(n=c?n.trimLeft():n.trim()).length&&"#"!==(h=n.charAt(0)))if("v"===h){var d=n.split(/\s+/);switch(d[0]){case"v":a.vertices.push(parseFloat(d[1]),parseFloat(d[2]),parseFloat(d[3])),8===d.length&&a.colors.push(parseFloat(d[4]),parseFloat(d[5]),parseFloat(d[6]));break;case"vn":a.normals.push(parseFloat(d[1]),parseFloat(d[2]),parseFloat(d[3]));break;case"vt":a.uvs.push(parseFloat(d[1]),parseFloat(d[2]))}}else if("f"===h){for(var m=n.substr(1).trim().split(/\s+/),v=[],f=0,g=m.length;f<g;f++){var E=m[f];if(E.length>0){var y=E.split("/");v.push(y)}}var b=v[0];for(f=1,g=v.length-1;f<g;f++){var T=v[f],x=v[f+1];a.addFace(b[0],T[0],x[0],b[1],T[1],x[1],b[2],T[2],x[2])}}else if("l"===h){var w=n.substring(1).trim().split(" "),M=[],R=[];if(-1===n.indexOf("/"))M=w;else for(var H=0,k=w.length;H<k;H++){var S=w[H].split("/");""!==S[0]&&M.push(S[0]),""!==S[1]&&R.push(S[1])}a.addLineGeometry(M,R)}else if("p"===h){var P=n.substr(1).trim().split(" ");a.addPointGeometry(P)}else if(null!==(l=t.exec(n))){var z=(" "+l[0].substr(1).trim()).substr(1);a.startObject(z)}else if(i.test(n))a.object.startMaterial(n.substring(7).trim(),a.materialLibraries);else if(e.test(n))a.materialLibraries.push(n.substring(7).trim());else{if("s"!==h){if("\0"===n)continue;throw new Error('THREE.OBJLoader: Unexpected line: "'+n+'"')}if((l=n.split(" ")).length>1){var L=l[1].trim().toLowerCase();a.object.smooth="0"!==L&&"off"!==L}else a.object.smooth=!0;(G=a.object.currentMaterial())&&(G.smooth=a.object.smooth)}a.finalize();var C=new THREE.Group;C.materialLibraries=[].concat(a.materialLibraries);for(u=0,p=a.objects.length;u<p;u++){var I=a.objects[u],A=I.geometry,B=I.materials,D="Line"===A.type,F="Points"===A.type,j=!1;if(0!==A.vertices.length){var O=new THREE.BufferGeometry;O.addAttribute("position",new THREE.Float32BufferAttribute(A.vertices,3)),A.normals.length>0?O.addAttribute("normal",new THREE.Float32BufferAttribute(A.normals,3)):O.computeVertexNormals(),A.colors.length>0&&(j=!0,O.addAttribute("color",new THREE.Float32BufferAttribute(A.colors,3))),A.uvs.length>0&&O.addAttribute("uv",new THREE.Float32BufferAttribute(A.uvs,2));for(var N,U=[],_=0,V=B.length;_<V;_++){var q=B[_],G=void 0;if(null!==this.materials)if(G=this.materials.create(q.name),!D||!G||G instanceof THREE.LineBasicMaterial){if(F&&G&&!(G instanceof THREE.PointsMaterial)){var X=new THREE.PointsMaterial({size:10,sizeAttenuation:!1});W.copy(G),G=X}}else{var W=new THREE.LineBasicMaterial;W.copy(G),W.lights=!1,G=W}G||((G=D?new THREE.LineBasicMaterial:F?new THREE.PointsMaterial({size:1,sizeAttenuation:!1}):new THREE.MeshPhongMaterial).name=q.name),G.flatShading=!q.smooth,G.vertexColors=j?THREE.VertexColors:THREE.NoColors,U.push(G)}if(U.length>1){for(_=0,V=B.length;_<V;_++){q=B[_];O.addGroup(q.groupStart,q.groupCount,_)}N=D?new THREE.LineSegments(O,U):F?new THREE.Points(O,U):new THREE.Mesh(O,U)}else N=D?new THREE.LineSegments(O,U[0]):F?new THREE.Points(O,U[0]):new THREE.Mesh(O,U[0]);N.name=I.name,C.add(N)}}return console.timeEnd("OBJLoader"),C}},r}()},function(t,e){THREE.CopyShader={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","gl_FragColor = opacity * texel;","}"].join("\n")}},function(t,e){THREE.EffectComposer=function(t,e){if(this.renderer=t,void 0===e){var i={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,stencilBuffer:!1},s=t.getDrawingBufferSize();(e=new THREE.WebGLRenderTarget(s.width,s.height,i)).texture.name="EffectComposer.rt1"}this.renderTarget1=e,this.renderTarget2=e.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.passes=[],void 0===THREE.CopyShader&&console.error("THREE.EffectComposer relies on THREE.CopyShader"),void 0===THREE.ShaderPass&&console.error("THREE.EffectComposer relies on THREE.ShaderPass"),this.copyPass=new THREE.ShaderPass(THREE.CopyShader)},Object.assign(THREE.EffectComposer.prototype,{swapBuffers:function(){var t=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=t},addPass:function(t){this.passes.push(t);var e=this.renderer.getDrawingBufferSize();t.setSize(e.width,e.height)},insertPass:function(t,e){this.passes.splice(e,0,t)},render:function(t){var e,i,s=!1,r=this.passes.length;for(i=0;i<r;i++)if(!1!==(e=this.passes[i]).enabled){if(e.render(this.renderer,this.writeBuffer,this.readBuffer,t,s),e.needsSwap){if(s){var a=this.renderer.context;a.stencilFunc(a.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,t),a.stencilFunc(a.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==THREE.MaskPass&&(e instanceof THREE.MaskPass?s=!0:e instanceof THREE.ClearMaskPass&&(s=!1))}},reset:function(t){if(void 0===t){var e=this.renderer.getDrawingBufferSize();(t=this.renderTarget1.clone()).setSize(e.width,e.height)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=t,this.renderTarget2=t.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2},setSize:function(t,e){this.renderTarget1.setSize(t,e),this.renderTarget2.setSize(t,e);for(var i=0;i<this.passes.length;i++)this.passes[i].setSize(t,e)}}),THREE.Pass=function(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1},Object.assign(THREE.Pass.prototype,{setSize:function(t,e){},render:function(t,e,i,s,r){console.error("THREE.Pass: .render() must be implemented in derived pass.")}})},function(t,e){THREE.LuminosityHighPassShader={shaderID:"luminosityHighPass",uniforms:{tDiffuse:{type:"t",value:null},luminosityThreshold:{type:"f",value:1},smoothWidth:{type:"f",value:1},defaultColor:{type:"c",value:new THREE.Color(0)},defaultOpacity:{type:"f",value:0}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec3 defaultColor;","uniform float defaultOpacity;","uniform float luminosityThreshold;","uniform float smoothWidth;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","vec3 luma = vec3( 0.299, 0.587, 0.114 );","float v = dot( texel.xyz, luma );","vec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );","float alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );","gl_FragColor = mix( outputColor, texel, alpha );","}"].join("\n")}},function(t,e){THREE.RenderPass=function(t,e,i,s,r){THREE.Pass.call(this),this.scene=t,this.camera=e,this.overrideMaterial=i,this.clearColor=s,this.clearAlpha=void 0!==r?r:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1},THREE.RenderPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.RenderPass,render:function(t,e,i,s,r){var a,o,n=t.autoClear;t.autoClear=!1,this.scene.overrideMaterial=this.overrideMaterial,this.clearColor&&(a=t.getClearColor().getHex(),o=t.getClearAlpha(),t.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&t.clearDepth(),t.render(this.scene,this.camera,this.renderToScreen?null:i,this.clear),this.clearColor&&t.setClearColor(a,o),this.scene.overrideMaterial=null,t.autoClear=n}})},function(t,e){THREE.ShaderPass=function(t,e){THREE.Pass.call(this),this.textureID=void 0!==e?e:"tDiffuse",t instanceof THREE.ShaderMaterial?(this.uniforms=t.uniforms,this.material=t):t&&(this.uniforms=THREE.UniformsUtils.clone(t.uniforms),this.material=new THREE.ShaderMaterial({defines:t.defines||{},uniforms:this.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader})),this.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),this.scene=new THREE.Scene,this.quad=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)},THREE.ShaderPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.ShaderPass,render:function(t,e,i,s,r){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=i.texture),this.quad.material=this.material,this.renderToScreen?t.render(this.scene,this.camera):t.render(this.scene,this.camera,e,this.clear)}})},function(t,e){THREE.UnrealBloomPass=function(t,e,i,s){THREE.Pass.call(this),this.strength=void 0!==e?e:1,this.radius=i,this.threshold=s,this.resolution=void 0!==t?new THREE.Vector2(t.x,t.y):new THREE.Vector2(256,256);var r={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat};this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;var a=Math.round(this.resolution.x/2),o=Math.round(this.resolution.y/2);this.renderTargetBright=new THREE.WebGLRenderTarget(a,o,r),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(var n=0;n<this.nMips;n++){var h;(h=new THREE.WebGLRenderTarget(a,o,r)).texture.name="UnrealBloomPass.h"+n,h.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(h),(h=new THREE.WebGLRenderTarget(a,o,r)).texture.name="UnrealBloomPass.v"+n,h.texture.generateMipmaps=!1,this.renderTargetsVertical.push(h),a=Math.round(a/2),o=Math.round(o/2)}void 0===THREE.LuminosityHighPassShader&&console.error("THREE.UnrealBloomPass relies on THREE.LuminosityHighPassShader");var l=THREE.LuminosityHighPassShader;this.highPassUniforms=THREE.UniformsUtils.clone(l.uniforms),this.highPassUniforms.luminosityThreshold.value=s,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new THREE.ShaderMaterial({uniforms:this.highPassUniforms,vertexShader:l.vertexShader,fragmentShader:l.fragmentShader,defines:{}}),this.separableBlurMaterials=[];var c=[3,5,7,9,11];for(a=Math.round(this.resolution.x/2),o=Math.round(this.resolution.y/2),n=0;n<this.nMips;n++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(c[n])),this.separableBlurMaterials[n].uniforms.texSize.value=new THREE.Vector2(a,o),a=Math.round(a/2),o=Math.round(o/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=e,this.compositeMaterial.uniforms.bloomRadius.value=.1,this.compositeMaterial.needsUpdate=!0;this.compositeMaterial.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],this.bloomTintColors=[new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,void 0===THREE.CopyShader&&console.error("THREE.BloomPass relies on THREE.CopyShader");var u=THREE.CopyShader;this.copyUniforms=THREE.UniformsUtils.clone(u.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new THREE.ShaderMaterial({uniforms:this.copyUniforms,vertexShader:u.vertexShader,fragmentShader:u.fragmentShader,blending:THREE.AdditiveBlending,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this.oldClearColor=new THREE.Color,this.oldClearAlpha=1,this.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),this.scene=new THREE.Scene,this.basic=new THREE.MeshBasicMaterial,this.quad=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)},THREE.UnrealBloomPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.UnrealBloomPass,dispose:function(){for(var t=0;t<this.renderTargetsHorizontal.length;t++)this.renderTargetsHorizontal[t].dispose();for(t=0;t<this.renderTargetsVertical.length;t++)this.renderTargetsVertical[t].dispose();this.renderTargetBright.dispose()},setSize:function(t,e){var i=Math.round(t/2),s=Math.round(e/2);this.renderTargetBright.setSize(i,s);for(var r=0;r<this.nMips;r++)this.renderTargetsHorizontal[r].setSize(i,s),this.renderTargetsVertical[r].setSize(i,s),this.separableBlurMaterials[r].uniforms.texSize.value=new THREE.Vector2(i,s),i=Math.round(i/2),s=Math.round(s/2)},render:function(t,e,i,s,r){this.oldClearColor.copy(t.getClearColor()),this.oldClearAlpha=t.getClearAlpha();var a=t.autoClear;t.autoClear=!1,t.setClearColor(new THREE.Color(0,0,0),0),r&&t.context.disable(t.context.STENCIL_TEST),this.renderToScreen&&(this.quad.material=this.basic,this.basic.map=i.texture,t.render(this.scene,this.camera,void 0,!0)),this.highPassUniforms.tDiffuse.value=i.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.quad.material=this.materialHighPassFilter,t.render(this.scene,this.camera,this.renderTargetBright,!0);for(var o=this.renderTargetBright,n=0;n<this.nMips;n++)this.quad.material=this.separableBlurMaterials[n],this.separableBlurMaterials[n].uniforms.colorTexture.value=o.texture,this.separableBlurMaterials[n].uniforms.direction.value=THREE.UnrealBloomPass.BlurDirectionX,t.render(this.scene,this.camera,this.renderTargetsHorizontal[n],!0),this.separableBlurMaterials[n].uniforms.colorTexture.value=this.renderTargetsHorizontal[n].texture,this.separableBlurMaterials[n].uniforms.direction.value=THREE.UnrealBloomPass.BlurDirectionY,t.render(this.scene,this.camera,this.renderTargetsVertical[n],!0),o=this.renderTargetsVertical[n];this.quad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,t.render(this.scene,this.camera,this.renderTargetsHorizontal[0],!0),this.quad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,r&&t.context.enable(t.context.STENCIL_TEST),this.renderToScreen?t.render(this.scene,this.camera,void 0,!1):t.render(this.scene,this.camera,i,!1),t.setClearColor(this.oldClearColor,this.oldClearAlpha),t.autoClear=a},getSeperableBlurMaterial:function(t){return new THREE.ShaderMaterial({defines:{KERNEL_RADIUS:t,SIGMA:t},uniforms:{colorTexture:{value:null},texSize:{value:new THREE.Vector2(.5,.5)},direction:{value:new THREE.Vector2(.5,.5)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D colorTexture;\n\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec2 direction;\t\t\t\t\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\t\t\t\t}\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tfloat fSigma = float(SIGMA);\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, fSigma);\t\t\t\t\tvec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;\t\t\t\t\tfor( int i = 1; i < KERNEL_RADIUS; i ++ ) {\t\t\t\t\t\tfloat x = float(i);\t\t\t\t\t\tfloat w = gaussianPdf(x, fSigma);\t\t\t\t\t\tvec2 uvOffset = direction * invSize * x;\t\t\t\t\t\tvec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;\t\t\t\t\t\tvec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;\t\t\t\t\t\tdiffuseSum += (sample1 + sample2) * w;\t\t\t\t\t\tweightSum += 2.0 * w;\t\t\t\t\t}\t\t\t\t\tgl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n\t\t\t\t}"})},getCompositeMaterial:function(t){return new THREE.ShaderMaterial({defines:{NUM_MIPS:t},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},dirtTexture:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D blurTexture1;\t\t\t\tuniform sampler2D blurTexture2;\t\t\t\tuniform sampler2D blurTexture3;\t\t\t\tuniform sampler2D blurTexture4;\t\t\t\tuniform sampler2D blurTexture5;\t\t\t\tuniform sampler2D dirtTexture;\t\t\t\tuniform float bloomStrength;\t\t\t\tuniform float bloomRadius;\t\t\t\tuniform float bloomFactors[NUM_MIPS];\t\t\t\tuniform vec3 bloomTintColors[NUM_MIPS];\t\t\t\t\t\t\t\tfloat lerpBloomFactor(const in float factor) { \t\t\t\t\tfloat mirrorFactor = 1.2 - factor;\t\t\t\t\treturn mix(factor, mirrorFactor, bloomRadius);\t\t\t\t}\t\t\t\t\t\t\t\tvoid main() {\t\t\t\t\tgl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );\t\t\t\t}"})}}),THREE.UnrealBloomPass.BlurDirectionX=new THREE.Vector2(1,0),THREE.UnrealBloomPass.BlurDirectionY=new THREE.Vector2(0,1)},function(t,e){THREE.PosterShader={uniforms:{tDiffuse:{value:null}},vertexShader:"\n    varying vec2 vUv;\n\n    void main() {\n      vUv = uv;\n      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n    }\n  ",fragmentShader:"\n    #define PI 3.14159\n    #define UV_SCALE 0.02\n    #define MAX_HEIGHT 0.5\n    varying vec2 vUv;\n    uniform sampler2D tDiffuse;\n\n    float posterise(float val, float amount) {\n      return floor(val * amount) / amount;\n    }\n\n    float posteriseCeil(float val, float amount) {\n      return ceil(val * amount) / amount;\n    }\n\n    void main() {\n      vec4 frag = texture2D(tDiffuse, vUv);\n      frag.r = posterise(frag.r, 16.0);\n      gl_FragColor = frag;\n    }\n  "},THREE.PosterPass=function(t){THREE.Pass.call(this),this.size=t,this.shader=THREE.PosterShader,this.material=new THREE.ShaderMaterial(this.shader),this.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),this.scene=new THREE.Scene,this.quad=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),this.material),this.quad.frustumCulled=!1,this.scene.add(this.quad),this.time=0},THREE.PosterPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.PosterPass,render:function(t,e,i,s,r){this.shader.uniforms.tDiffuse.value=i.texture,this.renderToScreen?t.render(this.scene,this.camera):t.render(this.scene,this.camera,e,this.clear)}})},function(t,e,i){"use strict";i.r(e);var s=class{constructor(t){this.root=t,this.position=t.player.position,this.rotation=t.player.rotation,this.height=t.player.height,this.target=new THREE.Vector3,this.fov=65,this.aspectRatio=this.root.width/this.root.height,this.offset=.1,this.camera=new THREE.PerspectiveCamera(this.fov,this.aspectRatio,.1,2e6),this.camera.up=new THREE.Vector3(0,1,0),this.camera.rotation.order="YXZ"}addListener(){this.listener=new THREE.AudioListener,this.camera.add(this.listener)}resize(t,e){this.aspectRatio=this.root.width/this.root.height,this.camera.aspect=this.aspectRatio,this.camera.updateProjectionMatrix()}update(t){this.offset,this.offset,Math.abs(Math.sin(this.rotation.y)),this.offset,this.position.y,this.height,this.camera.position.set(this.position.x,this.position.y+this.height,this.position.z),this.camera.rotation.y=this.rotation.x+Math.PI,this.camera.rotation.x=this.rotation.y}};const r=(t,e,i)=>(e-t)*i+t,a=function(t,e){return Math.atan2(Math.sin(e-t),Math.cos(e-t))},o=(Math.PI,(t,e,i)=>Math.min(i,Math.max(e,t)));var n=class{constructor(t){this.root=t,this.isDev=-1!=window.location.host.indexOf("localhost"),this.position=new THREE.Vector3(-24,1,16),this.rotation=new THREE.Vector2(.55*Math.PI,-.05*Math.PI),this.isDev,this.motion=new THREE.Vector3,this.target={position:this.position.clone(),rotation:this.rotation.clone(),motion:this.motion.clone()},this.collider=new Collider.Collider(this.target.position,this.motion),this.collider.setPhysics({gravity:20}),this.automove={active:{position:!0,rotation:!0},speed:{current:0,max:7.5,blend:.125},rotationSpeed:{current:0,max:Math.PI/2.5,accum:Math.PI/70},position:this.position.clone(),rotation:this.isDev?this.rotation.clone():new THREE.Vector2(.55*Math.PI,.03*Math.PI),threshold:{position:{outer:2,inner:.02},rotation:Math.PI/1e3}},this.speed=6,this.rotationSpeed=.5*Math.PI,this.jump=8,this.jumpSpeedMultiplier=.25,this.height=3,this.falling=!1,this.fallTime=0,this.fallTimeThreshold=.2,this.noclip=!1,this.noclipSpeed=36,this.toggleNoclip=()=>{this.noclip=0==this.noclip},this.minPitch=-.125*Math.PI,this.maxPitch=.125*Math.PI,this.adjust={slow:.05,normal:.1,fast:.125,maximum:.3},this.keys={disabled:!0},this.group=new THREE.Group,this.light=new THREE.PointLight(16777215,.75,12,2),this.light.position.y=this.height+.25,this.group.add(this.light),this.root.scene.add(this.group)}resetPosition(){this.position.set(-24,1,16),this.rotation.set(.55*Math.PI,-.05*Math.PI),this.target.position.copy(this.position),this.target.rotation.copy(this.rotation),this.automove.active.position=!0,this.automove.active.rotation=!0,this.automove.position.copy(this.position),this.automove.rotation.set(.55*Math.PI,.03*Math.PI)}move(t){if(this.keys.left||this.keys.right){this.automove.active.rotation&&(this.target.rotation.copy(this.rotation),this.automove.active.rotation=!1);const e=(this.keys.left?1:0)+(this.keys.right?-1:0);this.target.rotation.x+=e*this.rotationSpeed*t}if(this.keys.up||this.keys.down){this.automove.active.position&&(this.automove.active.position=!1,this.target.position.copy(this.position));const t=this.noclip?this.noclipSpeed*(1-Math.abs(Math.sin(this.target.rotation.y))):this.speed,e=(this.keys.up?1:0)+(this.keys.down?-1:0);this.target.motion.x=Math.sin(this.rotation.x)*t*e,this.target.motion.z=Math.cos(this.rotation.x)*t*e}else this.target.motion.x=0,this.target.motion.z=0;if(this.keys.jump&&(0==this.motion.y||this.fallTime<this.fallTimeThreshold)&&(this.motion.y=this.jump,this.fallTime=this.fallTimeThreshold),this.falling=0!=this.motion.y,this.fallTime=this.falling?this.fallTime+t:0,this.noclip){if(this.falling=!1,this.keys.up||this.keys.down){const t=(this.keys.up?1:0)+(this.keys.down?-1:0);this.target.motion.y=Math.sin(this.target.rotation.y)*t*this.noclipSpeed}else this.target.motion.y=0;this.motion.y=this.target.motion.y}this.falling?(this.motion.x=r(this.motion.x,this.target.motion.x,this.jumpSpeedMultiplier),this.motion.z=r(this.motion.z,this.target.motion.z,this.jumpSpeedMultiplier)):(this.motion.x=this.target.motion.x,this.motion.z=this.target.motion.z)}moveToArtwork(t){this.position.distanceTo(t.viewPosition)>this.automove.threshold.position.outer&&(this.automove.position.copy(t.viewPosition),this.automove.active.position=!0,this.automove.rotation.copy(t.viewRotation),this.automove.active.rotation=!0)}applyAutomove(t){if(this.automove.active.position){const e=this.automove.position.clone();e.sub(this.position);const i=e.length();if(e.normalize(),i>this.automove.threshold.position.outer)this.automove.speed.current+=(this.automove.speed.max-this.automove.speed.current)*this.automove.speed.blend,e.multiplyScalar(this.automove.speed.current*t),this.position.add(e);else if(i>this.automove.threshold.position.inner){const s=this.automove.speed.max*(i/this.automove.threshold.position.outer);this.automove.speed.current+=(s-this.automove.speed.current)*this.automove.speed.blend,e.multiplyScalar(this.automove.speed.current*t),this.position.add(e)}else this.target.position.copy(this.automove.position),this.automove.active.position=!1,this.keys.disabled=!1}else this.automove.speed.current=0;if(this.automove.active.rotation){this.automove.rotationSpeed.current=Math.min(this.automove.rotationSpeed.current+this.automove.rotationSpeed.accum,this.automove.rotationSpeed.max);const e=a(this.rotation.x,this.automove.rotation.x),i=a(this.rotation.y,this.automove.rotation.y),s=Math.hypot(e,i);this.rotation.x+=e*this.automove.rotationSpeed.current*t,this.rotation.y+=i*this.automove.rotationSpeed.current*t,s<this.automove.threshold.rotation&&(this.automove.active.rotation=!1,this.target.rotation.copy(this.automove.rotation))}else this.automove.rotationSpeed.current=0}setRotation(t,e){this.target.rotation.y=t,this.target.rotation.x=e,this.automove.active.rotation=!1}getTargetPosition(){return this.target.position}update(t){this.applyAutomove(t),this.keys.disabled||this.automove.active.position||(this.move(t),this.noclip?(this.target.position.x+=this.motion.x*t,this.target.position.y+=this.motion.y*t,this.target.position.z+=this.motion.z*t):this.collider.move(t,this.root.colliderSystem),this.position.x=r(this.position.x,this.target.position.x,this.adjust.maximum),this.position.y=r(this.position.y,this.target.position.y,this.adjust.maximum),this.position.z=r(this.position.z,this.target.position.z,this.adjust.maximum)),this.automove.active.rotation||(this.rotation.x+=a(this.rotation.x,this.target.rotation.x)*this.adjust.normal,this.rotation.y=r(this.rotation.y,this.target.rotation.y,this.adjust.normal)),this.group.position.set(this.position.x,this.position.y,this.position.z)}};i(0);var h=class{constructor(t){this.scene=t.scene,this.sky=new THREE.Sky,this.sky.scale.setScalar(45e4);const e=Math.PI*(.4875-.5),i=2*Math.PI*-.25,s=new THREE.Vector3(4e5*Math.cos(i),4e5*Math.sin(i)*Math.sin(e),4e5*Math.sin(i)*Math.cos(e));this.sky.material.uniforms.sunPosition.value.copy(s),this.scene.add(this.sky),this.lights={point:{},ambient:{},directional:{},hemisphere:{},spot:{}},this.lights.point.a=new THREE.PointLight(16777215,1,24,2),this.lights.point.b=new THREE.PointLight(16777215,1,32,2),this.lights.point.c=new THREE.PointLight(16777215,1,20,2),this.lights.ambient.a=new THREE.AmbientLight(16777215,.3),this.lights.directional.a=new THREE.DirectionalLight(16777215,.5),this.lights.hemisphere.a=new THREE.HemisphereLight(0,255,.25),this.lights.spot.a=new THREE.SpotLight(16777215,1,32,Math.PI/3,.25),this.reloadExhibition()}reloadExhibition(){this.lights.point.a.position.set(-8,10,14),this.lights.point.b.position.set(0,10,-4),this.lights.point.c.position.set(26,10,6),this.lights.directional.a.position.set(-1,1.5,-1),this.lights.spot.a.position.set(0,10,14),this.lights.spot.a.target.position.set(-4,0,6),this.lights.point.a.distance=24,this.lights.hemisphere.a.intensity=.25,this.lights.ambient.a.intensity=.3,this.lights.spot.a.intensity=1,this.lights.spot.a.distance=32,this.lights.spot.a.angle=Math.PI/3,this.lights.spot.a.penumbra=.25,Object.keys(this.lights).forEach(t=>{Object.keys(this.lights[t]).forEach(e=>{const i=this.lights[t][e];this.scene.add(i),i.isSpotLight&&this.scene.add(i.target)})}),this.scene.fog=new THREE.FogExp2(0,0);const t=document.querySelector(".active-exhibition-data .custom-exhibition-installation");if(t)switch(t.dataset.value){case"TIYAN":this.scene.remove(this.lights.directional.a),this.scene.remove(this.lights.point.b),this.lights.ambient.a.intensity=.1,this.lights.point.b.position.set(6,10,14),this.lights.point.a.position.set(2,9,18),this.lights.point.a.distance=26,this.lights.point.c.position.set(-22,8,18),this.lights.hemisphere.a.intensity=.01;break;case"DOUGLAS":this.scene.fog=new THREE.FogExp2(4478242,.02);break;case"BRENTON":this.lights.spot.a.position.set(-26,10,1),this.lights.spot.a.target.position.set(-22,0,1),this.lights.spot.a.angle=Math.PI/6,this.lights.spot.a.penumbra=.1;break;case"JACK_DE_LACY":default:this.scene.remove(this.lights.spot.a),this.scene.remove(this.lights.spot.a.target)}}};var l=class{constructor(t){this.path=`${APP_ROOT}/${t}/`,this.mat={},this.mat.default=new THREE.MeshPhysicalMaterial({emissive:0,roughness:1,envMapIntensity:.25}),this.mat.porcelain=new THREE.MeshPhysicalMaterial({color:16777215,emissive:8947848,emissiveIntensity:.6,roughness:.55,metalness:.125,envMapIntensity:.5}),this.mat.metal=new THREE.MeshPhysicalMaterial({color:11046521,emissive:0,roughness:.25,metalness:1,envMapIntensity:.5}),this.mat.neon=new THREE.MeshPhysicalMaterial({emissive:16777215,emissiveIntensity:1}),this.mat.dark=new THREE.MeshPhysicalMaterial({color:0,roughness:.5,metalness:0});const e=["posx","negx","posy","negy","posz","negz"].map(t=>`${this.path}envmap/${t}.jpg`);this.envMap=(new THREE.CubeTextureLoader).load(e),this.normalMap=(new THREE.TextureLoader).load(this.path+"textures/noise.jpg"),this.normalMap.wrapS=this.normalMap.wrapT=THREE.RepeatWrapping,this.normalMap.repeat.set(32,32),Object.keys(this.mat).forEach(t=>{this.mat[t].type&&"MeshPhysicalMaterial"===this.mat[t].type&&(this.mat[t].envMap=this.envMap)}),this.uniforms={time:{value:0}},this.loaded={}}getTexture(t){return(new THREE.TextureLoader).load(this.path+t)}conformGroup(t){"Mesh"===t.type?this.conformMaterial(t.material):t.children&&t.children.length&&t.children.forEach(t=>{this.conformGroup(t)})}conformMaterial(t){switch(this.loaded[t.name]||(this.loaded[t.name]=t),t.envMap=this.envMap,t.envMapIntensity=.5,t.name){case"concrete":t.normalScale.x=.25,t.normalScale.y=.25;break;case"gold":break;case"neon":case"neon1":case"neon2":t.emissive=new THREE.Color(1,1,1),t.emissiveIntensity=1;break;case"nu_metal":t.normalScale.x=.25,t.normalScale.y=.25;break;case"plastic":break;case"tree_trunk_1":t.vertexColors=THREE.NoColors;break;case"tree_leaves_1":t.vertexColors=THREE.NoColors,console.log(t);break;case"pollen_1":t.side=THREE.DoubleSide,t.depthWrite=!1}}getCustomMaterial(t){const e=t.clone();return e.onBeforeCompile=t=>{t.vertexShader=`uniform float time;\n${t.vertexShader}`,t.vertexShader=t.vertexShader.replace("#include <begin_vertex>","\n        vec4 mvp = modelMatrix * vec4(position, 1.0);\n        float theta = sin(time * 0.1 + mvp.x / 2.0);\n        float c = cos(theta);\n        float s = sin(theta);\n        float off = 1.0 * sin(time + position.x * 200.0);\n        mat3 roty = mat3(c, 0, s, 0, 1, 0, -s, 0, c);\n        //mat4 m = mat4(1, 0, 0, 0, 0, 1, 0, s * off * 2.0, 0, 0, 1, s * off, 0, 0, 0, 1);\n        vec3 p = position;\n        vec4 t = vec4(p.x + 0.25 * sin(time + p.y), p.y, p.z + 0.25 * cos(time + p.y), 1.0);\n        vec3 transformed = vec3(t.x, t.y, t.z);\n        vNormal = vNormal * roty;\n      "),t.uniforms.time=this.uniforms.time},e}update(t){this.uniforms.time.value+=t}};i(1),i(2),i(3);var c=class{constructor(t){this.path=`${APP_ROOT}/${t}/`,this.materials={},this.images={},this.loaderFBX=new THREE.FBXLoader,this.loaderOBJ=new THREE.OBJLoader}loadFBX(t){return new Promise((e,i)=>{try{this.loaderFBX.load(this.path+t+".fbx",t=>{e(t)})}catch(t){console.log(t),i(t)}})}loadOBJ(t){return new Promise((e,i)=>{try{this.loaderOBJ.load(this.path+t+".obj",t=>{e(t)})}catch(t){console.log(t),i(t)}})}};var u=class{constructor(t){this.root=t,this.scene=t.scene,this.colliderSystem=t.colliderSystem,this.materials=new l("assets"),this.loader=new c("assets"),this.loadScene(),this.reloadInstallation()}loadScene(){this.floor=new THREE.Mesh(new THREE.BoxBufferGeometry(100,1,100),new THREE.MeshPhongMaterial({})),this.floor.position.y=-.25,this.colliderSystem.add(this.floor),this.toLoad=2,this.checkLoaded=()=>{if(this.toLoad-=1,0==this.toLoad){const t=document.querySelector("#open-gallery");t.classList.remove("is-loading"),t.classList.add("flash"),t.innerHTML='<span class="mobile-show">&larr;&nbsp;Open Gallery</span><span class="mobile-hide">Open Gallery</span>'}},this.loader.loadFBX("map").then(t=>{this.scene.add(t),this.materials.conformGroup(t),this.checkLoaded()},t=>{console.log(t)}),this.loader.loadOBJ("collision").then(t=>{this.defaultCollisionMap=t,this.addCollisionMap(t),this.checkLoaded()},t=>{console.log(t)}),this.loader.loadFBX("props").then(t=>{this.scene.add(t),this.materials.conformGroup(t)});for(var t=-16;t<=16;t+=8){const e=19,i=new THREE.Mesh(new THREE.BoxBufferGeometry(.1,.1,4),this.materials.mat.neon),s=new THREE.Mesh(new THREE.BoxBufferGeometry(.1,.4,4),this.materials.mat.dark),r=new THREE.Mesh(new THREE.BoxBufferGeometry(.1,1,.1),this.materials.mat.dark),a=r.clone();i.position.set(t,e,6),s.position.set(t,e+.25,6),r.position.set(t,e+.45+.5,6+4/3),a.position.set(t,e+.45+.5,6-4/3),r.rotation.y=Math.PI/4,a.rotation.y=Math.PI/4,this.scene.add(i,s,r,a)}}reloadInstallation(){this.installation&&this.installation.length&&(this.installation.forEach(t=>{t.object&&this.scene.remove(t.object)}),this.root.colliderSystem=new Collider.System,this.colliderSystem=this.root.colliderSystem,this.addCollisionMap(this.defaultCollisionMap)),this.customExhibitionActive=!1,this.updateCustomExhibition=!1,this.installation=[];const t=document.querySelector(".active-exhibition-data .custom-exhibition-installation");if(t)switch(t.dataset.value){case"JACK_DE_LACY":this.installation=[{src:"jack_de_lacy/sculpture_1",scale:.6,rot:Math.PI/32,orientZ:Math.PI/4},{src:"jack_de_lacy/sculpture_2",scale:.5,rot:-Math.PI/32,orientZ:0},{src:"jack_de_lacy/sculpture_3",scale:.5,rot:Math.PI/32,orientZ:0}];for(var e=0;e<this.installation.length;++e){const t=e;this.loader.loadFBX(this.installation[t].src).then(e=>{const i=this.installation[t];e.children.forEach(e=>{this.materials.conformMaterial(e.material),e.material=this.materials.getCustomMaterial(e.material),2==t&&(e.material.side=THREE.DoubleSide),e.material.envMapIntensity=.25}),e.scale.multiplyScalar(i.scale),e.rotation.z=i.orientZ,e.position.set(12*t-12,14,6),this.scene.add(e),i.object=e,i.active=!0},t=>{console.log(t)})}this.customExhibitionActive=!0,this.updateCustomExhibition=t=>{this.installation.forEach(e=>{e.active&&(e.object.rotation.y+=e.rot*t)})};break;case"TIYAN":this.installation=[{src:"tiyan/separators"}],this.installation.forEach(t=>{this.loader.loadFBX(t.src).then(e=>{this.materials.conformGroup(e),this.scene.add(e),t.object=e})});const i=new THREE.Mesh(new THREE.BoxBufferGeometry(14,4,1.5),new THREE.MeshStandardMaterial({})),s=new THREE.Mesh(new THREE.BoxBufferGeometry(1.5,4,16),new THREE.MeshStandardMaterial({}));i.position.set(-23,1,6),s.position.set(17.25,1,15.5),this.colliderSystem.add(i),this.colliderSystem.add(s),this.customExhibitionActive=!0;break;case"DOUGLAS":this.installation=[{src:"douglas/tree"},{src:"douglas/leaves"},{src:"douglas/pollen"}],this.installation.forEach(t=>{this.loader.loadFBX(t.src).then(e=>{this.materials.conformGroup(e),this.scene.add(e),t.object=e})});break;case"BRENTON":this.installation=["crash7/crash_7","crash8/crash_8","crash9/crash_9","crash11/crash_11","crash12/crash_12","crash13/crash_13","new_crashform/new_crashform"].map(t=>({src:`brenton/${t}`}));const r=t=>{const e=new THREE.MeshPhysicalMaterial({});e.map=t.material.map?t.material.map:null,e.map||(e.color=t.material.color,e.emissive=t.material.color,e.emissiveIntensity=.1),e.envMap=this.materials.envMap,e.envMapIntensity=.5,e.normalMap=t.material.normalMap?t.material.normalMap:null,e.metalness=t.material.metalness?t.material.metalness:.75,e.roughness=t.material.roughness?t.material.roughness:.5,e.side=THREE.DoubleSide,t.material.transparent&&(e.transparent=!0,e.opacity=t.material.opacity),e.map&&(e.map.wrapS=e.map.wrapT=THREE.ClampToEdgeWrapping,e.map.minFilter=THREE.LinearFilter),e.normalMap&&(e.normalMap.wrapS=e.normalMap.wrapT=THREE.ClampToEdgeWrapping,e.normalMap.minFilter=THREE.LinearFilter),t.material=e,t.customPos={},t.customPos.x={max:t.position.x+.25,min:t.position.x-.25},t.customPos.y={max:t.position.y+.25,min:t.position.y-.25},t.customPos.z={max:t.position.z+.25,min:t.position.z-.25};const i=new THREE.Box3;i.setFromObject(t);const s=i.getSize(),r=s.x>4||s.y>4||s.z>4;t.animType=Math.random()>.3||r?"jitter":"rotate",t.rotationAxis=Math.random()>.5?"y":"x",t.name&&-1!=t.name.indexOf("spin")&&(t.animType="rotate",t.rotationAxis="y")};this.installation.forEach(t=>{this.loader.loadFBX(t.src).then(e=>{this.materials.conformGroup(e),this.scene.add(e),t.object=e,t.children=[],t.sparks=[],t.smokeMat=new THREE.MeshPhongMaterial({transparent:!0,side:THREE.DoubleSide,opacity:.25});const i=this.materials.getTexture("brenton/smoke.png");t.smokeMat.map=i,-1!=t.src.indexOf("12")&&(t.isLong=!0,t.radius=40);let s=0,a=new THREE.Vector3;e.children.forEach(e=>{"Mesh"==e.type?(r(e),t.children.push(e),a.add(e.position),s+=1):"Group"==e.type&&e.children.forEach(e=>{"Mesh"==e.type&&(r(e),t.children.push(e))})}),0!=s&&a.divideScalar(s),t.position=a})}),this.customExhibitionActive=!0,this.updateCustomExhibition=t=>{for(var e=0;e<this.installation.length;e++)if(this.installation[e].children){const r=this.installation[e],a=3,n=r.radius?r.radius:25,h=this.root.player.position.distanceTo(r.position),l=h<a?1:Math.max(0,1-(h-a)/(n-a)),c=.0125;if(r.children.forEach(t=>{"jitter"==t.animType?(t.position.x=o(t.position.x+l*(2*Math.random()-1)*c,t.customPos.x.min,t.customPos.x.max),t.position.y=o(t.position.y+l*(2*Math.random()-1)*c,t.customPos.y.min,t.customPos.y.max),t.position.z=o(t.position.z+l*(2*Math.random()-1)*c,t.customPos.z.min,t.customPos.z.max)):"rotate"==t.animType&&(t.rotation[t.rotationAxis]+=(2*Math.random()-1)*c*l)}),r.sparks.length<25&&Math.random()<2*l){const t={};if(Math.random()>.45){t.object=new THREE.Mesh(new THREE.BoxBufferGeometry(.02,.02,.04+.5*Math.random()),new THREE.MeshBasicMaterial({color:16777215})),t.object.position.copy(r.position),t.object.position.x+=r.isLong?20*Math.random()-10:4*Math.random()-2,t.object.position.y+=3*Math.random()-1.5,t.object.position.z+=4*Math.random()-2,t.vec=new THREE.Vector3(2*Math.random()-1,2*Math.random()-1,2*Math.random()-1),t.vec.normalize(),t.vec.multiplyScalar(5+15*Math.random());var i=new THREE.Vector3;i.addVectors(t.object.position,t.vec),t.object.lookAt(i),t.age=0,t.maxAge=.125+.25*Math.random()}else t.object=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),r.smokeMat),t.object.position.copy(r.position),t.object.position.x+=r.isLong?6*Math.random()-3:1*Math.random()-.5,t.object.position.y+=1*Math.random()-.5+2,t.object.position.z+=1*Math.random()-.5,t.vec=new THREE.Vector3(2*Math.random()-1,2*Math.random()-1,2*Math.random()-1),t.vec.normalize(),t.vec.multiplyScalar(2+4*Math.random()),t.object.rotation.set(Math.random(),Math.random(),Math.random()),t.age=0,t.maxAge=.25+.5*Math.random();this.scene.add(t.object),r.sparks.push(t)}for(var s=r.sparks.length-1;s>-1;s--){const e=r.sparks[s];e.object.position.x+=e.vec.x*t,e.object.position.y+=e.vec.y*t,e.object.position.z+=e.vec.z*t,e.age+=t,e.age>e.maxAge&&(this.scene.remove(e.object),r.sparks.splice(s,1))}}}}}addCollisionMap(t){"Mesh"===t.type?this.colliderSystem.add(t):t.children&&t.children.length&&t.children.forEach(t=>{this.addCollisionMap(t)})}loadExperimental(){this.treeParse=t=>{"Mesh"==t.type?t.material.transparent&&(console.log(t.material),t.material.color.set(16777215),t.material.side=THREE.DoubleSide,t.material.flatShading=!0):t.children&&t.children.forEach(t=>{this.treeParse(t)})},this.loader.loadFBX("tree/tree2").then(t=>{console.log(t),this.treeParse(t),this.scene.add(t)})}update(t){this.materials.update(t),this.customExhibitionActive&&this.updateCustomExhibition&&this.updateCustomExhibition(t)}};var p=class{constructor(){this.element=document.querySelector("#canvas-target"),this.width=window.innerWidth,this.height=window.innerHeight,this.scene=new THREE.Scene,this.colliderSystem=new Collider.System,this.player=new n(this),this.camera=new s(this),this.lighting=new h(this),this.map=new u(this)}resize(){const t=this.element.getBoundingClientRect();this.width=t.width,this.height=t.height,this.camera.resize()}reloadExhibition(){this.map.reloadInstallation(),this.lighting.reloadExhibition(),this.player.resetPosition()}update(t){this.player.update(t),this.camera.update(t),this.map.update(t)}};i(4),i(5),i(6),i(7),i(8),i(9),i(10);var d=class{constructor(t,e){this.root=e,this.scene=e.scene,this.camera=e.camera.camera,this.renderer=new THREE.WebGLRenderer({}),this.renderer.setClearColor(4473924,1),this.renderer.gammaInput=!0,this.renderer.gammaOutput=!0,this.renderer.gammaFactor=2.25,this.padding={x:64,y:96,minX:768,minY:700},this.setSize(),this.passRender=new THREE.RenderPass(this.scene,this.camera),this.passPoster=new THREE.PosterPass(this.size),this.passBloom=new THREE.UnrealBloomPass(this.size,.5,.125,.96),this.passBloom.renderToScreen=!0,this.composer=new THREE.EffectComposer(this.renderer),this.composer.addPass(this.passRender),this.composer.addPass(this.passPoster),this.composer.addPass(this.passBloom),this.domElement=document.querySelector("#canvas-target"),this.domElement.appendChild(this.renderer.domElement),this.resize(),e.resize()}setSize(){const t=Math.min(window.innerWidth,Math.max(this.padding.minX,window.innerWidth-2*this.padding.x)),e=Math.min(window.innerHeight,Math.max(this.padding.minY,window.innerHeight-2*this.padding.y));this.width=t,this.height=e,this.size?(this.size.x=this.width,this.size.y=this.height):this.size=new THREE.Vector2(this.width,this.height)}resize(){this.setSize(),this.domElement.style.width=`${this.width}px`,this.domElement.style.height=`${this.height}px`,this.renderer.setSize(this.width,this.height),this.composer.setSize(this.width,this.height),this.passBloom.setSize(this.width,this.height)}draw(t){this.composer.render(t)}};var m=class{constructor(t,e,i){this.root=t,this.cvs=document.createElement("canvas"),this.ctx=this.cvs.getContext("2d"),this.domElement=e,this.canvasTarget=i,this.resize(),this.domElement.appendChild(this.cvs),this.prompt={},this.prompt.touchMove={alpha:{current:0,min:0,max:1},size:{current:12,min:12,max:24}},this.prompt.click={alpha:{current:0,min:0,max:1}}}clear(){this.ctx.clearRect(0,0,this.cvs.width,this.cvs.height),this.ctx.font="15px Karla",this.ctx.strokeStyle="#fff",this.ctx.fillStyle="#fff",this.ctx.lineWidth=1.5,this.ctx.lineCap="round"}resize(){this.cvs.width=this.canvasTarget.width,this.cvs.height=this.canvasTarget.height}promptClick(t,e,i,s){this.prompt.click.alpha.current+=e?.2*(this.prompt.click.alpha.max-this.prompt.click.alpha.current):.2*(this.prompt.click.alpha.min-this.prompt.click.alpha.current),this.prompt.click.alpha.current>0&&(this.ctx.globalAlpha=this.prompt.click.alpha.current,this.ctx.fillText(t,i+12,s+12))}promptTouchMove(t){if(t?(this.prompt.touchMove.alpha.current+=.2*(this.prompt.touchMove.alpha.max-this.prompt.touchMove.alpha.current),this.prompt.touchMove.size.current+=.2*(this.prompt.touchMove.size.max-this.prompt.touchMove.size.current)):(this.prompt.touchMove.alpha.current+=.2*(this.prompt.touchMove.alpha.min-this.prompt.touchMove.alpha.current),this.prompt.touchMove.size.current+=.2*(this.prompt.touchMove.size.min-this.prompt.touchMove.size.current)),this.prompt.touchMove.alpha.current>0){const t=this.prompt.touchMove.size.current,e=this.cvs.width/2,i=this.cvs.height/2;this.ctx.globalAlpha=this.prompt.touchMove.alpha.current,this.ctx.beginPath(),this.ctx.arc(e,i,t,0,2*Math.PI,!1),this.ctx.moveTo(e-t,i),this.ctx.lineTo(e+t,i),this.ctx.moveTo(e,i-4),this.ctx.lineTo(e,i+4),this.ctx.stroke()}}promptGodMode(){this.ctx.globalAlpha=1,this.ctx.fillText("You can fly",20,this.cvs.height-40);const t=Math.round(10*this.root.player.position.x)/10,e=Math.round(10*this.root.player.position.y)/10,i=Math.round(10*this.root.player.position.z)/10,s=Math.round(100*this.root.player.rotation.x)/100;this.ctx.fillText(`${t}, ${e}, ${i}, ${s}`,20,this.cvs.height-20)}drawDevOverlay(){}getContext(){return this.ctx}};var v=class{constructor(t,e,i,s){this.onscreen=!0,this.position=t,this.rotation=e,this.clipping=i||null,this.coords=new THREE.Vector2,this.helper=new THREE.Vector3,this.root=s,this.active=!0,this.hover=!1,this.cornersOK=!1,this.clickable=!1,this.buttonActive=!1,this.buttonRadius=50,this.buttonPosition=new THREE.Vector2,this.buttonPosition.isClamped=!1,this.buttonHover=!1,this.textColour=Math.abs(t.x)<=16&&(t.z>10||t.z<0)?"#000":"#fff",this.radius={min:this.root.isMobile?10:9,max:32},this.corners={world:{a:new THREE.Vector3,b:new THREE.Vector3,c:new THREE.Vector3,d:new THREE.Vector3},screen:{a:new THREE.Vector2,b:new THREE.Vector2,c:new THREE.Vector2,d:new THREE.Vector2}},this.distance=-1,this.resize()}setCorners(){const t=this.root.position,e=this.root.direction,i=this.root.board.scale,s=e.x*this.root.thickness/2,r=e.z*this.root.thickness/2;this.corners.world.a.set(t.x-(0!=e.x?0:.5*i.x)+s,t.y+.5*i.y,t.z-(0!=e.z?0:.5*i.z)+r),this.corners.world.b.set(t.x+(0!=e.x?0:.5*i.x)+s,t.y+.5*i.y,t.z+(0!=e.z?0:.5*i.z)+r),this.corners.world.c.set(t.x+(0!=e.x?0:.5*i.x)+s,t.y-.5*i.y,t.z+(0!=e.z?0:.5*i.z)+r),this.corners.world.d.set(t.x-(0!=e.x?0:.5*i.x)+s,t.y-.5*i.y,t.z-(0!=e.z?0:.5*i.z)+r)}pointToScreen(t,e,i,s){const r=t.clone();r.project(e),s.x=(r.x+1)*i.x,s.y=(1-r.y)*i.y}updateCorners(t,e){this.pointToScreen(this.corners.world.a,t,e,this.corners.screen.a),this.pointToScreen(this.corners.world.b,t,e,this.corners.screen.b),this.pointToScreen(this.corners.world.c,t,e,this.corners.screen.c),this.pointToScreen(this.corners.world.d,t,e,this.corners.screen.d),this.cornersOK=this.corners.screen.a.y<this.corners.screen.c.y&&this.corners.screen.b.y<this.corners.screen.d.y&&Math.abs(this.corners.screen.a.x-this.corners.screen.b.x)<window.innerWidth&&!(this.corners.screen.a.x<0&&this.corners.screen.c.x<0)&&!(this.corners.screen.a.x>this.rect.width&&this.corners.screen.c.x>this.rect.width),this.buttonPosition.x=Math.max(this.corners.screen.c.x,this.corners.screen.d.x),this.buttonPosition.y=(this.buttonPosition.x==this.corners.screen.c.x?this.corners.screen.c.y:this.corners.screen.d.y)+18,this.buttonPosition.isClamped=(this.buttonPosition.x>this.rect.width||this.buttonPosition.y>this.rect.height)&&this.rect.width>Math.min(this.corners.screen.a.x,this.corners.screen.b.x)&&this.rect.width>Math.min(this.corners.screen.c.x,this.corners.screen.d.x),this.buttonPosition.isClamped&&(this.buttonPosition.x=this.rect.width-16,this.buttonPosition.y=this.rect.height-16)}disableInfoTag(){this.infoTagDisabled=!0}isCorrectQuadrant(t){return t.x<=-16||t.x>=16||this.position.x>=16||this.position.x<=-16||t.z>=6&&this.position.z>=6||t.z<=6&&this.position.z<=6}mouseOver(t,e,i){if(this.active&&this.onscreen&&this.cornersOK&&this.isCorrectQuadrant(i)){const i=Math.min(this.corners.screen.a.x,this.corners.screen.b.x,this.corners.screen.c.x,this.corners.screen.d.x)-10,s=Math.max(this.corners.screen.a.x,this.corners.screen.b.x,this.corners.screen.c.x,this.corners.screen.d.x)+10,r=Math.min(this.corners.screen.a.y,this.corners.screen.b.y)-10,a=Math.max(this.corners.screen.c.y,this.corners.screen.d.y)+10;this.buttonHover=this.buttonActive&&Math.hypot(this.buttonPosition.x-t,this.buttonPosition.y-e)<this.buttonRadius+10,this.hover=this.buttonHover||t>=i&&t<=s&&e>=r&&e<=a,this.buttonPosition.isClamped&&!this.hover&&(this.hover=this.buttonPosition.x>s&&t>=s-100&&e>=this.rect.height-100)}else this.hover=!1,this.buttonHover=!1;this.setClickable()}setClickable(){this.clickable=this.onscreen&&this.active&&this.hover&&this.cornersOK}isClickable(){return this.clickable}calculateNodePosition(t,e,i){this.helper.copy(t.position),this.helper.sub(this.position),this.helper.normalize(),this.helper.dot(e)<=0?(this.onscreen=!0,this.helper.copy(this.position),this.helper.project(t),this.coords.x=(this.helper.x+1)*i.x,this.coords.y=(1-this.helper.y)*i.y):this.onscreen=!1,this.clipping&&this.onscreen&&(this.helper.copy(t.position),this.helper.sub(this.position),this.helper.dot(this.clipping)<0&&(this.onscreen=!1))}update(t,e,i,s,r){this.calculateNodePosition(i,s,r),this.distance=e.position.distanceTo(this.position),this.active=this.distance<=this.radius.max,this.active&&(this.updateCorners(i,r),this.buttonActive=this.distance<=this.radius.min),this.setClickable()}draw(t){return!!this.clickable&&(t.globalAlpha=1,t.beginPath(),t.moveTo(this.corners.screen.a.x,this.corners.screen.a.y),t.lineTo(this.corners.screen.b.x,this.corners.screen.b.y),t.lineTo(this.corners.screen.c.x,this.corners.screen.c.y),t.lineTo(this.corners.screen.d.x,this.corners.screen.d.y),t.closePath(),t.stroke(),this.buttonActive&&(t.fillStyle=this.textColour,t.textAlign="right",t.globalAlpha=this.buttonHover&&!this.infoTagDisabled?.6:1,this.infoTagDisabled||t.fillText("[INFO]",this.buttonPosition.x,this.buttonPosition.y)),!0)}resize(){this.rect=document.querySelector("#canvas-target").getBoundingClientRect()}};var f=class{constructor(t,e,i,s,r){this.sceneRef=t,this.radius=17,this.refDistance=2,this.rolloff=1.4,this.active=!0,this.video=document.createElement("video"),this.video.src=e,this.video.muted="muted",this.video.loop=!0,this.video.load(),""!==i?(this.object3D=new THREE.Object3D,this.object3D.position.copy(s),this.sceneRef.add(this.object3D),this.cameraRef=r,this.audioSrc=i,this.audioRequired=!0):this.audioRequired=!1}initAudio(){this.cameraRef.listener||this.cameraRef.addListener(),this.audio=new THREE.PositionalAudio(this.cameraRef.listener),this.audioContext=this.audio.context,this.audioLoader=new THREE.AudioLoader,this.audioLoader.load(this.audioSrc,t=>{this.active&&(this.audio.setBuffer(t),this.audio.setRefDistance(this.refDistance),this.audio.setRolloffFactor(this.rolloff),this.audio.setDistanceModel("exponential"),this.audio.loop=!0,this.audio.setVolume(0),this.audio.play(),this.syncTracks(),this.fadeInRequired=!0)}),this.object3D.add(this.audio),this.audioRequired=!1}fadeInAudio(){if(this.active){const t=Math.min(1,this.audio.getVolume()+.01);1==t&&(this.fadeInRequired=!1),this.audio.setVolume(t)}}pauseVideo(){this.video.paused||this.video.pause()}resumeVideo(){this.video.paused&&(this.syncTracks(),this.video.play())}syncTracks(){if(this.audioContext){const t=this.audioContext.currentTime;this.video.currentTime=t>this.video.duration?t%this.video.duration:t}}update(t){this.audioRequired&&this.initAudio(),this.fadeInRequired&&this.fadeInAudio(),this.object3D.position.distanceTo(t)>this.radius?this.pauseVideo():this.resumeVideo()}destroy(){this.active=!1,this.object3D&&(this.sceneRef.remove(this.object3D),this.audio&&this.audio.isPlaying&&(this.object3D.remove(this.audio),this.audio.pause())),this.video&&this.video.pause()}getElement(){return this.video}};var g=class{constructor(t,e,i,s){this.root=t,this.id=e,this.isMobile=s,this.element=i,this.active=!1,this.position=new THREE.Vector3,this.direction=new THREE.Vector3,this.nearRadius=5,this.thickness=.2,this.artworkMenuActive=!0,this.data={url:i.dataset.url,title:i.dataset.title||"",subtitle:i.dataset.subtitle||"",desc:i.dataset.desc||"",link:i.dataset.link||"",width:parseFloat(i.dataset.width),offset:{horizontal:parseFloat(i.dataset.hoff),vertical:parseFloat(i.dataset.voff)},videoUrl:i.dataset.videofile||"",audioUrl:i.dataset.audiofile||"",index:i.dataset.location?parseInt(i.dataset.location)-1:-1}}init(t,e,i){this.sceneReference=t;const s=this.thickness/2+.01;this.board=new THREE.Mesh(new THREE.BoxBufferGeometry(1,1,1),new THREE.MeshStandardMaterial({color:0,roughness:.75,metalness:0})),this.plane=new THREE.Mesh(new THREE.PlaneBufferGeometry(1,1),new THREE.MeshStandardMaterial({roughness:1,metalness:.5})),this.baseY=e.y,e.x+=(0!=i.x?0:1)*this.data.offset.horizontal,e.y+=this.data.offset.vertical,e.z+=(0!=i.z?0:1)*this.data.offset.horizontal,this.plane.position.set(e.x+i.x*s,e.y,e.z+i.z*s),this.position.set(e.x,e.y,e.z),this.direction.set(i.x,i.y,i.z),this.node=new v(e,null,i,this);const r=this.isMobile?1.5:.9;let a;if(this.viewPosition=new THREE.Vector3,this.viewPosition.y=Math.min(7.8,this.baseY-3),this.viewPosition.x=e.x+i.x*Math.min((e.y-this.viewPosition.y)*r,8),this.viewPosition.z=e.z+i.z*Math.min((e.y-this.viewPosition.y)*r,8),e.x>20&&e.z<-10?this.viewPosition.set(28,4.4,-8):e.x<-20&&e.z<-10&&this.viewPosition.set(-28,4.4,-8),this.viewRotation=new THREE.Vector2,this.viewRotation.y=Math.atan2(e.y-(this.viewPosition.y+this.root.player.height)-.125,Math.hypot(e.x-this.viewPosition.x,e.z-this.viewPosition.z)),this.viewRotation.x=Math.atan2(e.x-this.viewPosition.x,e.z-this.viewPosition.z),this.board.scale.x=0!=i.x?this.thickness:1,this.board.scale.z=0!=i.z?this.thickness:1,this.board.position.set(e.x,e.y,e.z),""!==this.data.videoUrl){const t=new THREE.Vector3;t.copy(this.plane.position),t.x+=i.x/2,t.z+=i.z/2,this.videoElement=new f(this.sceneReference,this.data.videoUrl,this.data.audioUrl,t,this.root.root.scene.camera),a=new THREE.VideoTexture(this.videoElement.getElement());const e=this.data.width,s=.5625*e;this.plane.scale.x=e,this.plane.scale.y=s,this.board.scale.x=0!=i.x?this.thickness:e,this.board.scale.y=s,this.board.scale.z=0!=i.z?this.thickness:e,this.node.setCorners()}else a=(new THREE.TextureLoader).load(this.data.url,t=>{const e=this.data.width*(t.image.naturalHeight/t.image.naturalWidth);this.plane.scale.x=this.data.width,this.plane.scale.y=e,this.board.scale.x=0!=i.x?this.thickness:this.data.width,this.board.scale.y=e,this.board.scale.z=0!=i.z?this.thickness:this.data.width,this.node.setCorners()});this.plane.material.map=a,a.wrapS=a.wrapT=THREE.ClampToEdgeWrapping,a.minFilter=THREE.LinearFilter,1==i.z||(-1==i.z?this.plane.rotation.y=Math.PI:1==i.x?this.plane.rotation.y=.5*Math.PI:-1==i.x&&(this.plane.rotation.y=1.5*Math.PI)),t.add(this.plane),t.add(this.board)}mouseOver(t,e,i){this.node.mouseOver(t,e,i)}click(t,e,i){return this.node.mouseOver(t,e,i),!!this.node.isClickable()&&(this.root.moveToArtwork(this),this.isArtworkMenuMine()||this.root.closeArtworkMenu(),this.artworkMenuActive&&this.node.buttonActive&&this.node.buttonHover&&this.root.openArtworkMenu(this),!0)}disableArtworkMenu(){this.artworkMenuActive=!1,this.node.disableInfoTag()}isArtworkMenuMine(){const t=this.root.el.image.querySelector("img");return t?this.root.domElement.dataset.active==this.id&&t.src==this.data.url:this.root.domElement.dataset.active==this.id}update(t,e,i,s,r){this.node.update(t,e,i,s,r),this.videoElement&&this.videoElement.update(e.position)}draw(t){return this.node.draw(t)}destroy(){this.sceneReference.remove(this.plane),this.sceneReference.remove(this.board),this.videoElement&&this.videoElement.destroy()}removeHover(){this.node.hover=!1}forceHover(){this.node.hover=!0}getFloorPosition(){return this.floorPosition}isClickable(){return this.node.isClickable()}resize(){this.node.resize()}};var E={artworkPositions:[{x:-24,y:4,z:23,nx:0,nz:-1},{x:-10.5,y:3.5,z:23,nx:0,nz:-1},{x:-8,y:3.5,z:23,nx:0,nz:-1},{x:-5.5,y:3.5,z:23,nx:0,nz:-1},{x:5.5,y:3.5,z:23,nx:0,nz:-1},{x:8,y:3.5,z:23,nx:0,nz:-1},{x:10.5,y:3.5,z:23,nx:0,nz:-1},{x:24,y:4,z:23,nx:0,nz:-1},{x:-12,y:3.5,z:8,nx:0,nz:1},{x:-8,y:3.5,z:8,nx:0,nz:1},{x:-4,y:3.5,z:8,nx:0,nz:1},{x:4,y:3.5,z:8,nx:0,nz:1},{x:8,y:3.5,z:8,nx:0,nz:1},{x:12,y:3.5,z:8,nx:0,nz:1},{x:-31,y:4,z:14,nx:1,nz:0},{x:-29.5,y:4,z:6,nx:1,nz:0},{x:-31,y:4,z:-2,nx:1,nz:0},{x:32,y:4,z:14,nx:-1,nz:0},{x:30,y:4,z:6,nx:-1,nz:0},{x:32,y:4,z:-2,nx:-1,nz:0},{x:-12,y:3.5,z:4,nx:0,nz:-1},{x:-8,y:3.5,z:4,nx:0,nz:-1},{x:-4,y:3.5,z:4,nx:0,nz:-1},{x:4,y:3.5,z:4,nx:0,nz:-1},{x:8,y:3.5,z:4,nx:0,nz:-1},{x:12,y:3.5,z:4,nx:0,nz:-1},{x:-8,y:3.5,z:-11.5,nx:0,nz:1},{x:8,y:3.5,z:-11.5,nx:0,nz:1},{x:-24,y:11,z:-11,nx:0,nz:1},{x:-8,y:11,z:-11.5,nx:0,nz:1},{x:8,y:11,z:-11.5,nx:0,nz:1},{x:24,y:11,z:-11,nx:0,nz:1}]};var y=class{constructor(t,e){this.root=t,this.isMobile=e,this.player=this.root.scene.player,this.camera=this.root.scene.camera.camera,this.scene=this.root.scene.scene,this.centre=this.root.centre,this.cameraDirection=new THREE.Vector3,this.artworkActiveRadius=10,this.isDev=-1!=window.location.host.indexOf("localhost"),this.reloadExhibition(),this.domElement=document.querySelector("#artwork-target"),this.el={image:this.domElement.querySelector(".image"),title:this.domElement.querySelector(".title"),subtitle:this.domElement.querySelector(".subtitle"),desc:this.domElement.querySelector(".desc"),link:this.domElement.querySelector(".link"),close:this.domElement.querySelector(".close-artwork-menu")},this.el.close.addEventListener("click",()=>{this.closeArtworkMenu()})}reloadExhibition(){this.artworks&&this.artworks.forEach(t=>{try{t.destroy()}catch(t){console.log(t)}}),this.domTarget=".active-exhibition-data",this.artworks=[];var t=0;document.querySelectorAll(`${this.domTarget} .image`).forEach(e=>{this.artworks.push(new g(this,++t,e,this.isMobile))}),this.placeArtworks();const e=document.querySelector(".active-exhibition-data .custom-exhibition-installation");e&&e.dataset.value}placeArtworks(){const t=[];for(let e=this.artworks.length-1;e>=0;e--){const i=this.artworks[e];if("number"==typeof i.data.index&&i.data.index>=0&&i.data.index<E.artworkPositions.length){const e=E.artworkPositions[i.data.index];-1!=t.indexOf(i.data.index)?console.log("Warning: duplicate slot reference"):t.push(i.data.index),i.init(this.scene,new THREE.Vector3(e.x,e.y,e.z),new THREE.Vector3(e.nx,0,e.nz))}else console.log("Warning: no slot found."),console.log(this.artworks.splice(e,1))}}mouseOver(t,e){for(var i=[],s=0,r=this.artworks.length;s<r;++s)this.artworks[s].mouseOver(t,e,this.player.position),this.artworks[s].isClickable()&&i.push(this.artworks[s]);if(i.length>1){var a=100,o=i[0];for(s=0;s<i.length;++s){i[s].removeHover();const t=this.player.position.distanceTo(i[s].position);t<a&&(a=t,o=i[s])}o.forceHover()}i.length?this.root.domElement.classList.add("clickable"):this.root.domElement.classList.remove("clickable")}click(t,e){for(var i=0,s=this.artworks.length;i<s&&!this.artworks[i].click(t,e,this.player.position);++i);}openArtworkMenu(t){document.querySelector("#gallery-controls").classList.add("display-none"),document.querySelectorAll(".gallery-menu .menu.active").forEach(t=>{t.classList.remove("active"),t.querySelectorAll(".requires-activate").forEach(t=>{t.classList.remove("active")})});const e=document.querySelector("#nav-item-gallery");e.classList.contains("active")||(e.parentNode.querySelectorAll(".active").forEach(t=>{t.classList.remove("active")}),e.classList.add("active")),t.isArtworkMenuMine()||(this.domElement.dataset.active=t.id,this.el.image.innerHTML=`<img src="${t.data.url}"/>`,this.el.title.innerHTML=t.data.title,this.el.subtitle.innerHTML=t.data.subtitle,this.el.desc.innerHTML=t.data.desc,this.el.link.innerHTML=t.data.link?`<a href='${t.data.link}' target='_blank'>Link</a>`:""),this.domElement.classList.add("active")}closeArtworkMenu(){document.querySelector("#gallery-controls").classList.remove("display-none"),this.domElement.classList.remove("active")}moveToArtwork(t){this.player.moveToArtwork(t)}update(t){this.camera.getWorldDirection(this.cameraDirection);for(var e=0,i=this.artworks.length;e<i;++e)this.artworks[e].update(t,this.player,this.camera,this.cameraDirection,this.centre)}draw(t){for(var e=0,i=this.artworks.length;e<i&&!this.artworks[e].draw(t);++e);}resize(){this.artworks.forEach(t=>{t.resize()})}};var b=class{constructor(t,e,i,s,r){this.x=0,this.y=0,this.origin={x:0,y:0},this.delta={x:0,y:0},this.active=!1,this.domElement=t,r?(this.domElement.addEventListener("touchstart",e,!1),this.domElement.addEventListener("touchmove",i,!1),this.domElement.addEventListener("touchend",s,!1)):(this.domElement.addEventListener("mousedown",e,!1),this.domElement.addEventListener("mousemove",i,!1),this.domElement.addEventListener("mouseup",s,!1),this.domElement.addEventListener("mouseleave",s,!1)),this.domElement.addEventListener("click",t=>{i(t),s(t)},!1)}start(t){this.active=!0,this.origin.x=t.offsetX,this.origin.y=t.offsetY}move(t){this.x=t.offsetX,this.y=t.offsetY,this.delta.x=this.x-this.origin.x,this.delta.y=this.y-this.origin.y}stop(){this.active=!1}};var T=class{constructor(t){this.keys={},this.onEvent=t,document.addEventListener("keydown",t=>{this.onKeyDown(t)}),document.addEventListener("keyup",t=>{this.onKeyUp(t)})}onKeyDown(t){this.keys[t.key]=!0,this.onEvent(t.key)}onKeyUp(t){this.keys[t.key]=!1,this.onEvent(t.key)}release(t){this.keys[t]=!1}isSpecial(){return this.keys.Shift||this.keys.Control||this.keys.Alt}isControl(){return this.keys.Control}isShift(){return this.keys.Shift}isAlt(){return this.keys.Alt}};var x=class{constructor(t,e,i){this.scene=t,this.isMobile=i,this.player=this.scene.player,this.domElement=document.querySelector("#canvas-target"),this.domArtworkTarget=document.querySelector("#artwork-target"),this.centre={x:0,y:0},this.setSize(),this.rotation=new THREE.Vector2,this.timestamp=null,this.threshold={click:225,pan:200,mouseDelta:i?.5:.25},this.scaleRotation={x:i?.75:1,y:1},document.querySelectorAll("#gallery-controls .controls__inner .control").forEach(t=>{i?(t.addEventListener("touchstart",t=>{t.preventDefault(),this.onControlDown(t.currentTarget)}),t.addEventListener("touchend",t=>{t.preventDefault(),this.onControlUp(t.currentTarget)})):(t.addEventListener("mousedown",t=>{this.onControlDown(t.currentTarget)}),t.addEventListener("mouseup",t=>{this.onControlUp(t.currentTarget)}),t.addEventListener("mouseleave",t=>{this.onControlLeave(t.currentTarget)}))}),this.controls={up:document.querySelector("#ctrl-U"),down:document.querySelector("#ctrl-D"),left:document.querySelector("#ctrl-L"),right:document.querySelector("#ctrl-R")},this.keyboard=new T(t=>{this.onKeyboard(t)}),this.isMobile?this.mouse=new b(this.domElement,t=>{t.preventDefault(),this.onMouseDown(this.processTouch(t))},t=>{t.preventDefault(),this.onMouseMove(this.processTouch(t))},t=>{t.preventDefault(),this.onMouseUp(this.processTouch(t))},this.isMobile):this.mouse=new b(this.domElement,t=>{this.onMouseDown(t)},t=>{this.onMouseMove(t)},t=>{this.onMouseUp(t)},this.isMobile),this.canvas=new m(this,this.domElement,e.renderer.domElement),this.floorPlan=new y(this,i)}processTouch(t){var e=0,i=0;if(t.targetTouches&&t.targetTouches.length){const s=this.domElement.getBoundingClientRect(),r=t.targetTouches[0];e=r.pageX-s.left,i=r.pageY-s.top}return{offsetX:e,offsetY:i}}onMouseDown(t){this.rotation.y=this.player.rotation.y,this.rotation.x=this.player.rotation.x,this.timestamp=Date.now(),this.mouse.start(t),this.isMobile&&this.onMouseMove(t)}onMouseMove(t){if(this.mouse.move(t),this.mouse.active){if(!this.player.keys.left&&!this.player.keys.right){const e=this.rotation.x+this.mouse.delta.x/this.centre.x*this.scaleRotation.x,i=o(this.rotation.y+this.mouse.delta.y/this.centre.y*this.scaleRotation.y,this.player.minPitch,this.player.maxPitch);i!=this.player.minPitch&&i!=this.player.maxPitch||(this.mouse.origin.y=t.offsetY,this.rotation.y=i),this.player.setRotation(i,e)}}else this.floorPlan.mouseOver(this.mouse.x,this.mouse.y)}onMouseUp(t){this.mouse.stop(),Date.now()-this.timestamp<this.threshold.click&&Math.hypot(this.mouse.delta.x,this.mouse.delta.y)<window.innerWidth*this.threshold.mouseDelta&&this.floorPlan.click(this.mouse.x,this.mouse.y)}onControlUp(t){switch(t.dataset.dir){case"up":this.player.keys.up=!1;break;case"down":this.player.keys.down=!1;break;case"left":this.player.keys.left=!1;break;case"right":this.player.keys.right=!1}t.classList.remove("active")}onControlDown(t){switch(t.dataset.dir){case"up":this.player.keys.up=!0;break;case"down":this.player.keys.down=!0;break;case"left":this.player.keys.left=!0;break;case"right":this.player.keys.right=!0}t.classList.add("active")}onControlLeave(t){this.onControlUp(t)}onKeyboard(t){if(!this.domArtworkTarget.classList.contains("active"))switch(t){case"a":case"A":case"ArrowLeft":this.player.keys.left=this.keyboard.keys[t],this.player.keys.left?this.controls.left.classList.add("active"):this.controls.left.classList.remove("active");break;case"d":case"D":case"ArrowRight":this.player.keys.right=this.keyboard.keys[t],this.player.keys.right?this.controls.right.classList.add("active"):this.controls.right.classList.remove("active");break;case"w":case"W":case"ArrowUp":this.player.keys.up=this.keyboard.keys[t],this.player.keys.up?this.controls.up.classList.add("active"):this.controls.up.classList.remove("active");break;case"s":case"S":case"ArrowDown":this.player.keys.down=this.keyboard.keys[t],this.player.keys.down?this.controls.down.classList.add("active"):this.controls.down.classList.remove("active");break;case" ":this.player.keys.jump=this.keyboard.keys[t];break;case"x":case"X":(this.keyboard.keys.x||this.keyboard.keys.X)&&(this.keyboard.isControl()&&this.player.toggleNoclip(),this.keyboard.release("x"),this.keyboard.release("X"))}}setSize(){const t=this.domElement.getBoundingClientRect();this.centre.x=t.width/2,this.centre.y=t.height/2}resize(){this.setSize(),this.canvas.resize(),this.floorPlan.resize()}update(t){this.floorPlan.update(t)}draw(){this.canvas.clear(),this.floorPlan.draw(this.canvas.getContext()),this.canvas.promptTouchMove(this.mouse.active&&Date.now()-this.timestamp>this.threshold.pan),this.player.noclip?(this.canvas.promptGodMode(),this.canvas.drawDevOverlay()):this.canvas.drawDevOverlay()}};class w{constructor(t,e,i){this.isMobile=e,this.isDev=-1!=window.location.host.indexOf("localhost"),this.root=t,this.openGalleryButton=document.querySelector("#open-gallery"),this.openGalleryButton.onclick=()=>{this.openGalleryButton.classList.contains("is-loading")||(this.openGalleryButton.classList.remove("flash"),this.toggleGallery())},document.querySelectorAll(".close-gallery").forEach(t=>{t.addEventListener("click",()=>{this.closeGalleryMenu(),this.toggleGallery()})}),this.initMenus(),this.mobileWarning=document.querySelector("#mobile-warning"),this.isDev?this.toggleGallery():this.onMenuItem(document.querySelector("#nav-item-controls"))}toggleGallery(){if(!this.lock){this.lock=!0,this.toggleCount=this.toggleCount?this.toggleCount+1:1;const t=document.querySelector("#pane-content"),e=document.querySelector("#pane-gallery"),i=document.querySelector("#background-grid"),s=document.querySelector(".nav"),r=document.querySelector(".logo-main");t.classList.contains("active")?(t.classList.remove("active"),e.classList.add("active"),i.classList.add("active"),s.classList.add("active"),r.classList.add("active"),document.documentElement.classList.add("freeze"),1==this.toggleCount?setTimeout(()=>{this.lock=!1,e.querySelectorAll("canvas").forEach(t=>{t.classList.add("active")}),this.root.activate()},this.isDev?125:1e3):(this.root.activate(),this.lock=!1)):(e.classList.remove("active"),t.classList.add("active"),i.classList.remove("active"),s.classList.remove("active"),r.classList.remove("active"),document.documentElement.classList.remove("freeze"),this.root.deactivate(),this.lock=!1)}}closeGalleryMenu(){document.querySelectorAll("#nav-gallery .item.active, .gallery-menu .active").forEach(t=>{t.classList.remove("active")}),document.querySelector("#nav-gallery .close-gallery-menu").classList.add("active"),document.querySelector("#gallery-controls").classList.remove("display-none")}closeMobileWarning(){this.mobileWarning.classList.add("closing"),setTimeout(()=>{this.mobileWarning.parentNode.removeChild(this.mobileWarning)},500)}onMenuItem(t){if(t.dataset.active){const e=document.querySelector(t.dataset.active);e&&(t.parentNode.querySelectorAll(".active").forEach(t=>{t.classList.remove("active")}),t.classList.add("active"),"nav-content"==t.parentNode.getAttribute("id")?document.querySelectorAll(".pane-content .page.active").forEach(t=>{t.classList.remove("active")}):(document.querySelectorAll(".gallery-menu .menu.active").forEach(t=>{t.classList.remove("active"),t.querySelectorAll(".requires-activate").forEach(t=>{t.classList.remove("active")})}),document.querySelector("#gallery-controls").classList.add("display-none"),document.querySelector("#artwork-target").classList.remove("active")),e.classList.add("active"),e.querySelectorAll(".requires-activate").forEach(t=>{t.classList.add("active")}))}}initMenus(){document.querySelectorAll(".pane-content-nav .item").forEach(t=>{t.addEventListener("click",t=>{this.onMenuItem(t.currentTarget)})}),document.querySelectorAll(".close-gallery-menu").forEach(t=>{t.addEventListener("click",t=>{this.closeGalleryMenu()})})}}class M{constructor(t){this.root=t,this.lock=!1,this.active=!1,document.querySelectorAll(".archive-item").forEach(t=>{t.addEventListener("click",()=>{this.loadArchive(t)})}),this.featured=document.querySelector(".section-featured"),this.featured&&this.featured.addEventListener("click",()=>{this.reloadCurrentExhibition()})}activateGallery(t){document.querySelectorAll(".active-exhibition-data").forEach(t=>{t.classList.remove("active-exhibition-data")}),t.classList.add("active-exhibition-data"),this.root.surface.floorPlan.reloadExhibition(),this.root.scene.reloadExhibition()}reloadCurrentExhibition(){const t=this.featured.querySelector(".exhibition-data");if(!this.lock&&this.active&&t){this.active=!1,this.lock=!0,this.activateGallery(t);const e=document.querySelector("#open-gallery");e.innerHTML="Loading...",setTimeout(()=>{e.classList.add("flash"),e.innerHTML='<span class="mobile-show">&larr;&nbsp;Open Gallery</span><span class="mobile-hide">Open Gallery</span>',this.lock=!1},500),this.featured.classList.remove("clickable")}}loadArchive(t){const e=t.querySelector(".exhibition-data");if(!this.lock&&e&&!e.classList.contains("active-exhibition-data")){this.active=!0,this.lock=!0,this.activateGallery(e);const t=document.querySelector("#open-gallery");t.innerHTML="Loading...",setTimeout(()=>{t.classList.add("flash"),t.innerHTML='<span class="mobile-show">&larr;&nbsp;Open Archive</span><span class="mobile-hide">Open Archive</span>',this.lock=!1},500),this.featured.classList.add("clickable")}}}class R{constructor(){var t,e,i,s,r;this.active=!1,this.isMobile=(e=!1,t=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0),e),this.isMobileExclusive=function(){var t,e=!1;return t=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0),e}(),this.menu=new w(this,this.isMobile,()=>{this.load()}),this.maxTimeDelta=.1,this.load(),window.addEventListener("resize",()=>{this.resize()}),window.addEventListener("orientationchange",()=>{setTimeout(()=>{this.resize()},500)}),this.isMobileExclusive&&(i=window.navigator.userAgent,s=!!i.match(/iPad/i)||!!i.match(/iPhone/i),r=!!i.match(/WebKit/i),s&&r&&!i.match(/CriOS/i))&&document.querySelectorAll(".fix-safari").forEach(t=>{t.classList.add("safari")}),this.loop()}load(){this.loaded||(this.loaded=!0,this.scene=new p,this.renderer=new d(this,this.scene),this.surface=new x(this.scene,this.renderer,this.isMobile),this.archive=new M(this))}resize(){this.isMobileExclusive||(this.renderer.resize(),this.scene.resize(),this.surface.resize())}deactivate(){this.active=!1}activate(){this.active=!0,this.now=performance.now()}loop(){if(requestAnimationFrame(()=>{this.loop()}),this.active&&this.loaded){const t=performance.now(),e=Math.min(this.maxTimeDelta,(t-this.now)/1e3);this.now=t,this.scene.update(e),this.surface.update(e),this.renderer.draw(e),this.surface.draw()}}}window.onload=()=>{new R}}]);