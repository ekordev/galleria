var CLM=function(e){var t={};function i(r){if(t[r]){return t[r].exports}var s=t[r]={i:r,l:false,exports:{}};e[r].call(s.exports,s,s.exports,i);s.l=true;return s.exports}i.m=e;i.c=t;i.d=function(e,t,r){if(!i.o(e,t)){Object.defineProperty(e,t,{enumerable:true,get:r})}};i.r=function(e){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(e,"__esModule",{value:true})};i.t=function(e,t){if(t&1)e=i(e);if(t&8)return e;if(t&4&&typeof e==="object"&&e&&e.__esModule)return e;var r=Object.create(null);i.r(r);Object.defineProperty(r,"default",{enumerable:true,value:e});if(t&2&&typeof e!="string")for(var s in e)i.d(r,s,function(t){return e[t]}.bind(null,s));return r};i.n=function(e){var t=e&&e.__esModule?function t(){return e["default"]}:function t(){return e};i.d(t,"a",t);return t};i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};i.p="";return i(i.s=11)}([function(e,t){THREE.Sky=function(){var e=THREE.Sky.SkyShader;var t=new THREE.ShaderMaterial({fragmentShader:e.fragmentShader,vertexShader:e.vertexShader,uniforms:THREE.UniformsUtils.clone(e.uniforms),side:THREE.BackSide});THREE.Mesh.call(this,new THREE.BoxBufferGeometry(1,1,1),t)};THREE.Sky.prototype=Object.create(THREE.Mesh.prototype);THREE.Sky.SkyShader={uniforms:{luminance:{value:1},turbidity:{value:11.7},rayleigh:{value:2},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new THREE.Vector3}},vertexShader:["uniform vec3 sunPosition;","uniform float rayleigh;","uniform float turbidity;","uniform float mieCoefficient;","varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","const vec3 up = vec3( 0.0, 1.0, 0.0 );","const float e = 2.71828182845904523536028747135266249775724709369995957;","const float pi = 3.141592653589793238462643383279502884197169;","const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );","const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );","const float v = 4.0;","const vec3 K = vec3( 0.686, 0.678, 0.666 );","const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );","const float cutoffAngle = 1.6110731556870734;","const float steepness = 1.5;","const float EE = 1000.0;","float sunIntensity( float zenithAngleCos ) {","\tzenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );","\treturn EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );","}","vec3 totalMie( float T ) {","\tfloat c = ( 0.2 * T ) * 10E-18;","\treturn 0.434 * c * MieConst;","}","void main() {","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tvWorldPosition = worldPosition.xyz;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","\tgl_Position.z = gl_Position.w;","\tvSunDirection = normalize( sunPosition );","\tvSunE = sunIntensity( dot( vSunDirection, up ) );","\tvSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );","\tfloat rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );","\tvBetaR = totalRayleigh * rayleighCoefficient;","\tvBetaM = totalMie( turbidity ) * mieCoefficient;","}"].join("\n"),fragmentShader:["varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","uniform float luminance;","uniform float mieDirectionalG;","const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );","const float pi = 3.141592653589793238462643383279502884197169;","const float n = 1.0003;","const float N = 2.545E25;","const float rayleighZenithLength = 8.4E3;","const float mieZenithLength = 1.25E3;","const vec3 up = vec3( 0.0, 1.0, 0.0 );","const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;","const float THREE_OVER_SIXTEENPI = 0.05968310365946075;","const float ONE_OVER_FOURPI = 0.07957747154594767;","float rayleighPhase( float cosTheta ) {","\treturn THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );","}","float hgPhase( float cosTheta, float g ) {","\tfloat g2 = pow( g, 2.0 );","\tfloat inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );","\treturn ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );","}","const float A = 0.15;","const float B = 0.50;","const float C = 0.10;","const float D = 0.20;","const float E = 0.02;","const float F = 0.30;","const float whiteScale = 1.0748724675633854;","vec3 Uncharted2Tonemap( vec3 x ) {","\treturn ( ( x * ( A * x + C * B ) + D * E ) / ( x * ( A * x + B ) + D * F ) ) - E / F;","}","void main() {","\tfloat zenithAngle = acos( max( 0.0, dot( up, normalize( vWorldPosition - cameraPos ) ) ) );","\tfloat inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );","\tfloat sR = rayleighZenithLength * inverse;","\tfloat sM = mieZenithLength * inverse;","\tvec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );","\tfloat cosTheta = dot( normalize( vWorldPosition - cameraPos ), vSunDirection );","\tfloat rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );","\tvec3 betaRTheta = vBetaR * rPhase;","\tfloat mPhase = hgPhase( cosTheta, mieDirectionalG );","\tvec3 betaMTheta = vBetaM * mPhase;","\tvec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );","\tLin *= mix(vec3(1.0), pow(vSunE * ((betaRTheta + betaMTheta) / (vBetaR + vBetaM)) * Fex, vec3(1.0 / 2.0)), clamp(pow(1.0 - dot(up, vSunDirection), 5.0), 0.0, 1.0));","\tvec3 direction = normalize( vWorldPosition - cameraPos );","\tfloat theta = acos( direction.y ); // elevation --\x3e y-axis, [-pi/2, pi/2]","\tfloat phi = atan( direction.z, direction.x ); // azimuth --\x3e x-axis [-pi/2, pi/2]","\tvec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );","\tvec3 L0 = vec3( 0.1 ) * Fex;","\tvec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );","\tvec3 curr = Uncharted2Tonemap( ( log2( 2.0 / pow( luminance, 4.0 ) ) ) * texColor );","\tvec3 color = curr * whiteScale;","\tvec3 retColor = pow( color, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );","\tgl_FragColor = vec4( retColor, 1.0 );","}"].join("\n")}},function(e,t){THREE.MTLLoader=function(e){this.manager=e!==undefined?e:THREE.DefaultLoadingManager};THREE.MTLLoader.prototype={constructor:THREE.MTLLoader,load:function(e,t,i,r){var s=this;var a=new THREE.FileLoader(this.manager);a.setPath(this.path);a.load(e,function(e){t(s.parse(e))},i,r)},setPath:function(e){this.path=e},setTexturePath:function(e){this.texturePath=e},setBaseUrl:function(e){console.warn("THREE.MTLLoader: .setBaseUrl() is deprecated. Use .setTexturePath( path ) for texture path or .setPath( path ) for general base path instead.");this.setTexturePath(e)},setCrossOrigin:function(e){this.crossOrigin=e},setMaterialOptions:function(e){this.materialOptions=e},parse:function(e){var t=e.split("\n");var i={};var r=/\s+/;var s={};for(var a=0;a<t.length;a++){var o=t[a];o=o.trim();if(o.length===0||o.charAt(0)==="#"){continue}var n=o.indexOf(" ");var l=n>=0?o.substring(0,n):o;l=l.toLowerCase();var h=n>=0?o.substring(n+1):"";h=h.trim();if(l==="newmtl"){i={name:h};s[h]=i}else if(i){if(l==="ka"||l==="kd"||l==="ks"){var c=h.split(r,3);i[l]=[parseFloat(c[0]),parseFloat(c[1]),parseFloat(c[2])]}else{i[l]=h}}}var u=new THREE.MTLLoader.MaterialCreator(this.texturePath||this.path,this.materialOptions);u.setCrossOrigin(this.crossOrigin);u.setManager(this.manager);u.setMaterials(s);return u}};THREE.MTLLoader.MaterialCreator=function(e,t){this.baseUrl=e||"";this.options=t;this.materialsInfo={};this.materials={};this.materialsArray=[];this.nameLookup={};this.side=this.options&&this.options.side?this.options.side:THREE.FrontSide;this.wrap=this.options&&this.options.wrap?this.options.wrap:THREE.RepeatWrapping};THREE.MTLLoader.MaterialCreator.prototype={constructor:THREE.MTLLoader.MaterialCreator,crossOrigin:"Anonymous",setCrossOrigin:function(e){this.crossOrigin=e},setManager:function(e){this.manager=e},setMaterials:function(e){this.materialsInfo=this.convert(e);this.materials={};this.materialsArray=[];this.nameLookup={}},convert:function(e){if(!this.options)return e;var t={};for(var i in e){var r=e[i];var s={};t[i]=s;for(var a in r){var o=true;var n=r[a];var l=a.toLowerCase();switch(l){case"kd":case"ka":case"ks":if(this.options&&this.options.normalizeRGB){n=[n[0]/255,n[1]/255,n[2]/255]}if(this.options&&this.options.ignoreZeroRGBs){if(n[0]===0&&n[1]===0&&n[2]===0){o=false}}break;default:break}if(o){s[l]=n}}}return t},preload:function(){for(var e in this.materialsInfo){this.create(e)}},getIndex:function(e){return this.nameLookup[e]},getAsArray:function(){var e=0;for(var t in this.materialsInfo){this.materialsArray[e]=this.create(t);this.nameLookup[t]=e;e++}return this.materialsArray},create:function(e){if(this.materials[e]===undefined){this.createMaterial_(e)}return this.materials[e]},createMaterial_:function(e){var t=this;var i=this.materialsInfo[e];var r={name:e,side:this.side};function s(e,t){if(typeof t!=="string"||t==="")return"";if(/^https?:\/\//i.test(t))return t;return e+t}function a(e,i){if(r[e])return;var a=t.getTextureParams(i,r);var o=t.loadTexture(s(t.baseUrl,a.url));o.repeat.copy(a.scale);o.offset.copy(a.offset);o.wrapS=t.wrap;o.wrapT=t.wrap;r[e]=o}for(var o in i){var n=i[o];var l;if(n==="")continue;switch(o.toLowerCase()){case"kd":r.color=(new THREE.Color).fromArray(n);break;case"ks":r.specular=(new THREE.Color).fromArray(n);break;case"map_kd":a("map",n);break;case"map_ks":a("specularMap",n);break;case"norm":a("normalMap",n);break;case"map_bump":case"bump":a("bumpMap",n);break;case"ns":r.shininess=parseFloat(n);break;case"d":l=parseFloat(n);if(l<1){r.opacity=l;r.transparent=true}break;case"tr":l=parseFloat(n);if(l>0){r.opacity=1-l;r.transparent=true}break;default:break}}this.materials[e]=new THREE.MeshPhongMaterial(r);return this.materials[e]},getTextureParams:function(e,t){var i={scale:new THREE.Vector2(1,1),offset:new THREE.Vector2(0,0)};var r=e.split(/\s+/);var s;s=r.indexOf("-bm");if(s>=0){t.bumpScale=parseFloat(r[s+1]);r.splice(s,2)}s=r.indexOf("-s");if(s>=0){i.scale.set(parseFloat(r[s+1]),parseFloat(r[s+2]));r.splice(s,4)}s=r.indexOf("-o");if(s>=0){i.offset.set(parseFloat(r[s+1]),parseFloat(r[s+2]));r.splice(s,4)}i.url=r.join(" ").trim();return i},loadTexture:function(e,t,i,r,s){var a;var o=THREE.Loader.Handlers.get(e);var n=this.manager!==undefined?this.manager:THREE.DefaultLoadingManager;if(o===null){o=new THREE.TextureLoader(n)}if(o.setCrossOrigin)o.setCrossOrigin(this.crossOrigin);a=o.load(e,i,r,s);if(t!==undefined)a.mapping=t;return a}}},function(e,t){(function(){THREE.FBXLoader=function(e){this.manager=e!==undefined?e:THREE.DefaultLoadingManager};Object.assign(THREE.FBXLoader.prototype,{load:function(e,t,i,r){var s=this;var a=THREE.Loader.prototype.extractUrlBase(e);var o=new THREE.FileLoader(this.manager);o.setResponseType("arraybuffer");o.load(e,function(i){try{var o=s.parse(i,a);t(o)}catch(t){window.setTimeout(function(){if(r)r(t);s.manager.itemError(e)},0)}},i,r)},parse:function(i,s){var o;if(U(i)){o=(new N).parse(i)}else{var n=Y(i);if(!_(n)){throw new Error("THREE.FBXLoader: Unknown format.")}if(V(n)<7e3){throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+V(n))}o=(new F).parse(n)}var h=e(o);var u=t(o);var d=r(o,new THREE.TextureLoader(this.manager).setPath(s),u,h);var p=a(o,d,h);var f=l(o,h);var v=c(o,h,f);var m=w(o,h,f,v,p);return m}});function e(e){var t=new Map;if("Connections"in e){var i=e.Connections.properties.connections;for(var r=0,s=i.length;r<s;++r){var a=i[r];if(!t.has(a[0])){t.set(a[0],{parents:[],children:[]})}var o={ID:a[1],relationship:a[2]};t.get(a[0]).parents.push(o);if(!t.has(a[1])){t.set(a[1],{parents:[],children:[]})}var n={ID:a[0],relationship:a[2]};t.get(a[1]).children.push(n)}}return t}function t(e){var t=new Map;if("Video"in e.Objects.subNodes){var r=e.Objects.subNodes.Video;for(var s in r){var a=r[s];if("Content"in a.properties){var o=i(r[s]);t.set(parseInt(s),o)}}}return t}function i(e){var t=e.properties.Content;var i=e.properties.RelativeFilename||e.properties.Filename;var r=i.slice(i.lastIndexOf(".")+1).toLowerCase();var s;switch(r){case"bmp":s="image/bmp";break;case"jpg":case"jpeg":s="image/jpeg";break;case"png":s="image/png";break;case"tif":s="image/tiff";break;default:console.warn('FBXLoader: Image type "'+r+'" is not supported.');return}if(typeof t==="string"){return"data:"+s+";base64,"+t}else{var a=new Uint8Array(t);return window.URL.createObjectURL(new Blob([a],{type:s}))}}function r(e,t,i,r){var a=new Map;var o=["jpg","jpeg","png","bmp"];if("Texture"in e.Objects.subNodes){var n=e.Objects.subNodes.Texture;for(var l in n){var h=n[l];var c=h.properties.FileName.slice(h.properties.FileName.lastIndexOf(".")+1).toLowerCase();if(o.indexOf(c)!=-1){var u=s(h,t,i,r);a.set(parseInt(l),u)}}}return a}function s(e,t,i,r){var s=e.id;var a=e.attrName;var o;var n=e.properties.FileName;var l=e.properties.RelativeFilename;var h=r.get(s).children;if(h!==undefined&&h.length>0&&i.has(h[0].ID)){o=i.get(h[0].ID)}else if(l!==undefined&&l[0]!=="/"&&l.match(/^[a-zA-Z]:/)===null){o=l}else{var c=n.split(/[\\\/]/);if(c.length>0){o=c[c.length-1]}else{o=n}}var u=t.path;if(o.indexOf("blob:")===0||o.indexOf("data:")===0){t.setPath(undefined)}var d=t.load(o);d.name=a;d.FBX_ID=s;var p=e.properties.WrapModeU;var f=e.properties.WrapModeV;var v=p!==undefined?p.value:0;var m=f!==undefined?f.value:0;d.wrapS=v===0?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping;d.wrapT=m===0?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping;if("Scaling"in e.properties){var g=e.properties.Scaling.value;d.repeat.x=g[0];d.repeat.y=g[1]}t.setPath(u);return d}function a(e,t,i){var r=new Map;if("Material"in e.Objects.subNodes){var s=e.Objects.subNodes.Material;for(var a in s){var n=o(s[a],t,i);if(n!==null)r.set(parseInt(a),n)}}return r}function o(e,t,i){var r=e.id;var s=e.attrName;var a=e.properties.ShadingModel;if(typeof a==="object"){a=a.value}if(!i.has(r))return null;var o=i.get(r).children;var l=n(e.properties,t,o);var h;switch(a.toLowerCase()){case"phong":h=new THREE.MeshPhongMaterial;break;case"lambert":h=new THREE.MeshLambertMaterial;break;case"unknown":h=new THREE.MeshStandardMaterial;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',a);h=new THREE.MeshPhongMaterial({color:3342591});break}h.setValues(l);h.name=s;return h}function n(e,t,i){var r={};if(e.BumpFactor){r.bumpScale=e.BumpFactor.value}if(e.Diffuse){r.color=W(e.Diffuse)}if(e.DisplacementFactor){r.displacementScale=e.DisplacementFactor.value}if(e.ReflectionFactor){r.reflectivity=e.ReflectionFactor.value}if(e.Specular){r.specular=W(e.Specular)}if(e.Shininess){r.shininess=e.Shininess.value}if(e.Emissive){r.emissive=W(e.Emissive)}if(e.EmissiveFactor){r.emissiveIntensity=parseFloat(e.EmissiveFactor.value)}if(e.Opacity){r.opacity=parseFloat(e.Opacity.value)}if(r.opacity<1){r.transparent=true}if(e["Maya|base_color"]){var s=e["Maya|base_color"].value;r.color=new THREE.Color(s[0],s[1],s[2])}if(e["Maya|emissive"]){var s=e["Maya|emissive"];r.emissive=new THREE.Color(s[0],s[1],s[2])}if(e["Maya|emissive_intensity"]){r.emissiveIntensity=e["Maya|emissive_intensity"].value}if(e["Maya|metallic"]){r.metalness=e["Maya|metallic"].value}if(e["Maya|roughness"]){r.roughness=e["Maya|roughness"].value}var a=1;if(e["Maya|uv_scale"]){var a=e["Maya|uv_scale"].value}for(var o=0,n=i.length;o<n;++o){var l=i[o];var h=l.relationship;switch(h){case"Maya|TEX_color_map":var c="Maya|use_color_map";if(e[c]&&e[c].value==1){r.map=t.get(l.ID);if(a!=1){r.map.wrapS=THREE.RepeatWrapping;r.map.wrapT=THREE.RepeatWrapping;r.map.repeat.set(a,a)}}break;case"Maya|TEX_emissive_map":var c="Maya|use_emissive_map";if(e[c]&&e[c].value==1){r.emissiveMap=t.get(l.ID);if(a!=1){r.emissiveMap.wrapS=THREE.RepeatWrapping;r.emissiveMap.wrapT=THREE.RepeatWrapping;r.emissiveMap.repeat.set(a,a)}}break;case"Maya|TEX_roughness_map":var c="Maya|use_roughness_map";if(e[c]&&e[c].value==1){r.roughnessMap=t.get(l.ID);if(a!=1){r.roughnessMap.wrapS=THREE.RepeatWrapping;r.roughnessMap.wrapT=THREE.RepeatWrapping;r.roughnessMap.repeat.set(a,a)}}break;case"Maya|TEX_normal_map":var c="Maya|use_normal_map";if(e[c]&&e[c].value==1){r.normalMap=t.get(l.ID);if(a!=1){r.normalMap.wrapS=THREE.RepeatWrapping;r.normalMap.wrapT=THREE.RepeatWrapping;r.normalMap.repeat.set(a,a)}}break;case"Maya|TEX_metallic_map":var c="Maya|use_metallic_map";if(e[c]&&e[c].value==1){r.metalnessMap=t.get(l.ID);if(a!=1){r.metalnessMap.wrapS=THREE.RepeatWrapping;r.metalnessMap.wrapT=THREE.RepeatWrapping;r.metalnessMap.repeat.set(a,a)}}break;case"Maya|TEX_ao_map":var c="Maya|use_ao_map";if(e[c]&&e[c].value==1){r.aoMap=t.get(l.ID);if(a!=1){r.aoMap.wrapS=THREE.RepeatWrapping;r.aoMap.wrapT=THREE.RepeatWrapping;r.aoMap.repeat.set(a,a)}}break;case"Maya|TEX_brdf_lut":case"Maya|TEX_global_specular_cube":case"Maya|TEX_global_diffuse_cube":break;case"Bump":r.bumpMap=t.get(l.ID);break;case"DiffuseColor":r.map=t.get(l.ID);break;case"DisplacementColor":r.displacementMap=t.get(l.ID);break;case"EmissiveColor":r.emissiveMap=t.get(l.ID);break;case"NormalMap":r.normalMap=t.get(l.ID);break;case"ReflectionColor":r.envMap=t.get(l.ID);r.envMap.mapping=THREE.EquirectangularReflectionMapping;break;case"SpecularColor":r.specularMap=t.get(l.ID);break;case"TransparentColor":r.alphaMap=t.get(l.ID);r.transparent=true;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",h);break}}return r}function l(e,t){var i={};if("Deformer"in e.Objects.subNodes){var r=e.Objects.subNodes.Deformer;for(var s in r){var a=r[s];if(a.attrType==="Skin"){var o=t.get(parseInt(s));var n=h(o,r);n.FBX_ID=parseInt(s);i[s]=n}}}return i}function h(e,t){var i={};var r=e.children;for(var s=0,a=r.length;s<a;++s){var o=r[s];var n=t[o.ID];var l={FBX_ID:o.ID,index:s,indices:[],weights:[],transform:(new THREE.Matrix4).fromArray(n.subNodes.Transform.properties.a),transformLink:(new THREE.Matrix4).fromArray(n.subNodes.TransformLink.properties.a),linkMode:n.properties.Mode};if("Indexes"in n.subNodes){l.indices=n.subNodes.Indexes.properties.a;l.weights=n.subNodes.Weights.properties.a}i[o.ID]=l}return{map:i,bones:[]}}function c(e,t,i){var r=new Map;if("Geometry"in e.Objects.subNodes){var s=e.Objects.subNodes.Geometry;for(var a in s){var o=t.get(parseInt(a));var n=u(s[a],o,i);r.set(parseInt(a),n)}}return r}function u(e,t,i){switch(e.attrType){case"Mesh":return d(e,t,i);break;case"NurbsCurve":return T(e);break}}function d(e,t,i){for(var r=0;r<t.children.length;++r){var s=i[t.children[r].ID];if(s!==undefined)break}return p(e,s)}function p(e,t){var i=e.subNodes;var r=i.Vertices.properties.a;var s=i.PolygonVertexIndex.properties.a;var a=[];var o=[];var n=[];var l=[];var h=[];var c=[];var u=[];if(i.LayerElementColor){var d=m(i.LayerElementColor[0])}if(i.LayerElementMaterial){var p=g(i.LayerElementMaterial[0])}if(i.LayerElementNormal){var E=f(i.LayerElementNormal[0])}if(i.LayerElementUV){var y=[];var T=0;while(i.LayerElementUV[T]){y.push(v(i.LayerElementUV[T]));T++}}var w={};if(t){var x=t.map;for(var R in x){var M=x[R];var k=M.indices;for(var S=0;S<k.length;S++){var H=k[S];var P=M.weights[S];if(w[H]===undefined)w[H]=[];w[H].push({id:M.index,weight:P})}}}var z=0;var L=0;var C=false;var I=[];var A=[];var D=[];var B=[];var F=[];var N=[];for(var O=0;O<s.length;O++){var j=s[O];var U=false;if(j<0){j=j^-1;s[O]=j;U=true}var _=[];var V=[];I.push(j*3,j*3+1,j*3+2);if(d){var q=b(O,z,j,d);D.push(q[0],q[1],q[2])}if(t){if(w[j]!==undefined){var G=w[j];for(var S=0,X=G.length;S<X;S++){V.push(G[S].weight);_.push(G[S].id)}}if(V.length>4){if(!C){console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights.");C=true}var W=[0,0,0,0];var Y=[0,0,0,0];V.forEach(function(e,t){var i=e;var r=_[t];Y.forEach(function(e,t,s){if(i>e){s[t]=i;i=e;var a=W[t];W[t]=r;r=a}})});_=W;V=Y}for(var T=V.length;T<4;++T){V[T]=0;_[T]=0}for(var T=0;T<4;++T){F.push(V[T]);N.push(_[T])}}if(E){var q=b(O,z,j,E);A.push(q[0],q[1],q[2])}if(y){for(var T=0;T<y.length;T++){var q=b(O,z,j,y[T]);if(B[T]===undefined){B[T]=[]}B[T].push(q[0],q[1])}}L++;if(U){for(var T=2;T<L;T++){a.push(r[I[0]]);a.push(r[I[1]]);a.push(r[I[2]]);a.push(r[I[(T-1)*3]]);a.push(r[I[(T-1)*3+1]]);a.push(r[I[(T-1)*3+2]]);a.push(r[I[T*3]]);a.push(r[I[T*3+1]]);a.push(r[I[T*3+2]])}if(t){for(var T=2;T<L;T++){c.push(F[0]);c.push(F[1]);c.push(F[2]);c.push(F[3]);c.push(F[(T-1)*4]);c.push(F[(T-1)*4+1]);c.push(F[(T-1)*4+2]);c.push(F[(T-1)*4+3]);c.push(F[T*4]);c.push(F[T*4+1]);c.push(F[T*4+2]);c.push(F[T*4+3]);u.push(N[0]);u.push(N[1]);u.push(N[2]);u.push(N[3]);u.push(N[(T-1)*4]);u.push(N[(T-1)*4+1]);u.push(N[(T-1)*4+2]);u.push(N[(T-1)*4+3]);u.push(N[T*4]);u.push(N[T*4+1]);u.push(N[T*4+2]);u.push(N[T*4+3])}}if(E){for(var T=2;T<L;T++){o.push(A[0]);o.push(A[1]);o.push(A[2]);o.push(A[(T-1)*3]);o.push(A[(T-1)*3+1]);o.push(A[(T-1)*3+2]);o.push(A[T*3]);o.push(A[T*3+1]);o.push(A[T*3+2])}}if(y){for(var S=0;S<y.length;S++){if(l[S]===undefined)l[S]=[];for(var T=2;T<L;T++){l[S].push(B[S][0]);l[S].push(B[S][1]);l[S].push(B[S][(T-1)*2]);l[S].push(B[S][(T-1)*2+1]);l[S].push(B[S][T*2]);l[S].push(B[S][T*2+1])}}}if(d){for(var T=2;T<L;T++){n.push(D[0]);n.push(D[1]);n.push(D[2]);n.push(D[(T-1)*3]);n.push(D[(T-1)*3+1]);n.push(D[(T-1)*3+2]);n.push(D[T*3]);n.push(D[T*3+1]);n.push(D[T*3+2])}}if(p&&p.mappingType!=="AllSame"){var $=b(O,z,j,p)[0];for(var T=2;T<L;T++){h.push($);h.push($);h.push($)}}z++;U=false;L=0;I=[];A=[];D=[];B=[];F=[];N=[]}}var K=new THREE.BufferGeometry;K.name=e.name;K.addAttribute("position",new THREE.Float32BufferAttribute(a,3));if(n.length>0){K.addAttribute("color",new THREE.Float32BufferAttribute(n,3))}if(t){K.addAttribute("skinIndex",new THREE.Float32BufferAttribute(u,4));K.addAttribute("skinWeight",new THREE.Float32BufferAttribute(c,4));K.FBX_Deformer=t}if(o.length>0){K.addAttribute("normal",new THREE.Float32BufferAttribute(o,3))}if(l.length>0){for(var T=0;T<l.length;T++){var Z="uv"+(T+1).toString();if(T==0){Z="uv"}K.addAttribute(Z,new THREE.Float32BufferAttribute(l[T],2))}}if(p&&p.mappingType!=="AllSame"){var Q=h[0];var J=0;for(var T=0;T<h.length;++T){if(h[T]!==Q){K.addGroup(J,T-J,Q);Q=h[T];J=T}}if(K.groups.length>0){var ee=K.groups[K.groups.length-1];var te=ee.start+ee.count;if(te!==h.length){K.addGroup(te,h.length-te,Q)}}if(K.groups.length===0){K.addGroup(0,h.length,h[0])}}return K}function f(e){var t=e.properties.MappingInformationType;var i=e.properties.ReferenceInformationType;var r=e.subNodes.Normals.properties.a;var s=[];if(i==="IndexToDirect"){if("NormalIndex"in e.subNodes){s=e.subNodes.NormalIndex.properties.a}else if("NormalsIndex"in e.subNodes){s=e.subNodes.NormalsIndex.properties.a}}return{dataSize:3,buffer:r,indices:s,mappingType:t,referenceType:i}}function v(e){var t=e.properties.MappingInformationType;var i=e.properties.ReferenceInformationType;var r=e.subNodes.UV.properties.a;var s=[];if(i==="IndexToDirect"){s=e.subNodes.UVIndex.properties.a}return{dataSize:2,buffer:r,indices:s,mappingType:t,referenceType:i}}function m(e){var t=e.properties.MappingInformationType;var i=e.properties.ReferenceInformationType;var r=e.subNodes.Colors.properties.a;var s=[];if(i==="IndexToDirect"){s=e.subNodes.ColorIndex.properties.a}return{dataSize:4,buffer:r,indices:s,mappingType:t,referenceType:i}}function g(e){var t=e.properties.MappingInformationType;var i=e.properties.ReferenceInformationType;if(t==="NoMappingInformation"){return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:i}}var r=e.subNodes.Materials.properties.a;var s=[];for(var a=0,o=r.length;a<o;++a){s.push(a)}return{dataSize:1,buffer:r,indices:s,mappingType:t,referenceType:i}}var E=[];var y={ByPolygonVertex:{Direct:function(e,t,i,r){var s=e*r.dataSize;var a=e*r.dataSize+r.dataSize;return Z(E,r.buffer,s,a)},IndexToDirect:function(e,t,i,r){var s=r.indices[e];var a=s*r.dataSize;var o=s*r.dataSize+r.dataSize;return Z(E,r.buffer,a,o)}},ByPolygon:{Direct:function(e,t,i,r){var s=t*r.dataSize;var a=t*r.dataSize+r.dataSize;return Z(E,r.buffer,s,a)},IndexToDirect:function(e,t,i,r){var s=r.indices[t];var a=s*r.dataSize;var o=s*r.dataSize+r.dataSize;return Z(E,r.buffer,a,o)}},ByVertice:{Direct:function(e,t,i,r){var s=i*r.dataSize;var a=i*r.dataSize+r.dataSize;return Z(E,r.buffer,s,a)}},AllSame:{IndexToDirect:function(e,t,i,r){var s=r.indices[0]*r.dataSize;var a=r.indices[0]*r.dataSize+r.dataSize;return Z(E,r.buffer,s,a)}}};function b(e,t,i,r){return y[r.mappingType][r.referenceType](e,t,i,r)}function T(e){if(THREE.NURBSCurve===undefined){console.error("THREE.FBXLoader: The loader relies on THREE.NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry.");return new THREE.BufferGeometry}var t=parseInt(e.properties.Order);if(isNaN(t)){console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.properties.Order,e.id);return new THREE.BufferGeometry}var i=t-1;var r=e.subNodes.KnotVector.properties.a;var s=[];var a=e.subNodes.Points.properties.a;for(var o=0,n=a.length;o<n;o+=4){s.push((new THREE.Vector4).fromArray(a,o))}var l,h;if(e.properties.Form==="Closed"){s.push(s[0])}else if(e.properties.Form==="Periodic"){l=i;h=r.length-1-l;for(var o=0;o<i;++o){s.push(s[o])}}var c=new THREE.NURBSCurve(i,r,s,l,h);var u=c.getPoints(s.length*7);var d=new Float32Array(u.length*3);for(var o=0,n=u.length;o<n;++o){u[o].toArray(d,o*3)}var p=new THREE.BufferGeometry;p.addAttribute("position",new THREE.BufferAttribute(d,3));return p}function w(e,t,i,r,s){var a=new THREE.Group;var o=e.Objects.subNodes.Model;var n=[];var l=new Map;for(var h in o){var c=parseInt(h);var u=o[h];var d=t.get(c);var p=null;for(var f=0;f<d.parents.length;++f){for(var v in i){var m=i[v];var g=m.map;var E=g[d.parents[f].ID];if(E){var y=p;p=new THREE.Bone;m.bones[E.index]=p;if(y!==null)p.add(y)}}}if(!p){switch(u.attrType){case"Camera":var b;for(var T=0,w=d.children.length;T<w;++T){var R=d.children[T].ID;var M=e.Objects.subNodes.NodeAttribute[R];if(M!==undefined&&M.properties!==undefined){b=M.properties}}if(b===undefined){p=new THREE.Object3D}else{var k=0;if(b.CameraProjectionType!==undefined&&b.CameraProjectionType.value===1){k=1}var S=1;if(b.NearPlane!==undefined){S=b.NearPlane.value/1e3}var H=1e3;if(b.FarPlane!==undefined){H=b.FarPlane.value/1e3}var z=window.innerWidth;var L=window.innerHeight;if(b.AspectWidth!==undefined&&b.AspectHeight!==undefined){z=b.AspectWidth.value;L=b.AspectHeight.value}var C=z/L;var I=45;if(b.FieldOfView!==undefined){I=b.FieldOfView.value}switch(k){case 0:p=new THREE.PerspectiveCamera(I,C,S,H);break;case 1:p=new THREE.OrthographicCamera(-z/2,z/2,L/2,-L/2,S,H);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+k+".");p=new THREE.Object3D;break}}break;case"Light":var A;for(var T=0,w=d.children.length;T<w;++T){var R=d.children[T].ID;var M=e.Objects.subNodes.NodeAttribute[R];if(M!==undefined&&M.properties!==undefined){A=M.properties}}if(A===undefined){p=new THREE.Object3D}else{var k;if(A.LightType===undefined){k=0}else{k=A.LightType.value}var D=16777215;if(A.Color!==undefined){D=W(A.Color.value)}var B=A.Intensity===undefined?1:A.Intensity.value/100;if(A.CastLightOnObject!==undefined&&A.CastLightOnObject.value===0){B=0}var F=0;if(A.FarAttenuationEnd!==undefined){if(A.EnableFarAttenuation!==undefined&&A.EnableFarAttenuation.value===0){F=0}else{F=A.FarAttenuationEnd.value/1e3}}var N=1;switch(k){case 0:p=new THREE.PointLight(D,B,F,N);break;case 1:p=new THREE.DirectionalLight(D,B);break;case 2:var O=Math.PI/3;if(A.InnerAngle!==undefined){O=THREE.Math.degToRad(A.InnerAngle.value)}var j=0;if(A.OuterAngle!==undefined){j=THREE.Math.degToRad(A.OuterAngle.value);j=Math.max(j,1)}p=new THREE.SpotLight(D,B,F,O,j,N);break;default:console.warn("THREE.FBXLoader: Unknown light type "+A.LightType.value+", defaulting to a THREE.PointLight.");p=new THREE.PointLight(D,B);break}if(A.CastShadows!==undefined&&A.CastShadows.value===1){p.castShadow=true}}break;case"Mesh":var U=null;var _=null;var V=[];for(var T=0,w=d.children.length;T<w;++T){var q=d.children[T];if(r.has(q.ID)){U=r.get(q.ID)}if(s.has(q.ID)){V.push(s.get(q.ID))}}if(V.length>1){_=V}else if(V.length>0){_=V[0]}else{_=new THREE.MeshPhongMaterial({color:13421772});V.push(_)}if("color"in U.attributes){for(var G=0,X=V.length;G<X;++G){V[G].vertexColors=THREE.VertexColors}}if(U.FBX_Deformer){for(var Y=0,K=V.length;Y<K;++Y){V[Y].skinning=true}p=new THREE.SkinnedMesh(U,_)}else{p=new THREE.Mesh(U,_)}break;case"NurbsCurve":var U=null;for(var T=0,w=d.children.length;T<w;++T){var q=d.children[T];if(r.has(q.ID)){U=r.get(q.ID)}}_=new THREE.LineBasicMaterial({color:3342591,linewidth:5});p=new THREE.Line(U,_);break;default:p=new THREE.Group;break}}p.name=THREE.PropertyBinding.sanitizeNodeName(u.attrName);p.FBX_ID=c;n.push(p);l.set(c,p)}for(var Z=0,Q=n.length;Z<Q;++Z){var p=n[Z];var u=o[p.FBX_ID];if("Lcl_Translation"in u.properties){p.position.fromArray(u.properties.Lcl_Translation.value)}if("Lcl_Rotation"in u.properties){var J=u.properties.Lcl_Rotation.value.map(THREE.Math.degToRad);J.push("ZYX");p.rotation.fromArray(J)}if("Lcl_Scaling"in u.properties){p.scale.fromArray(u.properties.Lcl_Scaling.value)}if("PreRotation"in u.properties){var ee=u.properties.PreRotation.value.map(THREE.Math.degToRad);ee[3]="ZYX";var te=(new THREE.Euler).fromArray(ee);te=(new THREE.Quaternion).setFromEuler(te);var ie=(new THREE.Quaternion).setFromEuler(p.rotation);te.multiply(ie);p.rotation.setFromQuaternion(te,"ZYX")}if("GeometricTranslation"in u.properties){var ee=u.properties.GeometricTranslation.value;p.traverse(function(e){if(e.geometry){e.geometry.translate(ee[0],ee[1],ee[2])}})}if("LookAtProperty"in u.properties){var d=t.get(p.FBX_ID);for(var T=0,w=d.children.length;T<w;++T){var q=d.children[T];if(q.relationship==="LookAtProperty"){var re=e.Objects.subNodes.Model[q.ID];if("Lcl_Translation"in re.properties){var se=re.properties.Lcl_Translation.value;if(p.target!==undefined){p.target.position.set(se[0],se[1],se[2]);a.add(p.target)}else{p.lookAt(new THREE.Vector3(se[0],se[1],se[2]))}}}}}var d=t.get(p.FBX_ID);for(var ae=0;ae<d.parents.length;ae++){var oe=$(n,function(e){return e.FBX_ID===d.parents[ae].ID});if(oe>-1){n[oe].add(p);break}}if(p.parent===null){a.add(p)}}a.updateMatrixWorld(true);var ne=new Map;if("Pose"in e.Objects.subNodes){var le=e.Objects.subNodes.Pose;for(var h in le){if(le[h].attrType==="BindPose"){le=le[h];break}}var he=le.subNodes.PoseNode;for(var ce=0,ue=he.length;ce<ue;++ce){var u=he[ce];var de=(new THREE.Matrix4).fromArray(u.subNodes.Matrix.properties.a);ne.set(parseInt(u.properties.Node),de)}}for(var v in i){var m=i[v];var g=m.map;for(var pe in g){var E=g[pe];var fe=E.index;var ve=m.bones[fe];if(!ne.has(ve.FBX_ID)){break}var me=ne.get(ve.FBX_ID);ve.matrixWorld.copy(me)}m.skeleton=new THREE.Skeleton(m.bones);var d=t.get(m.FBX_ID);var ge=d.parents;for(var Ee=0,ye=ge.length;Ee<ye;++Ee){var be=ge[Ee];if(r.has(be.ID)){var Te=be.ID;var we=t.get(Te);for(var f=0;f<we.parents.length;++f){if(l.has(we.parents[f].ID)){var p=l.get(we.parents[f].ID);p.bind(m.skeleton,p.matrixWorld);break}}}}}a.updateMatrixWorld(true);a.skeleton={bones:n};var xe=x(e,t,a);P(a,xe);if("GlobalSettings"in e&&"AmbientColor"in e.GlobalSettings.properties){var Re=e.GlobalSettings.properties.AmbientColor.value;var Me=Re[0];var ke=Re[1];var Se=Re[2];if(Me!==0||ke!==0||Se!==0){var D=new THREE.Color(Me,ke,Se);a.add(new THREE.AmbientLight(D,1))}}return a}function x(e,t,i){var r=e.Objects.subNodes.AnimationCurveNode;var s=e.Objects.subNodes.AnimationCurve;var a=e.Objects.subNodes.AnimationLayer;var o=e.Objects.subNodes.AnimationStack;var n=30;if("GlobalSettings"in e&&"TimeMode"in e.GlobalSettings.properties){var l=[30,120,100,60,50,48,30,30,29.97,29.97,25,24,1,23.976,30,96,72,59.94];var h=e.GlobalSettings.properties.TimeMode.value;if(h===14){if("CustomFrameRate"in e.GlobalSettings.properties){n=e.GlobalSettings.properties.CustomFrameRate.value;n=n===-1?30:n}}else if(h<=17){n=l[h]}}var c={curves:new Map,layers:{},stacks:{},length:0,fps:n,frames:0};var u=[];for(var d in r){if(d.match(/\d+/)){var p=R(e,r[d],t,i);u.push(p)}}var f=new Map;for(var v=0;v<u.length;++v){if(u[v]===null){continue}f.set(u[v].id,u[v])}var m=[];for(d in s){if(d.match(/\d+/)){var g=M(s[d]);if(!t.has(g.id))continue;m.push(g);var E=t.get(g.id).parents[0];var y=E.ID;var b=E.relationship;var T="";if(b.match(/X/)){T="x"}else if(b.match(/Y/)){T="y"}else if(b.match(/Z/)){T="z"}else{continue}f.get(y).curves[T]=g}}f.forEach(function(e){var t=e.containerBoneID;if(!c.curves.has(t)){c.curves.set(t,{T:null,R:null,S:null})}c.curves.get(t)[e.attr]=e;if(e.attr==="R"){var i=e.curves;if(i.x===null){i.x={version:null,times:[0],values:[0]}}if(i.y===null){i.y={version:null,times:[0],values:[0]}}if(i.z===null){i.z={version:null,times:[0],values:[0]}}i.x.values=i.x.values.map(THREE.Math.degToRad);i.y.values=i.y.values.map(THREE.Math.degToRad);i.z.values=i.z.values.map(THREE.Math.degToRad);if(e.preRotations!==null){var r=(new THREE.Euler).setFromVector3(e.preRotations,"ZYX");r=(new THREE.Quaternion).setFromEuler(r);var s=new THREE.Euler;var a=new THREE.Quaternion;for(var o=0;o<i.x.times.length;++o){s.set(i.x.values[o],i.y.values[o],i.z.values[o],"ZYX");a.setFromEuler(s).premultiply(r);s.setFromQuaternion(a,"ZYX");i.x.values[o]=s.x;i.y.values[o]=s.y;i.z.values[o]=s.z}}}});for(var d in a){var w=[];var x=t.get(parseInt(d)).children;for(var S=0;S<x.length;S++){if(f.has(x[S].ID)){var H=f.get(x[S].ID);var P=H.containerBoneID;if(w[P]===undefined){w[P]={T:null,R:null,S:null}}w[P][H.attr]=H}}c.layers[d]=w}for(var d in o){var z=[];var x=t.get(parseInt(d)).children;var L={max:0,min:Number.MAX_VALUE};for(var S=0;S<x.length;++S){var C=c.layers[x[S].ID];if(C!==undefined){z.push(C);for(var I=0,A=C.length;I<A;++I){var w=C[I];if(w){k(w,L)}}}}if(L.max>L.min){c.stacks[d]={name:o[d].attrName,layers:z,length:L.max-L.min,frames:(L.max-L.min)*c.fps}}}return c}function R(e,t,i,r){var s=e.Objects.subNodes.Model;var a={id:t.id,attr:t.attrName,internalID:t.id,attrX:false,attrY:false,attrZ:false,containerBoneID:-1,containerID:-1,curves:{x:null,y:null,z:null},preRotations:null};if(a.attr.match(/S|R|T/)){for(var o in t.properties){if(o.match(/X/)){a.attrX=true}if(o.match(/Y/)){a.attrY=true}if(o.match(/Z/)){a.attrZ=true}}}else{return null}var n=i.get(a.id);var l=n.parents;for(var h=l.length-1;h>=0;--h){var c=$(r.skeleton.bones,function(e){return e.FBX_ID===l[h].ID});if(c>-1){a.containerBoneID=c;a.containerID=l[h].ID;var u=s[a.containerID.toString()];if("PreRotation"in u.properties){a.preRotations=X(u.properties.PreRotation).multiplyScalar(Math.PI/180)}break}}return a}function M(e){return{version:null,id:e.id,internalID:e.id,times:e.subNodes.KeyTime.properties.a.map(q),values:e.subNodes.KeyValueFloat.properties.a,attrFlag:e.subNodes.KeyAttrFlags.properties.a,attrData:e.subNodes.KeyAttrDataFloat.properties.a}}function k(e,t){if(e.R){S(e.R.curves,t)}if(e.S){S(e.S.curves,t)}if(e.T){S(e.T.curves,t)}}function S(e,t){if(e.x){H(e.x,t)}if(e.y){H(e.y,t)}if(e.z){H(e.z,t)}}function H(e,t){t.max=e.times[e.times.length-1]>t.max?e.times[e.times.length-1]:t.max;t.min=e.times[0]<t.min?e.times[0]:t.min}function P(e,t){if(e.animations===undefined){e.animations=[]}var i=t.stacks;for(var r in i){var s=i[r];var a={name:s.name,fps:t.fps,length:s.length,hierarchy:[]};var o=e.skeleton.bones;for(var n=0,l=o.length;n<l;++n){var h=o[n];var c=h.name.replace(/.*:/,"");var u=$(o,function(e){return h.parent===e});a.hierarchy.push({parent:u,name:c,keys:[]})}for(var d=0;d<=s.frames;d++){for(var n=0,l=o.length;n<l;++n){var h=o[n];var p=n;var f=s.layers[0][p];for(var v=0,m=a.hierarchy.length;v<m;++v){var g=a.hierarchy[v];if(g.name===h.name){g.keys.push(C(t,f,h,d))}}}}e.animations.push(THREE.AnimationClip.parseAnimation(a,o))}}var z=new THREE.Euler;var L=new THREE.Quaternion;function C(e,t,i,r){var s={time:r/e.fps,pos:i.position.toArray(),rot:i.quaternion.toArray(),scl:i.scale.toArray()};if(t===undefined)return s;z.setFromQuaternion(i.quaternion,"ZYX",false);try{if(A(t,"T")&&D(t.T,r)){if(t.T.curves.x.values[r]){s.pos[0]=t.T.curves.x.values[r]}if(t.T.curves.y.values[r]){s.pos[1]=t.T.curves.y.values[r]}if(t.T.curves.z.values[r]){s.pos[2]=t.T.curves.z.values[r]}}if(A(t,"R")&&D(t.R,r)){if(t.R.curves.x.values[r]){z.x=t.R.curves.x.values[r]}if(t.R.curves.y.values[r]){z.y=t.R.curves.y.values[r]}if(t.R.curves.z.values[r]){z.z=t.R.curves.z.values[r]}L.setFromEuler(z);s.rot=L.toArray()}if(A(t,"S")&&D(t.S,r)){if(t.T.curves.x.values[r]){s.scl[0]=t.S.curves.x.values[r]}if(t.T.curves.y.values[r]){s.scl[1]=t.S.curves.y.values[r]}if(t.T.curves.z.values[r]){s.scl[2]=t.S.curves.z.values[r]}}}catch(e){console.log("THREE.FBXLoader: ",i);console.log("THREE.FBXLoader: ",e)}return s}var I=["x","y","z"];function A(e,t){if(e===undefined){return false}var i=e[t];if(!i){return false}return I.every(function(e){return i.curves[e]!==null})}function D(e,t){return I.every(function(i){return B(e.curves[i],t)})}function B(e,t){return e.values[t]!==undefined}function F(){}Object.assign(F.prototype,{getPrevNode:function(){return this.nodeStack[this.currentIndent-2]},getCurrentNode:function(){return this.nodeStack[this.currentIndent-1]},getCurrentProp:function(){return this.currentProp},pushStack:function(e){this.nodeStack.push(e);this.currentIndent+=1},popStack:function(){this.nodeStack.pop();this.currentIndent-=1},setCurrentProp:function(e,t){this.currentProp=e;this.currentPropName=t},parse:function(e){this.currentIndent=0;this.allNodes=new j;this.nodeStack=[];this.currentProp=[];this.currentPropName="";var t=e.split("\n");for(var i=0,r=t.length;i<r;i++){var s=t[i];if(s.match(/^[\s\t]*;/)){continue}if(s.match(/^[\s\t]*$/)){continue}var a=new RegExp("^\\t{"+this.currentIndent+"}(\\w+):(.*){","");var o=s.match(a);if(o){var n=o[1].trim().replace(/^"/,"").replace(/"$/,"");var l=o[2].split(",");for(var h=0,s=l.length;h<s;h++){l[h]=l[h].trim().replace(/^"/,"").replace(/"$/,"")}this.parseNodeBegin(s,n,l||null);continue}var c=new RegExp("^\\t{"+this.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)");var o=s.match(c);if(o){var u=o[1].replace(/^"/,"").replace(/"$/,"").trim();var d=o[2].replace(/^"/,"").replace(/"$/,"").trim();if(u==="Content"&&d===","){d=t[++i].replace(/"/g,"").replace(/,$/,"").trim()}this.parseNodeProperty(s,u,d);continue}var p=new RegExp("^\\t{"+(this.currentIndent-1)+"}}");if(s.match(p)){this.nodeEnd();continue}if(s.match(/^[^\s\t}]/)){this.parseNodePropertyContinued(s)}}return this.allNodes},parseNodeBegin:function(e,t,i){var r={name:t,properties:{},subNodes:{}};var s=this.parseNodeAttr(i);var a=this.getCurrentNode();if(this.currentIndent===0){this.allNodes.add(t,r)}else{if(t in a.subNodes){var o=a.subNodes[t];if(this.isFlattenNode(a.subNodes[t])){if(s.id===""){a.subNodes[t]=[];a.subNodes[t].push(o)}else{a.subNodes[t]={};a.subNodes[t][o.id]=o}}if(s.id===""){a.subNodes[t].push(r)}else{a.subNodes[t][s.id]=r}}else if(typeof s.id==="number"||s.id.match(/^\d+$/)){a.subNodes[t]={};a.subNodes[t][s.id]=r}else{a.subNodes[t]=r}}if(i){r.id=s.id;r.attrName=s.name;r.attrType=s.type}this.pushStack(r)},parseNodeAttr:function(e){var t=e[0];if(e[0]!==""){t=parseInt(e[0]);if(isNaN(t)){t=e[0]}}var i="",r="";if(e.length>1){i=e[1].replace(/^(\w+)::/,"");r=e[2]}return{id:t,name:i,type:r}},parseNodeProperty:function(e,t,i){var r=this.getCurrentNode();var s=r.name;if(s!==undefined){var a=s.match(/Properties(\d)+/);if(a){this.parseNodeSpecialProperty(e,t,i);return}}if(t==="C"){var o=i.split(",").slice(1);var n=parseInt(o[0]);var l=parseInt(o[1]);var h=i.split(",").slice(3);h=h.map(function(e){return e.trim().replace(/^"/,"")});t="connections";i=[n,l];K(i,h);if(r.properties[t]===undefined){r.properties[t]=[]}}if(t==="Node"){var c=parseInt(i);r.properties.id=c;r.id=c}if(t in r.properties){if(Array.isArray(r.properties[t])){r.properties[t].push(i)}else{r.properties[t]+=i}}else{if(Array.isArray(r.properties[t])){r.properties[t].push(i)}else{r.properties[t]=i}}this.setCurrentProp(r.properties,t);if(t==="a"&&i.slice(-1)!==","){r.properties.a=G(i)}},parseNodePropertyContinued:function(e){this.currentProp[this.currentPropName]+=e;if(e.slice(-1)!==","){var t=this.getCurrentNode();t.properties.a=G(t.properties.a)}},parseNodeSpecialProperty:function(e,t,i){var r=i.split('",');for(var s=0,a=r.length;s<a;s++){r[s]=r[s].trim().replace(/^\"/,"").replace(/\s/,"_")}var o=r[0];var n=r[1];var l=r[2];var h=r[3];var c=r[4];switch(n){case"int":case"enum":case"bool":case"ULongLong":c=parseInt(c);break;case"double":case"Number":case"FieldOfView":c=parseFloat(c);break;case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":c=G(c);break}this.getPrevNode().properties[o]={type:n,type2:l,flag:h,value:c};this.setCurrentProp(this.getPrevNode().properties,o)},nodeEnd:function(){this.popStack()},isFlattenNode:function(e){return"subNodes"in e&&"properties"in e?true:false}});function N(){}Object.assign(N.prototype,{parse:function(e){var t=new O(e);t.skip(23);var i=t.getUint32();var r=new j;var s=0;while(!this.endOfContent(t)){try{var a=this.parseNode(t,i);if(a!==null){r.add(a.name,a)}}catch(e){console.log(e)}}return r},endOfContent:function(e){if(e.size()%16===0){return(e.getOffset()+160+16&~15)>=e.size()}else{return e.getOffset()+160+16>=e.size()}},parseNode:function(e,t){var i=t>=7500?e.getUint64():e.getUint32();var r=t>=7500?e.getUint64():e.getUint32();var s=t>=7500?e.getUint64():e.getUint32();var a=e.getUint8();var o=e.getString(a);if(i===0)return null;var n=[];for(var l=0;l<r;l++){n.push(this.parseProperty(e))}var h=n.length>0?n[0]:"";var c=n.length>1?n[1]:"";var u=n.length>2?n[2]:"";var d={};var p={};var f=false;if(r===1&&e.getOffset()===i){f=true}while(i>e.getOffset()){var v=this.parseNode(e,t);if(v===null)continue;if(v.singleProperty===true){var m=v.propertyList[0];if(Array.isArray(m)){d[v.name]=v;v.properties.a=m}else{p[v.name]=m}continue}if(o==="Connections"&&v.name==="C"){var g=[];for(var l=1,E=v.propertyList.length;l<E;l++){g[l-1]=v.propertyList[l]}if(p.connections===undefined){p.connections=[]}p.connections.push(g);continue}if(v.name.match(/^Properties\d+$/)){var y=Object.keys(v.properties);for(var l=0,E=y.length;l<E;l++){var b=y[l];p[b]=v.properties[b]}continue}if(o.match(/^Properties\d+$/)&&v.name==="P"){var T=v.propertyList[0];var w=v.propertyList[1];var x=v.propertyList[2];var R=v.propertyList[3];var M;if(T.indexOf("Lcl ")===0)T=T.replace("Lcl ","Lcl_");if(w.indexOf("Lcl ")===0)w=w.replace("Lcl ","Lcl_");if(w==="ColorRGB"||w==="Vector"||w==="Vector3D"||w.indexOf("Lcl_")===0){M=[v.propertyList[4],v.propertyList[5],v.propertyList[6]]}else{M=v.propertyList[4]}p[T]={type:w,type2:x,flag:R,value:M};continue}if(d[v.name]===undefined){if(typeof v.id==="number"){d[v.name]={};d[v.name][v.id]=v}else{d[v.name]=v}}else{if(v.id===""){if(!Array.isArray(d[v.name])){d[v.name]=[d[v.name]]}d[v.name].push(v)}else{if(d[v.name][v.id]===undefined){d[v.name][v.id]=v}else{if(!Array.isArray(d[v.name][v.id])){d[v.name][v.id]=[d[v.name][v.id]]}d[v.name][v.id].push(v)}}}}return{singleProperty:f,id:h,attrName:c,attrType:u,name:o,properties:p,propertyList:n,subNodes:d}},parseProperty:function(e){var t=e.getChar();switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":var i=e.getUint32();return e.getArrayBuffer(i);case"S":var i=e.getUint32();return e.getString(i);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":var r=e.getUint32();var s=e.getUint32();var a=e.getUint32();if(s===0){switch(t){case"b":case"c":return e.getBooleanArray(r);case"d":return e.getFloat64Array(r);case"f":return e.getFloat32Array(r);case"i":return e.getInt32Array(r);case"l":return e.getInt64Array(r)}}if(window.Zlib===undefined){throw new Error("THREE.FBXLoader: External library Inflate.min.js required, obtain or import from https://github.com/imaya/zlib.js")}var o=new Zlib.Inflate(new Uint8Array(e.getArrayBuffer(a)));var n=new O(o.decompress().buffer);switch(t){case"b":case"c":return n.getBooleanArray(r);case"d":return n.getFloat64Array(r);case"f":return n.getFloat32Array(r);case"i":return n.getInt32Array(r);case"l":return n.getInt64Array(r)}default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}});function O(e,t){this.dv=new DataView(e);this.offset=0;this.littleEndian=t!==undefined?t:true}Object.assign(O.prototype,{getOffset:function(){return this.offset},size:function(){return this.dv.buffer.byteLength},skip:function(e){this.offset+=e},getBoolean:function(){return(this.getUint8()&1)===1},getBooleanArray:function(e){var t=[];for(var i=0;i<e;i++){t.push(this.getBoolean())}return t},getInt8:function(){var e=this.dv.getInt8(this.offset);this.offset+=1;return e},getInt8Array:function(e){var t=[];for(var i=0;i<e;i++){t.push(this.getInt8())}return t},getUint8:function(){var e=this.dv.getUint8(this.offset);this.offset+=1;return e},getUint8Array:function(e){var t=[];for(var i=0;i<e;i++){t.push(this.getUint8())}return t},getInt16:function(){var e=this.dv.getInt16(this.offset,this.littleEndian);this.offset+=2;return e},getInt16Array:function(e){var t=[];for(var i=0;i<e;i++){t.push(this.getInt16())}return t},getUint16:function(){var e=this.dv.getUint16(this.offset,this.littleEndian);this.offset+=2;return e},getUint16Array:function(e){var t=[];for(var i=0;i<e;i++){t.push(this.getUint16())}return t},getInt32:function(){var e=this.dv.getInt32(this.offset,this.littleEndian);this.offset+=4;return e},getInt32Array:function(e){var t=[];for(var i=0;i<e;i++){t.push(this.getInt32())}return t},getUint32:function(){var e=this.dv.getUint32(this.offset,this.littleEndian);this.offset+=4;return e},getUint32Array:function(e){var t=[];for(var i=0;i<e;i++){t.push(this.getUint32())}return t},getInt64:function(){var e,t;if(this.littleEndian){e=this.getUint32();t=this.getUint32()}else{t=this.getUint32();e=this.getUint32()}if(t&2147483648){t=~t&4294967295;e=~e&4294967295;if(e===4294967295)t=t+1&4294967295;e=e+1&4294967295;return-(t*4294967296+e)}return t*4294967296+e},getInt64Array:function(e){var t=[];for(var i=0;i<e;i++){t.push(this.getInt64())}return t},getUint64:function(){var e,t;if(this.littleEndian){e=this.getUint32();t=this.getUint32()}else{t=this.getUint32();e=this.getUint32()}return t*4294967296+e},getUint64Array:function(e){var t=[];for(var i=0;i<e;i++){t.push(this.getUint64())}return t},getFloat32:function(){var e=this.dv.getFloat32(this.offset,this.littleEndian);this.offset+=4;return e},getFloat32Array:function(e){var t=[];for(var i=0;i<e;i++){t.push(this.getFloat32())}return t},getFloat64:function(){var e=this.dv.getFloat64(this.offset,this.littleEndian);this.offset+=8;return e},getFloat64Array:function(e){var t=[];for(var i=0;i<e;i++){t.push(this.getFloat64())}return t},getArrayBuffer:function(e){var t=this.dv.buffer.slice(this.offset,this.offset+e);this.offset+=e;return t},getChar:function(){return String.fromCharCode(this.getUint8())},getString:function(e){var t="";while(e>0){var i=this.getUint8();e--;if(i===0)break;t+=String.fromCharCode(i)}t=decodeURIComponent(escape(t));this.skip(e);return t}});function j(){}Object.assign(j.prototype,{add:function(e,t){this[e]=t}});function U(e){var t="Kaydara FBX Binary  \0";return e.byteLength>=t.length&&t===Y(e,0,t.length)}function _(e){var t=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];var i=0;function r(t){var r=e[t-1];e=e.slice(i+t);i++;return r}for(var s=0;s<t.length;++s){var a=r(1);if(a===t[s]){return false}}return true}function V(e){var t=/FBXVersion: (\d+)/;var i=e.match(t);if(i){var r=parseInt(i[1]);return r}throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function q(e){return e/46186158e3}function G(e){var t=e.split(",");for(var i=0,r=t.length;i<r;i++){t[i]=parseFloat(t[i])}return t}function X(e){return(new THREE.Vector3).fromArray(e.value)}function W(e){return(new THREE.Color).fromArray(e.value)}function Y(e,t,i){if(t===undefined)t=0;if(i===undefined)i=e.byteLength;var r=new Uint8Array(e,t,i);if(window.TextDecoder!==undefined){return(new TextDecoder).decode(r)}var s="";for(var a=0,o=r.length;a<o;a++){s+=String.fromCharCode(r[a])}return s}function $(e,t){for(var i=0,r=e.length;i<r;i++){if(t(e[i]))return i}return-1}function K(e,t){for(var i=0,r=e.length,s=t.length;i<s;i++,r++){e[r]=t[i]}}function Z(e,t,i,r){for(var s=i,a=0;s<r;s++,a++){e[a]=t[s]}return e}})()},function(e,t){THREE.OBJLoader=function(){var e=/^[og]\s*(.+)?/;var t=/^mtllib /;var i=/^usemtl /;function r(){var e={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materialLibraries:[],startObject:function(e,t){if(this.object&&this.object.fromDeclaration===false){this.object.name=e;this.object.fromDeclaration=t!==false;return}var i=this.object&&typeof this.object.currentMaterial==="function"?this.object.currentMaterial():undefined;if(this.object&&typeof this.object._finalize==="function"){this.object._finalize(true)}this.object={name:e||"",fromDeclaration:t!==false,geometry:{vertices:[],normals:[],colors:[],uvs:[]},materials:[],smooth:true,startMaterial:function(e,t){var i=this._finalize(false);if(i&&(i.inherited||i.groupCount<=0)){this.materials.splice(i.index,1)}var r={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&t.length>0?t[t.length-1]:"",smooth:i!==undefined?i.smooth:this.smooth,groupStart:i!==undefined?i.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:false,clone:function(e){var t={index:typeof e==="number"?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:false};t.clone=this.clone.bind(t);return t}};this.materials.push(r);return r},currentMaterial:function(){if(this.materials.length>0){return this.materials[this.materials.length-1]}return undefined},_finalize:function(e){var t=this.currentMaterial();if(t&&t.groupEnd===-1){t.groupEnd=this.geometry.vertices.length/3;t.groupCount=t.groupEnd-t.groupStart;t.inherited=false}if(e&&this.materials.length>1){for(var i=this.materials.length-1;i>=0;i--){if(this.materials[i].groupCount<=0){this.materials.splice(i,1)}}}if(e&&this.materials.length===0){this.materials.push({name:"",smooth:this.smooth})}return t}};if(i&&i.name&&typeof i.clone==="function"){var r=i.clone(0);r.inherited=true;this.object.materials.push(r)}this.objects.push(this.object)},finalize:function(){if(this.object&&typeof this.object._finalize==="function"){this.object._finalize(true)}},parseVertexIndex:function(e,t){var i=parseInt(e,10);return(i>=0?i-1:i+t/3)*3},parseNormalIndex:function(e,t){var i=parseInt(e,10);return(i>=0?i-1:i+t/3)*3},parseUVIndex:function(e,t){var i=parseInt(e,10);return(i>=0?i-1:i+t/2)*2},addVertex:function(e,t,i){var r=this.vertices;var s=this.object.geometry.vertices;s.push(r[e+0],r[e+1],r[e+2]);s.push(r[t+0],r[t+1],r[t+2]);s.push(r[i+0],r[i+1],r[i+2])},addVertexPoint:function(e){var t=this.vertices;var i=this.object.geometry.vertices;i.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){var t=this.vertices;var i=this.object.geometry.vertices;i.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,i){var r=this.normals;var s=this.object.geometry.normals;s.push(r[e+0],r[e+1],r[e+2]);s.push(r[t+0],r[t+1],r[t+2]);s.push(r[i+0],r[i+1],r[i+2])},addColor:function(e,t,i){var r=this.colors;var s=this.object.geometry.colors;s.push(r[e+0],r[e+1],r[e+2]);s.push(r[t+0],r[t+1],r[t+2]);s.push(r[i+0],r[i+1],r[i+2])},addUV:function(e,t,i){var r=this.uvs;var s=this.object.geometry.uvs;s.push(r[e+0],r[e+1]);s.push(r[t+0],r[t+1]);s.push(r[i+0],r[i+1])},addUVLine:function(e){var t=this.uvs;var i=this.object.geometry.uvs;i.push(t[e+0],t[e+1])},addFace:function(e,t,i,r,s,a,o,n,l){var h=this.vertices.length;var c=this.parseVertexIndex(e,h);var u=this.parseVertexIndex(t,h);var d=this.parseVertexIndex(i,h);this.addVertex(c,u,d);if(r!==undefined&&r!==""){var p=this.uvs.length;c=this.parseUVIndex(r,p);u=this.parseUVIndex(s,p);d=this.parseUVIndex(a,p);this.addUV(c,u,d)}if(o!==undefined&&o!==""){var f=this.normals.length;c=this.parseNormalIndex(o,f);u=o===n?c:this.parseNormalIndex(n,f);d=o===l?c:this.parseNormalIndex(l,f);this.addNormal(c,u,d)}if(this.colors.length>0){this.addColor(c,u,d)}},addPointGeometry:function(e){this.object.geometry.type="Points";var t=this.vertices.length;for(var i=0,r=e.length;i<r;i++){this.addVertexPoint(this.parseVertexIndex(e[i],t))}},addLineGeometry:function(e,t){this.object.geometry.type="Line";var i=this.vertices.length;var r=this.uvs.length;for(var s=0,a=e.length;s<a;s++){this.addVertexLine(this.parseVertexIndex(e[s],i))}for(var o=0,a=t.length;o<a;o++){this.addUVLine(this.parseUVIndex(t[o],r))}}};e.startObject("",false);return e}function s(e){this.manager=e!==undefined?e:THREE.DefaultLoadingManager;this.materials=null}s.prototype={constructor:s,load:function(e,t,i,r){var s=this;var a=new THREE.FileLoader(s.manager);a.setPath(this.path);a.load(e,function(e){t(s.parse(e))},i,r)},setPath:function(e){this.path=e;return this},setMaterials:function(e){this.materials=e;return this},parse:function(s){console.time("OBJLoader");var a=new r;if(s.indexOf("\r\n")!==-1){s=s.replace(/\r\n/g,"\n")}if(s.indexOf("\\\n")!==-1){s=s.replace(/\\\n/g,"")}var o=s.split("\n");var n="",l="";var h=0;var c=[];var u=typeof"".trimLeft==="function";for(var d=0,p=o.length;d<p;d++){n=o[d];n=u?n.trimLeft():n.trim();h=n.length;if(h===0)continue;l=n.charAt(0);if(l==="#")continue;if(l==="v"){var f=n.split(/\s+/);switch(f[0]){case"v":a.vertices.push(parseFloat(f[1]),parseFloat(f[2]),parseFloat(f[3]));if(f.length===8){a.colors.push(parseFloat(f[4]),parseFloat(f[5]),parseFloat(f[6]))}break;case"vn":a.normals.push(parseFloat(f[1]),parseFloat(f[2]),parseFloat(f[3]));break;case"vt":a.uvs.push(parseFloat(f[1]),parseFloat(f[2]));break}}else if(l==="f"){var v=n.substr(1).trim();var m=v.split(/\s+/);var g=[];for(var E=0,y=m.length;E<y;E++){var b=m[E];if(b.length>0){var T=b.split("/");g.push(T)}}var w=g[0];for(var E=1,y=g.length-1;E<y;E++){var x=g[E];var R=g[E+1];a.addFace(w[0],x[0],R[0],w[1],x[1],R[1],w[2],x[2],R[2])}}else if(l==="l"){var M=n.substring(1).trim().split(" ");var k=[],S=[];if(n.indexOf("/")===-1){k=M}else{for(var H=0,P=M.length;H<P;H++){var z=M[H].split("/");if(z[0]!=="")k.push(z[0]);if(z[1]!=="")S.push(z[1])}}a.addLineGeometry(k,S)}else if(l==="p"){var v=n.substr(1).trim();var L=v.split(" ");a.addPointGeometry(L)}else if((c=e.exec(n))!==null){var C=(" "+c[0].substr(1).trim()).substr(1);a.startObject(C)}else if(i.test(n)){a.object.startMaterial(n.substring(7).trim(),a.materialLibraries)}else if(t.test(n)){a.materialLibraries.push(n.substring(7).trim())}else if(l==="s"){c=n.split(" ");if(c.length>1){var I=c[1].trim().toLowerCase();a.object.smooth=I!=="0"&&I!=="off"}else{a.object.smooth=true}var A=a.object.currentMaterial();if(A)A.smooth=a.object.smooth}else{if(n==="\0")continue;throw new Error('THREE.OBJLoader: Unexpected line: "'+n+'"')}}a.finalize();var D=new THREE.Group;D.materialLibraries=[].concat(a.materialLibraries);for(var d=0,p=a.objects.length;d<p;d++){var B=a.objects[d];var F=B.geometry;var N=B.materials;var O=F.type==="Line";var j=F.type==="Points";var U=false;if(F.vertices.length===0)continue;var _=new THREE.BufferGeometry;_.addAttribute("position",new THREE.Float32BufferAttribute(F.vertices,3));if(F.normals.length>0){_.addAttribute("normal",new THREE.Float32BufferAttribute(F.normals,3))}else{_.computeVertexNormals()}if(F.colors.length>0){U=true;_.addAttribute("color",new THREE.Float32BufferAttribute(F.colors,3))}if(F.uvs.length>0){_.addAttribute("uv",new THREE.Float32BufferAttribute(F.uvs,2))}var V=[];for(var q=0,G=N.length;q<G;q++){var X=N[q];var A=undefined;if(this.materials!==null){A=this.materials.create(X.name);if(O&&A&&!(A instanceof THREE.LineBasicMaterial)){var W=new THREE.LineBasicMaterial;W.copy(A);W.lights=false;A=W}else if(j&&A&&!(A instanceof THREE.PointsMaterial)){var Y=new THREE.PointsMaterial({size:10,sizeAttenuation:false});W.copy(A);A=Y}}if(!A){if(O){A=new THREE.LineBasicMaterial}else if(j){A=new THREE.PointsMaterial({size:1,sizeAttenuation:false})}else{A=new THREE.MeshPhongMaterial}A.name=X.name}A.flatShading=X.smooth?false:true;A.vertexColors=U?THREE.VertexColors:THREE.NoColors;V.push(A)}var $;if(V.length>1){for(var q=0,G=N.length;q<G;q++){var X=N[q];_.addGroup(X.groupStart,X.groupCount,q)}if(O){$=new THREE.LineSegments(_,V)}else if(j){$=new THREE.Points(_,V)}else{$=new THREE.Mesh(_,V)}}else{if(O){$=new THREE.LineSegments(_,V[0])}else if(j){$=new THREE.Points(_,V[0])}else{$=new THREE.Mesh(_,V[0])}}$.name=B.name;D.add($)}console.timeEnd("OBJLoader");return D}};return s}()},function(e,t){THREE.CopyShader={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","gl_FragColor = opacity * texel;","}"].join("\n")}},function(e,t){THREE.EffectComposer=function(e,t){this.renderer=e;if(t===undefined){var i={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,stencilBuffer:false};var r=e.getDrawingBufferSize();t=new THREE.WebGLRenderTarget(r.width,r.height,i);t.texture.name="EffectComposer.rt1"}this.renderTarget1=t;this.renderTarget2=t.clone();this.renderTarget2.texture.name="EffectComposer.rt2";this.writeBuffer=this.renderTarget1;this.readBuffer=this.renderTarget2;this.passes=[];if(THREE.CopyShader===undefined){console.error("THREE.EffectComposer relies on THREE.CopyShader")}if(THREE.ShaderPass===undefined){console.error("THREE.EffectComposer relies on THREE.ShaderPass")}this.copyPass=new THREE.ShaderPass(THREE.CopyShader)};Object.assign(THREE.EffectComposer.prototype,{swapBuffers:function(){var e=this.readBuffer;this.readBuffer=this.writeBuffer;this.writeBuffer=e},addPass:function(e){this.passes.push(e);var t=this.renderer.getDrawingBufferSize();e.setSize(t.width,t.height)},insertPass:function(e,t){this.passes.splice(t,0,e)},render:function(e){var t=false;var i,r,s=this.passes.length;for(r=0;r<s;r++){i=this.passes[r];if(i.enabled===false)continue;i.render(this.renderer,this.writeBuffer,this.readBuffer,e,t);if(i.needsSwap){if(t){var a=this.renderer.context;a.stencilFunc(a.NOTEQUAL,1,4294967295);this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e);a.stencilFunc(a.EQUAL,1,4294967295)}this.swapBuffers()}if(THREE.MaskPass!==undefined){if(i instanceof THREE.MaskPass){t=true}else if(i instanceof THREE.ClearMaskPass){t=false}}}},reset:function(e){if(e===undefined){var t=this.renderer.getDrawingBufferSize();e=this.renderTarget1.clone();e.setSize(t.width,t.height)}this.renderTarget1.dispose();this.renderTarget2.dispose();this.renderTarget1=e;this.renderTarget2=e.clone();this.writeBuffer=this.renderTarget1;this.readBuffer=this.renderTarget2},setSize:function(e,t){this.renderTarget1.setSize(e,t);this.renderTarget2.setSize(e,t);for(var i=0;i<this.passes.length;i++){this.passes[i].setSize(e,t)}}});THREE.Pass=function(){this.enabled=true;this.needsSwap=true;this.clear=false;this.renderToScreen=false};Object.assign(THREE.Pass.prototype,{setSize:function(e,t){},render:function(e,t,i,r,s){console.error("THREE.Pass: .render() must be implemented in derived pass.")}})},function(e,t){THREE.LuminosityHighPassShader={shaderID:"luminosityHighPass",uniforms:{tDiffuse:{type:"t",value:null},luminosityThreshold:{type:"f",value:1},smoothWidth:{type:"f",value:1},defaultColor:{type:"c",value:new THREE.Color(0)},defaultOpacity:{type:"f",value:0}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec3 defaultColor;","uniform float defaultOpacity;","uniform float luminosityThreshold;","uniform float smoothWidth;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","vec3 luma = vec3( 0.299, 0.587, 0.114 );","float v = dot( texel.xyz, luma );","vec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );","float alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );","gl_FragColor = mix( outputColor, texel, alpha );","}"].join("\n")}},function(e,t){THREE.RenderPass=function(e,t,i,r,s){THREE.Pass.call(this);this.scene=e;this.camera=t;this.overrideMaterial=i;this.clearColor=r;this.clearAlpha=s!==undefined?s:0;this.clear=true;this.clearDepth=false;this.needsSwap=false};THREE.RenderPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.RenderPass,render:function(e,t,i,r,s){var a=e.autoClear;e.autoClear=false;this.scene.overrideMaterial=this.overrideMaterial;var o,n;if(this.clearColor){o=e.getClearColor().getHex();n=e.getClearAlpha();e.setClearColor(this.clearColor,this.clearAlpha)}if(this.clearDepth){e.clearDepth()}e.render(this.scene,this.camera,this.renderToScreen?null:i,this.clear);if(this.clearColor){e.setClearColor(o,n)}this.scene.overrideMaterial=null;e.autoClear=a}})},function(e,t){THREE.ShaderPass=function(e,t){THREE.Pass.call(this);this.textureID=t!==undefined?t:"tDiffuse";if(e instanceof THREE.ShaderMaterial){this.uniforms=e.uniforms;this.material=e}else if(e){this.uniforms=THREE.UniformsUtils.clone(e.uniforms);this.material=new THREE.ShaderMaterial({defines:e.defines||{},uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})}this.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1);this.scene=new THREE.Scene;this.quad=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),null);this.quad.frustumCulled=false;this.scene.add(this.quad)};THREE.ShaderPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.ShaderPass,render:function(e,t,i,r,s){if(this.uniforms[this.textureID]){this.uniforms[this.textureID].value=i.texture}this.quad.material=this.material;if(this.renderToScreen){e.render(this.scene,this.camera)}else{e.render(this.scene,this.camera,t,this.clear)}}})},function(e,t){THREE.UnrealBloomPass=function(e,t,i,r){THREE.Pass.call(this);this.strength=t!==undefined?t:1;this.radius=i;this.threshold=r;this.resolution=e!==undefined?new THREE.Vector2(e.x,e.y):new THREE.Vector2(256,256);var s={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat};this.renderTargetsHorizontal=[];this.renderTargetsVertical=[];this.nMips=5;var a=Math.round(this.resolution.x/2);var o=Math.round(this.resolution.y/2);this.renderTargetBright=new THREE.WebGLRenderTarget(a,o,s);this.renderTargetBright.texture.name="UnrealBloomPass.bright";this.renderTargetBright.texture.generateMipmaps=false;for(var n=0;n<this.nMips;n++){var l=new THREE.WebGLRenderTarget(a,o,s);l.texture.name="UnrealBloomPass.h"+n;l.texture.generateMipmaps=false;this.renderTargetsHorizontal.push(l);var l=new THREE.WebGLRenderTarget(a,o,s);l.texture.name="UnrealBloomPass.v"+n;l.texture.generateMipmaps=false;this.renderTargetsVertical.push(l);a=Math.round(a/2);o=Math.round(o/2)}if(THREE.LuminosityHighPassShader===undefined)console.error("THREE.UnrealBloomPass relies on THREE.LuminosityHighPassShader");var h=THREE.LuminosityHighPassShader;this.highPassUniforms=THREE.UniformsUtils.clone(h.uniforms);this.highPassUniforms["luminosityThreshold"].value=r;this.highPassUniforms["smoothWidth"].value=.01;this.materialHighPassFilter=new THREE.ShaderMaterial({uniforms:this.highPassUniforms,vertexShader:h.vertexShader,fragmentShader:h.fragmentShader,defines:{}});this.separableBlurMaterials=[];var c=[3,5,7,9,11];var a=Math.round(this.resolution.x/2);var o=Math.round(this.resolution.y/2);for(var n=0;n<this.nMips;n++){this.separableBlurMaterials.push(this.getSeperableBlurMaterial(c[n]));this.separableBlurMaterials[n].uniforms["texSize"].value=new THREE.Vector2(a,o);a=Math.round(a/2);o=Math.round(o/2)}this.compositeMaterial=this.getCompositeMaterial(this.nMips);this.compositeMaterial.uniforms["blurTexture1"].value=this.renderTargetsVertical[0].texture;this.compositeMaterial.uniforms["blurTexture2"].value=this.renderTargetsVertical[1].texture;this.compositeMaterial.uniforms["blurTexture3"].value=this.renderTargetsVertical[2].texture;this.compositeMaterial.uniforms["blurTexture4"].value=this.renderTargetsVertical[3].texture;this.compositeMaterial.uniforms["blurTexture5"].value=this.renderTargetsVertical[4].texture;this.compositeMaterial.uniforms["bloomStrength"].value=t;this.compositeMaterial.uniforms["bloomRadius"].value=.1;this.compositeMaterial.needsUpdate=true;var u=[1,.8,.6,.4,.2];this.compositeMaterial.uniforms["bloomFactors"].value=u;this.bloomTintColors=[new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1)];this.compositeMaterial.uniforms["bloomTintColors"].value=this.bloomTintColors;if(THREE.CopyShader===undefined){console.error("THREE.BloomPass relies on THREE.CopyShader")}var d=THREE.CopyShader;this.copyUniforms=THREE.UniformsUtils.clone(d.uniforms);this.copyUniforms["opacity"].value=1;this.materialCopy=new THREE.ShaderMaterial({uniforms:this.copyUniforms,vertexShader:d.vertexShader,fragmentShader:d.fragmentShader,blending:THREE.AdditiveBlending,depthTest:false,depthWrite:false,transparent:true});this.enabled=true;this.needsSwap=false;this.oldClearColor=new THREE.Color;this.oldClearAlpha=1;this.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1);this.scene=new THREE.Scene;this.basic=new THREE.MeshBasicMaterial;this.quad=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),null);this.quad.frustumCulled=false;this.scene.add(this.quad)};THREE.UnrealBloomPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.UnrealBloomPass,dispose:function(){for(var e=0;e<this.renderTargetsHorizontal.length;e++){this.renderTargetsHorizontal[e].dispose()}for(var e=0;e<this.renderTargetsVertical.length;e++){this.renderTargetsVertical[e].dispose()}this.renderTargetBright.dispose()},setSize:function(e,t){var i=Math.round(e/2);var r=Math.round(t/2);this.renderTargetBright.setSize(i,r);for(var s=0;s<this.nMips;s++){this.renderTargetsHorizontal[s].setSize(i,r);this.renderTargetsVertical[s].setSize(i,r);this.separableBlurMaterials[s].uniforms["texSize"].value=new THREE.Vector2(i,r);i=Math.round(i/2);r=Math.round(r/2)}},render:function(e,t,i,r,s){this.oldClearColor.copy(e.getClearColor());this.oldClearAlpha=e.getClearAlpha();var a=e.autoClear;e.autoClear=false;e.setClearColor(new THREE.Color(0,0,0),0);if(s)e.context.disable(e.context.STENCIL_TEST);if(this.renderToScreen){this.quad.material=this.basic;this.basic.map=i.texture;e.render(this.scene,this.camera,undefined,true)}this.highPassUniforms["tDiffuse"].value=i.texture;this.highPassUniforms["luminosityThreshold"].value=this.threshold;this.quad.material=this.materialHighPassFilter;e.render(this.scene,this.camera,this.renderTargetBright,true);var o=this.renderTargetBright;for(var n=0;n<this.nMips;n++){this.quad.material=this.separableBlurMaterials[n];this.separableBlurMaterials[n].uniforms["colorTexture"].value=o.texture;this.separableBlurMaterials[n].uniforms["direction"].value=THREE.UnrealBloomPass.BlurDirectionX;e.render(this.scene,this.camera,this.renderTargetsHorizontal[n],true);this.separableBlurMaterials[n].uniforms["colorTexture"].value=this.renderTargetsHorizontal[n].texture;this.separableBlurMaterials[n].uniforms["direction"].value=THREE.UnrealBloomPass.BlurDirectionY;e.render(this.scene,this.camera,this.renderTargetsVertical[n],true);o=this.renderTargetsVertical[n]}this.quad.material=this.compositeMaterial;this.compositeMaterial.uniforms["bloomStrength"].value=this.strength;this.compositeMaterial.uniforms["bloomRadius"].value=this.radius;this.compositeMaterial.uniforms["bloomTintColors"].value=this.bloomTintColors;e.render(this.scene,this.camera,this.renderTargetsHorizontal[0],true);this.quad.material=this.materialCopy;this.copyUniforms["tDiffuse"].value=this.renderTargetsHorizontal[0].texture;if(s)e.context.enable(e.context.STENCIL_TEST);if(this.renderToScreen){e.render(this.scene,this.camera,undefined,false)}else{e.render(this.scene,this.camera,i,false)}e.setClearColor(this.oldClearColor,this.oldClearAlpha);e.autoClear=a},getSeperableBlurMaterial:function(e){return new THREE.ShaderMaterial({defines:{KERNEL_RADIUS:e,SIGMA:e},uniforms:{colorTexture:{value:null},texSize:{value:new THREE.Vector2(.5,.5)},direction:{value:new THREE.Vector2(.5,.5)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D colorTexture;\n\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec2 direction;\t\t\t\t\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\t\t\t\t}\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tfloat fSigma = float(SIGMA);\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, fSigma);\t\t\t\t\tvec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;\t\t\t\t\tfor( int i = 1; i < KERNEL_RADIUS; i ++ ) {\t\t\t\t\t\tfloat x = float(i);\t\t\t\t\t\tfloat w = gaussianPdf(x, fSigma);\t\t\t\t\t\tvec2 uvOffset = direction * invSize * x;\t\t\t\t\t\tvec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;\t\t\t\t\t\tvec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;\t\t\t\t\t\tdiffuseSum += (sample1 + sample2) * w;\t\t\t\t\t\tweightSum += 2.0 * w;\t\t\t\t\t}\t\t\t\t\tgl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n\t\t\t\t}"})},getCompositeMaterial:function(e){return new THREE.ShaderMaterial({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},dirtTexture:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D blurTexture1;\t\t\t\tuniform sampler2D blurTexture2;\t\t\t\tuniform sampler2D blurTexture3;\t\t\t\tuniform sampler2D blurTexture4;\t\t\t\tuniform sampler2D blurTexture5;\t\t\t\tuniform sampler2D dirtTexture;\t\t\t\tuniform float bloomStrength;\t\t\t\tuniform float bloomRadius;\t\t\t\tuniform float bloomFactors[NUM_MIPS];\t\t\t\tuniform vec3 bloomTintColors[NUM_MIPS];\t\t\t\t\t\t\t\tfloat lerpBloomFactor(const in float factor) { \t\t\t\t\tfloat mirrorFactor = 1.2 - factor;\t\t\t\t\treturn mix(factor, mirrorFactor, bloomRadius);\t\t\t\t}\t\t\t\t\t\t\t\tvoid main() {\t\t\t\t\tgl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );\t\t\t\t}"})}});THREE.UnrealBloomPass.BlurDirectionX=new THREE.Vector2(1,0);THREE.UnrealBloomPass.BlurDirectionY=new THREE.Vector2(0,1)},function(e,t){THREE.PosterShader={uniforms:{tDiffuse:{value:null}},vertexShader:`\n    varying vec2 vUv;\n\n    void main() {\n      vUv = uv;\n      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n    }\n  `,fragmentShader:`\n    #define PI 3.14159\n    #define UV_SCALE 0.02\n    #define MAX_HEIGHT 0.5\n    varying vec2 vUv;\n    uniform sampler2D tDiffuse;\n\n    float posterise(float val, float amount) {\n      return floor(val * amount) / amount;\n    }\n\n    float posteriseCeil(float val, float amount) {\n      return ceil(val * amount) / amount;\n    }\n\n    void main() {\n      vec4 frag = texture2D(tDiffuse, vUv);\n      frag.r = posterise(frag.r, 16.0);\n      gl_FragColor = frag;\n    }\n  `};THREE.PosterPass=function(e){THREE.Pass.call(this);this.size=e;this.shader=THREE.PosterShader;this.material=new THREE.ShaderMaterial(this.shader);this.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1);this.scene=new THREE.Scene;this.quad=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),this.material);this.quad.frustumCulled=false;this.scene.add(this.quad);this.time=0};THREE.PosterPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.PosterPass,render:function(e,t,i,r,s){this.shader.uniforms["tDiffuse"].value=i.texture;if(this.renderToScreen){e.render(this.scene,this.camera)}else{e.render(this.scene,this.camera,t,this.clear)}}})},function(e,t,i){"use strict";i.r(t);class r{constructor(e){this.root=e;this.position=e.player.position;this.rotation=e.player.rotation;this.height=e.player.height;this.target=new THREE.Vector3;this.fov=65;this.aspectRatio=this.root.width/this.root.height;this.offset=.1;this.camera=new THREE.PerspectiveCamera(this.fov,this.aspectRatio,.1,2e6);this.camera.up=new THREE.Vector3(0,1,0);this.camera.rotation.order="YXZ"}addListener(){this.listener=new THREE.AudioListener;this.camera.add(this.listener)}resize(e,t){this.aspectRatio=this.root.width/this.root.height;this.camera.aspect=this.aspectRatio;this.camera.updateProjectionMatrix()}update(e){const t=this.offset-this.offset*Math.abs(Math.sin(this.rotation.y));const i=this.offset;const r=this.position.y+this.height;this.camera.position.set(this.position.x,this.position.y+this.height,this.position.z);this.camera.rotation.y=this.rotation.x+Math.PI;this.camera.rotation.x=this.rotation.y}}var s=r;const a=(e,t,i)=>{return(t-e)*i+e};const o=function(e,t){return Math.atan2(Math.sin(t-e),Math.cos(t-e))};const n=e=>{return Math.random()*e-e/2};const l=Math.PI*2;const h=(e,t,i)=>{return Math.min(i,Math.max(t,e))};class c{constructor(e){this.root=e;this.isDev=window.location.host.indexOf("localhost")!=-1;this.position=new THREE.Vector3(-24,1,16);this.rotation=new THREE.Vector2(Math.PI*.55,Math.PI*-.05);if(this.isDev){}this.motion=new THREE.Vector3;this.target={position:this.position.clone(),rotation:this.rotation.clone(),motion:this.motion.clone()};this.collider=new Collider.Collider(this.target.position,this.motion);this.collider.setPhysics({gravity:20});this.automove={active:{position:true,rotation:true},speed:{current:0,max:7.5,blend:.125},rotationSpeed:{current:0,max:Math.PI/2.5,accum:Math.PI/70},position:this.position.clone(),rotation:this.isDev?this.rotation.clone():new THREE.Vector2(Math.PI*.55,Math.PI*.03),threshold:{position:{outer:2,inner:.02},rotation:Math.PI/1e3}};this.speed=6;this.rotationSpeed=Math.PI*.5;this.jump=8;this.jumpSpeedMultiplier=.25;this.height=3;this.falling=false;this.fallTime=0;this.fallTimeThreshold=.2;this.noclip=false;this.noclipSpeed=36;this.toggleNoclip=(()=>{this.noclip=this.noclip==false});this.minPitch=Math.PI*-.125;this.maxPitch=Math.PI*.125;this.adjust={slow:.05,normal:.1,fast:.125,maximum:.3};this.keys={disabled:true};this.group=new THREE.Group;this.light=new THREE.PointLight(16777215,.75,12,2);this.light.position.y=this.height+.25;this.group.add(this.light);this.root.scene.add(this.group)}resetPosition(){this.position.set(-24,1,16);this.rotation.set(Math.PI*.55,Math.PI*-.05);this.target.position.copy(this.position);this.target.rotation.copy(this.rotation);this.automove.active.position=true;this.automove.active.rotation=true;this.automove.position.copy(this.position);this.automove.rotation.set(Math.PI*.55,Math.PI*.03)}move(e){if(this.keys.left||this.keys.right){if(this.automove.active.rotation){this.target.rotation.copy(this.rotation);this.automove.active.rotation=false}const t=(this.keys.left?1:0)+(this.keys.right?-1:0);this.target.rotation.x+=t*this.rotationSpeed*e}if(this.keys.up||this.keys.down){if(this.automove.active.position){this.automove.active.position=false;this.target.position.copy(this.position)}const e=this.noclip?this.noclipSpeed*(1-Math.abs(Math.sin(this.target.rotation.y))):this.speed;const t=(this.keys.up?1:0)+(this.keys.down?-1:0);this.target.motion.x=Math.sin(this.rotation.x)*e*t;this.target.motion.z=Math.cos(this.rotation.x)*e*t}else{this.target.motion.x=0;this.target.motion.z=0}if(this.keys.jump){if(this.motion.y==0||this.fallTime<this.fallTimeThreshold){this.motion.y=this.jump;this.fallTime=this.fallTimeThreshold}}this.falling=this.motion.y!=0;this.fallTime=this.falling?this.fallTime+e:0;if(this.noclip){this.falling=false;if(this.keys.up||this.keys.down){const e=(this.keys.up?1:0)+(this.keys.down?-1:0);this.target.motion.y=Math.sin(this.target.rotation.y)*e*this.noclipSpeed}else{this.target.motion.y=0}this.motion.y=this.target.motion.y}if(!this.falling){this.motion.x=this.target.motion.x;this.motion.z=this.target.motion.z}else{this.motion.x=a(this.motion.x,this.target.motion.x,this.jumpSpeedMultiplier);this.motion.z=a(this.motion.z,this.target.motion.z,this.jumpSpeedMultiplier)}}moveToArtwork(e){if(this.position.distanceTo(e.viewPosition)>this.automove.threshold.position.outer){this.automove.position.copy(e.viewPosition);this.automove.active.position=true;this.automove.rotation.copy(e.viewRotation);this.automove.active.rotation=true}}applyAutomove(e){if(this.automove.active.position){const t=this.automove.position.clone();t.sub(this.position);const i=t.length();t.normalize();if(i>this.automove.threshold.position.outer){this.automove.speed.current+=(this.automove.speed.max-this.automove.speed.current)*this.automove.speed.blend;t.multiplyScalar(this.automove.speed.current*e);this.position.add(t)}else{if(i>this.automove.threshold.position.inner){const r=this.automove.speed.max*(i/this.automove.threshold.position.outer);this.automove.speed.current+=(r-this.automove.speed.current)*this.automove.speed.blend;t.multiplyScalar(this.automove.speed.current*e);this.position.add(t)}else{this.target.position.copy(this.automove.position);this.automove.active.position=false;this.keys.disabled=false}}}else{this.automove.speed.current=0}if(this.automove.active.rotation){this.automove.rotationSpeed.current=Math.min(this.automove.rotationSpeed.current+this.automove.rotationSpeed.accum,this.automove.rotationSpeed.max);const t=o(this.rotation.x,this.automove.rotation.x);const i=o(this.rotation.y,this.automove.rotation.y);const r=Math.hypot(t,i);this.rotation.x+=t*this.automove.rotationSpeed.current*e;this.rotation.y+=i*this.automove.rotationSpeed.current*e;if(r<this.automove.threshold.rotation){this.automove.active.rotation=false;this.target.rotation.copy(this.automove.rotation)}}else{this.automove.rotationSpeed.current=0}}setRotation(e,t){this.target.rotation.y=e;this.target.rotation.x=t;this.automove.active.rotation=false}getTargetPosition(){return this.target.position}update(e){this.applyAutomove(e);if(!this.keys.disabled&&!this.automove.active.position){this.move(e);if(!this.noclip){this.collider.move(e,this.root.colliderSystem)}else{this.target.position.x+=this.motion.x*e;this.target.position.y+=this.motion.y*e;this.target.position.z+=this.motion.z*e}this.position.x=a(this.position.x,this.target.position.x,this.adjust.maximum);this.position.y=a(this.position.y,this.target.position.y,this.adjust.maximum);this.position.z=a(this.position.z,this.target.position.z,this.adjust.maximum)}if(!this.automove.active.rotation){this.rotation.x+=o(this.rotation.x,this.target.rotation.x)*this.adjust.normal;this.rotation.y=a(this.rotation.y,this.target.rotation.y,this.adjust.normal)}this.group.position.set(this.position.x,this.position.y,this.position.z)}}var u=c;var d=i(0);class p{constructor(e){this.scene=e.scene;this.sky=new THREE.Sky;this.sky.scale.setScalar(45e4);const t=4e5;const i=.25;const r=.4875;const s=Math.PI*(r-.5);const a=Math.PI*2*(i-.5);const o=new THREE.Vector3(t*Math.cos(a),t*Math.sin(a)*Math.sin(s),t*Math.sin(a)*Math.cos(s));this.sky.material.uniforms.sunPosition.value.copy(o);this.scene.add(this.sky);this.lights={point:{},ambient:{},directional:{},hemisphere:{},spot:{}};this.lights.point.a=new THREE.PointLight(16777215,1,24,2);this.lights.point.b=new THREE.PointLight(16777215,1,32,2);this.lights.point.c=new THREE.PointLight(16777215,1,20,2);this.lights.ambient.a=new THREE.AmbientLight(16777215,.3);this.lights.directional.a=new THREE.DirectionalLight(16777215,.5);this.lights.hemisphere.a=new THREE.HemisphereLight(0,255,.25);this.lights.spot.a=new THREE.SpotLight(16777215,1,32,Math.PI/3,.25);this.reloadExhibition()}reloadExhibition(){this.lights.point.a.position.set(-8,10,14);this.lights.point.b.position.set(0,10,-4);this.lights.point.c.position.set(26,10,6);this.lights.directional.a.position.set(-1,1.5,-1);this.lights.spot.a.position.set(0,10,14);this.lights.spot.a.target.position.set(-4,0,6);this.lights.point.a.distance=24;this.lights.hemisphere.a.intensity=.25;this.lights.ambient.a.intensity=.3;Object.keys(this.lights).forEach(e=>{Object.keys(this.lights[e]).forEach(t=>{const i=this.lights[e][t];this.scene.add(i);if(i.isSpotLight){this.scene.add(i.target)}})});const e=document.querySelector(".active-exhibition-data .custom-exhibition-installation");if(e){switch(e.dataset.value){case"TIYAN":this.scene.remove(this.lights.directional.a);this.scene.remove(this.lights.point.b);this.lights.ambient.a.intensity=.1;this.lights.point.b.position.set(6,10,14);this.lights.point.a.position.set(2,9,18);this.lights.point.a.distance=26;this.lights.point.c.position.set(-22,8,18);this.lights.hemisphere.a.intensity=.01;break;case"JACK_DE_LACY":default:this.scene.remove(this.lights.spot.a);this.scene.remove(this.lights.spot.a.target);break}}}}var f=p;class v{constructor(e){this.path=`${APP_ROOT}/${e}/`;this.mat={};this.mat.default=new THREE.MeshPhysicalMaterial({emissive:0,roughness:1,envMapIntensity:.25});this.mat.porcelain=new THREE.MeshPhysicalMaterial({color:16777215,emissive:8947848,emissiveIntensity:.6,roughness:.55,metalness:.125,envMapIntensity:.5});this.mat.metal=new THREE.MeshPhysicalMaterial({color:11046521,emissive:0,roughness:.25,metalness:1,envMapIntensity:.5});this.mat.neon=new THREE.MeshPhysicalMaterial({emissive:16777215,emissiveIntensity:1});this.mat.dark=new THREE.MeshPhysicalMaterial({color:0,roughness:.5,metalness:0});const t=["posx","negx","posy","negy","posz","negz"].map(e=>`${this.path}envmap/${e}.jpg`);this.envMap=(new THREE.CubeTextureLoader).load(t);this.normalMap=(new THREE.TextureLoader).load(this.path+"textures/noise.jpg");this.normalMap.wrapS=this.normalMap.wrapT=THREE.RepeatWrapping;this.normalMap.repeat.set(32,32);Object.keys(this.mat).forEach(e=>{if(this.mat[e].type&&this.mat[e].type==="MeshPhysicalMaterial"){this.mat[e].envMap=this.envMap}});this.uniforms={time:{value:0}};this.loaded={}}conformGroup(e){if(e.type==="Mesh"){this.conformMaterial(e.material)}else if(e.children&&e.children.length){e.children.forEach(e=>{this.conformGroup(e)})}}conformMaterial(e){if(!this.loaded[e.name]){this.loaded[e.name]=e}e.envMap=this.envMap;e.envMapIntensity=.5;switch(e.name){case"concrete":e.normalScale.x=.25;e.normalScale.y=.25;break;case"gold":break;case"neon":case"neon1":e.emissive=new THREE.Color(1,1,1);e.emissiveIntensity=1;break;case"nu_metal":e.normalScale.x=.25;e.normalScale.y=.25;break;case"plastic":break;default:break}}getCustomMaterial(e){const t=e.clone();t.onBeforeCompile=(e=>{e.vertexShader=`uniform float time;\n${e.vertexShader}`;const t=`\n        vec4 mvp = modelMatrix * vec4(position, 1.0);\n        float theta = sin(time * 0.1 + mvp.x / 2.0);\n        float c = cos(theta);\n        float s = sin(theta);\n        float off = 1.0 * sin(time + position.x * 200.0);\n        mat3 roty = mat3(c, 0, s, 0, 1, 0, -s, 0, c);\n        //mat4 m = mat4(1, 0, 0, 0, 0, 1, 0, s * off * 2.0, 0, 0, 1, s * off, 0, 0, 0, 1);\n        vec3 p = position;\n        vec4 t = vec4(p.x + 0.25 * sin(time + p.y), p.y, p.z + 0.25 * cos(time + p.y), 1.0);\n        vec3 transformed = vec3(t.x, t.y, t.z);\n        vNormal = vNormal * roty;\n      `;e.vertexShader=e.vertexShader.replace("#include <begin_vertex>",t);e.uniforms.time=this.uniforms.time});return t}update(e){this.uniforms.time.value+=e}}var m=v;var g=i(1);var E=i(2);var y=i(3);class b{constructor(e){this.path=`${APP_ROOT}/${e}/`;this.materials={};this.images={};this.loaderFBX=new THREE.FBXLoader;this.loaderOBJ=new THREE.OBJLoader}loadFBX(e){return new Promise((t,i)=>{try{this.loaderFBX.load(this.path+e+".fbx",e=>{t(e)})}catch(e){console.log(e);i(e)}})}loadOBJ(e){return new Promise((t,i)=>{try{this.loaderOBJ.load(this.path+e+".obj",e=>{t(e)})}catch(e){console.log(e);i(e)}})}}var T=b;class w{constructor(e){this.root=e;this.scene=e.scene;this.colliderSystem=e.colliderSystem;this.materials=new m("assets");this.loader=new T("assets");this.loadScene();this.reloadInstallation()}loadScene(){this.floor=new THREE.Mesh(new THREE.BoxBufferGeometry(100,1,100),new THREE.MeshPhongMaterial({}));this.floor.position.y=-.25;this.colliderSystem.add(this.floor);this.toLoad=2;this.checkLoaded=(()=>{this.toLoad-=1;if(this.toLoad==0){const e=document.querySelector("#open-gallery");e.classList.remove("is-loading");e.classList.add("flash");e.innerHTML='<span class="mobile-show">&larr;&nbsp;Open Gallery</span><span class="mobile-hide">Open Gallery</span>'}});this.loader.loadFBX("map").then(e=>{this.scene.add(e);this.materials.conformGroup(e);this.checkLoaded()},e=>{console.log(e)});this.loader.loadOBJ("collision").then(e=>{this.defaultCollisionMap=e;this.addCollisionMap(e);this.checkLoaded()},e=>{console.log(e)});this.loader.loadFBX("props").then(e=>{this.scene.add(e);this.materials.conformGroup(e)});const e=.1;const t=4;for(var i=-16;i<=16;i+=8){const r=19;const s=new THREE.Mesh(new THREE.BoxBufferGeometry(e,e,t),this.materials.mat.neon);const a=new THREE.Mesh(new THREE.BoxBufferGeometry(e,e*4,t),this.materials.mat.dark);const o=new THREE.Mesh(new THREE.BoxBufferGeometry(e,1,e),this.materials.mat.dark);const n=o.clone();s.position.set(i,r,6);a.position.set(i,r+e*2.5,6);o.position.set(i,r+e*4.5+.5,6+t/3);n.position.set(i,r+e*4.5+.5,6-t/3);o.rotation.y=Math.PI/4;n.rotation.y=Math.PI/4;this.scene.add(s,a,o,n)}}reloadInstallation(){if(this.customExhibitionActive&&this.installation){this.installation.forEach(e=>{if(e.object){this.scene.remove(e.object)}});this.root.colliderSystem=new Collider.System;this.colliderSystem=this.root.colliderSystem;this.addCollisionMap(this.defaultCollisionMap)}this.customExhibitionActive=false;this.updateCustomExhibition=false;this.installation=[];const e=document.querySelector(".active-exhibition-data .custom-exhibition-installation");if(e){const i=e.dataset.value;switch(i){case"JACK_DE_LACY":this.installation=[{src:"jack_de_lacy/sculpture_1",scale:.6,rot:Math.PI/32,orientZ:Math.PI/4},{src:"jack_de_lacy/sculpture_2",scale:.5,rot:-Math.PI/32,orientZ:0},{src:"jack_de_lacy/sculpture_3",scale:.5,rot:Math.PI/32,orientZ:0}];for(var t=0;t<this.installation.length;++t){const e=t;this.loader.loadFBX(this.installation[e].src).then(t=>{const i=this.installation[e];t.children.forEach(t=>{this.materials.conformMaterial(t.material);t.material=this.materials.getCustomMaterial(t.material);if(e==2){t.material.side=THREE.DoubleSide}t.material.envMapIntensity=.25});t.scale.multiplyScalar(i.scale);t.rotation.z=i.orientZ;t.position.set(-12+e*12,14,6);this.scene.add(t);i.object=t;i.active=true},e=>{console.log(e)})}this.customExhibitionActive=true;this.updateCustomExhibition=(e=>{this.installation.forEach(t=>{if(t.active){t.object.rotation.y+=t.rot*e}})});break;case"TIYAN":this.installation=[{src:"tiyan/separators"}];this.installation.forEach(e=>{this.loader.loadFBX(e.src).then(t=>{this.materials.conformGroup(t);this.scene.add(t);e.object=t})});const e=new THREE.Mesh(new THREE.BoxBufferGeometry(14,4,1.5),new THREE.MeshStandardMaterial({}));const r=new THREE.Mesh(new THREE.BoxBufferGeometry(1.5,4,16),new THREE.MeshStandardMaterial({}));e.position.set(-23,1,6);r.position.set(17.25,1,15.5);this.colliderSystem.add(e);this.colliderSystem.add(r);this.customExhibitionActive=true;break;default:break}}}addCollisionMap(e){if(e.type==="Mesh"){this.colliderSystem.add(e)}else if(e.children&&e.children.length){e.children.forEach(e=>{this.addCollisionMap(e)})}}loadExperimental(){this.treeParse=(e=>{if(e.type=="Mesh"){if(e.material.transparent){console.log(e.material);e.material.color.set(16777215);e.material.side=THREE.DoubleSide;e.material.flatShading=true}}else if(e.children){e.children.forEach(e=>{this.treeParse(e)})}});this.loader.loadFBX("tree/tree2").then(e=>{console.log(e);this.treeParse(e);this.scene.add(e)})}update(e){this.materials.update(e);if(this.customExhibitionActive&&this.updateCustomExhibition){this.updateCustomExhibition(e)}}}var x=w;class R{constructor(){this.element=document.querySelector("#canvas-target");this.width=window.innerWidth;this.height=window.innerHeight;this.scene=new THREE.Scene;this.colliderSystem=new Collider.System;this.player=new u(this);this.camera=new s(this);this.lighting=new f(this);this.map=new x(this)}resize(){const e=this.element.getBoundingClientRect();this.width=e.width;this.height=e.height;this.camera.resize()}reloadExhibition(){this.map.reloadInstallation();this.lighting.reloadExhibition();this.player.resetPosition()}update(e){this.player.update(e);this.camera.update(e);this.map.update(e)}}var M=R;var k=i(4);var S=i(5);var H=i(6);var P=i(7);var z=i(8);var L=i(9);var C=i(10);class I{constructor(e,t){this.root=t;this.scene=t.scene;this.camera=t.camera.camera;this.renderer=new THREE.WebGLRenderer({});this.renderer.setClearColor(4473924,1);this.renderer.gammaInput=true;this.renderer.gammaOutput=true;this.renderer.gammaFactor=2.25;this.padding={x:64,y:96,minX:768,minY:700};this.setSize();const i=.5;const r=.125;const s=.96;this.passRender=new THREE.RenderPass(this.scene,this.camera);this.passPoster=new THREE.PosterPass(this.size);this.passBloom=new THREE.UnrealBloomPass(this.size,i,r,s);this.passBloom.renderToScreen=true;this.composer=new THREE.EffectComposer(this.renderer);this.composer.addPass(this.passRender);this.composer.addPass(this.passPoster);this.composer.addPass(this.passBloom);this.domElement=document.querySelector("#canvas-target");this.domElement.appendChild(this.renderer.domElement);this.resize();t.resize()}setSize(){const e=Math.min(window.innerWidth,Math.max(this.padding.minX,window.innerWidth-this.padding.x*2));const t=Math.min(window.innerHeight,Math.max(this.padding.minY,window.innerHeight-this.padding.y*2));this.width=e;this.height=t;if(!this.size){this.size=new THREE.Vector2(this.width,this.height)}else{this.size.x=this.width;this.size.y=this.height}}resize(){this.setSize();this.domElement.style.width=`${this.width}px`;this.domElement.style.height=`${this.height}px`;this.renderer.setSize(this.width,this.height);this.composer.setSize(this.width,this.height);this.passBloom.setSize(this.width,this.height)}draw(e){this.composer.render(e)}}var A=I;class D{constructor(e,t,i){this.root=e;this.cvs=document.createElement("canvas");this.ctx=this.cvs.getContext("2d");this.domElement=t;this.canvasTarget=i;this.resize();this.domElement.appendChild(this.cvs);this.prompt={};this.prompt.touchMove={alpha:{current:0,min:0,max:1},size:{current:12,min:12,max:24}};this.prompt.click={alpha:{current:0,min:0,max:1}}}clear(){this.ctx.clearRect(0,0,this.cvs.width,this.cvs.height);this.ctx.font="15px Karla";this.ctx.strokeStyle="#fff";this.ctx.fillStyle="#fff";this.ctx.lineWidth=1.5;this.ctx.lineCap="round"}resize(){this.cvs.width=this.canvasTarget.width;this.cvs.height=this.canvasTarget.height}promptClick(e,t,i,r){if(t){this.prompt.click.alpha.current+=(this.prompt.click.alpha.max-this.prompt.click.alpha.current)*.2}else{this.prompt.click.alpha.current+=(this.prompt.click.alpha.min-this.prompt.click.alpha.current)*.2}if(this.prompt.click.alpha.current>0){this.ctx.globalAlpha=this.prompt.click.alpha.current;this.ctx.fillText(e,i+12,r+12)}}promptTouchMove(e){if(e){this.prompt.touchMove.alpha.current+=(this.prompt.touchMove.alpha.max-this.prompt.touchMove.alpha.current)*.2;this.prompt.touchMove.size.current+=(this.prompt.touchMove.size.max-this.prompt.touchMove.size.current)*.2}else{this.prompt.touchMove.alpha.current+=(this.prompt.touchMove.alpha.min-this.prompt.touchMove.alpha.current)*.2;this.prompt.touchMove.size.current+=(this.prompt.touchMove.size.min-this.prompt.touchMove.size.current)*.2}if(this.prompt.touchMove.alpha.current>0){const e=this.prompt.touchMove.size.current;const t=e*2;const i=this.cvs.width/2;const r=this.cvs.height/2;this.ctx.globalAlpha=this.prompt.touchMove.alpha.current;this.ctx.beginPath();this.ctx.arc(i,r,e,0,Math.PI*2,false);this.ctx.moveTo(i-e,r);this.ctx.lineTo(i+e,r);this.ctx.moveTo(i,r-4);this.ctx.lineTo(i,r+4);this.ctx.stroke()}}promptGodMode(){this.ctx.globalAlpha=1;this.ctx.fillText("You can fly",20,this.cvs.height-40);const e=Math.round(this.root.player.position.x*10)/10;const t=Math.round(this.root.player.position.y*10)/10;const i=Math.round(this.root.player.position.z*10)/10;const r=Math.round(this.root.player.rotation.x*100)/100;this.ctx.fillText(`${e}, ${t}, ${i}, ${r}`,20,this.cvs.height-20)}drawDevOverlay(){}getContext(){return this.ctx}}var B=D;class F{constructor(e,t,i,r){this.onscreen=true;this.position=e;this.rotation=t;this.clipping=i||null;this.coords=new THREE.Vector2;this.helper=new THREE.Vector3;this.root=r;this.active=true;this.hover=false;this.cornersOK=false;this.clickable=false;this.buttonActive=false;this.buttonRadius=50;this.buttonPosition=new THREE.Vector2;this.buttonPosition.isClamped=false;this.buttonHover=false;this.textColour=Math.abs(e.x)<=16&&(e.z>10||e.z<0)?"#000":"#fff";this.radius={min:this.root.isMobile?10:9,max:32};this.corners={world:{a:new THREE.Vector3,b:new THREE.Vector3,c:new THREE.Vector3,d:new THREE.Vector3},screen:{a:new THREE.Vector2,b:new THREE.Vector2,c:new THREE.Vector2,d:new THREE.Vector2}};this.distance=-1;this.resize()}setCorners(){const e=this.root.position;const t=this.root.direction;const i=this.root.board.scale;const r=.5;const s=t.x*this.root.thickness/2;const a=t.z*this.root.thickness/2;this.corners.world.a.set(e.x-(t.x!=0?0:i.x*r)+s,e.y+i.y*r,e.z-(t.z!=0?0:i.z*r)+a);this.corners.world.b.set(e.x+(t.x!=0?0:i.x*r)+s,e.y+i.y*r,e.z+(t.z!=0?0:i.z*r)+a);this.corners.world.c.set(e.x+(t.x!=0?0:i.x*r)+s,e.y-i.y*r,e.z+(t.z!=0?0:i.z*r)+a);this.corners.world.d.set(e.x-(t.x!=0?0:i.x*r)+s,e.y-i.y*r,e.z-(t.z!=0?0:i.z*r)+a)}pointToScreen(e,t,i,r){const s=e.clone();s.project(t);r.x=(s.x+1)*i.x;r.y=(-s.y+1)*i.y}updateCorners(e,t){this.pointToScreen(this.corners.world.a,e,t,this.corners.screen.a);this.pointToScreen(this.corners.world.b,e,t,this.corners.screen.b);this.pointToScreen(this.corners.world.c,e,t,this.corners.screen.c);this.pointToScreen(this.corners.world.d,e,t,this.corners.screen.d);this.cornersOK=this.corners.screen.a.y<this.corners.screen.c.y&&this.corners.screen.b.y<this.corners.screen.d.y&&Math.abs(this.corners.screen.a.x-this.corners.screen.b.x)<window.innerWidth&&!(this.corners.screen.a.x<0&&this.corners.screen.c.x<0)&&!(this.corners.screen.a.x>this.rect.width&&this.corners.screen.c.x>this.rect.width);this.buttonPosition.x=Math.max(this.corners.screen.c.x,this.corners.screen.d.x);this.buttonPosition.y=(this.buttonPosition.x==this.corners.screen.c.x?this.corners.screen.c.y:this.corners.screen.d.y)+18;this.buttonPosition.isClamped=(this.buttonPosition.x>this.rect.width||this.buttonPosition.y>this.rect.height)&&this.rect.width>Math.min(this.corners.screen.a.x,this.corners.screen.b.x)&&this.rect.width>Math.min(this.corners.screen.c.x,this.corners.screen.d.x);if(this.buttonPosition.isClamped){this.buttonPosition.x=this.rect.width-16;this.buttonPosition.y=this.rect.height-16}}disableInfoTag(){this.infoTagDisabled=true}isCorrectQuadrant(e){return e.x<=-16||e.x>=16||this.position.x>=16||this.position.x<=-16||e.z>=6&&this.position.z>=6||e.z<=6&&this.position.z<=6}mouseOver(e,t,i){if(this.active&&this.onscreen&&this.cornersOK&&this.isCorrectQuadrant(i)){const i=Math.min(this.corners.screen.a.x,this.corners.screen.b.x,this.corners.screen.c.x,this.corners.screen.d.x)-10;const r=Math.max(this.corners.screen.a.x,this.corners.screen.b.x,this.corners.screen.c.x,this.corners.screen.d.x)+10;const s=Math.min(this.corners.screen.a.y,this.corners.screen.b.y)-10;const a=Math.max(this.corners.screen.c.y,this.corners.screen.d.y)+10;this.buttonHover=this.buttonActive&&Math.hypot(this.buttonPosition.x-e,this.buttonPosition.y-t)<this.buttonRadius+10;this.hover=this.buttonHover||e>=i&&e<=r&&t>=s&&t<=a;if(this.buttonPosition.isClamped&&!this.hover){this.hover=this.buttonPosition.x>r&&e>=r-100&&t>=this.rect.height-100}}else{this.hover=false;this.buttonHover=false}this.setClickable()}setClickable(){this.clickable=this.onscreen&&this.active&&this.hover&&this.cornersOK}isClickable(){return this.clickable}calculateNodePosition(e,t,i){this.helper.copy(e.position);this.helper.sub(this.position);this.helper.normalize();if(this.helper.dot(t)<=0){this.onscreen=true;this.helper.copy(this.position);this.helper.project(e);this.coords.x=(this.helper.x+1)*i.x;this.coords.y=(-this.helper.y+1)*i.y}else{this.onscreen=false}if(this.clipping&&this.onscreen){this.helper.copy(e.position);this.helper.sub(this.position);if(this.helper.dot(this.clipping)<0){this.onscreen=false}}}update(e,t,i,r,s){this.calculateNodePosition(i,r,s);this.distance=t.position.distanceTo(this.position);this.active=this.distance<=this.radius.max;if(this.active){this.updateCorners(i,s);this.buttonActive=this.distance<=this.radius.min}this.setClickable()}draw(e){if(this.clickable){e.globalAlpha=1;e.beginPath();e.moveTo(this.corners.screen.a.x,this.corners.screen.a.y);e.lineTo(this.corners.screen.b.x,this.corners.screen.b.y);e.lineTo(this.corners.screen.c.x,this.corners.screen.c.y);e.lineTo(this.corners.screen.d.x,this.corners.screen.d.y);e.closePath();e.stroke();if(this.buttonActive){e.fillStyle=this.textColour;e.textAlign="right";e.globalAlpha=this.buttonHover&&!this.infoTagDisabled?.6:1;if(!this.infoTagDisabled){e.fillText("[INFO]",this.buttonPosition.x,this.buttonPosition.y)}}return true}return false}resize(){this.rect=document.querySelector("#canvas-target").getBoundingClientRect()}}var N=F;class O{constructor(e,t,i,r,s){this.sceneRef=e;this.radius=17;this.refDistance=2;this.rolloff=1.4;this.active=true;this.video=document.createElement("video");this.video.src=t;this.video.muted="muted";this.video.loop=true;this.video.load();if(i!==""){this.object3D=new THREE.Object3D;this.object3D.position.copy(r);this.sceneRef.add(this.object3D);this.cameraRef=s;this.audioSrc=i;this.audioRequired=true}else{this.audioRequired=false}}initAudio(){if(!this.cameraRef.listener){this.cameraRef.addListener()}this.audio=new THREE.PositionalAudio(this.cameraRef.listener);this.audioContext=this.audio.context;this.audioLoader=new THREE.AudioLoader;this.audioLoader.load(this.audioSrc,e=>{if(this.active){this.audio.setBuffer(e);this.audio.setRefDistance(this.refDistance);this.audio.setRolloffFactor(this.rolloff);this.audio.setDistanceModel("exponential");this.audio.loop=true;this.audio.setVolume(0);this.audio.play();this.syncTracks();this.fadeInRequired=true}});this.object3D.add(this.audio);this.audioRequired=false}fadeInAudio(){if(this.active){const e=Math.min(1,this.audio.getVolume()+.01);if(e==1){this.fadeInRequired=false}this.audio.setVolume(e)}}pauseVideo(){if(!this.video.paused){this.video.pause()}}resumeVideo(){if(this.video.paused){this.syncTracks();this.video.play()}}syncTracks(){if(this.audioContext){const e=this.audioContext.currentTime;this.video.currentTime=e>this.video.duration?e%this.video.duration:e}}update(e){if(this.audioRequired){this.initAudio()}if(this.fadeInRequired){this.fadeInAudio()}if(this.object3D.position.distanceTo(e)>this.radius){this.pauseVideo()}else{this.resumeVideo()}}destroy(){this.active=false;if(this.object3D){this.sceneRef.remove(this.object3D);if(this.audio&&this.audio.isPlaying){this.object3D.remove(this.audio);this.audio.pause()}}if(this.video){this.video.pause()}}getElement(){return this.video}}var j=O;class U{constructor(e,t,i,r){this.root=e;this.id=t;this.isMobile=r;this.element=i;this.active=false;this.position=new THREE.Vector3;this.direction=new THREE.Vector3;this.nearRadius=5;this.thickness=.2;this.artworkMenuActive=true;this.data={url:i.dataset.url,title:i.dataset.title||"",subtitle:i.dataset.subtitle||"",desc:i.dataset.desc||"",link:i.dataset.link||"",width:parseFloat(i.dataset.width),offset:{horizontal:parseFloat(i.dataset.hoff),vertical:parseFloat(i.dataset.voff)},videoUrl:i.dataset.videofile||"",audioUrl:i.dataset.audiofile||"",index:i.dataset.location?parseInt(i.dataset.location)-1:-1}}init(e,t,i){this.sceneReference=e;const r=this.thickness/2+.01;this.board=new THREE.Mesh(new THREE.BoxBufferGeometry(1,1,1),new THREE.MeshStandardMaterial({color:0,roughness:.75,metalness:0}));this.plane=new THREE.Mesh(new THREE.PlaneBufferGeometry(1,1),new THREE.MeshStandardMaterial({roughness:1,metalness:.5}));this.baseY=t.y;t.x+=(i.x!=0?0:1)*this.data.offset.horizontal;t.y+=this.data.offset.vertical;t.z+=(i.z!=0?0:1)*this.data.offset.horizontal;this.plane.position.set(t.x+i.x*r,t.y,t.z+i.z*r);this.position.set(t.x,t.y,t.z);this.direction.set(i.x,i.y,i.z);this.node=new N(t,null,i,this);const s=this.isMobile?1.5:.9;this.viewPosition=new THREE.Vector3;this.viewPosition.y=Math.min(7.8,this.baseY-3);this.viewPosition.x=t.x+i.x*Math.min((t.y-this.viewPosition.y)*s,8);this.viewPosition.z=t.z+i.z*Math.min((t.y-this.viewPosition.y)*s,8);if(t.x>20&&t.z<-10){this.viewPosition.set(28,4.4,-8)}else if(t.x<-20&&t.z<-10){this.viewPosition.set(-28,4.4,-8)}this.viewRotation=new THREE.Vector2;this.viewRotation.y=Math.atan2(t.y-(this.viewPosition.y+this.root.player.height)-.125,Math.hypot(t.x-this.viewPosition.x,t.z-this.viewPosition.z));this.viewRotation.x=Math.atan2(t.x-this.viewPosition.x,t.z-this.viewPosition.z);this.board.scale.x=i.x!=0?this.thickness:1;this.board.scale.z=i.z!=0?this.thickness:1;this.board.position.set(t.x,t.y,t.z);let a;if(this.data.videoUrl!==""){const e=new THREE.Vector3;e.copy(this.plane.position);e.x+=i.x/2;e.z+=i.z/2;this.videoElement=new j(this.sceneReference,this.data.videoUrl,this.data.audioUrl,e,this.root.root.scene.camera);a=new THREE.VideoTexture(this.videoElement.getElement());const t=this.data.width;const r=t*(1080/1920);this.plane.scale.x=t;this.plane.scale.y=r;this.board.scale.x=i.x!=0?this.thickness:t;this.board.scale.y=r;this.board.scale.z=i.z!=0?this.thickness:t;this.node.setCorners()}else{a=(new THREE.TextureLoader).load(this.data.url,e=>{const t=this.data.width*(e.image.naturalHeight/e.image.naturalWidth);this.plane.scale.x=this.data.width;this.plane.scale.y=t;this.board.scale.x=i.x!=0?this.thickness:this.data.width;this.board.scale.y=t;this.board.scale.z=i.z!=0?this.thickness:this.data.width;this.node.setCorners()})}this.plane.material.map=a;a.wrapS=a.wrapT=THREE.ClampToEdgeWrapping;a.minFilter=THREE.LinearFilter;if(i.z==1){}else if(i.z==-1){this.plane.rotation.y=Math.PI}else if(i.x==1){this.plane.rotation.y=Math.PI*.5}else if(i.x==-1){this.plane.rotation.y=Math.PI*1.5}e.add(this.plane);e.add(this.board)}mouseOver(e,t,i){this.node.mouseOver(e,t,i)}click(e,t,i){this.node.mouseOver(e,t,i);if(this.node.isClickable()){this.root.moveToArtwork(this);if(!this.isArtworkMenuMine()){this.root.closeArtworkMenu()}if(this.artworkMenuActive&&this.node.buttonActive&&this.node.buttonHover){this.root.openArtworkMenu(this)}return true}return false}disableArtworkMenu(){this.artworkMenuActive=false;this.node.disableInfoTag()}isArtworkMenuMine(){const e=this.root.el.image.querySelector("img");if(e){return this.root.domElement.dataset.active==this.id&&e.src==this.data.url}else{return this.root.domElement.dataset.active==this.id}}update(e,t,i,r,s){this.node.update(e,t,i,r,s);if(this.videoElement){this.videoElement.update(t.position)}}draw(e){return this.node.draw(e)}destroy(){this.sceneReference.remove(this.plane);this.sceneReference.remove(this.board);if(this.videoElement){this.videoElement.destroy()}}removeHover(){this.node.hover=false}forceHover(){this.node.hover=true}getFloorPosition(){return this.floorPosition}isClickable(){return this.node.isClickable()}resize(){this.node.resize()}}var _=U;const V={artworkPositions:[{x:-24,y:4,z:23,nx:0,nz:-1},{x:-10.5,y:3.5,z:23,nx:0,nz:-1},{x:-8,y:3.5,z:23,nx:0,nz:-1},{x:-5.5,y:3.5,z:23,nx:0,nz:-1},{x:5.5,y:3.5,z:23,nx:0,nz:-1},{x:8,y:3.5,z:23,nx:0,nz:-1},{x:10.5,y:3.5,z:23,nx:0,nz:-1},{x:24,y:4,z:23,nx:0,nz:-1},{x:-12,y:3.5,z:8,nx:0,nz:1},{x:-8,y:3.5,z:8,nx:0,nz:1},{x:-4,y:3.5,z:8,nx:0,nz:1},{x:4,y:3.5,z:8,nx:0,nz:1},{x:8,y:3.5,z:8,nx:0,nz:1},{x:12,y:3.5,z:8,nx:0,nz:1},{x:-31,y:4,z:14,nx:1,nz:0},{x:-29.5,y:4,z:6,nx:1,nz:0},{x:-31,y:4,z:-2,nx:1,nz:0},{x:32,y:4,z:14,nx:-1,nz:0},{x:30,y:4,z:6,nx:-1,nz:0},{x:32,y:4,z:-2,nx:-1,nz:0},{x:-12,y:3.5,z:4,nx:0,nz:-1},{x:-8,y:3.5,z:4,nx:0,nz:-1},{x:-4,y:3.5,z:4,nx:0,nz:-1},{x:4,y:3.5,z:4,nx:0,nz:-1},{x:8,y:3.5,z:4,nx:0,nz:-1},{x:12,y:3.5,z:4,nx:0,nz:-1},{x:-8,y:3.5,z:-11.5,nx:0,nz:1},{x:8,y:3.5,z:-11.5,nx:0,nz:1},{x:-24,y:11,z:-11,nx:0,nz:1},{x:-8,y:11,z:-11.5,nx:0,nz:1},{x:8,y:11,z:-11.5,nx:0,nz:1},{x:24,y:11,z:-11,nx:0,nz:1}]};var q=V;class G{constructor(e,t){this.root=e;this.isMobile=t;this.player=this.root.scene.player;this.camera=this.root.scene.camera.camera;this.scene=this.root.scene.scene;this.centre=this.root.centre;this.cameraDirection=new THREE.Vector3;this.artworkActiveRadius=10;this.isDev=window.location.host.indexOf("localhost")!=-1;this.reloadExhibition();this.domElement=document.querySelector("#artwork-target");this.el={image:this.domElement.querySelector(".image"),title:this.domElement.querySelector(".title"),subtitle:this.domElement.querySelector(".subtitle"),desc:this.domElement.querySelector(".desc"),link:this.domElement.querySelector(".link"),close:this.domElement.querySelector(".close-artwork-menu")};this.el.close.addEventListener("click",()=>{this.closeArtworkMenu()})}reloadExhibition(){if(this.artworks){this.artworks.forEach(e=>{try{e.destroy()}catch(e){console.log(e)}})}this.domTarget=".active-exhibition-data";this.artworks=[];var e=0;document.querySelectorAll(`${this.domTarget} .image`).forEach(t=>{this.artworks.push(new _(this,++e,t,this.isMobile))});this.placeArtworks();const t=document.querySelector(".active-exhibition-data .custom-exhibition-installation");if(t){switch(t.dataset.value){case"TIYAN":break;default:break}}}placeArtworks(){const e=[];for(let t=this.artworks.length-1;t>=0;t--){const i=this.artworks[t];if(typeof i.data.index=="number"&&i.data.index>=0&&i.data.index<q.artworkPositions.length){const t=q.artworkPositions[i.data.index];if(e.indexOf(i.data.index)!=-1){console.log("Warning: duplicate slot reference")}else{e.push(i.data.index)}i.init(this.scene,new THREE.Vector3(t.x,t.y,t.z),new THREE.Vector3(t.nx,0,t.nz))}else{console.log("Warning: no slot found.");console.log(this.artworks.splice(t,1))}}}mouseOver(e,t){var i=[];for(var r=0,s=this.artworks.length;r<s;++r){this.artworks[r].mouseOver(e,t,this.player.position);if(this.artworks[r].isClickable()){i.push(this.artworks[r])}}if(i.length>1){var a=100;var o=i[0];for(var r=0;r<i.length;++r){i[r].removeHover();const e=this.player.position.distanceTo(i[r].position);if(e<a){a=e;o=i[r]}}o.forceHover()}if(i.length){this.root.domElement.classList.add("clickable")}else{this.root.domElement.classList.remove("clickable")}}click(e,t){for(var i=0,r=this.artworks.length;i<r;++i){if(this.artworks[i].click(e,t,this.player.position)){break}}}openArtworkMenu(e){document.querySelector("#gallery-controls").classList.add("display-none");document.querySelectorAll(".gallery-menu .menu.active").forEach(e=>{e.classList.remove("active");e.querySelectorAll(".requires-activate").forEach(e=>{e.classList.remove("active")})});const t=document.querySelector("#nav-item-gallery");if(!t.classList.contains("active")){t.parentNode.querySelectorAll(".active").forEach(e=>{e.classList.remove("active")});t.classList.add("active")}if(!e.isArtworkMenuMine()){this.domElement.dataset.active=e.id;this.el.image.innerHTML=`<img src="${e.data.url}"/>`;this.el.title.innerHTML=e.data.title;this.el.subtitle.innerHTML=e.data.subtitle;this.el.desc.innerHTML=e.data.desc;this.el.link.innerHTML=e.data.link?`<a href='${e.data.link}' target='_blank'>Link</a>`:""}this.domElement.classList.add("active")}closeArtworkMenu(){document.querySelector("#gallery-controls").classList.remove("display-none");this.domElement.classList.remove("active")}moveToArtwork(e){this.player.moveToArtwork(e)}update(e){this.camera.getWorldDirection(this.cameraDirection);for(var t=0,i=this.artworks.length;t<i;++t){this.artworks[t].update(e,this.player,this.camera,this.cameraDirection,this.centre)}}draw(e){for(var t=0,i=this.artworks.length;t<i;++t){if(this.artworks[t].draw(e)){break}}}resize(){this.artworks.forEach(e=>{e.resize()})}}var X=G;class W{constructor(e,t,i,r,s){this.x=0;this.y=0;this.origin={x:0,y:0};this.delta={x:0,y:0};this.active=false;this.domElement=e;if(!s){this.domElement.addEventListener("mousedown",t,false);this.domElement.addEventListener("mousemove",i,false);this.domElement.addEventListener("mouseup",r,false);this.domElement.addEventListener("mouseleave",r,false)}else{this.domElement.addEventListener("touchstart",t,false);this.domElement.addEventListener("touchmove",i,false);this.domElement.addEventListener("touchend",r,false)}this.domElement.addEventListener("click",e=>{i(e);r(e)},false)}start(e){this.active=true;this.origin.x=e.offsetX;this.origin.y=e.offsetY}move(e){this.x=e.offsetX;this.y=e.offsetY;this.delta.x=this.x-this.origin.x;this.delta.y=this.y-this.origin.y}stop(){this.active=false}}var Y=W;class ${constructor(e){this.keys={};this.onEvent=e;document.addEventListener("keydown",e=>{this.onKeyDown(e)});document.addEventListener("keyup",e=>{this.onKeyUp(e)})}onKeyDown(e){this.keys[e.key]=true;this.onEvent(e.key)}onKeyUp(e){this.keys[e.key]=false;this.onEvent(e.key)}release(e){this.keys[e]=false}isSpecial(){return this.keys["Shift"]||this.keys["Control"]||this.keys["Alt"]}isControl(){return this.keys["Control"]}isShift(){return this.keys["Shift"]}isAlt(){return this.keys["Alt"]}}var K=$;class Z{constructor(e,t,i){this.scene=e;this.isMobile=i;this.player=this.scene.player;this.domElement=document.querySelector("#canvas-target");this.domArtworkTarget=document.querySelector("#artwork-target");this.centre={x:0,y:0};this.setSize();this.rotation=new THREE.Vector2;this.timestamp=null;this.threshold={click:225,pan:200,mouseDelta:i?.5:.25};this.scaleRotation={x:i?.75:1,y:1};document.querySelectorAll("#gallery-controls .controls__inner .control").forEach(e=>{if(!i){e.addEventListener("mousedown",e=>{this.onControlDown(e.currentTarget)});e.addEventListener("mouseup",e=>{this.onControlUp(e.currentTarget)});e.addEventListener("mouseleave",e=>{this.onControlLeave(e.currentTarget)})}else{e.addEventListener("touchstart",e=>{e.preventDefault();this.onControlDown(e.currentTarget)});e.addEventListener("touchend",e=>{e.preventDefault();this.onControlUp(e.currentTarget)})}});this.controls={up:document.querySelector("#ctrl-U"),down:document.querySelector("#ctrl-D"),left:document.querySelector("#ctrl-L"),right:document.querySelector("#ctrl-R")};this.keyboard=new K(e=>{this.onKeyboard(e)});if(!this.isMobile){this.mouse=new Y(this.domElement,e=>{this.onMouseDown(e)},e=>{this.onMouseMove(e)},e=>{this.onMouseUp(e)},this.isMobile)}else{this.mouse=new Y(this.domElement,e=>{e.preventDefault();this.onMouseDown(this.processTouch(e))},e=>{e.preventDefault();this.onMouseMove(this.processTouch(e))},e=>{e.preventDefault();this.onMouseUp(this.processTouch(e))},this.isMobile)}this.canvas=new B(this,this.domElement,t.renderer.domElement);this.floorPlan=new X(this,i)}processTouch(e){var t=0;var i=0;if(e.targetTouches&&e.targetTouches.length){const r=this.domElement.getBoundingClientRect();const s=e.targetTouches[0];t=s.pageX-r.left;i=s.pageY-r.top}return{offsetX:t,offsetY:i}}onMouseDown(e){this.rotation.y=this.player.rotation.y;this.rotation.x=this.player.rotation.x;this.timestamp=Date.now();this.mouse.start(e);if(this.isMobile){this.onMouseMove(e)}}onMouseMove(e){this.mouse.move(e);if(this.mouse.active){if(!(this.player.keys.left||this.player.keys.right)){const t=this.rotation.x+this.mouse.delta.x/this.centre.x*this.scaleRotation.x;const i=h(this.rotation.y+this.mouse.delta.y/this.centre.y*this.scaleRotation.y,this.player.minPitch,this.player.maxPitch);if(i==this.player.minPitch||i==this.player.maxPitch){this.mouse.origin.y=e.offsetY;this.rotation.y=i}this.player.setRotation(i,t)}}else{this.floorPlan.mouseOver(this.mouse.x,this.mouse.y)}}onMouseUp(e){this.mouse.stop();if(Date.now()-this.timestamp<this.threshold.click&&Math.hypot(this.mouse.delta.x,this.mouse.delta.y)<window.innerWidth*this.threshold.mouseDelta){this.floorPlan.click(this.mouse.x,this.mouse.y)}}onControlUp(e){switch(e.dataset.dir){case"up":this.player.keys.up=false;break;case"down":this.player.keys.down=false;break;case"left":this.player.keys.left=false;break;case"right":this.player.keys.right=false;break;default:break}e.classList.remove("active")}onControlDown(e){switch(e.dataset.dir){case"up":this.player.keys.up=true;break;case"down":this.player.keys.down=true;break;case"left":this.player.keys.left=true;break;case"right":this.player.keys.right=true;break;default:break}e.classList.add("active")}onControlLeave(e){this.onControlUp(e)}onKeyboard(e){if(!this.domArtworkTarget.classList.contains("active")){switch(e){case"a":case"A":case"ArrowLeft":this.player.keys.left=this.keyboard.keys[e];if(this.player.keys.left){this.controls.left.classList.add("active")}else{this.controls.left.classList.remove("active")}break;case"d":case"D":case"ArrowRight":this.player.keys.right=this.keyboard.keys[e];if(this.player.keys.right){this.controls.right.classList.add("active")}else{this.controls.right.classList.remove("active")}break;case"w":case"W":case"ArrowUp":this.player.keys.up=this.keyboard.keys[e];if(this.player.keys.up){this.controls.up.classList.add("active")}else{this.controls.up.classList.remove("active")}break;case"s":case"S":case"ArrowDown":this.player.keys.down=this.keyboard.keys[e];if(this.player.keys.down){this.controls.down.classList.add("active")}else{this.controls.down.classList.remove("active")}break;case" ":this.player.keys.jump=this.keyboard.keys[e];break;case"x":case"X":if(this.keyboard.keys["x"]||this.keyboard.keys["X"]){if(this.keyboard.isControl()){this.player.toggleNoclip()}this.keyboard.release("x");this.keyboard.release("X")}break;default:break}}}setSize(){const e=this.domElement.getBoundingClientRect();this.centre.x=e.width/2;this.centre.y=e.height/2}resize(){this.setSize();this.canvas.resize();this.floorPlan.resize()}update(e){this.floorPlan.update(e)}draw(){this.canvas.clear();this.floorPlan.draw(this.canvas.getContext());this.canvas.promptTouchMove(this.mouse.active&&Date.now()-this.timestamp>this.threshold.pan);if(this.player.noclip){this.canvas.promptGodMode();this.canvas.drawDevOverlay()}else{this.canvas.drawDevOverlay()}}}var Q=Z;function J(){var e=false;(function(t){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))e=true})(navigator.userAgent||navigator.vendor||window.opera);return e}function ee(){var e=window.navigator.userAgent;var t=!!e.match(/iPad/i)||!!e.match(/iPhone/i);var i=!!e.match(/WebKit/i);return t&&i&&!e.match(/CriOS/i)}function te(){var e=false;(function(t){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))e=true})(navigator.userAgent||navigator.vendor||window.opera);return e}class ie{constructor(e,t,i){this.isMobile=t;this.isDev=window.location.host.indexOf("localhost")!=-1;this.root=e;this.openGalleryButton=document.querySelector("#open-gallery");this.openGalleryButton.onclick=(()=>{if(!this.openGalleryButton.classList.contains("is-loading")){this.openGalleryButton.classList.remove("flash");this.toggleGallery()}});document.querySelectorAll(".close-gallery").forEach(e=>{e.addEventListener("click",()=>{this.closeGalleryMenu();this.toggleGallery()})});this.initMenus();this.mobileWarning=document.querySelector("#mobile-warning");if(!this.isMobile){this.mobileWarning.parentNode.removeChild(this.mobileWarning)}else{this.mobileWarning.classList.remove("hidden");this.mobileWarning.classList.add("active");const e=this.mobileWarning.querySelector("#mobile-warning-close");e.addEventListener("touchstart",e=>{e.preventDefault();this.closeMobileWarning();i()});e.addEventListener("mousedown",e=>{this.closeMobileWarning();i()})}if(this.isDev){this.toggleGallery()}else{this.onMenuItem(document.querySelector("#nav-item-controls"))}}toggleGallery(){if(!this.lock){this.lock=true;this.toggleCount=this.toggleCount?this.toggleCount+1:1;const e=document.querySelector("#pane-content");const t=document.querySelector("#pane-gallery");const i=document.querySelector("#background-grid");const r=document.querySelector(".nav");const s=document.querySelector(".logo-main");if(e.classList.contains("active")){e.classList.remove("active");t.classList.add("active");i.classList.add("active");r.classList.add("active");s.classList.add("active");document.documentElement.classList.add("freeze");if(this.toggleCount==1){setTimeout(()=>{this.lock=false;t.querySelectorAll("canvas").forEach(e=>{e.classList.add("active")});this.root.activate()},this.isDev?125:1e3)}else{this.root.activate();this.lock=false}}else{t.classList.remove("active");e.classList.add("active");i.classList.remove("active");r.classList.remove("active");s.classList.remove("active");document.documentElement.classList.remove("freeze");this.root.deactivate();this.lock=false}}}closeGalleryMenu(){document.querySelectorAll("#nav-gallery .item.active, .gallery-menu .active").forEach(e=>{e.classList.remove("active")});document.querySelector("#nav-gallery .close-gallery-menu").classList.add("active");document.querySelector("#gallery-controls").classList.remove("display-none")}closeMobileWarning(){this.mobileWarning.classList.add("closing");setTimeout(()=>{this.mobileWarning.parentNode.removeChild(this.mobileWarning)},500)}onMenuItem(e){if(e.dataset.active){const t=document.querySelector(e.dataset.active);if(t){e.parentNode.querySelectorAll(".active").forEach(e=>{e.classList.remove("active")});e.classList.add("active");if(e.parentNode.getAttribute("id")=="nav-content"){document.querySelectorAll(".pane-content .page.active").forEach(e=>{e.classList.remove("active")})}else{document.querySelectorAll(".gallery-menu .menu.active").forEach(e=>{e.classList.remove("active");e.querySelectorAll(".requires-activate").forEach(e=>{e.classList.remove("active")})});document.querySelector("#gallery-controls").classList.add("display-none");document.querySelector("#artwork-target").classList.remove("active")}t.classList.add("active");t.querySelectorAll(".requires-activate").forEach(e=>{e.classList.add("active")})}}}initMenus(){document.querySelectorAll(".pane-content-nav .item").forEach(e=>{e.addEventListener("click",e=>{this.onMenuItem(e.currentTarget)})});document.querySelectorAll(".close-gallery-menu").forEach(e=>{e.addEventListener("click",e=>{this.closeGalleryMenu()})})}}class re{constructor(e){this.root=e;this.lock=false;this.active=false;document.querySelectorAll(".archive-item").forEach(e=>{e.addEventListener("click",()=>{this.loadArchive(e)})});this.featured=document.querySelector(".section-featured");if(this.featured){this.featured.addEventListener("click",()=>{this.reloadCurrentExhibition()})}}activateGallery(e){document.querySelectorAll(".active-exhibition-data").forEach(e=>{e.classList.remove("active-exhibition-data")});e.classList.add("active-exhibition-data");this.root.surface.floorPlan.reloadExhibition();this.root.scene.reloadExhibition()}reloadCurrentExhibition(){const e=this.featured.querySelector(".exhibition-data");if(!this.lock&&this.active&&e){this.active=false;this.lock=true;this.activateGallery(e);const t=document.querySelector("#open-gallery");t.innerHTML="Loading...";setTimeout(()=>{t.classList.add("flash");t.innerHTML='<span class="mobile-show">&larr;&nbsp;Open Gallery</span><span class="mobile-hide">Open Gallery</span>';this.lock=false},500);this.featured.classList.remove("clickable")}}loadArchive(e){const t=e.querySelector(".exhibition-data");if(!this.lock&&t&&!t.classList.contains("active-exhibition-data")){this.active=true;this.lock=true;this.activateGallery(t);const e=document.querySelector("#open-gallery");e.innerHTML="Loading...";setTimeout(()=>{e.classList.add("flash");e.innerHTML='<span class="mobile-show">&larr;&nbsp;Open Archive</span><span class="mobile-hide">Open Archive</span>';this.lock=false},500);this.featured.classList.add("clickable")}}}class se{constructor(){this.active=false;this.isMobile=te();this.isMobileExclusive=J();this.menu=new ie(this,this.isMobile,()=>{this.load()});this.maxTimeDelta=.1;if(!this.isMobile){this.load()}window.addEventListener("resize",()=>{this.resize()});window.addEventListener("orientationchange",()=>{setTimeout(()=>{this.resize()},500)});if(this.isMobileExclusive&&ee()){document.querySelectorAll(".fix-safari").forEach(e=>{e.classList.add("safari")})}this.loop()}load(){if(!this.loaded){this.loaded=true;this.scene=new M;this.renderer=new A(this,this.scene);this.surface=new Q(this.scene,this.renderer,this.isMobile);this.archive=new re(this)}}resize(){if(!this.isMobileExclusive){this.renderer.resize();this.scene.resize();this.surface.resize()}}deactivate(){this.active=false}activate(){this.active=true;this.now=performance.now()}loop(){requestAnimationFrame(()=>{this.loop()});if(this.active&&this.loaded){const e=performance.now();const t=Math.min(this.maxTimeDelta,(e-this.now)/1e3);this.now=e;this.scene.update(t);this.surface.update(t);this.renderer.draw(t);this.surface.draw()}}}window.onload=(()=>{const e=new se})}]);