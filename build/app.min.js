var COMGALLERY=function(e){var t={};function i(s){if(t[s])return t[s].exports;var r=t[s]={i:s,l:!1,exports:{}};return e[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=e,i.c=t,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(s,r,function(t){return e[t]}.bind(null,r));return s},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=9)}([function(e,t){!function(){function e(e){var t,i=e.properties.Content,s=e.properties.RelativeFilename||e.properties.Filename,r=s.slice(s.lastIndexOf(".")+1).toLowerCase();switch(r){case"bmp":t="image/bmp";break;case"jpg":case"jpeg":t="image/jpeg";break;case"png":t="image/png";break;case"tif":t="image/tiff";break;default:return void console.warn('FBXLoader: Image type "'+r+'" is not supported.')}if("string"==typeof i)return"data:"+t+";base64,"+i;var o=new Uint8Array(i);return window.URL.createObjectURL(new Blob([o],{type:t}))}function t(e,t,i,s){var r,o=e.id,a=e.attrName,n=e.properties.FileName,h=e.properties.RelativeFilename,l=s.get(o).children;if(void 0!==l&&l.length>0&&i.has(l[0].ID))r=i.get(l[0].ID);else if(void 0!==h&&"/"!==h[0]&&null===h.match(/^[a-zA-Z]:/))r=h;else{var c=n.split(/[\\\/]/);r=c.length>0?c[c.length-1]:n}var p=t.path;0!==r.indexOf("blob:")&&0!==r.indexOf("data:")||t.setPath(void 0);var u=t.load(r);u.name=a,u.FBX_ID=o;var d=e.properties.WrapModeU,m=e.properties.WrapModeV,f=void 0!==d?d.value:0,v=void 0!==m?m.value:0;if(u.wrapS=0===f?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,u.wrapT=0===v?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,"Scaling"in e.properties){var g=e.properties.Scaling.value;u.repeat.x=g[0],u.repeat.y=g[1]}return t.setPath(p),u}function i(e,t,i){var s=e.id,r=e.attrName,o=e.properties.ShadingModel;if("object"==typeof o&&(o=o.value),!i.has(s))return null;var a,n=i.get(s).children,h=function(e,t,i){var s={};e.BumpFactor&&(s.bumpScale=e.BumpFactor.value);e.Diffuse&&(s.color=k(e.Diffuse));e.DisplacementFactor&&(s.displacementScale=e.DisplacementFactor.value);e.ReflectionFactor&&(s.reflectivity=e.ReflectionFactor.value);e.Specular&&(s.specular=k(e.Specular));e.Shininess&&(s.shininess=e.Shininess.value);e.Emissive&&(s.emissive=k(e.Emissive));e.EmissiveFactor&&(s.emissiveIntensity=parseFloat(e.EmissiveFactor.value));e.Opacity&&(s.opacity=parseFloat(e.Opacity.value));s.opacity<1&&(s.transparent=!0);if(e["Maya|base_color"]){var r=e["Maya|base_color"].value;s.color=new THREE.Color(r[0],r[1],r[2])}if(e["Maya|emissive"]){var r=e["Maya|emissive"];s.emissive=new THREE.Color(r[0],r[1],r[2])}e["Maya|emissive_intensity"]&&(s.emissiveIntensity=e["Maya|emissive_intensity"].value);e["Maya|metallic"]&&(s.metalness=e["Maya|metallic"].value);e["Maya|roughness"]&&(s.roughness=e["Maya|roughness"].value);var o=1;if(e["Maya|uv_scale"])var o=e["Maya|uv_scale"].value;for(var a=0,n=i.length;a<n;++a){var h=i[a],l=h.relationship;switch(l){case"Maya|TEX_color_map":var c="Maya|use_color_map";e[c]&&1==e[c].value&&(s.map=t.get(h.ID),1!=o&&(s.map.wrapS=THREE.RepeatWrapping,s.map.wrapT=THREE.RepeatWrapping,s.map.repeat.set(o,o)));break;case"Maya|TEX_emissive_map":var c="Maya|use_emissive_map";e[c]&&1==e[c].value&&(s.emissiveMap=t.get(h.ID),1!=o&&(s.emissiveMap.wrapS=THREE.RepeatWrapping,s.emissiveMap.wrapT=THREE.RepeatWrapping,s.emissiveMap.repeat.set(o,o)));break;case"Maya|TEX_roughness_map":var c="Maya|use_roughness_map";e[c]&&1==e[c].value&&(s.roughnessMap=t.get(h.ID),1!=o&&(s.roughnessMap.wrapS=THREE.RepeatWrapping,s.roughnessMap.wrapT=THREE.RepeatWrapping,s.roughnessMap.repeat.set(o,o)));break;case"Maya|TEX_normal_map":var c="Maya|use_normal_map";e[c]&&1==e[c].value&&(s.normalMap=t.get(h.ID),1!=o&&(s.normalMap.wrapS=THREE.RepeatWrapping,s.normalMap.wrapT=THREE.RepeatWrapping,s.normalMap.repeat.set(o,o)));break;case"Maya|TEX_metallic_map":var c="Maya|use_metallic_map";e[c]&&1==e[c].value&&(s.metalnessMap=t.get(h.ID),1!=o&&(s.metalnessMap.wrapS=THREE.RepeatWrapping,s.metalnessMap.wrapT=THREE.RepeatWrapping,s.metalnessMap.repeat.set(o,o)));break;case"Maya|TEX_ao_map":var c="Maya|use_ao_map";e[c]&&1==e[c].value&&(s.aoMap=t.get(h.ID),1!=o&&(s.aoMap.wrapS=THREE.RepeatWrapping,s.aoMap.wrapT=THREE.RepeatWrapping,s.aoMap.repeat.set(o,o)));break;case"Maya|TEX_brdf_lut":case"Maya|TEX_global_specular_cube":case"Maya|TEX_global_diffuse_cube":break;case"Bump":s.bumpMap=t.get(h.ID);break;case"DiffuseColor":s.map=t.get(h.ID);break;case"DisplacementColor":s.displacementMap=t.get(h.ID);break;case"EmissiveColor":s.emissiveMap=t.get(h.ID);break;case"NormalMap":s.normalMap=t.get(h.ID);break;case"ReflectionColor":s.envMap=t.get(h.ID),s.envMap.mapping=THREE.EquirectangularReflectionMapping;break;case"SpecularColor":s.specularMap=t.get(h.ID);break;case"TransparentColor":s.alphaMap=t.get(h.ID),s.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",l)}}return s}(e.properties,t,n);switch(o.toLowerCase()){case"phong":a=new THREE.MeshPhongMaterial;break;case"lambert":a=new THREE.MeshLambertMaterial;break;case"unknown":a=new THREE.MeshStandardMaterial;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',o),a=new THREE.MeshPhongMaterial({color:3342591})}return a.setValues(h),a.name=r,a}function s(e,t){for(var i={},s=e.children,r=0,o=s.length;r<o;++r){var a=s[r],n=t[a.ID],h={FBX_ID:a.ID,index:r,indices:[],weights:[],transform:(new THREE.Matrix4).fromArray(n.subNodes.Transform.properties.a),transformLink:(new THREE.Matrix4).fromArray(n.subNodes.TransformLink.properties.a),linkMode:n.properties.Mode};"Indexes"in n.subNodes&&(h.indices=n.subNodes.Indexes.properties.a,h.weights=n.subNodes.Weights.properties.a),i[a.ID]=h}return{map:i,bones:[]}}function r(e,t,i){switch(e.attrType){case"Mesh":return function(e,t,i){for(var s=0;s<t.children.length;++s){var r=i[t.children[s].ID];if(void 0!==r)break}return function(e,t){var i=e.subNodes,s=i.Vertices.properties.a,r=i.PolygonVertexIndex.properties.a,a=[],n=[],l=[],c=[],p=[],u=[],d=[];if(i.LayerElementColor)var m=function(e){var t=e.properties.MappingInformationType,i=e.properties.ReferenceInformationType,s=e.subNodes.Colors.properties.a,r=[];"IndexToDirect"===i&&(r=e.subNodes.ColorIndex.properties.a);return{dataSize:4,buffer:s,indices:r,mappingType:t,referenceType:i}}(i.LayerElementColor[0]);if(i.LayerElementMaterial)var f=function(e){var t=e.properties.MappingInformationType,i=e.properties.ReferenceInformationType;if("NoMappingInformation"===t)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:i};for(var s=e.subNodes.Materials.properties.a,r=[],o=0,a=s.length;o<a;++o)r.push(o);return{dataSize:1,buffer:s,indices:r,mappingType:t,referenceType:i}}(i.LayerElementMaterial[0]);if(i.LayerElementNormal)var v=function(e){var t=e.properties.MappingInformationType,i=e.properties.ReferenceInformationType,s=e.subNodes.Normals.properties.a,r=[];"IndexToDirect"===i&&("NormalIndex"in e.subNodes?r=e.subNodes.NormalIndex.properties.a:"NormalsIndex"in e.subNodes&&(r=e.subNodes.NormalsIndex.properties.a));return{dataSize:3,buffer:s,indices:r,mappingType:t,referenceType:i}}(i.LayerElementNormal[0]);if(i.LayerElementUV)for(var g=[],y=0;i.LayerElementUV[y];)g.push(o(i.LayerElementUV[y])),y++;var E={};if(t){var w=t.map;for(var T in w)for(var b=w[T],x=b.indices,M=0;M<x.length;M++){var R=x[M],H=b.weights[M];void 0===E[R]&&(E[R]=[]),E[R].push({id:b.index,weight:H})}}for(var k=0,S=0,P=!1,z=[],L=[],I=[],C=[],A=[],B=[],D=0;D<r.length;D++){var V=r[D],F=!1;V<0&&(V^=-1,r[D]=V,F=!0);var _=[],j=[];if(z.push(3*V,3*V+1,3*V+2),m){var N=h(D,k,V,m);I.push(N[0],N[1],N[2])}if(t){if(void 0!==E[V])for(var O=E[V],M=0,U=O.length;M<U;M++)j.push(O[M].weight),_.push(O[M].id);if(j.length>4){P||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),P=!0);var G=[0,0,0,0],q=[0,0,0,0];j.forEach(function(e,t){var i=e,s=_[t];q.forEach(function(e,t,r){if(i>e){r[t]=i,i=e;var o=G[t];G[t]=s,s=o}})}),_=G,j=q}for(var y=j.length;y<4;++y)j[y]=0,_[y]=0;for(var y=0;y<4;++y)A.push(j[y]),B.push(_[y])}if(v){var N=h(D,k,V,v);L.push(N[0],N[1],N[2])}if(g)for(var y=0;y<g.length;y++){var N=h(D,k,V,g[y]);void 0===C[y]&&(C[y]=[]),C[y].push(N[0],N[1])}if(S++,F){for(var y=2;y<S;y++)a.push(s[z[0]]),a.push(s[z[1]]),a.push(s[z[2]]),a.push(s[z[3*(y-1)]]),a.push(s[z[3*(y-1)+1]]),a.push(s[z[3*(y-1)+2]]),a.push(s[z[3*y]]),a.push(s[z[3*y+1]]),a.push(s[z[3*y+2]]);if(t)for(var y=2;y<S;y++)u.push(A[0]),u.push(A[1]),u.push(A[2]),u.push(A[3]),u.push(A[4*(y-1)]),u.push(A[4*(y-1)+1]),u.push(A[4*(y-1)+2]),u.push(A[4*(y-1)+3]),u.push(A[4*y]),u.push(A[4*y+1]),u.push(A[4*y+2]),u.push(A[4*y+3]),d.push(B[0]),d.push(B[1]),d.push(B[2]),d.push(B[3]),d.push(B[4*(y-1)]),d.push(B[4*(y-1)+1]),d.push(B[4*(y-1)+2]),d.push(B[4*(y-1)+3]),d.push(B[4*y]),d.push(B[4*y+1]),d.push(B[4*y+2]),d.push(B[4*y+3]);if(v)for(var y=2;y<S;y++)n.push(L[0]),n.push(L[1]),n.push(L[2]),n.push(L[3*(y-1)]),n.push(L[3*(y-1)+1]),n.push(L[3*(y-1)+2]),n.push(L[3*y]),n.push(L[3*y+1]),n.push(L[3*y+2]);if(g)for(var M=0;M<g.length;M++){void 0===c[M]&&(c[M]=[]);for(var y=2;y<S;y++)c[M].push(C[M][0]),c[M].push(C[M][1]),c[M].push(C[M][2*(y-1)]),c[M].push(C[M][2*(y-1)+1]),c[M].push(C[M][2*y]),c[M].push(C[M][2*y+1])}if(m)for(var y=2;y<S;y++)l.push(I[0]),l.push(I[1]),l.push(I[2]),l.push(I[3*(y-1)]),l.push(I[3*(y-1)+1]),l.push(I[3*(y-1)+2]),l.push(I[3*y]),l.push(I[3*y+1]),l.push(I[3*y+2]);if(f&&"AllSame"!==f.mappingType)for(var X=h(D,k,V,f)[0],y=2;y<S;y++)p.push(X),p.push(X),p.push(X);k++,F=!1,S=0,z=[],L=[],I=[],C=[],A=[],B=[]}}var W=new THREE.BufferGeometry;W.name=e.name,W.addAttribute("position",new THREE.Float32BufferAttribute(a,3)),l.length>0&&W.addAttribute("color",new THREE.Float32BufferAttribute(l,3));t&&(W.addAttribute("skinIndex",new THREE.Float32BufferAttribute(d,4)),W.addAttribute("skinWeight",new THREE.Float32BufferAttribute(u,4)),W.FBX_Deformer=t);n.length>0&&W.addAttribute("normal",new THREE.Float32BufferAttribute(n,3));if(c.length>0)for(var y=0;y<c.length;y++){var $="uv"+(y+1).toString();0==y&&($="uv"),W.addAttribute($,new THREE.Float32BufferAttribute(c[y],2))}if(f&&"AllSame"!==f.mappingType){for(var Y=p[0],Q=0,y=0;y<p.length;++y)p[y]!==Y&&(W.addGroup(Q,y-Q,Y),Y=p[y],Q=y);if(W.groups.length>0){var K=W.groups[W.groups.length-1],Z=K.start+K.count;Z!==p.length&&W.addGroup(Z,p.length-Z,Y)}0===W.groups.length&&W.addGroup(0,p.length,p[0])}return W}(e,r)}(e,t,i);case"NurbsCurve":return function(e){if(void 0===THREE.NURBSCurve)return console.error("THREE.FBXLoader: The loader relies on THREE.NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new THREE.BufferGeometry;var t=parseInt(e.properties.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.properties.Order,e.id),new THREE.BufferGeometry;for(var i,s,r=t-1,o=e.subNodes.KnotVector.properties.a,a=[],n=e.subNodes.Points.properties.a,h=0,l=n.length;h<l;h+=4)a.push((new THREE.Vector4).fromArray(n,h));if("Closed"===e.properties.Form)a.push(a[0]);else if("Periodic"===e.properties.Form){i=r,s=o.length-1-i;for(var h=0;h<r;++h)a.push(a[h])}for(var c=new THREE.NURBSCurve(r,o,a,i,s).getPoints(7*a.length),p=new Float32Array(3*c.length),h=0,l=c.length;h<l;++h)c[h].toArray(p,3*h);var u=new THREE.BufferGeometry;return u.addAttribute("position",new THREE.BufferAttribute(p,3)),u}(e)}}function o(e){var t=e.properties.MappingInformationType,i=e.properties.ReferenceInformationType,s=e.subNodes.UV.properties.a,r=[];return"IndexToDirect"===i&&(r=e.subNodes.UVIndex.properties.a),{dataSize:2,buffer:s,indices:r,mappingType:t,referenceType:i}}THREE.FBXLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},Object.assign(THREE.FBXLoader.prototype,{load:function(e,t,i,s){var r=this,o=THREE.LoaderUtils.extractUrlBase(e),a=new THREE.FileLoader(this.manager);a.setResponseType("arraybuffer"),a.load(e,function(i){try{var a=r.parse(i,o);t(a)}catch(t){window.setTimeout(function(){s&&s(t),r.manager.itemError(e)},0)}},i,s)},parse:function(o,a){var n,h,u;if(u="Kaydara FBX Binary  \0",(h=o).byteLength>=u.length&&u===S(h,0,u.length))n=(new T).parse(o);else{var d=S(o);if(!function(e){var t=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],i=0;function s(t){var s=e[t-1];return e=e.slice(i+t),i++,s}for(var r=0;r<t.length;++r){var o=s(1);if(o===t[r])return!1}return!0}(d))throw new Error("THREE.FBXLoader: Unknown format.");if(M(d)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+M(d));n=(new w).parse(d)}var m=function(e){var t=new Map;if("Connections"in e)for(var i=e.Connections.properties.connections,s=0,r=i.length;s<r;++s){var o=i[s];t.has(o[0])||t.set(o[0],{parents:[],children:[]});var a={ID:o[1],relationship:o[2]};t.get(o[0]).parents.push(a),t.has(o[1])||t.set(o[1],{parents:[],children:[]});var n={ID:o[0],relationship:o[2]};t.get(o[1]).children.push(n)}return t}(n),f=function(t){var i=new Map;if("Video"in t.Objects.subNodes){var s=t.Objects.subNodes.Video;for(var r in s){var o=s[r];if("Content"in o.properties){var a=e(s[r]);i.set(parseInt(r),a)}}}return i}(n),g=function(e,t,s){var r=new Map;if("Material"in e.Objects.subNodes){var o=e.Objects.subNodes.Material;for(var a in o){var n=i(o[a],t,s);null!==n&&r.set(parseInt(a),n)}}return r}(n,function(e,i,s,r){var o=new Map,a=["jpg","jpeg","png","bmp"];if("Texture"in e.Objects.subNodes){var n=e.Objects.subNodes.Texture;for(var h in n){var l=n[h],c=l.properties.FileName.slice(l.properties.FileName.lastIndexOf(".")+1).toLowerCase();if(-1!=a.indexOf(c)){var p=t(l,i,s,r);o.set(parseInt(h),p)}}}return o}(n,new THREE.TextureLoader(this.manager).setPath(a),f,m),m),y=function(e,t){var i={};if("Deformer"in e.Objects.subNodes){var r=e.Objects.subNodes.Deformer;for(var o in r){var a=r[o];if("Skin"===a.attrType){var n=t.get(parseInt(o)),h=s(n,r);h.FBX_ID=parseInt(o),i[o]=h}}}return i}(n,m),E=function(e,t,i){var s=new Map;if("Geometry"in e.Objects.subNodes){var o=e.Objects.subNodes.Geometry;for(var a in o){var n=t.get(parseInt(a)),h=r(o[a],n,i);s.set(parseInt(a),h)}}return s}(n,m,y);return function(e,t,i,s,r){var o=new THREE.Group,a=e.Objects.subNodes.Model,n=[],h=new Map;for(var u in a){for(var d=parseInt(u),m=a[u],f=t.get(d),g=null,y=0;y<f.parents.length;++y)for(var E in i){var w=i[E],T=w.map,b=T[f.parents[y].ID];if(b){var x=g;g=new THREE.Bone,w.bones[b.index]=g,null!==x&&g.add(x)}}if(!g)switch(m.attrType){case"Camera":for(var M,R=0,H=f.children.length;R<H;++R){var S=f.children[R].ID,z=e.Objects.subNodes.NodeAttribute[S];void 0!==z&&void 0!==z.properties&&(M=z.properties)}if(void 0===M)g=new THREE.Object3D;else{var L=0;void 0!==M.CameraProjectionType&&1===M.CameraProjectionType.value&&(L=1);var I=1;void 0!==M.NearPlane&&(I=M.NearPlane.value/1e3);var C=1e3;void 0!==M.FarPlane&&(C=M.FarPlane.value/1e3);var A=window.innerWidth,B=window.innerHeight;void 0!==M.AspectWidth&&void 0!==M.AspectHeight&&(A=M.AspectWidth.value,B=M.AspectHeight.value);var D=A/B,V=45;switch(void 0!==M.FieldOfView&&(V=M.FieldOfView.value),L){case 0:g=new THREE.PerspectiveCamera(V,D,I,C);break;case 1:g=new THREE.OrthographicCamera(-A/2,A/2,B/2,-B/2,I,C);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+L+"."),g=new THREE.Object3D}}break;case"Light":for(var F,R=0,H=f.children.length;R<H;++R){var S=f.children[R].ID,z=e.Objects.subNodes.NodeAttribute[S];void 0!==z&&void 0!==z.properties&&(F=z.properties)}if(void 0===F)g=new THREE.Object3D;else{L=void 0===F.LightType?0:F.LightType.value;var _=16777215;void 0!==F.Color&&(_=k(F.Color.value));var j=void 0===F.Intensity?1:F.Intensity.value/100;void 0!==F.CastLightOnObject&&0===F.CastLightOnObject.value&&(j=0);var N=0;void 0!==F.FarAttenuationEnd&&(N=void 0!==F.EnableFarAttenuation&&0===F.EnableFarAttenuation.value?0:F.FarAttenuationEnd.value/1e3);switch(L){case 0:g=new THREE.PointLight(_,j,N,1);break;case 1:g=new THREE.DirectionalLight(_,j);break;case 2:var O=Math.PI/3;void 0!==F.InnerAngle&&(O=THREE.Math.degToRad(F.InnerAngle.value));var U=0;void 0!==F.OuterAngle&&(U=THREE.Math.degToRad(F.OuterAngle.value),U=Math.max(U,1)),g=new THREE.SpotLight(_,j,N,O,U,1);break;default:console.warn("THREE.FBXLoader: Unknown light type "+F.LightType.value+", defaulting to a THREE.PointLight."),g=new THREE.PointLight(_,j)}void 0!==F.CastShadows&&1===F.CastShadows.value&&(g.castShadow=!0)}break;case"Mesh":for(var G=null,q=null,X=[],R=0,H=f.children.length;R<H;++R){var W=f.children[R];s.has(W.ID)&&(G=s.get(W.ID)),r.has(W.ID)&&X.push(r.get(W.ID))}if(X.length>1?q=X:X.length>0?q=X[0]:(q=new THREE.MeshPhongMaterial({color:13421772}),X.push(q)),"color"in G.attributes)for(var $=0,Y=X.length;$<Y;++$)X[$].vertexColors=THREE.VertexColors;if(G.FBX_Deformer){for(var Q=0,K=X.length;Q<K;++Q)X[Q].skinning=!0;g=new THREE.SkinnedMesh(G,q)}else g=new THREE.Mesh(G,q);break;case"NurbsCurve":for(var G=null,R=0,H=f.children.length;R<H;++R){var W=f.children[R];s.has(W.ID)&&(G=s.get(W.ID))}q=new THREE.LineBasicMaterial({color:3342591,linewidth:5}),g=new THREE.Line(G,q);break;default:g=new THREE.Group}g.name=THREE.PropertyBinding.sanitizeNodeName(m.attrName),g.FBX_ID=d,n.push(g),h.set(d,g)}for(var Z=0,J=n.length;Z<J;++Z){var g=n[Z],m=a[g.FBX_ID];if("Lcl_Translation"in m.properties&&g.position.fromArray(m.properties.Lcl_Translation.value),"Lcl_Rotation"in m.properties){var ee=m.properties.Lcl_Rotation.value.map(THREE.Math.degToRad);ee.push("ZYX"),g.rotation.fromArray(ee)}if("Lcl_Scaling"in m.properties&&g.scale.fromArray(m.properties.Lcl_Scaling.value),"PreRotation"in m.properties){var te=m.properties.PreRotation.value.map(THREE.Math.degToRad);te[3]="ZYX";var ie=(new THREE.Euler).fromArray(te);ie=(new THREE.Quaternion).setFromEuler(ie);var se=(new THREE.Quaternion).setFromEuler(g.rotation);ie.multiply(se),g.rotation.setFromQuaternion(ie,"ZYX")}if("GeometricTranslation"in m.properties){var te=m.properties.GeometricTranslation.value;g.traverse(function(e){e.geometry&&e.geometry.translate(te[0],te[1],te[2])})}if("LookAtProperty"in m.properties)for(var f=t.get(g.FBX_ID),R=0,H=f.children.length;R<H;++R){var W=f.children[R];if("LookAtProperty"===W.relationship){var re=e.Objects.subNodes.Model[W.ID];if("Lcl_Translation"in re.properties){var oe=re.properties.Lcl_Translation.value;void 0!==g.target?(g.target.position.set(oe[0],oe[1],oe[2]),o.add(g.target)):g.lookAt(new THREE.Vector3(oe[0],oe[1],oe[2]))}}}for(var f=t.get(g.FBX_ID),ae=0;ae<f.parents.length;ae++){var ne=P(n,function(e){return e.FBX_ID===f.parents[ae].ID});if(ne>-1){n[ne].add(g);break}}null===g.parent&&o.add(g)}o.updateMatrixWorld(!0);var he=new Map;if("Pose"in e.Objects.subNodes){var le=e.Objects.subNodes.Pose;for(var u in le)if("BindPose"===le[u].attrType){le=le[u];break}for(var ce=le.subNodes.PoseNode,pe=0,ue=ce.length;pe<ue;++pe){var m=ce[pe],de=(new THREE.Matrix4).fromArray(m.subNodes.Matrix.properties.a);he.set(parseInt(m.properties.Node),de)}}for(var E in i){var w=i[E],T=w.map;for(var me in T){var b=T[me],fe=b.index,ve=w.bones[fe];if(!he.has(ve.FBX_ID))break;var ge=he.get(ve.FBX_ID);ve.matrixWorld.copy(ge)}w.skeleton=new THREE.Skeleton(w.bones);for(var f=t.get(w.FBX_ID),ye=f.parents,Ee=0,we=ye.length;Ee<we;++Ee){var Te=ye[Ee];if(s.has(Te.ID))for(var be=Te.ID,xe=t.get(be),y=0;y<xe.parents.length;++y)if(h.has(xe.parents[y].ID)){var g=h.get(xe.parents[y].ID);g.bind(w.skeleton,g.matrixWorld);break}}}o.updateMatrixWorld(!0),o.skeleton={bones:n};var Me=function(e,t,i){var s=e.Objects.subNodes.AnimationCurveNode,r=e.Objects.subNodes.AnimationCurve,o=e.Objects.subNodes.AnimationLayer,a=e.Objects.subNodes.AnimationStack,n=30;if("GlobalSettings"in e&&"TimeMode"in e.GlobalSettings.properties){var h=e.GlobalSettings.properties.TimeMode.value;14===h?"CustomFrameRate"in e.GlobalSettings.properties&&(n=-1===(n=e.GlobalSettings.properties.CustomFrameRate.value)?30:n):h<=17&&(n=[30,120,100,60,50,48,30,30,29.97,29.97,25,24,1,23.976,30,96,72,59.94][h])}var u={curves:new Map,layers:{},stacks:{},length:0,fps:n,frames:0},d=[];for(var m in s)if(m.match(/\d+/)){var f=l(e,s[m],t,i);d.push(f)}for(var v=new Map,g=0;g<d.length;++g)null!==d[g]&&v.set(d[g].id,d[g]);var y=[];for(m in r)if(m.match(/\d+/)){var E=c(r[m]);if(!t.has(E.id))continue;y.push(E);var w=t.get(E.id).parents[0],T=w.ID,b=w.relationship,x="";if(b.match(/X/))x="x";else if(b.match(/Y/))x="y";else{if(!b.match(/Z/))continue;x="z"}v.get(T).curves[x]=E}for(var m in v.forEach(function(e){var t=e.containerBoneID;if(u.curves.has(t)||u.curves.set(t,{T:null,R:null,S:null}),u.curves.get(t)[e.attr]=e,"R"===e.attr){var i=e.curves;if(null===i.x&&(i.x={version:null,times:[0],values:[0]}),null===i.y&&(i.y={version:null,times:[0],values:[0]}),null===i.z&&(i.z={version:null,times:[0],values:[0]}),i.x.values=i.x.values.map(THREE.Math.degToRad),i.y.values=i.y.values.map(THREE.Math.degToRad),i.z.values=i.z.values.map(THREE.Math.degToRad),null!==e.preRotations){var s=(new THREE.Euler).setFromVector3(e.preRotations,"ZYX");s=(new THREE.Quaternion).setFromEuler(s);for(var r=new THREE.Euler,o=new THREE.Quaternion,a=0;a<i.x.times.length;++a)r.set(i.x.values[a],i.y.values[a],i.z.values[a],"ZYX"),o.setFromEuler(r).premultiply(s),r.setFromQuaternion(o,"ZYX"),i.x.values[a]=r.x,i.y.values[a]=r.y,i.z.values[a]=r.z}}}),o){for(var M=[],R=t.get(parseInt(m)).children,H=0;H<R.length;H++)if(v.has(R[H].ID)){var k=v.get(R[H].ID),S=k.containerBoneID;void 0===M[S]&&(M[S]={T:null,R:null,S:null}),M[S][k.attr]=k}u.layers[m]=M}for(var m in a){for(var P=[],R=t.get(parseInt(m)).children,z={max:0,min:Number.MAX_VALUE},H=0;H<R.length;++H){var L=u.layers[R[H].ID];if(void 0!==L){P.push(L);for(var I=0,C=L.length;I<C;++I){var M=L[I];M&&p(M,z)}}}z.max>z.min&&(u.stacks[m]={name:a[m].attrName,layers:P,length:z.max-z.min,frames:(z.max-z.min)*u.fps})}return u}(e,t,o);if(function(e,t){void 0===e.animations&&(e.animations=[]);var i=t.stacks;for(var s in i){for(var r=i[s],o={name:r.name,fps:t.fps,length:r.length,hierarchy:[]},a=e.skeleton.bones,n=0,h=a.length;n<h;++n){var l=a[n],c=l.name.replace(/.*:/,""),p=P(a,function(e){return l.parent===e});o.hierarchy.push({parent:p,name:c,keys:[]})}for(var u=0;u<=r.frames;u++)for(var n=0,h=a.length;n<h;++n)for(var l=a[n],d=n,m=r.layers[0][d],f=0,g=o.hierarchy.length;f<g;++f){var y=o.hierarchy[f];y.name===l.name&&y.keys.push(v(t,m,l,u))}e.animations.push(THREE.AnimationClip.parseAnimation(o,a))}}(o,Me),"GlobalSettings"in e&&"AmbientColor"in e.GlobalSettings.properties){var Re=e.GlobalSettings.properties.AmbientColor.value,He=Re[0],ke=Re[1],Se=Re[2];if(0!==He||0!==ke||0!==Se){var _=new THREE.Color(He,ke,Se);o.add(new THREE.AmbientLight(_,1))}}return o}(n,m,y,E,g)}});var a=[],n={ByPolygonVertex:{Direct:function(e,t,i,s){var r=e*s.dataSize,o=e*s.dataSize+s.dataSize;return z(a,s.buffer,r,o)},IndexToDirect:function(e,t,i,s){var r=s.indices[e],o=r*s.dataSize,n=r*s.dataSize+s.dataSize;return z(a,s.buffer,o,n)}},ByPolygon:{Direct:function(e,t,i,s){var r=t*s.dataSize,o=t*s.dataSize+s.dataSize;return z(a,s.buffer,r,o)},IndexToDirect:function(e,t,i,s){var r=s.indices[t],o=r*s.dataSize,n=r*s.dataSize+s.dataSize;return z(a,s.buffer,o,n)}},ByVertice:{Direct:function(e,t,i,s){var r=i*s.dataSize,o=i*s.dataSize+s.dataSize;return z(a,s.buffer,r,o)}},AllSame:{IndexToDirect:function(e,t,i,s){var r=s.indices[0]*s.dataSize,o=s.indices[0]*s.dataSize+s.dataSize;return z(a,s.buffer,r,o)}}};function h(e,t,i,s){return n[s.mappingType][s.referenceType](e,t,i,s)}function l(e,t,i,s){var r=e.Objects.subNodes.Model,o={id:t.id,attr:t.attrName,internalID:t.id,attrX:!1,attrY:!1,attrZ:!1,containerBoneID:-1,containerID:-1,curves:{x:null,y:null,z:null},preRotations:null};if(!o.attr.match(/S|R|T/))return null;for(var a in t.properties)a.match(/X/)&&(o.attrX=!0),a.match(/Y/)&&(o.attrY=!0),a.match(/Z/)&&(o.attrZ=!0);for(var n,h=i.get(o.id).parents,l=h.length-1;l>=0;--l){var c=P(s.skeleton.bones,function(e){return e.FBX_ID===h[l].ID});if(c>-1){o.containerBoneID=c,o.containerID=h[l].ID;var p=r[o.containerID.toString()];"PreRotation"in p.properties&&(o.preRotations=(n=p.properties.PreRotation,(new THREE.Vector3).fromArray(n.value)).multiplyScalar(Math.PI/180));break}}return o}function c(e){return{version:null,id:e.id,internalID:e.id,times:e.subNodes.KeyTime.properties.a.map(R),values:e.subNodes.KeyValueFloat.properties.a,attrFlag:e.subNodes.KeyAttrFlags.properties.a,attrData:e.subNodes.KeyAttrDataFloat.properties.a}}function p(e,t){e.R&&u(e.R.curves,t),e.S&&u(e.S.curves,t),e.T&&u(e.T.curves,t)}function u(e,t){e.x&&d(e.x,t),e.y&&d(e.y,t),e.z&&d(e.z,t)}function d(e,t){t.max=e.times[e.times.length-1]>t.max?e.times[e.times.length-1]:t.max,t.min=e.times[0]<t.min?e.times[0]:t.min}var m=new THREE.Euler,f=new THREE.Quaternion;function v(e,t,i,s){var r={time:s/e.fps,pos:i.position.toArray(),rot:i.quaternion.toArray(),scl:i.scale.toArray()};if(void 0===t)return r;m.setFromQuaternion(i.quaternion,"ZYX",!1);try{y(t,"T")&&E(t.T,s)&&(t.T.curves.x.values[s]&&(r.pos[0]=t.T.curves.x.values[s]),t.T.curves.y.values[s]&&(r.pos[1]=t.T.curves.y.values[s]),t.T.curves.z.values[s]&&(r.pos[2]=t.T.curves.z.values[s])),y(t,"R")&&E(t.R,s)&&(t.R.curves.x.values[s]&&(m.x=t.R.curves.x.values[s]),t.R.curves.y.values[s]&&(m.y=t.R.curves.y.values[s]),t.R.curves.z.values[s]&&(m.z=t.R.curves.z.values[s]),f.setFromEuler(m),r.rot=f.toArray()),y(t,"S")&&E(t.S,s)&&(t.T.curves.x.values[s]&&(r.scl[0]=t.S.curves.x.values[s]),t.T.curves.y.values[s]&&(r.scl[1]=t.S.curves.y.values[s]),t.T.curves.z.values[s]&&(r.scl[2]=t.S.curves.z.values[s]))}catch(e){console.log("THREE.FBXLoader: ",i),console.log("THREE.FBXLoader: ",e)}return r}var g=["x","y","z"];function y(e,t){if(void 0===e)return!1;var i=e[t];return!!i&&g.every(function(e){return null!==i.curves[e]})}function E(e,t){return g.every(function(i){return function(e,t){return void 0!==e.values[t]}(e.curves[i],t)})}function w(){}function T(){}function b(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===t||t}function x(){}function M(e){var t=e.match(/FBXVersion: (\d+)/);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function R(e){return e/46186158e3}function H(e){for(var t=e.split(","),i=0,s=t.length;i<s;i++)t[i]=parseFloat(t[i]);return t}function k(e){return(new THREE.Color).fromArray(e.value)}function S(e,t,i){void 0===t&&(t=0),void 0===i&&(i=e.byteLength);var s=new Uint8Array(e,t,i);if(void 0!==window.TextDecoder)return(new TextDecoder).decode(s);for(var r="",o=0,a=s.length;o<a;o++)r+=String.fromCharCode(s[o]);return r}function P(e,t){for(var i=0,s=e.length;i<s;i++)if(t(e[i]))return i;return-1}function z(e,t,i,s){for(var r=i,o=0;r<s;r++,o++)e[o]=t[r];return e}Object.assign(w.prototype,{getPrevNode:function(){return this.nodeStack[this.currentIndent-2]},getCurrentNode:function(){return this.nodeStack[this.currentIndent-1]},getCurrentProp:function(){return this.currentProp},pushStack:function(e){this.nodeStack.push(e),this.currentIndent+=1},popStack:function(){this.nodeStack.pop(),this.currentIndent-=1},setCurrentProp:function(e,t){this.currentProp=e,this.currentPropName=t},parse:function(e){this.currentIndent=0,this.allNodes=new x,this.nodeStack=[],this.currentProp=[],this.currentPropName="";for(var t=e.split("\n"),i=0,s=t.length;i<s;i++){if(!(h=t[i]).match(/^[\s\t]*;/)&&!h.match(/^[\s\t]*$/)){var r=new RegExp("^\\t{"+this.currentIndent+"}(\\w+):(.*){","");if(l=h.match(r)){for(var o=l[1].trim().replace(/^"/,"").replace(/"$/,""),a=l[2].split(","),n=0,h=a.length;n<h;n++)a[n]=a[n].trim().replace(/^"/,"").replace(/"$/,"");this.parseNodeBegin(h,o,a||null)}else{var l,c=new RegExp("^\\t{"+this.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)");if(l=h.match(c)){var p=l[1].replace(/^"/,"").replace(/"$/,"").trim(),u=l[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===p&&","===u&&(u=t[++i].replace(/"/g,"").replace(/,$/,"").trim()),this.parseNodeProperty(h,p,u)}else{var d=new RegExp("^\\t{"+(this.currentIndent-1)+"}}");h.match(d)?this.nodeEnd():h.match(/^[^\s\t}]/)&&this.parseNodePropertyContinued(h)}}}}return this.allNodes},parseNodeBegin:function(e,t,i){var s={name:t,properties:{},subNodes:{}},r=this.parseNodeAttr(i),o=this.getCurrentNode();if(0===this.currentIndent)this.allNodes.add(t,s);else if(t in o.subNodes){var a=o.subNodes[t];this.isFlattenNode(o.subNodes[t])&&(""===r.id?(o.subNodes[t]=[],o.subNodes[t].push(a)):(o.subNodes[t]={},o.subNodes[t][a.id]=a)),""===r.id?o.subNodes[t].push(s):o.subNodes[t][r.id]=s}else"number"==typeof r.id||r.id.match(/^\d+$/)?(o.subNodes[t]={},o.subNodes[t][r.id]=s):o.subNodes[t]=s;i&&(s.id=r.id,s.attrName=r.name,s.attrType=r.type),this.pushStack(s)},parseNodeAttr:function(e){var t=e[0];""!==e[0]&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));var i="",s="";return e.length>1&&(i=e[1].replace(/^(\w+)::/,""),s=e[2]),{id:t,name:i,type:s}},parseNodeProperty:function(e,t,i){var s=this.getCurrentNode(),r=s.name;if(void 0!==r&&r.match(/Properties(\d)+/))return void this.parseNodeSpecialProperty(e,t,i);if("C"===t){var o=i.split(",").slice(1),a=parseInt(o[0]),n=parseInt(o[1]),h=i.split(",").slice(3);t="connections",function(e,t){for(var i=0,s=e.length,r=t.length;i<r;i++,s++)e[s]=t[i]}(i=[a,n],h=h.map(function(e){return e.trim().replace(/^"/,"")})),void 0===s.properties[t]&&(s.properties[t]=[])}if("Node"===t){var l=parseInt(i);s.properties.id=l,s.id=l}t in s.properties?Array.isArray(s.properties[t])?s.properties[t].push(i):s.properties[t]+=i:Array.isArray(s.properties[t])?s.properties[t].push(i):s.properties[t]=i,this.setCurrentProp(s.properties,t),"a"===t&&","!==i.slice(-1)&&(s.properties.a=H(i))},parseNodePropertyContinued:function(e){if(this.currentProp[this.currentPropName]+=e,","!==e.slice(-1)){var t=this.getCurrentNode();t.properties.a=H(t.properties.a)}},parseNodeSpecialProperty:function(e,t,i){for(var s=i.split('",'),r=0,o=s.length;r<o;r++)s[r]=s[r].trim().replace(/^\"/,"").replace(/\s/,"_");var a=s[0],n=s[1],h=s[2],l=s[3],c=s[4];switch(n){case"int":case"enum":case"bool":case"ULongLong":c=parseInt(c);break;case"double":case"Number":case"FieldOfView":c=parseFloat(c);break;case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":c=H(c)}this.getPrevNode().properties[a]={type:n,type2:h,flag:l,value:c},this.setCurrentProp(this.getPrevNode().properties,a)},nodeEnd:function(){this.popStack()},isFlattenNode:function(e){return"subNodes"in e&&"properties"in e}}),Object.assign(T.prototype,{parse:function(e){var t=new b(e);t.skip(23);for(var i=t.getUint32(),s=new x;!this.endOfContent(t);)try{var r=this.parseNode(t,i);null!==r&&s.add(r.name,r)}catch(e){console.log(e)}return s},endOfContent:function(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()},parseNode:function(e,t){var i=t>=7500?e.getUint64():e.getUint32(),s=t>=7500?e.getUint64():e.getUint32(),r=(t>=7500?e.getUint64():e.getUint32(),e.getUint8()),o=e.getString(r);if(0===i)return null;for(var a=[],n=0;n<s;n++)a.push(this.parseProperty(e));var h=a.length>0?a[0]:"",l=a.length>1?a[1]:"",c=a.length>2?a[2]:"",p={},u={},d=!1;for(1===s&&e.getOffset()===i&&(d=!0);i>e.getOffset();){var m=this.parseNode(e,t);if(null!==m)if(!0!==m.singleProperty)if("Connections"!==o||"C"!==m.name)if(m.name.match(/^Properties\d+$/)){var f=Object.keys(m.properties);for(n=0,x=f.length;n<x;n++){var v=f[n];u[v]=m.properties[v]}}else if(o.match(/^Properties\d+$/)&&"P"===m.name){var g,y=m.propertyList[0],E=m.propertyList[1],w=m.propertyList[2],T=m.propertyList[3];0===y.indexOf("Lcl ")&&(y=y.replace("Lcl ","Lcl_")),0===E.indexOf("Lcl ")&&(E=E.replace("Lcl ","Lcl_")),g="ColorRGB"===E||"Vector"===E||"Vector3D"===E||0===E.indexOf("Lcl_")?[m.propertyList[4],m.propertyList[5],m.propertyList[6]]:m.propertyList[4],u[y]={type:E,type2:w,flag:T,value:g}}else void 0===p[m.name]?"number"==typeof m.id?(p[m.name]={},p[m.name][m.id]=m):p[m.name]=m:""===m.id?(Array.isArray(p[m.name])||(p[m.name]=[p[m.name]]),p[m.name].push(m)):void 0===p[m.name][m.id]?p[m.name][m.id]=m:(Array.isArray(p[m.name][m.id])||(p[m.name][m.id]=[p[m.name][m.id]]),p[m.name][m.id].push(m));else{for(var b=[],n=1,x=m.propertyList.length;n<x;n++)b[n-1]=m.propertyList[n];void 0===u.connections&&(u.connections=[]),u.connections.push(b)}else{var M=m.propertyList[0];Array.isArray(M)?(p[m.name]=m,m.properties.a=M):u[m.name]=M}}return{singleProperty:d,id:h,attrName:l,attrType:c,name:o,properties:u,propertyList:a,subNodes:p}},parseProperty:function(e){var t=e.getChar();switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":var i=e.getUint32();return e.getArrayBuffer(i);case"S":i=e.getUint32();return e.getString(i);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":var s=e.getUint32(),r=e.getUint32(),o=e.getUint32();if(0===r)switch(t){case"b":case"c":return e.getBooleanArray(s);case"d":return e.getFloat64Array(s);case"f":return e.getFloat32Array(s);case"i":return e.getInt32Array(s);case"l":return e.getInt64Array(s)}if(void 0===window.Zlib)throw new Error("THREE.FBXLoader: External library Inflate.min.js required, obtain or import from https://github.com/imaya/zlib.js");var a=new b(new Zlib.Inflate(new Uint8Array(e.getArrayBuffer(o))).decompress().buffer);switch(t){case"b":case"c":return a.getBooleanArray(s);case"d":return a.getFloat64Array(s);case"f":return a.getFloat32Array(s);case"i":return a.getInt32Array(s);case"l":return a.getInt64Array(s)}default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}}),Object.assign(b.prototype,{getOffset:function(){return this.offset},size:function(){return this.dv.buffer.byteLength},skip:function(e){this.offset+=e},getBoolean:function(){return 1==(1&this.getUint8())},getBooleanArray:function(e){for(var t=[],i=0;i<e;i++)t.push(this.getBoolean());return t},getInt8:function(){var e=this.dv.getInt8(this.offset);return this.offset+=1,e},getInt8Array:function(e){for(var t=[],i=0;i<e;i++)t.push(this.getInt8());return t},getUint8:function(){var e=this.dv.getUint8(this.offset);return this.offset+=1,e},getUint8Array:function(e){for(var t=[],i=0;i<e;i++)t.push(this.getUint8());return t},getInt16:function(){var e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e},getInt16Array:function(e){for(var t=[],i=0;i<e;i++)t.push(this.getInt16());return t},getUint16:function(){var e=this.dv.getUint16(this.offset,this.littleEndian);return this.offset+=2,e},getUint16Array:function(e){for(var t=[],i=0;i<e;i++)t.push(this.getUint16());return t},getInt32:function(){var e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e},getInt32Array:function(e){for(var t=[],i=0;i<e;i++)t.push(this.getInt32());return t},getUint32:function(){var e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e},getUint32Array:function(e){for(var t=[],i=0;i<e;i++)t.push(this.getUint32());return t},getInt64:function(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,4294967295===(e=4294967295&~e)&&(t=t+1&4294967295),-(4294967296*t+(e=e+1&4294967295))):4294967296*t+e},getInt64Array:function(e){for(var t=[],i=0;i<e;i++)t.push(this.getInt64());return t},getUint64:function(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e},getUint64Array:function(e){for(var t=[],i=0;i<e;i++)t.push(this.getUint64());return t},getFloat32:function(){var e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e},getFloat32Array:function(e){for(var t=[],i=0;i<e;i++)t.push(this.getFloat32());return t},getFloat64:function(){var e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e},getFloat64Array:function(e){for(var t=[],i=0;i<e;i++)t.push(this.getFloat64());return t},getArrayBuffer:function(e){var t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t},getChar:function(){return String.fromCharCode(this.getUint8())},getString:function(e){for(var t="";e>0;){var i=this.getUint8();if(e--,0===i)break;t+=String.fromCharCode(i)}return t=decodeURIComponent(escape(t)),this.skip(e),t}}),Object.assign(x.prototype,{add:function(e,t){this[e]=t}})}()},function(e,t){THREE.OBJLoader=function(){var e=/^[og]\s*(.+)?/,t=/^mtllib /,i=/^usemtl /;function s(){var e={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materialLibraries:[],startObject:function(e,t){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=e,void(this.object.fromDeclaration=!1!==t);var i=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:!1!==t,geometry:{vertices:[],normals:[],colors:[],uvs:[]},materials:[],smooth:!0,startMaterial:function(e,t){var i=this._finalize(!1);i&&(i.inherited||i.groupCount<=0)&&this.materials.splice(i.index,1);var s={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&t.length>0?t[t.length-1]:"",smooth:void 0!==i?i.smooth:this.smooth,groupStart:void 0!==i?i.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(e){var t={index:"number"==typeof e?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return t.clone=this.clone.bind(t),t}};return this.materials.push(s),s},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(e){var t=this.currentMaterial();if(t&&-1===t.groupEnd&&(t.groupEnd=this.geometry.vertices.length/3,t.groupCount=t.groupEnd-t.groupStart,t.inherited=!1),e&&this.materials.length>1)for(var i=this.materials.length-1;i>=0;i--)this.materials[i].groupCount<=0&&this.materials.splice(i,1);return e&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),t}},i&&i.name&&"function"==typeof i.clone){var s=i.clone(0);s.inherited=!0,this.object.materials.push(s)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(e,t){var i=parseInt(e,10);return 3*(i>=0?i-1:i+t/3)},parseNormalIndex:function(e,t){var i=parseInt(e,10);return 3*(i>=0?i-1:i+t/3)},parseUVIndex:function(e,t){var i=parseInt(e,10);return 2*(i>=0?i-1:i+t/2)},addVertex:function(e,t,i){var s=this.vertices,r=this.object.geometry.vertices;r.push(s[e+0],s[e+1],s[e+2]),r.push(s[t+0],s[t+1],s[t+2]),r.push(s[i+0],s[i+1],s[i+2])},addVertexPoint:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,i){var s=this.normals,r=this.object.geometry.normals;r.push(s[e+0],s[e+1],s[e+2]),r.push(s[t+0],s[t+1],s[t+2]),r.push(s[i+0],s[i+1],s[i+2])},addColor:function(e,t,i){var s=this.colors,r=this.object.geometry.colors;r.push(s[e+0],s[e+1],s[e+2]),r.push(s[t+0],s[t+1],s[t+2]),r.push(s[i+0],s[i+1],s[i+2])},addUV:function(e,t,i){var s=this.uvs,r=this.object.geometry.uvs;r.push(s[e+0],s[e+1]),r.push(s[t+0],s[t+1]),r.push(s[i+0],s[i+1])},addUVLine:function(e){var t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,i,s,r,o,a,n,h){var l=this.vertices.length,c=this.parseVertexIndex(e,l),p=this.parseVertexIndex(t,l),u=this.parseVertexIndex(i,l);if(this.addVertex(c,p,u),void 0!==s&&""!==s){var d=this.uvs.length;c=this.parseUVIndex(s,d),p=this.parseUVIndex(r,d),u=this.parseUVIndex(o,d),this.addUV(c,p,u)}if(void 0!==a&&""!==a){var m=this.normals.length;c=this.parseNormalIndex(a,m),p=a===n?c:this.parseNormalIndex(n,m),u=a===h?c:this.parseNormalIndex(h,m),this.addNormal(c,p,u)}this.colors.length>0&&this.addColor(c,p,u)},addPointGeometry:function(e){this.object.geometry.type="Points";for(var t=this.vertices.length,i=0,s=e.length;i<s;i++)this.addVertexPoint(this.parseVertexIndex(e[i],t))},addLineGeometry:function(e,t){this.object.geometry.type="Line";for(var i=this.vertices.length,s=this.uvs.length,r=0,o=e.length;r<o;r++)this.addVertexLine(this.parseVertexIndex(e[r],i));var a=0;for(o=t.length;a<o;a++)this.addUVLine(this.parseUVIndex(t[a],s))}};return e.startObject("",!1),e}function r(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.materials=null}return r.prototype={constructor:r,load:function(e,t,i,s){var r=this,o=new THREE.FileLoader(r.manager);o.setPath(this.path),o.load(e,function(e){t(r.parse(e))},i,s)},setPath:function(e){return this.path=e,this},setMaterials:function(e){return this.materials=e,this},parse:function(r){console.time("OBJLoader");var o=new s;-1!==r.indexOf("\r\n")&&(r=r.replace(/\r\n/g,"\n")),-1!==r.indexOf("\\\n")&&(r=r.replace(/\\\n/g,""));for(var a=r.split("\n"),n="",h="",l=[],c="function"==typeof"".trimLeft,p=0,u=a.length;p<u;p++)if(n=a[p],0!==(n=c?n.trimLeft():n.trim()).length&&"#"!==(h=n.charAt(0)))if("v"===h){var d=n.split(/\s+/);switch(d[0]){case"v":o.vertices.push(parseFloat(d[1]),parseFloat(d[2]),parseFloat(d[3])),8===d.length&&o.colors.push(parseFloat(d[4]),parseFloat(d[5]),parseFloat(d[6]));break;case"vn":o.normals.push(parseFloat(d[1]),parseFloat(d[2]),parseFloat(d[3]));break;case"vt":o.uvs.push(parseFloat(d[1]),parseFloat(d[2]))}}else if("f"===h){for(var m=n.substr(1).trim().split(/\s+/),f=[],v=0,g=m.length;v<g;v++){var y=m[v];if(y.length>0){var E=y.split("/");f.push(E)}}var w=f[0];for(v=1,g=f.length-1;v<g;v++){var T=f[v],b=f[v+1];o.addFace(w[0],T[0],b[0],w[1],T[1],b[1],w[2],T[2],b[2])}}else if("l"===h){var x=n.substring(1).trim().split(" "),M=[],R=[];if(-1===n.indexOf("/"))M=x;else for(var H=0,k=x.length;H<k;H++){var S=x[H].split("/");""!==S[0]&&M.push(S[0]),""!==S[1]&&R.push(S[1])}o.addLineGeometry(M,R)}else if("p"===h){var P=n.substr(1).trim().split(" ");o.addPointGeometry(P)}else if(null!==(l=e.exec(n))){var z=(" "+l[0].substr(1).trim()).substr(1);o.startObject(z)}else if(i.test(n))o.object.startMaterial(n.substring(7).trim(),o.materialLibraries);else if(t.test(n))o.materialLibraries.push(n.substring(7).trim());else{if("s"!==h){if("\0"===n)continue;throw new Error('THREE.OBJLoader: Unexpected line: "'+n+'"')}if((l=n.split(" ")).length>1){var L=l[1].trim().toLowerCase();o.object.smooth="0"!==L&&"off"!==L}else o.object.smooth=!0;(q=o.object.currentMaterial())&&(q.smooth=o.object.smooth)}o.finalize();var I=new THREE.Group;I.materialLibraries=[].concat(o.materialLibraries);for(p=0,u=o.objects.length;p<u;p++){var C=o.objects[p],A=C.geometry,B=C.materials,D="Line"===A.type,V="Points"===A.type,F=!1;if(0!==A.vertices.length){var _=new THREE.BufferGeometry;_.addAttribute("position",new THREE.Float32BufferAttribute(A.vertices,3)),A.normals.length>0?_.addAttribute("normal",new THREE.Float32BufferAttribute(A.normals,3)):_.computeVertexNormals(),A.colors.length>0&&(F=!0,_.addAttribute("color",new THREE.Float32BufferAttribute(A.colors,3))),A.uvs.length>0&&_.addAttribute("uv",new THREE.Float32BufferAttribute(A.uvs,2));for(var j,N=[],O=0,U=B.length;O<U;O++){var G=B[O],q=void 0;if(null!==this.materials)if(q=this.materials.create(G.name),!D||!q||q instanceof THREE.LineBasicMaterial){if(V&&q&&!(q instanceof THREE.PointsMaterial)){var X=new THREE.PointsMaterial({size:10,sizeAttenuation:!1});W.copy(q),q=X}}else{var W=new THREE.LineBasicMaterial;W.copy(q),W.lights=!1,q=W}q||((q=D?new THREE.LineBasicMaterial:V?new THREE.PointsMaterial({size:1,sizeAttenuation:!1}):new THREE.MeshPhongMaterial).name=G.name),q.flatShading=!G.smooth,q.vertexColors=F?THREE.VertexColors:THREE.NoColors,N.push(q)}if(N.length>1){for(O=0,U=B.length;O<U;O++){G=B[O];_.addGroup(G.groupStart,G.groupCount,O)}j=D?new THREE.LineSegments(_,N):V?new THREE.Points(_,N):new THREE.Mesh(_,N)}else j=D?new THREE.LineSegments(_,N[0]):V?new THREE.Points(_,N[0]):new THREE.Mesh(_,N[0]);j.name=C.name,I.add(j)}}return console.timeEnd("OBJLoader"),I}},r}()},function(e,t){THREE.CopyShader={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","gl_FragColor = opacity * texel;","}"].join("\n")}},function(e,t){var i,s,r;THREE.EffectComposer=function(e,t){if(this.renderer=e,void 0===t){var i={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,stencilBuffer:!1},s=e.getSize(new THREE.Vector2);this._pixelRatio=e.getPixelRatio(),this._width=s.width,this._height=s.height,(t=new THREE.WebGLRenderTarget(this._width*this._pixelRatio,this._height*this._pixelRatio,i)).texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],void 0===THREE.CopyShader&&console.error("THREE.EffectComposer relies on THREE.CopyShader"),void 0===THREE.ShaderPass&&console.error("THREE.EffectComposer relies on THREE.ShaderPass"),this.copyPass=new THREE.ShaderPass(THREE.CopyShader),this.clock=new THREE.Clock},Object.assign(THREE.EffectComposer.prototype,{swapBuffers:function(){var e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e},addPass:function(e){this.passes.push(e);var t=this.renderer.getDrawingBufferSize(new THREE.Vector2);e.setSize(t.width,t.height)},insertPass:function(e,t){this.passes.splice(t,0,e)},isLastEnabledPass:function(e){for(var t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0},render:function(e){void 0===e&&(e=this.clock.getDelta());var t,i,s=this.renderer.getRenderTarget(),r=!1,o=this.passes.length;for(i=0;i<o;i++)if(!1!==(t=this.passes[i]).enabled){if(t.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(i),t.render(this.renderer,this.writeBuffer,this.readBuffer,e,r),t.needsSwap){if(r){var a=this.renderer.context;a.stencilFunc(a.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),a.stencilFunc(a.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==THREE.MaskPass&&(t instanceof THREE.MaskPass?r=!0:t instanceof THREE.ClearMaskPass&&(r=!1))}this.renderer.setRenderTarget(s)},reset:function(e){if(void 0===e){var t=this.renderer.getSize(new THREE.Vector2);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2},setSize:function(e,t){this._width=e,this._height=t;var i=this._width*this._pixelRatio,s=this._height*this._pixelRatio;this.renderTarget1.setSize(i,s),this.renderTarget2.setSize(i,s);for(var r=0;r<this.passes.length;r++)this.passes[r].setSize(i,s)},setPixelRatio:function(e){this._pixelRatio=e,this.setSize(this._width,this._height)}}),THREE.Pass=function(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1},Object.assign(THREE.Pass.prototype,{setSize:function(){},render:function(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}),THREE.Pass.FullScreenQuad=(i=new THREE.OrthographicCamera(-1,1,1,-1,0,1),s=new THREE.PlaneBufferGeometry(2,2),r=function(e){this._mesh=new THREE.Mesh(s,e)},Object.defineProperty(r.prototype,"material",{get:function(){return this._mesh.material},set:function(e){this._mesh.material=e}}),Object.assign(r.prototype,{render:function(e){e.render(this._mesh,i)}}),r)},function(e,t){THREE.LuminosityHighPassShader={shaderID:"luminosityHighPass",uniforms:{tDiffuse:{type:"t",value:null},luminosityThreshold:{type:"f",value:1},smoothWidth:{type:"f",value:1},defaultColor:{type:"c",value:new THREE.Color(0)},defaultOpacity:{type:"f",value:0}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec3 defaultColor;","uniform float defaultOpacity;","uniform float luminosityThreshold;","uniform float smoothWidth;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","vec3 luma = vec3( 0.299, 0.587, 0.114 );","float v = dot( texel.xyz, luma );","vec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );","float alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );","gl_FragColor = mix( outputColor, texel, alpha );","}"].join("\n")}},function(e,t){THREE.RenderPass=function(e,t,i,s,r){THREE.Pass.call(this),this.scene=e,this.camera=t,this.overrideMaterial=i,this.clearColor=s,this.clearAlpha=void 0!==r?r:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1},THREE.RenderPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.RenderPass,render:function(e,t,i){var s,r,o=e.autoClear;e.autoClear=!1,this.scene.overrideMaterial=this.overrideMaterial,this.clearColor&&(s=e.getClearColor().getHex(),r=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:i),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor&&e.setClearColor(s,r),this.scene.overrideMaterial=null,e.autoClear=o}})},function(e,t){THREE.ShaderPass=function(e,t){THREE.Pass.call(this),this.textureID=void 0!==t?t:"tDiffuse",e instanceof THREE.ShaderMaterial?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=THREE.UniformsUtils.clone(e.uniforms),this.material=new THREE.ShaderMaterial({defines:e.defines||{},uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),this.scene=new THREE.Scene,this.quad=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)},THREE.ShaderPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.ShaderPass,render:function(e,t,i,s,r){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=i.texture),this.quad.material=this.material,this.renderToScreen?e.render(this.scene,this.camera):e.render(this.scene,this.camera,t,this.clear)}})},function(e,t){THREE.UnrealBloomPass=function(e,t,i,s){THREE.Pass.call(this),this.strength=void 0!==t?t:1,this.radius=i,this.threshold=s,this.resolution=void 0!==e?new THREE.Vector2(e.x,e.y):new THREE.Vector2(256,256),this.clearColor=new THREE.Color(0,0,0);var r={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat};this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;var o=Math.round(this.resolution.x/2),a=Math.round(this.resolution.y/2);this.renderTargetBright=new THREE.WebGLRenderTarget(o,a,r),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(var n=0;n<this.nMips;n++){var h=new THREE.WebGLRenderTarget(o,a,r);h.texture.name="UnrealBloomPass.h"+n,h.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(h);var l=new THREE.WebGLRenderTarget(o,a,r);l.texture.name="UnrealBloomPass.v"+n,l.texture.generateMipmaps=!1,this.renderTargetsVertical.push(l),o=Math.round(o/2),a=Math.round(a/2)}void 0===THREE.LuminosityHighPassShader&&console.error("THREE.UnrealBloomPass relies on THREE.LuminosityHighPassShader");var c=THREE.LuminosityHighPassShader;this.highPassUniforms=THREE.UniformsUtils.clone(c.uniforms),this.highPassUniforms.luminosityThreshold.value=s,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new THREE.ShaderMaterial({uniforms:this.highPassUniforms,vertexShader:c.vertexShader,fragmentShader:c.fragmentShader,defines:{}}),this.separableBlurMaterials=[];var p=[3,5,7,9,11];for(o=Math.round(this.resolution.x/2),a=Math.round(this.resolution.y/2),n=0;n<this.nMips;n++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(p[n])),this.separableBlurMaterials[n].uniforms.texSize.value=new THREE.Vector2(o,a),o=Math.round(o/2),a=Math.round(a/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=t,this.compositeMaterial.uniforms.bloomRadius.value=.1,this.compositeMaterial.needsUpdate=!0;this.compositeMaterial.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],this.bloomTintColors=[new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,void 0===THREE.CopyShader&&console.error("THREE.UnrealBloomPass relies on THREE.CopyShader");var u=THREE.CopyShader;this.copyUniforms=THREE.UniformsUtils.clone(u.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new THREE.ShaderMaterial({uniforms:this.copyUniforms,vertexShader:u.vertexShader,fragmentShader:u.fragmentShader,blending:THREE.AdditiveBlending,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this.oldClearColor=new THREE.Color,this.oldClearAlpha=1,this.basic=new THREE.MeshBasicMaterial,this.fsQuad=new THREE.Pass.FullScreenQuad(null)},THREE.UnrealBloomPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.UnrealBloomPass,dispose:function(){for(var e=0;e<this.renderTargetsHorizontal.length;e++)this.renderTargetsHorizontal[e].dispose();for(e=0;e<this.renderTargetsVertical.length;e++)this.renderTargetsVertical[e].dispose();this.renderTargetBright.dispose()},setSize:function(e,t){var i=Math.round(e/2),s=Math.round(t/2);this.renderTargetBright.setSize(i,s);for(var r=0;r<this.nMips;r++)this.renderTargetsHorizontal[r].setSize(i,s),this.renderTargetsVertical[r].setSize(i,s),this.separableBlurMaterials[r].uniforms.texSize.value=new THREE.Vector2(i,s),i=Math.round(i/2),s=Math.round(s/2)},render:function(e,t,i,s,r){this.oldClearColor.copy(e.getClearColor()),this.oldClearAlpha=e.getClearAlpha();var o=e.autoClear;e.autoClear=!1,e.setClearColor(this.clearColor,0),r&&e.context.disable(e.context.STENCIL_TEST),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=i.texture,e.setRenderTarget(null),e.clear(),this.fsQuad.render(e)),this.highPassUniforms.tDiffuse.value=i.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,e.setRenderTarget(this.renderTargetBright),e.clear(),this.fsQuad.render(e);for(var a=this.renderTargetBright,n=0;n<this.nMips;n++)this.fsQuad.material=this.separableBlurMaterials[n],this.separableBlurMaterials[n].uniforms.colorTexture.value=a.texture,this.separableBlurMaterials[n].uniforms.direction.value=THREE.UnrealBloomPass.BlurDirectionX,e.setRenderTarget(this.renderTargetsHorizontal[n]),e.clear(),this.fsQuad.render(e),this.separableBlurMaterials[n].uniforms.colorTexture.value=this.renderTargetsHorizontal[n].texture,this.separableBlurMaterials[n].uniforms.direction.value=THREE.UnrealBloomPass.BlurDirectionY,e.setRenderTarget(this.renderTargetsVertical[n]),e.clear(),this.fsQuad.render(e),a=this.renderTargetsVertical[n];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,e.setRenderTarget(this.renderTargetsHorizontal[0]),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,r&&e.context.enable(e.context.STENCIL_TEST),this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(i),this.fsQuad.render(e)),e.setClearColor(this.oldClearColor,this.oldClearAlpha),e.autoClear=o},getSeperableBlurMaterial:function(e){return new THREE.ShaderMaterial({defines:{KERNEL_RADIUS:e,SIGMA:e},uniforms:{colorTexture:{value:null},texSize:{value:new THREE.Vector2(.5,.5)},direction:{value:new THREE.Vector2(.5,.5)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D colorTexture;\n\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec2 direction;\t\t\t\t\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\t\t\t\t}\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tfloat fSigma = float(SIGMA);\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, fSigma);\t\t\t\t\tvec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;\t\t\t\t\tfor( int i = 1; i < KERNEL_RADIUS; i ++ ) {\t\t\t\t\t\tfloat x = float(i);\t\t\t\t\t\tfloat w = gaussianPdf(x, fSigma);\t\t\t\t\t\tvec2 uvOffset = direction * invSize * x;\t\t\t\t\t\tvec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;\t\t\t\t\t\tvec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;\t\t\t\t\t\tdiffuseSum += (sample1 + sample2) * w;\t\t\t\t\t\tweightSum += 2.0 * w;\t\t\t\t\t}\t\t\t\t\tgl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n\t\t\t\t}"})},getCompositeMaterial:function(e){return new THREE.ShaderMaterial({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},dirtTexture:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D blurTexture1;\t\t\t\tuniform sampler2D blurTexture2;\t\t\t\tuniform sampler2D blurTexture3;\t\t\t\tuniform sampler2D blurTexture4;\t\t\t\tuniform sampler2D blurTexture5;\t\t\t\tuniform sampler2D dirtTexture;\t\t\t\tuniform float bloomStrength;\t\t\t\tuniform float bloomRadius;\t\t\t\tuniform float bloomFactors[NUM_MIPS];\t\t\t\tuniform vec3 bloomTintColors[NUM_MIPS];\t\t\t\t\t\t\t\tfloat lerpBloomFactor(const in float factor) { \t\t\t\t\tfloat mirrorFactor = 1.2 - factor;\t\t\t\t\treturn mix(factor, mirrorFactor, bloomRadius);\t\t\t\t}\t\t\t\t\t\t\t\tvoid main() {\t\t\t\t\tgl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );\t\t\t\t}"})}}),THREE.UnrealBloomPass.BlurDirectionX=new THREE.Vector2(1,0),THREE.UnrealBloomPass.BlurDirectionY=new THREE.Vector2(0,1)},function(e,t){THREE.PosterShader={uniforms:{tDiffuse:{value:null}},vertexShader:"\n    varying vec2 vUv;\n\n    void main() {\n      vUv = uv;\n      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n    }\n  ",fragmentShader:"\n    #define PI 3.14159\n    #define UV_SCALE 0.02\n    #define MAX_HEIGHT 0.5\n    varying vec2 vUv;\n    uniform sampler2D tDiffuse;\n\n    float posterise(float val, float amount) {\n      return floor(val * amount) / amount;\n    }\n\n    float posteriseCeil(float val, float amount) {\n      return ceil(val * amount) / amount;\n    }\n\n    void main() {\n      vec4 frag = texture2D(tDiffuse, vUv);\n      frag.r = posterise(frag.r, 16.0);\n      gl_FragColor = frag;\n    }\n  "},THREE.PosterPass=function(e){THREE.Pass.call(this),this.size=e,this.shader=THREE.PosterShader,this.material=new THREE.ShaderMaterial(this.shader),this.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),this.scene=new THREE.Scene,this.quad=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),this.material),this.quad.frustumCulled=!1,this.scene.add(this.quad),this.time=0},THREE.PosterPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.PosterPass,render:function(e,t,i,s,r){this.shader.uniforms.tDiffuse.value=i.texture,this.renderToScreen?(e.setRenderTarget(null),e.clear(),e.render(this.scene,this.camera)):(e.setRenderTarget(t),e.clear(),e.render(this.scene,this.camera))}})},function(e,t,i){"use strict";i.r(t);var s=()=>{var e=!1;return function(t){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0)}(navigator.userAgent||navigator.vendor||window.opera),e};var r=()=>{let e=!1;const t=location.search;return t&&""!=t&&(-1!==t.indexOf("single")&&(e="single"),console.log("Site mode:",e)),e};const o=r(),a="single"===o?0:10;var n={renderer:{getWidth:()=>Math.max(100,window.innerWidth-0),getHeight:()=>window.innerWidth<=768?Math.max(100,window.innerHeight-128):Math.max(100,window.innerHeight-8*a*2)},mobileBreakpoint:768,floorPlan:{artworkPositions:[{x:-24,y:4,z:23,nx:0,nz:-1},{x:-10.5,y:3.5,z:23,nx:0,nz:-1},{x:-8,y:3.5,z:23,nx:0,nz:-1},{x:-5.5,y:3.5,z:23,nx:0,nz:-1},{x:5.5,y:3.5,z:23,nx:0,nz:-1},{x:8,y:3.5,z:23,nx:0,nz:-1},{x:10.5,y:3.5,z:23,nx:0,nz:-1},{x:24,y:4,z:23,nx:0,nz:-1},{x:-12,y:3.5,z:8,nx:0,nz:1},{x:-8,y:3.5,z:8,nx:0,nz:1},{x:-4,y:3.5,z:8,nx:0,nz:1},{x:4,y:3.5,z:8,nx:0,nz:1},{x:8,y:3.5,z:8,nx:0,nz:1},{x:12,y:3.5,z:8,nx:0,nz:1},{x:-31,y:4,z:14,nx:1,nz:0},{x:-29.5,y:4,z:6,nx:1,nz:0},{x:-31,y:4,z:-2,nx:1,nz:0},{x:32,y:4,z:14,nx:-1,nz:0},{x:30,y:4,z:6,nx:-1,nz:0},{x:32,y:4,z:-2,nx:-1,nz:0},{x:-12,y:3.5,z:4,nx:0,nz:-1},{x:-8,y:3.5,z:4,nx:0,nz:-1},{x:-4,y:3.5,z:4,nx:0,nz:-1},{x:4,y:3.5,z:4,nx:0,nz:-1},{x:8,y:3.5,z:4,nx:0,nz:-1},{x:12,y:3.5,z:4,nx:0,nz:-1},{x:-8,y:3.5,z:-11.5,nx:0,nz:1},{x:8,y:3.5,z:-11.5,nx:0,nz:1},{x:-24,y:11,z:-11,nx:0,nz:1},{x:-8,y:11,z:-11.5,nx:0,nz:1},{x:8,y:11,z:-11.5,nx:0,nz:1},{x:24,y:11,z:-11,nx:0,nz:1}]}};var h=class{constructor(){this.devMode=!1,this.isMobile=s(),this.el={openGallery:document.querySelector(".open-gallery-prompt"),archiveItems:document.querySelectorAll(".section--archive"),preview:document.querySelector(".section--preview"),featured:document.querySelector(".section--featured"),fromTheArchive:document.querySelector(".section--from-the-archive"),default:document.querySelector(".section--default"),logo:document.querySelector("#logo"),gallery:{gallery:document.querySelector(".gallery"),controls:document.querySelector("#gallery-controls"),controlsPopup:document.querySelector("#popup-gallery-controls"),navItems:document.querySelector(".gallery .nav__item"),navItemGallery:document.querySelector("#nav-item-gallery"),navItemControls:document.querySelector("#nav-item-controls"),artworkInfoPopup:document.querySelector("#popup-artwork-info"),artworkInfoPopupInner:document.querySelector("#popup-artwork-info .popup-artwork-info__inner"),artworkInfoPopupDetails:document.querySelector("#popup-artwork-info .popup-artwork-info__details"),artworkInfoPopupImage:document.querySelector("#popup-artwork-info .image"),artworkInfoPopupTitle:document.querySelector("#popup-artwork-info .title"),artworkInfoPopupSubtitle:document.querySelector("#popup-artwork-info .subtitle"),artworkInfoPopupDesc:document.querySelector("#popup-artwork-info .desc"),artworkInfoPopupLink:document.querySelector("#popup-artwork-info .link"),artworkInfoPopupClose:document.querySelector("#popup-artwork-info-close")}}}bind(e){this.ref={},this.ref.gallery=e.modules.gallery,this.ref.logo=e.modules.logo;const t=this.el.preview?this.el.preview:this.el.featured?this.el.featured:this.el.fromTheArchive?this.el.fromTheArchive:this.el.default;let i=null;if(t&&(i=this.parseExhibitionDataTags(t)),this.ref.gallery.load(i),this.el.preview||this.el.featured||this.el.fromTheArchive||!this.el.default||this.el.default.classList.remove("hidden"),this.el.featured&&this.el.fromTheArchive){const e=this.el.fromTheArchive;e&&!e.classList.contains("clickable")&&(e.classList.add("clickable"),e.addEventListener("click",()=>{const t=this.parseExhibitionDataTags(e);this.ref.gallery.load(t),this.makeClickable(this.el.featured)}))}this.devMode&&this.forceGalleryOpen();const s=r();if(s&&"single"==s){const e=document.querySelector(".nav--gallery"),t=document.querySelector(".footer--gallery");e&&(e.style.opacity=0,e.style.pointerEvents="none"),t&&(t.style.opacity=0,t.style.pointerEvents="none"),this.forceGalleryOpen()}this.bindEvents()}bindEvents(){if(this.el.openGallery.addEventListener("click",()=>{this.onOpenGallery()}),document.querySelectorAll(".close-gallery").forEach(e=>{e.addEventListener("click",()=>{this.onCloseGallery()})}),document.querySelectorAll(".wrapper .nav__item").forEach(e=>{e.addEventListener("click",e=>{this.onWrapperNavItem(e.target)})}),document.querySelectorAll(".mobile-menu__item").forEach(e=>{e.addEventListener("click",t=>{this.onMobileMenuItem(e)})}),this.el.archiveItems.forEach(e=>{e.addEventListener("click",t=>{if("A"!==t.target.tagName){const t=this.parseExhibitionDataTags(e);if(this.ref.gallery.load(t),this.isMobile&&window.innerWidth<=n.mobileBreakpoint){const e=document.querySelector('.mobile-menu__item[data-target="#page-home"]');e&&e.click()}const i=this.el.preview?this.el.preview:this.el.featured?this.el.featured:this.el.fromTheArchive?this.el.fromTheArchive:this.el.default;this.makeClickable(i)}})}),this.el.gallery.navItemGallery.addEventListener("click",()=>{this.closeControlsPopup(),this.closeArtworkInfo()}),this.el.gallery.navItemControls.addEventListener("click",e=>{e.target.classList.contains("active")?this.closeControlsPopup():(this.openControlsPopup(),this.closeArtworkInfo())}),this.el.gallery.controlsPopup.addEventListener("click",()=>{this.closeControlsPopup()}),this.el.gallery.artworkInfoPopupClose.addEventListener("click",()=>{this.closeArtworkInfo()}),this.el.gallery.artworkInfoPopup.addEventListener("click",e=>{this.closeArtworkInfo()}),this.el.gallery.artworkInfoPopupDetails.addEventListener("click",e=>{e.stopPropagation()}),document.querySelectorAll(".open-mobile-menu-button").forEach(e=>{e.addEventListener("click",()=>{e.classList.contains("active")?this.closeMobileMenu():this.openMobileMenu(e)})}),this.resize(),window.addEventListener("resize",()=>{this.resize()}),window.addEventListener("orientationchange",()=>{setTimeout(()=>{window.dispatchEvent(new Event("resize"))},500)}),window.location.hash){const e=`#page-${window.location.hash.replace("#","")}`,t=document.querySelector(`[data-target="${e}"]`);t&&t.click()}}makeClickable(e){e&&!e.classList.contains("clickable")&&(e.classList.add("clickable"),e.addEventListener("click",()=>{const t=this.parseExhibitionDataTags(e);this.ref.gallery.load(t)}))}removeLoadingScreen(){const e=document.querySelector(".loading-screen");e&&(e.classList.remove("active"),setTimeout(()=>{e.parentNode.removeChild(e)},500))}resize(){if(this.isMobile){const e=window.innerHeight+"px";document.querySelector(".gallery").style.height=e,document.querySelector(".logo").style.height=window.innerWidth<=n.mobileBreakpoint?e:"300px"}}parseExhibitionDataTags(e){const t={};return t.id=e.querySelector("[data-id]").dataset.id,t.title=e.querySelector(".section__title").innerHTML,t.artistName=e.querySelector(".section__heading").innerHTML,t.date=e.querySelector(".section__date").innerHTML,t.images=[],e.querySelectorAll(".section__image").forEach(e=>{const i={};Object.keys(e.dataset).forEach(t=>{i[t]=e.dataset[t]}),i.horizontalOffset=parseFloat(i.horizontalOffset),i.verticalOffset=parseFloat(i.verticalOffset),i.width=parseFloat(i.width),i.location=parseInt(i.location),i.imageWidth=parseInt(i.imageWidth),i.imageHeight=parseInt(i.imageHeight),t.images.push(i)}),t.customValue=e.querySelector(".section__custom-value").dataset.customValue,t}onOpenGallery(){this.el.openGallery.classList.contains("loading")||(this.ref.logo.pause(),this.el.openGallery.classList.remove("prompt-action"),document.querySelector("html").classList.add("freeze"),document.querySelector(".wrapper").classList.remove("active"),this.el.logo.classList.remove("active"),document.querySelectorAll(".mobile-menu__item.active").forEach(e=>{e.classList.remove("active")}),this.scrollToTop(),this.el.gallery.gallery.classList.add("transition"),setTimeout(()=>{this.el.gallery.gallery.classList.add("active")},100),setTimeout(()=>{this.el.logo.classList.remove("transition"),this.ref.gallery.start()},1100),this.isMobile&&window.innerWidth<=n.mobileBreakpoint&&this.openControlsPopup())}onCloseGallery(){this.ref.gallery.pause(),this.ref.logo.start(),this.closeArtworkInfo(),document.querySelector("html").classList.remove("freeze"),document.querySelector(".gallery").classList.remove("active"),this.el.logo.classList.add("transition"),setTimeout(()=>{document.querySelector(".wrapper").classList.add("active"),this.el.logo.classList.add("active")},100),setTimeout(()=>{document.querySelector(".gallery").classList.remove("transition")},1100)}forceGalleryOpen(){this.ref.logo.pause(),this.el.openGallery.classList.remove("prompt-action"),document.querySelector("html").classList.add("freeze"),document.querySelector(".wrapper").classList.remove("active"),document.querySelector(".logo").classList.remove("active"),this.scrollToTop(),this.el.gallery.gallery.classList.add("active"),this.ref.gallery.start()}openArtworkInfo(e){if(!e.isArtworkMenuMine()&&(this.el.gallery.artworkInfoPopup.dataset.id=e.id,this.el.gallery.artworkInfoPopupTitle.innerHTML=e.data.title,this.el.gallery.artworkInfoPopupSubtitle.innerHTML=e.data.subTitle,this.el.gallery.artworkInfoPopupDesc.innerHTML=e.data.description,this.el.gallery.artworkInfoPopupLink.innerHTML=e.data.link?`<a href='${e.data.link}' target='_blank'>Link</a>`:"",e.data.imageHeight&&e.data.imageWidth)){const t=e.data.imageWidth,i=e.data.imageHeight;if(t/i<window.innerWidth/window.innerHeight){const e=this.isMobile?.65:.75,s=this.isMobile?.85:.95,r=window.innerHeight*e,o=Math.min(r*(t/i),window.innerWidth*s);this.el.gallery.artworkInfoPopupInner.style.width=`${Math.round(o)}px`,this.el.gallery.artworkInfoPopupInner.style.height=`${Math.round(r)}px`}else{const e=this.isMobile?.75:.85,s=this.isMobile?.65:.75,r=window.innerWidth*e,o=Math.min(r*(i/t),window.innerHeight*s);this.el.gallery.artworkInfoPopupInner.style.width=`${Math.round(r)}px`,this.el.gallery.artworkInfoPopupInner.style.height=`${Math.round(o)}px`}this.el.gallery.artworkInfoPopupImage.innerHTML=`<img src="${e.data.url}"/>`}this.el.gallery.artworkInfoPopup.classList.add("active"),this.el.gallery.controls.classList.remove("active"),this.el.gallery.controlsPopup.classList.remove("active"),this.el.gallery.navItemControls.classList.remove("active"),this.el.gallery.navItemGallery.classList.add("active")}closeArtworkInfo(){this.el.gallery.artworkInfoPopup.classList.remove("active"),this.el.gallery.controls.classList.add("active")}openControlsPopup(){this.el.gallery.controlsPopup.classList.add("active"),this.el.gallery.controls.classList.remove("active"),this.el.gallery.navItemControls.classList.add("active"),this.el.gallery.navItemGallery.classList.remove("active")}closeControlsPopup(){this.el.gallery.controlsPopup.classList.remove("active"),this.el.gallery.controls.classList.add("active"),this.el.gallery.navItemControls.classList.remove("active"),this.el.gallery.navItemGallery.classList.add("active")}openMobileMenu(e){e.classList.add("active");const t=document.querySelector(e.dataset.target);t&&t.classList.add("active")}closeMobileMenu(){document.querySelectorAll(".mobile-menu__button").forEach(e=>{e.classList.remove("active")}),document.querySelectorAll(".mobile-menu").forEach(e=>{e.classList.remove("active")})}onMobileMenuItem(e){if(e.dataset.target){const t=document.querySelector(e.dataset.target);t&&(document.querySelectorAll(".page.active, .mobile-menu__item").forEach(e=>{e.classList.remove("active")}),t.classList.add("active"),e.classList.add("active"),window.location.hash=`${e.dataset.target.split("-")[1]}`,this.closeMobileMenu(),this.scrollToTop(),this.ref.gallery.active&&this.onCloseGallery(),"#page-home"===e.dataset.target?this.el.logo.classList.remove("hidden"):this.el.logo.classList.add("hidden"))}}onWrapperNavItem(e){if(e.dataset.target){const t=document.querySelector(e.dataset.target);t&&(document.querySelectorAll(".page.active, .wrapper .nav__item.active").forEach(e=>{e.classList.remove("active")}),t.classList.add("active"),e.classList.add("active"),window.location.hash=`${e.dataset.target.split("-")[1]}`)}}scrollToTop(){document.documentElement.scrollTop=0,window.scrollTo(0,0)}};i(0),i(1);var l=class{constructor(e){this.path=`${APP_ROOT}/${e}/`,this.materials={},this.images={},this.loaderFBX=new THREE.FBXLoader,this.loaderOBJ=new THREE.OBJLoader}loadFBX(e){return new Promise((t,i)=>{try{this.loaderFBX.load(this.path+e+".fbx",e=>{t(e)})}catch(e){console.log(e),i(e)}})}loadOBJ(e){return new Promise((t,i)=>{try{this.loaderOBJ.load(this.path+e+".obj",e=>{t(e)})}catch(e){console.log(e),i(e)}})}};var c=class{constructor(){this.scene=new THREE.Scene,this.camera=new THREE.OrthographicCamera(-2.5,2.5,2.5,-2.5,1,100),this.camera.position.set(10,5,10),this.camera.lookAt(0,1.5,0),this.scene.add(this.camera),this.loaded=!1,this.loader=new l("assets/logo"),this.dLight1=new THREE.DirectionalLight(16777215,1),this.dLight2=new THREE.DirectionalLight(4243884,1),this.dLight3=new THREE.DirectionalLight(16777215,1),this.dLight3.position.set(1,.5,-.25),this.scene.add(this.dLight1),this.scene.add(this.dLight2),this.scene.add(this.dLight3),this.renderer=new THREE.WebGLRenderer({alpha:!0,antialias:!0}),this.renderer.setClearColor(0,0),this.domTarget=document.querySelector("#canvas-logo-target"),this.resize(),window.addEventListener("resize",()=>{this.resize()}),this.domTarget.appendChild(this.renderer.domElement),document.querySelector("#logo").addEventListener("mouseenter",()=>{this.children&&this.children.forEach(e=>{e.material.color.setHex(4243884)})}),document.querySelector("#logo").addEventListener("mouseleave",()=>{this.children&&this.children.forEach(e=>{e.material.color.setHex(3355443),e.position.set(0,0,0)})}),this.loop()}bind(e){this.ref={},this.ref.nav=e.modules.nav,this.loader.loadFBX("logo").then(e=>{this.logo=e,this.children=[];const t=new THREE.MeshPhysicalMaterial({color:3355443,metalness:.75,emissive:3355443,emissiveIntensity:1,side:THREE.DoubleSide}),i=new THREE.Box3,s=e=>{"Group"===e.type?e.children.forEach(e=>{s(e)}):(e.material=t,i.setFromObject(e),i.max.z-i.min.z<2&&(e.customVector=new THREE.Vector3(0,0,0),-1!==e.name.indexOf("x_pos")?e.customVector.x=1:-1!==e.name.indexOf("y_neg")?e.customVector.y=-1:-1!==e.name.indexOf("y_pos")?e.customVector.y=1:-1!==e.name.indexOf("z_pos")&&(e.customVector.z=1),this.children.push(e)))};s(e),this.scene.add(e),this.loaded=!0,this.start(),this.ref.nav.removeLoadingScreen()})}start(){this.age=this.age?this.age:0,this.timer={previous:performance.now()},this.active=!0,document.querySelector("#canvas-logo-target").classList.add("active")}pause(){this.active=!1,document.querySelector("#canvas-logo-target").classList.remove("active")}resize(){window.innerWidth<=n.mobileBreakpoint?this.screenSize=window.innerWidth-10:this.screenSize=window.innerWidth>window.innerHeight?Math.round(.3*window.innerWidth):Math.round(.3*window.innerHeight),this.domTarget.style.width=`${this.screenSize}px`,this.domTarget.style.height=`${this.screenSize}px`,window.devicePixelRatio>1&&(this.screenSize*=window.devicePixelRatio),this.renderer.setSize(this.screenSize,this.screenSize)}updateChild(e,t){if(e.customAnimation){const i=e.customAnimation;i.age+=t;const s=Math.max(i.minT,Math.min(i.maxT,i.age/i.duration));e.position.x=i.from.x+(i.to.x-i.from.x)*s,e.position.y=i.from.y+(i.to.y-i.from.y)*s,e.position.z=i.from.z+(i.to.z-i.from.z)*s}if(Math.random()>.97)if(e.customAnimation={duration:.1+1*Math.random(),from:e.position.clone(),minT:Math.random()>.25?0:Math.random(),maxT:Math.random()>.25?1:1+.25*Math.random(),age:0},Math.random()>.65)e.customAnimation.to=new THREE.Vector3(0,0,0);else{const t=.025+.125*Math.random();e.customAnimation.to=e.customVector.clone(),e.customAnimation.to.multiplyScalar(t)}}update(){if(this.active){const e=performance.now(),t=Math.min(.1,(e-this.timer.previous)/1e3);this.timer.previous=e,this.age+=.125*t,this.dLight1.position.set(Math.sin(this.age),Math.cos(this.age),0),this.dLight2.position.set(Math.cos(this.age),0,-Math.sin(this.age)),this.children&&this.children.forEach(e=>{this.updateChild(e,t)}),this.renderer.render(this.scene,this.camera)}}mobileLoop(){setTimeout(()=>{this.mobileLoop()},Math.round(1e3/30)),this.update()}loop(){requestAnimationFrame(()=>{this.loop()}),this.update()}};var p=class{constructor(e){this.fov=65,this.aspectRatio=n.renderer.getWidth()/n.renderer.getHeight(),this.offset=.1,this.camera=new THREE.PerspectiveCamera(this.fov,this.aspectRatio,.1,2e6),this.camera.up=new THREE.Vector3(0,1,0),this.camera.rotation.order="YXZ"}bind(e){this.ref={},this.ref.player=e.modules.player,window.addEventListener("resize",()=>{this.resize()})}addAudioListener(){this.listener=new THREE.AudioListener,this.camera.add(this.listener)}resize(){this.aspectRatio=n.renderer.getWidth()/n.renderer.getHeight(),this.camera.aspect=this.aspectRatio,this.camera.updateProjectionMatrix()}update(e){this.offset,this.offset,Math.abs(Math.sin(this.ref.player.rotation.y)),this.offset,this.ref.player.position.y,this.ref.player.height,this.camera.position.set(this.ref.player.position.x,this.ref.player.position.y+this.ref.player.height,this.ref.player.position.z),this.camera.rotation.y=this.ref.player.rotation.x+Math.PI,this.camera.rotation.x=this.ref.player.rotation.y}};var u=class{constructor(e,t,i){this.cvs=document.createElement("canvas"),this.ctx=this.cvs.getContext("2d"),document.querySelector("#canvas-target").appendChild(this.cvs),this.resize(),this.prompt={},this.prompt.touchMove={alpha:{current:0,min:0,max:1},size:{current:44,min:44,max:50}},this.prompt.click={alpha:{current:0,min:0,max:1}}}bind(e){this.ref={},this.ref.player=e.modules.player,this.ref.renderer=e.modules.renderer,window.addEventListener("resize",()=>{this.resize()})}clear(){this.ctx.clearRect(0,0,this.cvs.width,this.cvs.height),this.ctx.font="16px Karla",this.ctx.strokeStyle="#fff",this.ctx.fillStyle="#fff",this.ctx.lineWidth=1.5,this.ctx.lineCap="round"}resize(){this.cvs.width=n.renderer.getWidth(),this.cvs.height=n.renderer.getHeight()}promptClick(e,t,i,s){this.prompt.click.alpha.current+=t?.2*(this.prompt.click.alpha.max-this.prompt.click.alpha.current):.2*(this.prompt.click.alpha.min-this.prompt.click.alpha.current),this.prompt.click.alpha.current>0&&(this.ctx.globalAlpha=this.prompt.click.alpha.current,this.ctx.fillText(e,i+12,s+12))}drawBoxHint(e,t,i,s,r,o){if(this.ctx.beginPath(),this.ctx.moveTo(e-i,t-s+r),this.ctx.lineTo(e-i,t-s),this.ctx.lineTo(e-i+r,t-s),this.ctx.moveTo(e+i-r,t-s),this.ctx.lineTo(e+i,t-s),this.ctx.lineTo(e+i,t-s+r),this.ctx.moveTo(e+i,t+s-r),this.ctx.lineTo(e+i,t+s),this.ctx.lineTo(e+i-r,t+s),this.ctx.moveTo(e-i+r,t+s),this.ctx.lineTo(e-i,t+s),this.ctx.lineTo(e-i,t+s-r),this.ctx.stroke(),o){const r=e-i+5,a=t-s+14;this.ctx.fillStyle="#f00",this.ctx.fillText(o,r+2,a+2),this.ctx.fillStyle="#fff",this.ctx.fillText(o,r,a)}}promptTouchMove(e){if(e?(this.prompt.touchMove.alpha.current+=.2*(this.prompt.touchMove.alpha.max-this.prompt.touchMove.alpha.current),this.prompt.touchMove.size.current+=.2*(this.prompt.touchMove.size.max-this.prompt.touchMove.size.current)):(this.prompt.touchMove.alpha.current+=.2*(this.prompt.touchMove.alpha.min-this.prompt.touchMove.alpha.current),this.prompt.touchMove.size.current+=.2*(this.prompt.touchMove.size.min-this.prompt.touchMove.size.current)),this.prompt.touchMove.alpha.current>0){const e=this.cvs.width/2,t=this.cvs.height/2,i=this.prompt.touchMove.size.current;this.ctx.globalAlpha=this.prompt.touchMove.alpha.current,this.drawBoxHint(e,t,i,i,10)}}promptGodMode(){this.ctx.globalAlpha=1,this.ctx.fillText("FREE MODE",20,this.cvs.height-60);const e=Math.round(100*Math.sin(this.ref.player.rotation.x))/100,t=Math.round(100*Math.cos(this.ref.player.rotation.x))/100;this.ctx.fillText(`sinx ${e}, cosx ${t}`,20,this.cvs.height-40);const i=Math.round(10*this.ref.player.position.x)/10,s=Math.round(10*this.ref.player.position.y)/10,r=Math.round(10*this.ref.player.position.z)/10;this.ctx.fillText(`x ${i}, y ${s}, z ${r}`,20,this.cvs.height-20)}drawDevOverlay(){}getContext(){return this.ctx}};var d=class{constructor(e,t,i,s){this.onscreen=!0,this.position=e,this.rotation=t,this.clipping=i||null,this.coords=new THREE.Vector2,this.helper=new THREE.Vector3,this.root=s,this.active=!0,this.hover=!1,this.cornersOK=!1,this.clickable=!1,this.buttonActive=!1,this.buttonRadius=50,this.buttonPosition=new THREE.Vector2,this.buttonPosition.isClamped=!1,this.buttonHover=!1,this.textColour=Math.abs(e.x)<=16&&(e.z>10||e.z<0)?"#000":"#fff",this.radius={min:this.root.isMobile?10:9,max:32},this.corners={world:{a:new THREE.Vector3,b:new THREE.Vector3,c:new THREE.Vector3,d:new THREE.Vector3},screen:{a:new THREE.Vector2,b:new THREE.Vector2,c:new THREE.Vector2,d:new THREE.Vector2}},this.distance=-1,this.resize()}setCorners(){const e=this.root.position,t=this.root.direction,i=this.root.board.scale,s=t.x*this.root.thickness/2,r=t.z*this.root.thickness/2;this.corners.world.a.set(e.x-(0!=t.x?0:.5*i.x)+s,e.y+.5*i.y,e.z-(0!=t.z?0:.5*i.z)+r),this.corners.world.b.set(e.x+(0!=t.x?0:.5*i.x)+s,e.y+.5*i.y,e.z+(0!=t.z?0:.5*i.z)+r),this.corners.world.c.set(e.x+(0!=t.x?0:.5*i.x)+s,e.y-.5*i.y,e.z+(0!=t.z?0:.5*i.z)+r),this.corners.world.d.set(e.x-(0!=t.x?0:.5*i.x)+s,e.y-.5*i.y,e.z-(0!=t.z?0:.5*i.z)+r)}pointToScreen(e,t,i,s){const r=e.clone();r.project(t),s.x=(r.x+1)*i.x,s.y=(1-r.y)*i.y}updateCorners(e,t){this.pointToScreen(this.corners.world.a,e,t,this.corners.screen.a),this.pointToScreen(this.corners.world.b,e,t,this.corners.screen.b),this.pointToScreen(this.corners.world.c,e,t,this.corners.screen.c),this.pointToScreen(this.corners.world.d,e,t,this.corners.screen.d),this.cornersOK=this.corners.screen.a.y<this.corners.screen.c.y&&this.corners.screen.b.y<this.corners.screen.d.y&&Math.abs(this.corners.screen.a.x-this.corners.screen.b.x)<window.innerWidth&&!(this.corners.screen.a.x<0&&this.corners.screen.c.x<0)&&!(this.corners.screen.a.x>this.rect.width&&this.corners.screen.c.x>this.rect.width),this.buttonPosition.x=Math.max(this.corners.screen.c.x,this.corners.screen.d.x),this.buttonPosition.y=(this.buttonPosition.x==this.corners.screen.c.x?this.corners.screen.c.y:this.corners.screen.d.y)+18,this.buttonPosition.isClamped=(this.buttonPosition.x>this.rect.width||this.buttonPosition.y>this.rect.height)&&this.rect.width>Math.min(this.corners.screen.a.x,this.corners.screen.b.x)&&this.rect.width>Math.min(this.corners.screen.c.x,this.corners.screen.d.x),this.buttonPosition.isClamped&&(this.buttonPosition.x=this.rect.width-16,this.buttonPosition.y=this.rect.height-16)}disableInfoTag(){this.infoTagDisabled=!0}isCorrectQuadrant(e){return e.x<=-16||e.x>=16||this.position.x>=16||this.position.x<=-16||e.z>=6&&this.position.z>=6||e.z<=6&&this.position.z<=6}mouseOver(e,t,i){if(this.active&&this.onscreen&&this.cornersOK&&this.isCorrectQuadrant(i)){const i=Math.min(this.corners.screen.a.x,this.corners.screen.b.x,this.corners.screen.c.x,this.corners.screen.d.x)-10,s=Math.max(this.corners.screen.a.x,this.corners.screen.b.x,this.corners.screen.c.x,this.corners.screen.d.x)+10,r=Math.min(this.corners.screen.a.y,this.corners.screen.b.y)-10,o=Math.max(this.corners.screen.c.y,this.corners.screen.d.y)+10;this.buttonHover=this.buttonActive&&Math.hypot(this.buttonPosition.x-e,this.buttonPosition.y-t)<this.buttonRadius+10,this.hover=this.buttonHover||e>=i&&e<=s&&t>=r&&t<=o,this.buttonPosition.isClamped&&!this.hover&&(this.hover=this.buttonPosition.x>s&&e>=s-100&&t>=this.rect.height-100)}else this.hover=!1,this.buttonHover=!1;this.setClickable()}setClickable(){this.clickable=this.onscreen&&this.active&&this.hover&&this.cornersOK}isClickable(){return this.clickable}calculateNodePosition(e,t,i){this.helper.copy(e.position),this.helper.sub(this.position),this.helper.normalize(),this.helper.dot(t)<=0?(this.onscreen=!0,this.helper.copy(this.position),this.helper.project(e),this.coords.x=(this.helper.x+1)*i.x,this.coords.y=(1-this.helper.y)*i.y):this.onscreen=!1,this.clipping&&this.onscreen&&(this.helper.copy(e.position),this.helper.sub(this.position),this.helper.dot(this.clipping)<0&&(this.onscreen=!1))}update(e,t,i,s,r){this.calculateNodePosition(i,s,r),this.distance=t.position.distanceTo(this.position),this.active=this.distance<=this.radius.max,this.active&&(this.updateCorners(i,r),this.buttonActive=this.distance<=this.radius.min),this.setClickable()}draw(e){return!!this.clickable&&(e.globalAlpha=1,e.beginPath(),e.moveTo(this.corners.screen.a.x,this.corners.screen.a.y),e.lineTo(this.corners.screen.b.x,this.corners.screen.b.y),e.lineTo(this.corners.screen.c.x,this.corners.screen.c.y),e.lineTo(this.corners.screen.d.x,this.corners.screen.d.y),e.closePath(),e.stroke(),this.buttonActive&&(e.fillStyle=this.textColour,e.textAlign="right",e.globalAlpha=this.buttonHover&&!this.infoTagDisabled?.6:1,this.infoTagDisabled||e.fillText("[INFO]",this.buttonPosition.x,this.buttonPosition.y)),!0)}resize(){this.rect=document.querySelector("#canvas-target").getBoundingClientRect()}};var m=class{constructor(e,t,i,s,r){this.sceneRef=e,this.radius=17,this.refDistance=2,this.rolloff=1.4,this.active=!0,this.video=document.createElement("video"),this.video.src=t,this.video.muted="muted",this.video.loop=!0,this.video.load(),""!==i?(this.object3D=new THREE.Object3D,this.object3D.position.copy(s),this.sceneRef.add(this.object3D),this.cameraRef=r,this.audioSrc=i,this.audioRequired=!0):this.audioRequired=!1}initAudio(){this.cameraRef.listener||this.cameraRef.addAudioListener(),this.audio=new THREE.PositionalAudio(this.cameraRef.listener),this.audioContext=this.audio.context,this.audioLoader=new THREE.AudioLoader,this.audioLoader.load(this.audioSrc,e=>{this.active&&(this.audio.setBuffer(e),this.audio.setRefDistance(this.refDistance),this.audio.setRolloffFactor(this.rolloff),this.audio.setDistanceModel("exponential"),this.audio.loop=!0,this.audio.setVolume(0),this.audio.play(),this.syncTracks(),this.fadeInRequired=!0)}),this.object3D.add(this.audio),this.audioRequired=!1}fadeInAudio(){if(this.active){const e=Math.min(1,this.audio.getVolume()+.01);1==e&&(this.fadeInRequired=!1),this.audio.setVolume(e)}}pauseVideo(){this.video.paused||this.video.pause()}resumeVideo(){this.video.paused&&(this.syncTracks(),this.video.play())}syncTracks(){if(this.audioContext){const e=this.audioContext.currentTime;this.video.currentTime=e>this.video.duration?e%this.video.duration:e}}update(e){this.audioRequired&&this.initAudio(),this.fadeInRequired&&this.fadeInAudio(),this.object3D.position.distanceTo(e)>this.radius?this.pauseVideo():this.resumeVideo()}destroy(){this.active=!1,this.object3D&&(this.sceneRef.remove(this.object3D),this.audio&&this.audio.isPlaying&&(this.object3D.remove(this.audio),this.audio.pause())),this.video&&this.video.pause()}getElement(){return this.video}};var f=class{constructor(e,t,i,s){this.root=e,this.ref={},this.ref.nav=e.ref.nav,this.ref.materials=e.ref.materials,this.id="artwork-"+t,this.index=t,this.data=i,this.isMobile=s,this.active=!1,this.position=new THREE.Vector3,this.direction=new THREE.Vector3,this.nearRadius=5,this.thickness=.2,this.artworkMenuActive=!0}init(e,t,i){this.sceneReference=e;const s=this.thickness/2+.01;this.board=new THREE.Mesh(new THREE.BoxBufferGeometry(1,1,1),new THREE.MeshStandardMaterial({color:0,roughness:.75,metalness:0})),this.plane=new THREE.Mesh(new THREE.PlaneBufferGeometry(1,1),new THREE.MeshStandardMaterial({roughness:1,metalness:.5})),this.baseY=t.y,t.x+=(0!=i.x?0:1)*this.data.horizontalOffset,t.y+=this.data.verticalOffset,t.z+=(0!=i.z?0:1)*this.data.horizontalOffset,this.plane.position.set(t.x+i.x*s,t.y,t.z+i.z*s),this.position.set(t.x,t.y,t.z),this.direction.set(i.x,i.y,i.z),this.node=new d(t,null,i,this);const r=this.isMobile?1.5:.9;let o;if(this.viewPosition=new THREE.Vector3,this.viewPosition.y=Math.min(7.8,this.baseY-3),this.viewPosition.x=t.x+i.x*Math.min((t.y-this.viewPosition.y)*r,8),this.viewPosition.z=t.z+i.z*Math.min((t.y-this.viewPosition.y)*r,8),t.x>20&&t.z<-10?this.viewPosition.set(28,4.4,-8):t.x<-20&&t.z<-10&&this.viewPosition.set(-28,4.4,-8),this.viewRotation=new THREE.Vector2,this.viewRotation.y=Math.atan2(t.y-(this.viewPosition.y+this.root.ref.player.height)-.125,Math.hypot(t.x-this.viewPosition.x,t.z-this.viewPosition.z)),this.viewRotation.x=Math.atan2(t.x-this.viewPosition.x,t.z-this.viewPosition.z),this.board.scale.x=0!=i.x?this.thickness:1,this.board.scale.z=0!=i.z?this.thickness:1,this.board.position.set(t.x,t.y,t.z),""!==this.data.videoFile){const e=new THREE.Vector3;e.copy(this.plane.position),e.x+=i.x/2,e.z+=i.z/2,this.videoElement=new m(this.sceneReference,this.data.videoFile,this.data.audioFile,e,this.root.ref.camera),o=new THREE.VideoTexture(this.videoElement.getElement());const t=this.data.width,s=.5625*t;this.plane.scale.x=t,this.plane.scale.y=s,this.board.scale.x=0!=i.x?this.thickness:t,this.board.scale.y=s,this.board.scale.z=0!=i.z?this.thickness:t,this.node.setCorners()}else o=(new THREE.TextureLoader).load(this.data.url,e=>{const t=this.data.width*(e.image.naturalHeight/e.image.naturalWidth);this.plane.scale.x=this.data.width,this.plane.scale.y=t,this.board.scale.x=0!=i.x?this.thickness:this.data.width,this.board.scale.y=t,this.board.scale.z=0!=i.z?this.thickness:this.data.width,this.node.setCorners()});if(this.plane.material.map=o,o.wrapS=o.wrapT=THREE.ClampToEdgeWrapping,o.minFilter=THREE.LinearFilter,1==i.z||(-1==i.z?this.plane.rotation.y=Math.PI:1==i.x?this.plane.rotation.y=.5*Math.PI:-1==i.x&&(this.plane.rotation.y=1.5*Math.PI)),this.data.alphaMap){const e=(new THREE.TextureLoader).load(this.data.alphaMap,e=>{});e.wrapS=e.wrapT=THREE.ClampToEdgeWrapping,e.minFilter=THREE.LinearFilter,this.ref.materials.applyAlphaMap(this.plane.material,e)}e.add(this.plane),this.data.alphaMap||e.add(this.board)}mouseOver(e,t,i){this.node.mouseOver(e,t,i)}click(e,t,i){return this.node.mouseOver(e,t,i),!!this.node.isClickable()&&(this.root.moveToArtwork(this),this.isArtworkMenuMine()||this.ref.nav.closeArtworkInfo(),this.artworkMenuActive&&this.node.buttonActive&&this.node.buttonHover&&this.ref.nav.openArtworkInfo(this),!0)}disableArtworkMenu(){this.artworkMenuActive=!1,this.node.disableInfoTag()}isArtworkMenuMine(){const e=this.ref.nav.el.gallery.artworkInfoPopup,t=e.querySelector("img");return t?e.dataset.id===this.id&&t.src===this.data.url:e.dataset.id===this.id}update(e,t,i,s,r){this.node.update(e,t,i,s,r),this.videoElement&&this.videoElement.update(t.position)}draw(e){return this.node.draw(e)}destroy(){this.sceneReference.remove(this.plane),this.sceneReference.remove(this.board),this.videoElement&&this.videoElement.destroy()}removeHover(){this.node.hover=!1}forceHover(){this.node.hover=!0}getFloorPosition(){return this.floorPosition}isClickable(){return this.node.isClickable()}resize(){this.node.resize()}};var v=class{constructor(){this.isMobile=s(),this.artworks=[],this.artworkActiveRadius=10}bind(e){this.ref={},this.ref.player=e.modules.player,this.ref.camera=e.modules.camera,this.ref.scene=e.modules.scene.scene,this.ref.surface=e.modules.surface,this.ref.cameraDirection=new THREE.Vector3,this.ref.nav=e.ref.nav,this.ref.materials=e.modules.materials}load(e){if(this.unload(),e&&e.images){const t=[];e.images.forEach(e=>{const i=new f(this,this.artworks.length,e,this.isMobile),s=i.data.location-1;if(s<n.floorPlan.artworkPositions.length){const e=n.floorPlan.artworkPositions[s];-1==t.indexOf(s)?t.push(s):console.log("Warning: Duplicate slot reference:",s),i.init(this.ref.scene,new THREE.Vector3(e.x,e.y,e.z),new THREE.Vector3(e.nx,0,e.nz)),this.artworks.push(i)}else console.log("Warning: No valid slot:",s)})}}unload(){this.artworks.forEach(e=>{try{e.destroy()}catch(e){console.log(e)}}),this.artworks=[]}mouseOver(e,t){for(var i=[],s=0,r=this.artworks.length;s<r;++s)this.artworks[s].mouseOver(e,t,this.ref.player.position),this.artworks[s].isClickable()&&i.push(this.artworks[s]);if(i.length>1){var o=100,a=i[0];for(s=0;s<i.length;++s){i[s].removeHover();const e=this.ref.player.position.distanceTo(i[s].position);e<o&&(o=e,a=i[s])}a.forceHover()}return i.length>0}click(e,t){for(var i=0,s=this.artworks.length;i<s&&!this.artworks[i].click(e,t,this.ref.player.position);++i);}moveToArtwork(e){this.ref.player.moveToArtwork(e)}update(e){this.ref.camera.camera.getWorldDirection(this.ref.cameraDirection);for(var t=0,i=this.artworks.length;t<i;++t)this.artworks[t].update(e,this.ref.player,this.ref.camera.camera,this.ref.cameraDirection,this.ref.surface.centre)}draw(e){for(var t=0,i=this.artworks.length;t<i&&!this.artworks[t].draw(e);++t);}resize(){this.artworks.forEach(e=>{e.resize()})}};var g=class{constructor(){this.lightingModel=s()?1:2,this.lights={point:{},ambient:{},directional:{},hemisphere:{},spot:{}},this.lights.point.a=new THREE.PointLight(16777215,1,24,this.lightingModel),this.lights.point.b=new THREE.PointLight(16777215,1,32,this.lightingModel),this.lights.point.c=new THREE.PointLight(16777215,1,20,this.lightingModel),this.lights.ambient.a=new THREE.AmbientLight(16777215,.3),this.lights.directional.a=new THREE.DirectionalLight(16777215,.5),this.lights.hemisphere.a=new THREE.HemisphereLight(0,255,.25),this.lights.spot.a=new THREE.SpotLight(16777215,1,32,Math.PI/3,.25),this.lights.spot.b=new THREE.SpotLight(16777215,0,32,Math.PI/3,.25)}bind(e){this.ref={},this.ref.scene=e.modules.scene.scene,this.ref.materials=e.modules.materials}load(e){if(this.updateCallback=null,this.lights.point.a.position.set(-8,10,14),this.lights.point.b.position.set(0,10,-4),this.lights.point.c.position.set(26,10,6),this.lights.directional.a.position.set(-1,1.5,-1),this.lights.spot.a.position.set(0,10,14),this.lights.spot.a.target.position.set(-4,0,6),this.lights.spot.b.position.set(0,-1,0),this.lights.spot.b.target.position.set(0,-2,0),this.lights.point.a.intensity=1,this.lights.point.b.intensity=1,this.lights.point.c.intensity=1,this.lights.ambient.a.intensity=.3,this.lights.directional.a.intensity=.5,this.lights.hemisphere.a.intensity=.25,this.lights.spot.a.intensity=1,this.lights.spot.b.intensity=0,this.lights.point.a.color.setHex(16777215),this.lights.point.b.color.setHex(16777215),this.lights.point.c.color.setHex(16777215),this.lights.ambient.a.color.setHex(16777215),this.lights.spot.a.color.setHex(16777215),this.lights.spot.b.color.setHex(16777215),this.lights.point.a.distance=24,this.lights.point.c.distance=20,this.lights.spot.a.distance=32,this.lights.spot.a.angle=Math.PI/3,this.lights.spot.a.penumbra=.25,Object.keys(this.lights).forEach(e=>{Object.keys(this.lights[e]).forEach(t=>{const i=this.lights[e][t];this.ref.scene.add(i),i.isSpotLight&&this.ref.scene.add(i.target)})}),this.ref.scene.fog=new THREE.FogExp2(0,0),e)switch(e.customValue){case"CEMENT":break;case"XAVIER":Object.keys(this.lights).forEach(e=>{Object.keys(this.lights[e]).forEach(t=>{this.lights[e][t].intensity=0})}),this.lights.spot.a.intensity=.5,this.lights.spot.a.color.setHex(16711680),this.lights.spot.a.angle=Math.PI/6,this.lights.spot.a.position.set(-24,14,8),this.lights.spot.a.target.position.set(-26,4,-6),this.lights.spot.b.intensity=1,this.lights.spot.b.color.setHex(255),this.lights.spot.b.position.set(20,12,8),this.lights.spot.b.target.position.set(28,5.5,4),this.lights.spot.b.penumbra=Math.PI/2,this.lights.point.b.position.set(4,10,0),this.lights.point.a.position.set(-4,10,12),this.lights.point.a.color.setHex(16711680),this.lights.point.b.color.setHex(255),this.lights.ambient.a.color.setHex(16713736);let t=0;this.updateCallback=e=>{t+=e;const i=.5*(Math.cos(t)+1);this.lights.ambient.a.intensity=.005+.025*i,this.lights.point.a.intensity=.5*i,this.lights.point.b.intensity=.8*(1-i)};break;case"TIYAN":this.ref.scene.remove(this.lights.directional.a),this.ref.scene.remove(this.lights.point.b),this.lights.ambient.a.intensity=.1,this.lights.point.b.position.set(6,10,14),this.lights.point.a.position.set(2,9,18),this.lights.point.a.distance=26,this.lights.point.c.position.set(-22,8,18),this.lights.hemisphere.a.intensity=.01;break;case"BRENTON":this.lights.spot.a.position.set(-26,10,1),this.lights.spot.a.target.position.set(-22,0,1),this.lights.spot.a.angle=Math.PI/6,this.lights.spot.a.penumbra=.1;break;case"JACK_DE_LACY":default:this.ref.scene.remove(this.lights.spot.a),this.ref.scene.remove(this.lights.spot.a.target)}}update(e){this.updateCallback&&this.updateCallback(e)}};var y=(e,t,i)=>Math.min(i,Math.max(t,e));var E=class{constructor(e,t,i,s,r,o,a){this.position=e,this.width=t,this.height=i,this.callback=s,this.normal=o,this.label=a||null,this.side=Math.sign(e.z-6),this.helper=new THREE.Vector3,this.worldVector=new THREE.Vector3,this.box={position:new THREE.Vector2,width:0,height:0},this.onscreen=!1,this.hover=!1,this.activeThreshold=30,this.ref={},this.ref.camera=r,this.bind()}bind(){this.resize=()=>{this.centre={x:n.renderer.getWidth()/2,y:n.renderer.getHeight()/2},this.ref.focalLength=this.ref.camera.getFocalLength()},this.resize(),window.addEventListener("resize",this.resize)}delete(){window.removeEventListener("resize",this.resize)}mouseMove(e,t){return this.hover=this.onscreen&&this.position.distanceTo(this.ref.camera.position)<this.activeThreshold&&Math.abs(this.box.position.x-e)<this.box.width/2&&Math.abs(this.box.position.y-t)<this.box.height/2,this.hover}click(e,t){this.mouseMove(e,t)&&this.callback()}update(){this.helper.copy(this.ref.camera.position),this.helper.sub(this.position),this.helper.normalize(),this.ref.camera.getWorldDirection(this.worldVector),this.onscreen=this.helper.dot(this.worldVector)<=0&&this.normal.dot(this.helper)>=0&&(Math.sign(this.ref.camera.position.z-6)==this.side||this.position.x>20);const e=this.position.distanceTo(this.ref.camera.position);this.onscreen&&e<this.activeThreshold&&0!=e&&(this.helper.copy(this.position),this.helper.project(this.ref.camera),this.box.position.x=(this.helper.x+1)*this.centre.x,this.box.position.y=(1-this.helper.y)*this.centre.y,this.ref.focalLength,this.box.width=2*Math.atan(this.width/(2*e))*window.innerHeight,this.box.height=2*Math.atan(this.height/(2*e))*window.innerHeight)}};const w=e=>e<.5?2*e*e:(4-2*e)*e-1;var T=class{constructor(e,t,i){this.position=t,this.target=i,this.ref={player:e},this.rotation=new THREE.Vector2,this.rotation.x=Math.atan2(this.target.x-this.position.x,this.target.z-this.position.z),this.rotation.y=Math.atan2(this.target.y-(this.position.y+this.ref.player.height)-.125,Math.hypot(this.target.x-this.position.x,this.target.z-this.position.z))}apply(){this.ref.player.position.distanceTo(this.position)>this.ref.player.automove.threshold.position.outer&&(this.ref.player.automove.position.copy(this.position),this.ref.player.automove.rotation.copy(this.rotation),this.ref.player.automove.active.position=!0,this.ref.player.automove.active.rotation=!0)}};var b=class{constructor(e){this.loader=new l("assets/xavier"),this.ref={scene:e.ref.scene,materials:e.ref.materials,camera:e.ref.camera,player:e.ref.player,canvas2d:e.ref.canvas2d}}load(){return new Promise((e,t)=>{this.toLoad=0,this.onLoad=()=>{--this.toLoad<=0&&e()},this.interactionPoints=[],this.updateCallbacks=[],this.meshes=[],this.toLoad+=1,this.loader.loadFBX("final/peripherals").then(e=>{this.ref.materials.conformGroup(e),this.ref.scene.scene.add(e),this.meshes.push(e),this.applyToMeshes(e,e=>{-1!==e.material.name.indexOf("transparent")&&(this.ref.materials.applyAlphaMap(e.material,e.material.map),e.material.side=THREE.DoubleSide)}),this.onLoad()}),this.envMap=this.ref.materials.createEnvMap("xavier/env"),this.loadVectorField(),this.loadExploders(),this.loadOscillators(),this.loadIntersectors(),this.loadPlatformer(),this.loadGameOfLife(),this.loadPulses(),this.loadMez()})}loadVectorField(){const e=[],t=new THREE.Vector3(-8,4.5,8);this.updateCallbacks.push(i=>{if(this.ref.player.position.z>8&&Math.abs(this.ref.player.position.x-t.x)<=16&&Math.cos(this.ref.player.rotation.x)<.5){const t=i*Math.PI/8;e.forEach(e=>{e.rotation.x+=t,e.rotation.y-=t,e.rotation.z+=t})}});for(let i=t.x-5.375;i<=t.x+5.375;i+=.25)for(let s=t.y-2;s<=t.y+2;s+=.25){const t=new THREE.Mesh(new THREE.BoxBufferGeometry(.045,.25,.045),this.ref.materials.mat.neon),r=Math.sin((i+s)/5)*Math.PI,o=Math.cos(i/5)*Math.PI,a=Math.sin((2*i+s/2)/5)*Math.PI;t.rotation.set(r,o,a),t.position.set(i,s,8.05),this.ref.scene.scene.add(t),this.meshes.push(t),e.push(t)}const i=new T(this.ref.player,new THREE.Vector3(-8,.5,14),t);this.interactionPoints.push(new E(t,4,3,()=>{i.apply()},this.ref.camera.camera,new THREE.Vector3(0,0,1)))}loadExploders(){const e=10.75,t=[],i=new THREE.Vector3(8,4.5,8);for(let s=0;s<130;++s){const s=new THREE.Group,r=.25,o=new THREE.Mesh(new THREE.BoxBufferGeometry(.05+r,.05,.05),this.ref.materials.mat.neon),a=new THREE.Mesh(new THREE.BoxBufferGeometry(.05,.05+r,.05),this.ref.materials.mat.neon);s.add(o),s.add(a);const n=(Math.random()-.5)*e,h=4*(Math.random()-.5);s.position.set(i.x+n,i.y+h,i.z),s.vec=new THREE.Vector2,s.rotation.z=Math.random()>.5?Math.PI/4:0,this.ref.scene.scene.add(s),this.meshes.push(s),t.push(s)}let s=0;this.updateCallbacks.push(r=>{if(this.ref.player.position.z>8&&Math.abs(this.ref.player.position.x-i.x)<=12&&Math.cos(this.ref.player.rotation.x)<.5){if((s+=r)>1){const r=new THREE.Vector3(i.x+(Math.random()-.5)*e,i.y+4*(Math.random()-.5),i.z),o=.5+3.5*Math.random();t.forEach(e=>{const t=e.position.distanceTo(r);t<=o&&(e.vec.set(e.position.x-r.x,e.position.y-r.y),e.vec.normalize(),e.vec.multiplyScalar(2*(o-t)))}),s-=1}t.forEach(t=>{t.position.x+=t.vec.x*r,t.position.y+=t.vec.y*r,t.rotation.z+=(t.vec.x+t.vec.y)*r,Math.abs(t.position.x-i.x)>e/2&&(t.vec.x*=-1,t.position.x+=t.vec.x*r),Math.abs(t.position.y-i.y)>2&&(t.vec.y*=-1,t.position.y+=t.vec.y*r),t.vec.x-=.4*t.vec.x*r,t.vec.y-=.4*t.vec.y*r})}});const r=new T(this.ref.player,new THREE.Vector3(8,.5,14),i);this.interactionPoints.push(new E(i,4,3,()=>{r.apply()},this.ref.camera.camera,new THREE.Vector3(0,0,1)))}loadOscillators(){const e=[];let t=0;this.updateCallbacks.push(i=>{if(this.ref.player.position.z>8&&Math.abs(this.ref.player.position.x+8)<=16){t+=i;for(let i=0;i<e.length;i++){const s=t+.125*i,r=s%2/2,o=w(s%4<2?1-r:r),a=.3+i%3*.3;e[i].position.z=23-a*o}}}),this.loader.loadFBX("final/oscillators/oscillators").then(t=>{this.ref.materials.conformGroup(t),this.ref.scene.scene.add(t),this.meshes.push(t),this.applyToMeshes(t,t=>{t.scale.x=Math.random()>.5?.85:.95,t.scale.y=Math.random()>.5?.85:.95,e.push(t)}),e.reverse()});const i=new THREE.Vector3(-8,7.75,23),s=new T(this.ref.player,new THREE.Vector3(-8,.5,14),i);this.interactionPoints.push(new E(i,3,6,()=>{s.apply()},this.ref.camera.camera,new THREE.Vector3(0,0,-1)))}loadIntersectors(){const e=[];for(let t=2.75;t<14.75;t+=.125){const i=new THREE.Mesh(new THREE.BoxBufferGeometry(3,.05,.05),this.ref.materials.mat.neon);i.position.set(8,t,23),this.ref.scene.scene.add(i),this.meshes.push(i),e.push(i)}this.updateCallbacks.push(t=>{this.ref.player.position.z>8&&Math.abs(this.ref.player.position.x-8)<=32&&(t=>{for(let i=0;i<e.length;++i){const s=e[i];s.position.y-=t,s.position.y<=2.75&&(s.position.y+=12);let r=1-(s.position.y-2.75)/12;r=i%6==0?Math.sin(r*Math.PI):r,s.scale.x=Math.max(.001,r),s.position.x=8+(i%2?1:-1)*(1-r)*1.5}})(t)});const t=new THREE.Vector3(8,7.75,23),i=new T(this.ref.player,new THREE.Vector3(8,.5,14),t);this.interactionPoints.push(new E(t,3,6,()=>{i.apply()},this.ref.camera.camera,new THREE.Vector3(0,0,-1)))}loadPlatformer(){const e=[];this.updateCallbacks.push(t=>{this.ref.player.position.z<6&&e.forEach(e=>{e.rotation.x-=t*Math.PI/12,Math.random()>.99&&(e.material.emissiveIntensity=1==e.material.emissiveIntensity?0:1)})}),this.loader.loadFBX("final/platformer/platformer").then(t=>{this.ref.materials.conformGroup(t),this.applyToMeshes(t,t=>{t.material=t.material.clone(),t.material.envMapIntensity=.25,t.material.emissive.setHex(16777215),-1==t.name.indexOf("no_rotate")&&(t.material.envMap=this.envMap,t.material.envMapIntensity=.125,t.rotation.x=Math.random()*Math.PI*2,e.push(t))}),this.ref.scene.scene.add(t),this.meshes.push(t)});const t=new T(this.ref.player,new THREE.Vector3(8,.5,-6),new THREE.Vector3(8,4.5,-12)),i=new T(this.ref.player,new THREE.Vector3(-8,.5,-6),new THREE.Vector3(-8,4.5,-12));this.interactionPoints.push(new E(new THREE.Vector3(8,4.5,-12),2,2,()=>{t.apply()},this.ref.camera.camera,new THREE.Vector3(0,0,1)),new E(new THREE.Vector3(-8,4.5,-12),2,2,()=>{i.apply()},this.ref.camera.camera,new THREE.Vector3(0,0,1)))}loadGameOfLife(){const e=new THREE.Vector3(-8,4.5,4),t=Math.ceil(20)+1,i=Math.ceil(7)+1,s=[];for(let r=0;r<i;++r)for(let i=0;i<t;++i){const t=e.x-5+.5*i,o=e.y-1.75+.5*r,a=new THREE.Mesh(new THREE.PlaneBufferGeometry(.5,.5),this.ref.materials.mat.neon);a.position.set(t,o,3.95),a.rotation.x=Math.PI,a.state={alive:Math.random()>.75?1:0,nextAlive:0,x:i,y:r,x1:t,x2:t+16},this.ref.scene.scene.add(a),this.meshes.push(a),s.push(a)}const r=(e,r)=>{s[(r=r<0?r+i:r>=i?r-i:r)*t+(e=e<0?e+t:e>=t?e-t:e)].state.alive=1},o=(e,r)=>s[(r=r<0?r+i:r>=i?r-i:r)*t+(e=e<0?e+t:e>=t?e-t:e)].state.alive;let a=0,n=10;const h=e=>{if(n-=e,(a+=e)>=.18&&(a-=.18,s.forEach(e=>{const t=((e,t)=>o(e-1,t-1)+o(e,t-1)+o(e+1,t-1)+o(e-1,t)+o(e+1,t)+o(e-1,t+1)+o(e,t+1)+o(e+1,t+1))(e.state.x,e.state.y);e.state.nextAlive=3==t||2==t&&e.state.alive?1:0}),s.forEach(e=>{e.state.alive=e.state.nextAlive,e.state.alive?e.position.x=e.state.x1:(e.position.x=e.state.x2,e.scale.x)})),n<0){n+=10;const e=Math.floor(t/2-4),s=Math.floor(i/2-4);for(let t=e;t<e+8;t++)for(let e=s;e<s+8;e++)Math.random()>.5&&r(t,e)}};this.updateCallbacks.push(e=>{this.ref.player.position.z<4&&this.ref.player.position.x<18&&this.ref.player.position.x>-18&&Math.cos(this.ref.player.rotation.x)>-.4&&h(e)});const l=new THREE.Vector3(e.x+16,e.y,e.z),c=new T(this.ref.player,new THREE.Vector3(-8,.5,-2),e),p=new T(this.ref.player,new THREE.Vector3(8,.5,-2),l);this.interactionPoints.push(new E(e,4,3,()=>{c.apply()},this.ref.camera.camera,new THREE.Vector3(0,0,-1)),new E(l,4,3,()=>{p.apply()},this.ref.camera.camera,new THREE.Vector3(0,0,-1))),h(.18)}loadPulses(){const e=new THREE.Mesh(new THREE.BoxBufferGeometry(.125,.5,.5),this.ref.materials.mat.neon),t=new THREE.Mesh(new THREE.BoxBufferGeometry(.125,.5,.5),this.ref.materials.mat.neon);e.position.set(30.375,5.625,14),t.position.set(30.375,11.625,14),this.ref.scene.scene.add(e),this.ref.scene.scene.add(t),this.meshes.push(e),this.meshes.push(t);const i=new THREE.Vector3(30.275,8.625,14);this.updateCallbacks.push(s=>{if(this.ref.player.position.x>0){const s=this.ref.player.position.distanceTo(i),r=s<24?s>8?1-(s-8)/16:1:0,o=1+3*r+Math.random()*r*.5,a=1+3*r+Math.random()*r*.5;e.scale.set(1,o,o),t.scale.set(1,a,a)}});const s=new T(this.ref.player,new THREE.Vector3(20,1,14),i);this.interactionPoints.push(new E(i,3,4,()=>{s.apply()},this.ref.camera.camera,new THREE.Vector3(-1,0,0)))}loadMez(){const e=[],t=[];let i=6.375;for(let s=9.925;s<=13.175;s+=.25){const r=new THREE.Mesh(new THREE.BoxBufferGeometry(4.4,.075,.075),this.ref.materials.mat.neon),o=new THREE.Mesh(new THREE.BoxBufferGeometry(.075,4.3,.075),this.ref.materials.mat.neon);r.position.set(-8,s,-11.5),o.position.set(i,11.75,-11.5),r.refY=s,o.refX=i,this.ref.scene.scene.add(r),this.ref.scene.scene.add(o),this.meshes.push(r),this.meshes.push(o),e.push(r),t.push(o),i+=.25}let s=0;const r=i=>{s+=i,e.forEach(e=>{const t=Math.sin((e.refY+s)*Math.PI/2);e.position.y=e.refY+.25*t}),t.forEach(e=>{const t=Math.sin((e.refX+s)*Math.PI/2);e.position.x=e.refX+.25*t})};this.updateCallbacks.push(e=>{this.ref.player.position.z<6&&Math.cos(this.ref.player.rotation.x)<.5&&r(e)}),r(0);const o=new T(this.ref.player,new THREE.Vector3(8,7.7,-6),new THREE.Vector3(8,11.675,-12)),a=new T(this.ref.player,new THREE.Vector3(-8,7.7,-6),new THREE.Vector3(-8,11.675,-12));this.interactionPoints.push(new E(new THREE.Vector3(8,11.675,-12),2,2,()=>{o.apply()},this.ref.camera.camera,new THREE.Vector3(0,0,1)),new E(new THREE.Vector3(-8,11.675,-12),2,2,()=>{a.apply()},this.ref.camera.camera,new THREE.Vector3(0,0,1)))}unload(){this.interactionPoints.forEach(e=>{e.delete()}),this.meshes.forEach(e=>{this.ref.scene.scene.remove(e)})}isLoaded(){return this.toLoad<=0}applyToMeshes(e,t){e.isMesh?t(e):e.children&&e.children.forEach(e=>{this.applyToMeshes(e,t)})}mouseMove(e,t){let i=!1;return this.interactionPoints&&this.interactionPoints.forEach(s=>{i=s.mouseMove(e,t)||i}),i}click(e,t){if(this.interactionPoints){const i=[];this.interactionPoints.forEach(s=>{s.mouseMove(e,t)&&i.push(s)});const s=this.getNearest(i);s&&s.click(e,t)}}getNearest(e){let t=null,i=null;return e.forEach(e=>{const s=e.position.distanceTo(this.ref.player.position);(null===i||s<i)&&(t=e,i=s)}),t}update(e){this.ribbons,this.interactionPoints&&this.interactionPoints.forEach(e=>{e.update()}),this.updateCallbacks.forEach(t=>{t(e)})}render(){if(this.interactionPoints){this.ref.canvas2d.ctx.globalAlpha=1;const e=[];this.interactionPoints.forEach(t=>{t.onscreen&&t.hover&&e.push(t)});const t=this.getNearest(e);t&&this.ref.canvas2d.drawBoxHint(t.box.position.x,t.box.position.y,t.box.width/2,t.box.height/2,5,t.label)}}};var x=class{constructor(e){this.ref={materials:e.ref.materials,scene:e.ref.scene}}load(){return new Promise((e,t)=>{this.loadModels(),e()})}loadModels(){this.assets=[{src:"jack_de_lacy/sculpture_1",scale:.6,rot:Math.PI/32,orientZ:Math.PI/4},{src:"jack_de_lacy/sculpture_2",scale:.5,rot:-Math.PI/32,orientZ:0},{src:"jack_de_lacy/sculpture_3",scale:.5,rot:Math.PI/32,orientZ:0}];const e=new l("assets");for(var t=0;t<this.assets.length;++t){const i=t;e.loadFBX(this.assets[i].src).then(e=>{e.children.forEach(e=>{this.ref.materials.conformMaterial(e.material),e.material=this.ref.materials.createCustomMaterial(e.material,"\n      vec4 mvp = modelMatrix * vec4(position, 1.0);\n      float theta = sin(time * 0.1 + mvp.x / 2.0);\n      float c = cos(theta);\n      float s = sin(theta);\n      float off = 1.0 * sin(time + position.x * 200.0);\n      mat3 roty = mat3(c, 0, s, 0, 1, 0, -s, 0, c);\n      // mat4 m = mat4(1, 0, 0, 0, 0, 1, 0, s * off * 2.0, 0, 0, 1, s * off, 0, 0, 0, 1);\n      vec3 p = position;\n      vec4 t = vec4(p.x + 0.25 * sin(time + p.y), p.y, p.z + 0.25 * cos(time + p.y), 1.0);\n      vec3 transformed = vec3(t.x, t.y, t.z);\n      vNormal = vNormal * roty;\n    "),e.material.envMapIntensity=.25,2==i&&(e.material.side=THREE.DoubleSide)}),e.scale.multiplyScalar(this.assets[i].scale),e.rotation.z=this.assets[i].orientZ,e.position.set(12*i-12,14,6),this.ref.scene.scene.add(e),this.assets[i].object=e},e=>{console.log(e)})}}unload(){this.assets.forEach(e=>{this.ref.scene.scene.remove(e.object)})}update(e){this.assets.forEach(t=>{t.object&&(t.object.rotation.y+=t.rot*e)})}};var M=class{constructor(e){this.ref={scene:e.ref.scene,materials:e.ref.materials}}load(){return new Promise((e,t)=>{this.loadModels(),e()})}loadModels(){this.assets=[],new l("assets").loadFBX("tiyan/separators").then(e=>{this.ref.materials.conformGroup(e),this.ref.scene.scene.add(e),this.assets.push(e)});const e=new THREE.Mesh(new THREE.BoxBufferGeometry(14,4,1.5),new THREE.MeshStandardMaterial({})),t=new THREE.Mesh(new THREE.BoxBufferGeometry(1.5,4,16),new THREE.MeshStandardMaterial({}));e.position.set(-23,1,6),t.position.set(17.25,1,15.5),this.ref.scene.colliderSystem.add(e),this.ref.scene.colliderSystem.add(t)}unload(){this.assets.forEach(e=>{this.ref.scene.scene.remove(e)})}};var R=class{constructor(e){this.ref={scene:e.ref.scene,player:e.ref.player,materials:e.ref.materials}}load(){return new Promise((e,t)=>{this.loadModels(),e()})}loadModels(){const e=new l("assets");this.assets=["brenton/crash7/crash_7","brenton/crash8/crash_8","brenton/crash9/crash_9","brenton/crash11/crash_11","brenton/crash12/crash_12","brenton/crash13/crash_13","brenton/new_crashform/new_crashform"].map(e=>({src:e})),this.assets.forEach(t=>{e.loadFBX(t.src).then(e=>{this.ref.materials.conformGroup(e),this.ref.scene.scene.add(e),t.object=e,t.sparks=[],t.children=[],t.smokeMat=new THREE.MeshPhongMaterial({transparent:!0,side:THREE.DoubleSide,opacity:.25});const i=this.ref.materials.getTexture("brenton/smoke.png");t.smokeMat.map=i,-1!=t.src.indexOf("12")&&(t.isLong=!0,t.radius=40);let s=0,r=new THREE.Vector3;e.children.forEach(e=>{"Mesh"==e.type?(this.setInstallation(e),t.children.push(e),r.add(e.position),s+=1):"Group"==e.type&&e.children.forEach(e=>{"Mesh"==e.type&&(this.setInstallation(e),t.children.push(e))})}),0!=s&&r.divideScalar(s),t.position=r})})}unload(){this.assets.forEach(e=>{e.isMesh?this.ref.scene.scene.remove(e):e.object&&(this.ref.scene.scene.remove(e.object),e.sparks&&e.sparks.forEach(e=>{this.ref.scene.scene.remove(e.object)}))})}setInstallation(e){const t=new THREE.MeshPhysicalMaterial({});t.map=e.material.map?e.material.map:null,t.map||(t.color=e.material.color,t.emissive=e.material.color,t.emissiveIntensity=.1),t.envMap=this.ref.materials.envMap,t.envMapIntensity=.5,t.normalMap=e.material.normalMap?e.material.normalMap:null,t.metalness=e.material.metalness?e.material.metalness:.75,t.roughness=e.material.roughness?e.material.roughness:.5,t.side=THREE.DoubleSide,e.material.transparent&&(t.transparent=!0,t.opacity=e.material.opacity),t.map&&(t.map.wrapS=t.map.wrapT=THREE.ClampToEdgeWrapping,t.map.minFilter=THREE.LinearFilter),t.normalMap&&(t.normalMap.wrapS=t.normalMap.wrapT=THREE.ClampToEdgeWrapping,t.normalMap.minFilter=THREE.LinearFilter),e.material=t,e.customPos={},e.customPos.x={max:e.position.x+.25,min:e.position.x-.25},e.customPos.y={max:e.position.y+.25,min:e.position.y-.25},e.customPos.z={max:e.position.z+.25,min:e.position.z-.25};const i=new THREE.Box3;i.setFromObject(e);const s=new THREE.Vector3;i.getSize(s);const r=s.x>4||s.y>4||s.z>4;e.animType=Math.random()>.3||r?"jitter":"rotate",e.rotationAxis=Math.random()>.5?"y":"x",e.name&&-1!=e.name.indexOf("spin")&&(e.animType="rotate",e.rotationAxis="y")}update(e){for(let i=0,s=this.assets.length;i<s;++i)if(this.assets[i].children){const s=this.assets[i],r=3,o=s.radius?s.radius:25,a=this.ref.player.position.distanceTo(s.position),n=a<r?1:Math.max(0,1-(a-r)/(o-r)),h=.0125;if(s.children.forEach(e=>{"jitter"==e.animType?(e.position.x=y(e.position.x+n*(2*Math.random()-1)*h,e.customPos.x.min,e.customPos.x.max),e.position.y=y(e.position.y+n*(2*Math.random()-1)*h,e.customPos.y.min,e.customPos.y.max),e.position.z=y(e.position.z+n*(2*Math.random()-1)*h,e.customPos.z.min,e.customPos.z.max)):"rotate"==e.animType&&(e.rotation[e.rotationAxis]+=(2*Math.random()-1)*h*n)}),s.sparks.length<25&&Math.random()<2*n){const e={};if(Math.random()>.45){e.object=new THREE.Mesh(new THREE.BoxBufferGeometry(.02,.02,.04+.5*Math.random()),new THREE.MeshBasicMaterial({color:16777215})),e.object.position.copy(s.position),e.object.position.x+=s.isLong?20*Math.random()-10:4*Math.random()-2,e.object.position.y+=3*Math.random()-1.5,e.object.position.z+=4*Math.random()-2,e.vec=new THREE.Vector3(2*Math.random()-1,2*Math.random()-1,2*Math.random()-1),e.vec.normalize(),e.vec.multiplyScalar(5+15*Math.random());var t=new THREE.Vector3;t.addVectors(e.object.position,e.vec),e.object.lookAt(t),e.age=0,e.maxAge=.125+.25*Math.random()}else e.object=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),s.smokeMat),e.object.position.copy(s.position),e.object.position.x+=s.isLong?6*Math.random()-3:1*Math.random()-.5,e.object.position.y+=1*Math.random()-.5+2,e.object.position.z+=1*Math.random()-.5,e.vec=new THREE.Vector3(2*Math.random()-1,2*Math.random()-1,2*Math.random()-1),e.vec.normalize(),e.vec.multiplyScalar(2+4*Math.random()),e.object.rotation.set(Math.random(),Math.random(),Math.random()),e.age=0,e.maxAge=.25+.5*Math.random();this.ref.scene.scene.add(e.object),s.sparks.push(e)}for(let t=s.sparks.length-1,i=-1;t>i;t--){const i=s.sparks[t];i.object.position.x+=i.vec.x*e,i.object.position.y+=i.vec.y*e,i.object.position.z+=i.vec.z*e,i.age+=e,i.age>i.maxAge&&(this.ref.scene.scene.remove(i.object),s.sparks.splice(t,1))}}}};var H=function(e,t){return Math.atan2(Math.sin(t-e),Math.cos(t-e))};function k(e,t,i){THREE.Curve.call(this),this.radius=e,this.start=t,this.stop=i}k.prototype=Object.create(THREE.Curve.prototype),k.prototype.constructor=k,k.prototype.getPoint=function(e){const t=this.start+(this.stop-this.start)*e;var i=Math.cos(t)*this.radius,s=Math.sin(t)*this.radius;return new THREE.Vector3(0,s,i)};const S=Math.PI/32;var P=(e,t,i,s,r)=>{i+=i<0?2*Math.PI:0,s+=s<0?2*Math.PI:0,r=void 0!==r?r:Math.round(Math.max(8,Math.abs(H(i,s))/S));const o=new k(e,i,s),a=new THREE.TubeGeometry(o,r,t,8,!1),n=new THREE.MeshBasicMaterial({});return new THREE.Mesh(a,n)};var z=(e,t,i,s)=>{const r=i.x-e.x,o=i.y-e.y,a=s.x-e.x,n=s.y-e.y,h=a-r,l=n-o,c=Math.sqrt(h*h+l*l),p=r*n-a*o,u=c*c,d=t*t*u-p*p;if(d<=0)return null;const m=(p*l-h*Math.sqrt(d))/u+e.x,f=(-p*h+Math.abs(l)*Math.sqrt(d))/u+e.y,v=(Math.sqrt(d),e.x,Math.abs(l),Math.sqrt(d),e.y,i.x,s.x,i.y,s.y,m),g=f;return new THREE.Vector2(v,g)};var L=class{constructor(e){this.ref={materials:e.ref.materials,scene:e.ref.scene}}load(){return new Promise((e,t)=>{this.loadModels(),e()})}loadModels(){this.toUnload=[],this.meshes=[],this.age=0;for(let e=0;e<=1;e+=.025){const t=this.makeDoor(5,6,.07),i=30*(e<.5?2*e*e:(4-2*e)*e-1)-15;t.position.set(i,11,-7.25),this.ref.scene.scene.add(t),this.toUnload.push(t)}}makeDoor(e,t,i){const s=e/2-i/2,r=t/2-i/2,o=new THREE.Group,a=new THREE.MeshStandardMaterial({color:12325886,emissive:0,metalness:.5,roughness:.4}),n=new THREE.MeshStandardMaterial({color:16646554,emissive:0,metalness:.5,roughness:.4}),h=new THREE.Mesh(new THREE.BoxBufferGeometry(i,t,i),a),l=new THREE.Mesh(new THREE.BoxBufferGeometry(i,t,i),n);h.position.z=s,l.position.z=-s,o.add(h,l);const c=new THREE.Vector2(-s,r),p=new THREE.Vector2(s,r),u=new THREE.Vector2(-s,-r),d=new THREE.Vector2(s,-r),m=new THREE.Vector2(2*-s,.5),f=1.25*e,v=z(m,f,c,p),g=z(m,f,u,d),y=Math.atan2(v.y-m.y,v.x-m.x),E=Math.atan2(g.y-m.y,g.x-m.x),w=P(f,i,E,y),T=w.clone();w.position.set(0,m.y,m.x+.25+1.75*f),T.position.set(0,m.y,m.x-.25+1.75*f),w.material=a,T.material=n,o.add(w,T);const b=new THREE.Mesh(new THREE.BoxBufferGeometry(i,i,1),a),x=new THREE.Mesh(new THREE.BoxBufferGeometry(i,i,1),n),M=new THREE.Mesh(new THREE.BoxBufferGeometry(i,i,1),a),R=new THREE.Mesh(new THREE.BoxBufferGeometry(i,i,1),n);b.position.y=r,x.position.y=r,M.position.y=-r,R.position.y=-r,o.add(b,x,M,R);const H={arc1:{z:w.position.z},arc2:{z:T.position.z},T:{L:v.x+w.position.z-m.x,R:v.x+T.position.z-m.x},B:{L:g.x+w.position.z-m.x,R:g.x+T.position.z-m.x},left:s,right:-s,age:0,step:Math.PI/12,update:(e,t)=>{H.age+=e;const i=Math.sin(H.age+t*H.step);w.position.z=H.arc1.z+i,T.position.z=H.arc2.z+i;const s=H.T.L+i,r=H.T.R+i,o=H.B.L+i,h=H.B.R+i;b.position.z=H.left+(s-H.left)/2,x.position.z=H.right+(r-H.right)/2,M.position.z=H.left+(o-H.left)/2,R.position.z=H.right+(h-H.right)/2,b.scale.z=Math.abs(s-H.left),x.scale.z=Math.abs(r-H.right),M.scale.z=Math.abs(o-H.left),R.scale.z=Math.abs(h-H.right);const l=H.age/2+.25*t;if(l%6<=2){const e=Math.sin(l%6/2*Math.PI);a.emissive.setScalar(e),n.emissive.setScalar(e)}}};return o.anim=H,this.toUnload.push(o),this.meshes.push(o),o}unload(){this.toUnload.forEach(e=>{this.ref.scene.scene.remove(e)})}update(e){this.age+=e/2;let t=0;this.meshes.forEach(i=>{i.anim.update(e,t++)})}};var I=class{constructor(){}bind(e){this.ref={},this.ref.scene=e.modules.scene,this.ref.materials=e.modules.materials,this.ref.player=e.modules.player,this.ref.camera=e.modules.camera,this.ref.canvas2d=e.modules.canvas2d}load(e,t){if(this.exhibition&&void 0!==this.exhibition.unload&&this.exhibition.unload(),this.exhibition=null,e)switch(e.customValue){case"CEMENT":this.exhibition=new L(this);break;case"XAVIER":this.exhibition=new b(this);break;case"JACK_DE_LACY":this.exhibition=new x(this);break;case"TIYAN":this.exhibition=new M(this);break;case"BRENTON":this.exhibition=new R(this)}this.exhibition?this.exhibition.load().then(()=>{console.log("Custom exhibition loaded:",e.customValue),t()}):t()}isLoaded(){return null===this.exhibition||void 0===this.exhibition.isLoaded||this.exhibition.isLoaded()}mouseMove(e,t){return!(!this.exhibition||void 0===this.exhibition.mouseMove)&&this.exhibition.mouseMove(e,t)}click(e,t){this.exhibition&&void 0!==this.exhibition.click&&this.exhibition.click(e,t)}update(e){this.exhibition&&void 0!==this.exhibition.update&&this.exhibition.update(e)}render(){this.exhibition&&void 0!==this.exhibition.render&&this.exhibition.render()}};var C=class{constructor(){this.assets={},this.loader=new l("assets"),this.customExhibition=new I}bind(e){this.ref={},this.ref.root=e,this.ref.scene=e.modules.scene,this.ref.player=e.modules.player,this.ref.materials=e.modules.materials,this.customExhibition.bind(e)}load(e){return new Promise((t,i)=>{const s=()=>{this.isLoaded()&&this.customExhibition.isLoaded()&&t()};this.toLoad=2,this.onLoad=()=>{this.toLoad-=1,this.toLoad<=0&&(console.log("Default map loaded"),s())},this.customExhibition.load(e,s),this.loadDefaultExhibition(s)})}isLoaded(){return this.toLoad<=0}loadDefaultExhibition(e){if(this.assets.defaultCollisionMap?(this.onLoad(),this.addCollisionMap(this.assets.defaultCollisionMap)):this.loader.loadOBJ("collision").then(e=>{this.assets.defaultCollisionMap=e,this.addCollisionMap(this.assets.defaultCollisionMap),this.onLoad()},e=>{console.log(e)}),this.assets.map?(this.ref.materials.conformGroup(this.assets.map),this.onLoad()):this.loader.loadFBX("map").then(e=>{this.ref.scene.scene.add(e),this.ref.materials.conformGroup(e),this.assets.map=e,this.onLoad()},e=>{console.log(e)}),this.assets.floor||(this.assets.floor=new THREE.Mesh(new THREE.BoxBufferGeometry(100,1,100),new THREE.MeshPhongMaterial({})),this.assets.floor.position.y=-.25),this.addCollisionMap(this.assets.floor),this.assets.props||this.loader.loadFBX("props").then(e=>{this.assets.props=e,this.ref.scene.scene.add(e),this.ref.materials.conformGroup(e)}),!this.assets.ceilingLights){const e=.1,i=4;for(var t=-16;t<=16;t+=8){const s=19,r=new THREE.Mesh(new THREE.BoxBufferGeometry(e,e,i),this.ref.materials.mat.neon),o=new THREE.Mesh(new THREE.BoxBufferGeometry(e,4*e,i),this.ref.materials.mat.dark),a=new THREE.Mesh(new THREE.BoxBufferGeometry(e,1,e),this.ref.materials.mat.dark),n=a.clone();r.position.set(t,s,6),o.position.set(t,s+2.5*e,6),a.position.set(t,s+4.5*e+.5,6+i/3),n.position.set(t,s+4.5*e+.5,6-i/3),a.rotation.y=Math.PI/4,n.rotation.y=Math.PI/4,this.ref.scene.scene.add(r,o,a,n)}this.assets.ceilingLights=!0}}addCollisionMap(e){"Mesh"===e.type?this.ref.scene.colliderSystem.add(e):e.children&&e.children.length&&e.children.forEach(e=>{this.addCollisionMap(e)})}update(e){this.ref.materials.update(e),this.customExhibition.update(e)}render(){this.customExhibition.render()}};var A=class{constructor(){this.path=`${APP_ROOT}/assets/`,this.mat={},this.mat.default=new THREE.MeshPhysicalMaterial({emissive:0,roughness:1,envMapIntensity:.25}),this.mat.porcelain=new THREE.MeshPhysicalMaterial({color:16777215,emissive:8947848,emissiveIntensity:.6,roughness:.55,metalness:.125,envMapIntensity:.5}),this.mat.metal=new THREE.MeshPhysicalMaterial({color:11046521,emissive:0,roughness:.25,metalness:1,envMapIntensity:.5}),this.mat.neon=new THREE.MeshPhysicalMaterial({emissive:16777215,emissiveIntensity:1}),this.envMap=this.createEnvMap("envmap"),this.envMapIntensity=.5,this.normalMap=(new THREE.TextureLoader).load(this.path+"textures/noise.jpg"),this.normalMap.wrapS=this.normalMap.wrapT=THREE.RepeatWrapping,this.normalMap.repeat.set(32,32),Object.keys(this.mat).forEach(e=>{this.mat[e].type&&"MeshPhysicalMaterial"===this.mat[e].type&&(this.mat[e].envMap=this.envMap)}),this.mat.dark=new THREE.MeshPhysicalMaterial({color:0,roughness:.5,metalness:0}),this.uniforms={time:{value:0}},this.loaded={}}bind(e){}load(e){if(this.envMapDisabled=!1,e)switch(e.customValue){case"XAVIER":this.envMapDisabled=!0}}createEnvMap(e){const t=["posx","negx","posy","negy","posz","negz"].map(t=>`${this.path}${e}/${t}.jpg`);return(new THREE.CubeTextureLoader).load(t)}getTexture(e){return(new THREE.TextureLoader).load(this.path+e)}conformGroup(e){"Mesh"===e.type?this.conformMaterial(e.material):e.children&&e.children.length&&e.children.forEach(e=>{this.conformGroup(e)})}conformMaterial(e){this.loaded[e.name]||(this.loaded[e.name]=e),this.addEnvironmentMap(e),this.applyMaterialSettings(e)}applyMaterialSettings(e){e.name&&("conrete"===e.name?(e.normalScale.x=.25,e.normalScale.y=.25):-1!==e.name.indexOf("neon")?(e.emissive=new THREE.Color(1,1,1),e.emissiveIntensity=1):"nu_metal"===e.name&&(e.normalScale.x=.25,e.normalScale.y=.25))}addEnvironmentMap(e){this.envMapDisabled?(e.envMap=null,e.envMapIntensity=0):(e.envMap=this.envMap,e.envMapIntensity=this.envMapIntensity)}createCustomMaterial(e,t,i){const s=e.clone();return s.onBeforeCompile=e=>{e.vertexShader=`uniform float time;\n${i||""}\n${e.vertexShader}`,e.vertexShader=e.vertexShader.replace("#include <begin_vertex>",t),e.uniforms.time=this.uniforms.time},s}applyAlphaMap(e,t){e.color.setHex(16777215),e.alphaMap=t,e.transparent=!0,e.side=THREE.DoubleSide,e.depthWrite=!1}update(e){this.uniforms.time.value+=e}};var B=(e,t,i)=>e+(t-e)*i;var D=class{constructor(){this.position=new THREE.Vector3(-24,1,16),this.rotation=new THREE.Vector2(.55*Math.PI,-.05*Math.PI),this.motion=new THREE.Vector3,this.target={position:this.position.clone(),rotation:this.rotation.clone(),motion:this.motion.clone()},this.collider=new Collider.Collider(this.target.position,this.motion),this.collider.setPhysics({gravity:20}),this.automove={active:{position:!0,rotation:!0},speed:{current:0,max:7.5,blend:.125},rotationSpeed:{current:0,max:Math.PI/2.5,accum:Math.PI/70},position:this.position.clone(),rotation:new THREE.Vector2(.55*Math.PI,.03*Math.PI),threshold:{position:{outer:2,inner:.02},rotation:Math.PI/1e3}},this.speed=6,this.rotationSpeed=.5*Math.PI,this.jump=8,this.jumpSpeedMultiplier=.25,this.height=3.25,this.falling=!1,this.fallTime=0,this.fallTimeThreshold=.2,this.noclip=!1,this.noclipSpeed=36,this.toggleNoclip=()=>{this.noclip=0==this.noclip},this.minPitch=-.125*Math.PI,this.maxPitch=.125*Math.PI,this.adjust={slow:.05,normal:.1,fast:.125,maximum:.3},this.keys={disabled:!0},this.group=new THREE.Group,this.light=new THREE.PointLight(16777215,.75,12,2),this.light.position.y=this.height+.25,this.group.add(this.light)}bind(e){this.ref={},this.ref.scene=e.modules.scene,this.ref.scene.scene.add(this.group)}load(e){if(this.light.intensity=.75,e)switch(e.customValue){case"XAVIER":this.light.intensity=0}}reset(){this.position.set(-24,1,16),this.rotation.set(.55*Math.PI,-.05*Math.PI),this.target.position.copy(this.position),this.target.rotation.copy(this.rotation),this.automove.active.position=!0,this.automove.active.rotation=!0,this.automove.position.copy(this.position),this.automove.rotation.set(.55*Math.PI,.03*Math.PI)}move(e){if(this.keys.left||this.keys.right){this.automove.active.rotation&&(this.target.rotation.copy(this.rotation),this.automove.active.rotation=!1);const t=(this.keys.left?1:0)+(this.keys.right?-1:0);this.target.rotation.x+=t*this.rotationSpeed*e}if(this.keys.up||this.keys.down){this.automove.active.position&&(this.automove.active.position=!1,this.target.position.copy(this.position));const e=this.noclip?this.noclipSpeed*(1-Math.abs(Math.sin(this.target.rotation.y))):this.speed,t=(this.keys.up?1:0)+(this.keys.down?-1:0);this.target.motion.x=Math.sin(this.rotation.x)*e*t,this.target.motion.z=Math.cos(this.rotation.x)*e*t}else this.target.motion.x=0,this.target.motion.z=0;if(this.keys.jump&&(0==this.motion.y||this.fallTime<this.fallTimeThreshold)&&(this.motion.y=this.jump,this.fallTime=this.fallTimeThreshold),this.falling=0!=this.motion.y,this.fallTime=this.falling?this.fallTime+e:0,this.noclip){if(this.falling=!1,this.keys.up||this.keys.down){const e=(this.keys.up?1:0)+(this.keys.down?-1:0);this.target.motion.y=Math.sin(this.target.rotation.y)*e*this.noclipSpeed}else this.target.motion.y=0;this.motion.y=this.target.motion.y}this.falling?(this.motion.x=B(this.motion.x,this.target.motion.x,this.jumpSpeedMultiplier),this.motion.z=B(this.motion.z,this.target.motion.z,this.jumpSpeedMultiplier)):(this.motion.x=this.target.motion.x,this.motion.z=this.target.motion.z)}moveToArtwork(e){this.position.distanceTo(e.viewPosition)>this.automove.threshold.position.outer&&(this.automove.position.copy(e.viewPosition),this.automove.active.position=!0,this.automove.rotation.copy(e.viewRotation),this.automove.active.rotation=!0)}applyAutomove(e){if(this.automove.active.position){const t=this.automove.position.clone();t.sub(this.position);const i=t.length();if(t.normalize(),i>this.automove.threshold.position.outer)this.automove.speed.current+=(this.automove.speed.max-this.automove.speed.current)*this.automove.speed.blend,t.multiplyScalar(this.automove.speed.current*e),this.position.add(t);else if(i>this.automove.threshold.position.inner){const s=this.automove.speed.max*(i/this.automove.threshold.position.outer);this.automove.speed.current+=(s-this.automove.speed.current)*this.automove.speed.blend,t.multiplyScalar(this.automove.speed.current*e),this.position.add(t)}else this.target.position.copy(this.automove.position),this.automove.active.position=!1,this.keys.disabled=!1}else this.automove.speed.current=0;if(this.automove.active.rotation){this.automove.rotationSpeed.current=Math.min(this.automove.rotationSpeed.current+this.automove.rotationSpeed.accum,this.automove.rotationSpeed.max);const t=H(this.rotation.x,this.automove.rotation.x),i=H(this.rotation.y,this.automove.rotation.y),s=Math.hypot(t,i);this.rotation.x+=t*this.automove.rotationSpeed.current*e,this.rotation.y+=i*this.automove.rotationSpeed.current*e,s<this.automove.threshold.rotation&&(this.automove.active.rotation=!1,this.target.rotation.copy(this.automove.rotation))}else this.automove.rotationSpeed.current=0}setRotation(e,t){this.target.rotation.y=e,this.target.rotation.x=t,this.automove.active.rotation=!1}getTargetPosition(){return this.target.position}update(e){this.applyAutomove(e),this.keys.disabled||this.automove.active.position||(this.move(e),this.noclip?(this.target.position.x+=this.motion.x*e,this.target.position.y+=this.motion.y*e,this.target.position.z+=this.motion.z*e):this.collider.move(e,this.ref.scene.colliderSystem),this.position.x=B(this.position.x,this.target.position.x,this.adjust.maximum),this.position.y=B(this.position.y,this.target.position.y,this.adjust.maximum),this.position.z=B(this.position.z,this.target.position.z,this.adjust.maximum)),this.automove.active.rotation||(this.rotation.x+=H(this.rotation.x,this.target.rotation.x)*this.adjust.normal,this.rotation.y=B(this.rotation.y,this.target.rotation.y,this.adjust.normal)),this.group.position.set(this.position.x,this.position.y,this.position.z)}};i(2),i(3),i(4),i(5),i(6),i(7),i(8);var V=class{constructor(){this.renderer=new THREE.WebGLRenderer({}),this.renderer.setClearColor(16768734,1),this.renderer.gammaInput=!0,this.renderer.gammaOutput=!0,this.renderer.gammaFactor=2.25,document.querySelector("#canvas-target").appendChild(this.renderer.domElement)}bind(e){this.ref={},this.ref.scene=e.modules.scene.scene,this.ref.camera=e.modules.camera.camera,this.width=n.renderer.getWidth(),this.height=n.renderer.getHeight(),this.size=new THREE.Vector2(this.width,this.height),this.passRender=new THREE.RenderPass(this.ref.scene,this.ref.camera),this.passBloom=new THREE.UnrealBloomPass(this.size,.5,.125,.96),this.composer=new THREE.EffectComposer(this.renderer),this.composer.addPass(this.passRender),s()?this.passRender.renderToScreen=!0:(this.composer.addPass(this.passBloom),this.passBloom.renderToScreen=!0),this.resize(),window.addEventListener("resize",()=>{this.resize()})}resize(){this.width=n.renderer.getWidth(),this.height=n.renderer.getHeight(),this.size.set(this.width,this.height),this.renderer.setSize(this.width,this.height),this.composer.setSize(this.width,this.height),this.passBloom.setSize(this.width,this.height)}render(e){this.composer.render(e)}};var F=class{constructor(){this.scene=new THREE.Scene}bind(e){this.ref={}}reset(){this.colliderSystem=new Collider.System}};var _=class{constructor(e){this.active=!1,this.position={x:0,y:0},this.origin={x:0,y:0},this.delta={x:0,y:0},this.domTarget=e.domTarget,this.onMouseDownCallback=e.onMouseDown||null,this.onMouseUpCallback=e.onMouseUp||null,this.onMouseMoveCallback=e.onMouseMove||null,this.resize(),window.addEventListener("resize",()=>{this.resize()}),s()?(this.domTarget.addEventListener("touchstart",e=>{e.preventDefault(),e.touches&&e.touches.length&&this.onMouseDown(e.touches[0])}),this.domTarget.addEventListener("touchmove",e=>{e.preventDefault(),e.touches&&e.touches.length&&this.onMouseMove(e.touches[0])}),this.domTarget.addEventListener("touchend",e=>{e.preventDefault(),this.onMouseUp(e)})):(this.domTarget.addEventListener("mousedown",e=>{this.onMouseDown(e)}),this.domTarget.addEventListener("mousemove",e=>{this.onMouseMove(e)}),this.domTarget.addEventListener("mouseup",e=>{this.onMouseUp(e)}),this.domTarget.addEventListener("mouseleave",e=>{this.onMouseUp(e)}))}onMouseDown(e){this.active=!0,this.origin.x=e.clientX-this.left,this.origin.y=e.clientY-this.top,this.delta.x=0,this.delta.y=0,this.onMouseDownCallback&&this.onMouseDownCallback(e),this.onMouseMove(e)}onMouseMove(e){this.position.x=e.clientX-this.left,this.position.y=e.clientY-this.top,this.active&&(this.delta.x=this.position.x-this.origin.x,this.delta.y=this.position.y-this.origin.y),this.onMouseMoveCallback&&this.onMouseMoveCallback(e)}onMouseUp(e){this.active=!1,this.onMouseUpCallback&&this.onMouseUpCallback(e)}resize(){this.left=(window.innerWidth-n.renderer.getWidth())/2,this.top=(window.innerHeight-n.renderer.getHeight())/2}};var j=class{constructor(e){this.keys={},this.onEvent=e,document.addEventListener("keydown",e=>{this.onKeyDown(e)}),document.addEventListener("keyup",e=>{this.onKeyUp(e)})}onKeyDown(e){this.keys[e.key]=!0,this.onEvent(e.key)}onKeyUp(e){this.keys[e.key]=!1,this.onEvent(e.key)}release(e){this.keys[e]=!1}isSpecial(){return this.keys.Shift||this.keys.Control||this.keys.Alt}isControl(){return this.keys.Control}isShift(){return this.keys.Shift}isAlt(){return this.keys.Alt}};var N=class{constructor(){this.el={canvasTarget:document.querySelector("#canvas-target"),artworkInfo:document.querySelector("#popup-artwork-info")},this.rotation=new THREE.Vector2,this.timestamp=null,this.isMobile=s(),this.threshold={click:225,pan:200,mouseDelta:this.isMobile?.4:.25},this.scaleRotation={x:this.isMobile?.75:1,y:1},document.querySelectorAll("#gallery-controls .control").forEach(e=>{this.isMobile?(e.addEventListener("touchstart",e=>{e.preventDefault(),this.onControlDown(e.currentTarget)}),e.addEventListener("touchend",e=>{e.preventDefault(),this.onControlUp(e.currentTarget)})):(e.addEventListener("mousedown",e=>{this.onControlDown(e.currentTarget)}),e.addEventListener("mouseup",e=>{this.onControlUp(e.currentTarget)}),e.addEventListener("mouseleave",e=>{this.onControlLeave(e.currentTarget)}))}),this.controls={up:document.querySelector("#ctrl-U"),down:document.querySelector("#ctrl-D"),left:document.querySelector("#ctrl-L"),right:document.querySelector("#ctrl-R")},this.keyboard=new j(e=>{this.onKeyboard(e)}),this.mouse=new _({domTarget:this.el.canvasTarget,onMouseDown:e=>{this.onMouseDown(e)},onMouseMove:e=>{this.onMouseMove(e)},onMouseUp:e=>{this.onMouseUp(e)}})}bind(e){this.ref={},this.ref.scene=e.modules.scene,this.ref.player=e.modules.player,this.ref.canvas2d=e.modules.canvas2d,this.ref.floorPlan=e.modules.floorPlan,this.ref.customExhibition=e.modules.map.customExhibition,this.resize(),window.addEventListener("resize",()=>{this.resize()})}onMouseDown(e){this.rotation.y=this.ref.player.rotation.y,this.rotation.x=this.ref.player.rotation.x,this.timestamp=performance.now(),this.touchMoveTimeout=!1,setTimeout(()=>{this.mouse.active&&(this.touchMoveTimeout=!0)},100)}onMouseMove(e){if(this.mouse.active){if(!this.ref.player.keys.left&&!this.ref.player.keys.right){const t=this.rotation.x+this.mouse.delta.x/this.centre.x*this.scaleRotation.x;let i=this.rotation.y+this.mouse.delta.y/this.centre.y*this.scaleRotation.y;(i=y(i,this.ref.player.minPitch,this.ref.player.maxPitch))!==this.ref.player.minPitch&&i!==this.ref.player.maxPitch||(this.mouse.origin.y=e.clientY-this.mouse.top,this.rotation.y=i),this.ref.player.setRotation(i,t)}}else this.ref.floorPlan.mouseOver(this.mouse.position.x,this.mouse.position.y)||this.ref.customExhibition.mouseMove(this.mouse.position.x,this.mouse.position.y)?this.el.canvasTarget.classList.add("clickable"):this.el.canvasTarget.classList.remove("clickable")}onMouseUp(e){const t=performance.now()-this.timestamp,i=Math.hypot(this.mouse.delta.x,this.mouse.delta.y);t<this.threshold.click&&i<window.innerWidth*this.threshold.mouseDelta&&(this.ref.floorPlan.click(this.mouse.position.x,this.mouse.position.y),this.ref.customExhibition.click(this.mouse.position.x,this.mouse.position.y),this.isMobile&&(e.preventDefault(),e.stopPropagation()))}onControlUp(e){this.ref.player.keys[e.dataset.dir]=!1,e.classList.remove("active")}onControlDown(e){this.ref.player.keys[e.dataset.dir]=!0,e.classList.add("active")}onControlLeave(e){this.onControlUp(e)}onKeyboard(e){if(!this.el.artworkInfo.classList.contains("active"))switch(e){case"a":case"A":case"ArrowLeft":this.ref.player.keys.left=this.keyboard.keys[e],this.controls.left.classList[this.ref.player.keys.left?"add":"remove"]("active");break;case"d":case"D":case"ArrowRight":this.ref.player.keys.right=this.keyboard.keys[e],this.ref.player.keys.right?this.controls.right.classList.add("active"):this.controls.right.classList.remove("active");break;case"w":case"W":case"ArrowUp":this.ref.player.keys.up=this.keyboard.keys[e],this.ref.player.keys.up?this.controls.up.classList.add("active"):this.controls.up.classList.remove("active");break;case"s":case"S":case"ArrowDown":this.ref.player.keys.down=this.keyboard.keys[e],this.ref.player.keys.down?this.controls.down.classList.add("active"):this.controls.down.classList.remove("active");break;case" ":this.ref.player.keys.jump=this.keyboard.keys[e];break;case"x":case"X":if(this.keyboard.keys.x||this.keyboard.keys.X){if(this.keyboard.isControl()){this.ref.player.toggleNoclip();const e=document.querySelector(".gallery__controls");e&&(this.ref.player.noclip?e.classList.add("hidden"):e.classList.remove("hidden"))}this.keyboard.release("x"),this.keyboard.release("X")}}}resize(){this.width=n.renderer.getWidth(),this.height=n.renderer.getHeight(),this.centre={x:this.width/2,y:this.height/2},this.el.canvasTarget.style.width=`${this.width}px`,this.el.canvasTarget.style.height=`${this.height}px`}update(e){this.ref.floorPlan.update(e)}render(){this.ref.canvas2d.clear(),this.ref.floorPlan.draw(this.ref.canvas2d.getContext()),this.ref.canvas2d.promptTouchMove(this.mouse.active&&this.touchMoveTimeout&&Date.now()-this.timestamp>this.threshold.pan),this.ref.player.noclip?(this.ref.canvas2d.promptGodMode(),this.ref.canvas2d.drawDevOverlay()):this.ref.canvas2d.drawDevOverlay()}};var O=class{constructor(){this.isMobile=s(),this.modules={renderer:new V,scene:new F,player:new D,camera:new p,floorPlan:new v,lighting:new g,map:new C,materials:new A,surface:new N,canvas2d:new u}}bind(e){this.ref={},this.ref.nav=e.modules.nav,Object.keys(this.modules).forEach(e=>{this.modules[e].bind(this)}),this.isMobile?this.mobileLoop():this.loop()}load(e){console.log("[Gallery] loading data:",e),this.modules.player.reset(),this.modules.scene.reset(),document.querySelector("#open-gallery-artist").innerText=e&&e.artistName?e.artistName:"",document.querySelector("#open-gallery-prompt").classList.add("loading"),this.modules.player.load(e),this.modules.materials.load(e),this.modules.lighting.load(e),this.modules.map.load(e).then(()=>{this.modules.floorPlan.load(e);const t=document.querySelector("#open-gallery-prompt");t.classList.remove("loading"),t.classList.add("prompt-action")})}start(){this.timer={previous:performance.now()},this.active=!0,document.querySelector("#canvas-target").classList.add("active")}pause(){this.active=!1,document.querySelector("#canvas-target").classList.remove("active")}update(){if(this.active){const e=performance.now(),t=Math.min(.1,(e-this.timer.previous)/1e3);this.timer.previous=e,Object.keys(this.modules).forEach(e=>{this.modules[e].update&&this.modules[e].update(t)}),this.modules.renderer.render(t),this.modules.surface.render(),this.modules.map.render()}}mobileLoop(){setTimeout(()=>{this.mobileLoop()},Math.round(1e3/45)),this.update()}loop(){requestAnimationFrame(()=>{this.loop()}),this.update()}};class U{constructor(){this.modules={gallery:new O,logo:new c,nav:new h},Object.keys(this.modules).forEach(e=>{this.modules[e].bind(this)})}}window.onload=()=>{new U}}]);